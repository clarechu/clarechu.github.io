{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"themes/keep/source/css/font-awesome.min.css","path":"css/font-awesome.min.css","modified":0,"renderable":1},{"_id":"themes/keep/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/keep/source/images/avatar.svg","path":"images/avatar.svg","modified":0,"renderable":1},{"_id":"themes/keep/source/images/bp.jpeg","path":"images/bp.jpeg","modified":0,"renderable":1},{"_id":"themes/keep/source/images/bp.jpg","path":"images/bp.jpg","modified":0,"renderable":1},{"_id":"themes/keep/source/images/loading.svg","path":"images/loading.svg","modified":0,"renderable":1},{"_id":"themes/keep/source/images/bg.svg","path":"images/bg.svg","modified":0,"renderable":1},{"_id":"themes/keep/source/js/back2top.js","path":"js/back2top.js","modified":0,"renderable":1},{"_id":"themes/keep/source/js/code-copy.js","path":"js/code-copy.js","modified":0,"renderable":1},{"_id":"themes/keep/source/js/header-shrink.js","path":"js/header-shrink.js","modified":0,"renderable":1},{"_id":"themes/keep/source/js/lazyload.js","path":"js/lazyload.js","modified":0,"renderable":1},{"_id":"themes/keep/source/js/left-side-toggle.js","path":"js/left-side-toggle.js","modified":0,"renderable":1},{"_id":"themes/keep/source/js/local-search.js","path":"js/local-search.js","modified":0,"renderable":1},{"_id":"themes/keep/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"themes/keep/source/js/toc.js","path":"js/toc.js","modified":0,"renderable":1},{"_id":"themes/keep/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/keep/source/js/dark-light-toggle.js","path":"js/dark-light-toggle.js","modified":0,"renderable":1},{"_id":"themes/keep/source/webfonts/fa-brands-400.eot","path":"webfonts/fa-brands-400.eot","modified":0,"renderable":1},{"_id":"themes/keep/source/webfonts/fa-brands-400.svg","path":"webfonts/fa-brands-400.svg","modified":0,"renderable":1},{"_id":"themes/keep/source/webfonts/fa-brands-400.woff","path":"webfonts/fa-brands-400.woff","modified":0,"renderable":1},{"_id":"themes/keep/source/webfonts/fa-brands-400.woff2","path":"webfonts/fa-brands-400.woff2","modified":0,"renderable":1},{"_id":"themes/keep/source/webfonts/fa-regular-400.eot","path":"webfonts/fa-regular-400.eot","modified":0,"renderable":1},{"_id":"themes/keep/source/webfonts/fa-regular-400.svg","path":"webfonts/fa-regular-400.svg","modified":0,"renderable":1},{"_id":"themes/keep/source/webfonts/fa-regular-400.ttf","path":"webfonts/fa-regular-400.ttf","modified":0,"renderable":1},{"_id":"themes/keep/source/webfonts/fa-regular-400.woff","path":"webfonts/fa-regular-400.woff","modified":0,"renderable":1},{"_id":"themes/keep/source/webfonts/fa-regular-400.woff2","path":"webfonts/fa-regular-400.woff2","modified":0,"renderable":1},{"_id":"themes/keep/source/webfonts/fa-solid-900.eot","path":"webfonts/fa-solid-900.eot","modified":0,"renderable":1},{"_id":"themes/keep/source/webfonts/fa-solid-900.svg","path":"webfonts/fa-solid-900.svg","modified":0,"renderable":1},{"_id":"themes/keep/source/webfonts/fa-solid-900.ttf","path":"webfonts/fa-solid-900.ttf","modified":0,"renderable":1},{"_id":"themes/keep/source/webfonts/fa-solid-900.woff","path":"webfonts/fa-solid-900.woff","modified":0,"renderable":1},{"_id":"themes/keep/source/webfonts/fa-solid-900.woff2","path":"webfonts/fa-solid-900.woff2","modified":0,"renderable":1},{"_id":"themes/keep/source/webfonts/fa-brands-400.ttf","path":"webfonts/fa-brands-400.ttf","modified":0,"renderable":1},{"_id":"themes/keep/source/css/common/animated.styl","path":"css/common/animated.styl","modified":0,"renderable":1},{"_id":"themes/keep/source/css/common/basic.styl","path":"css/common/basic.styl","modified":0,"renderable":1},{"_id":"themes/keep/source/css/common/keep-theme.styl","path":"css/common/keep-theme.styl","modified":0,"renderable":1},{"_id":"themes/keep/source/css/common/markdown.styl","path":"css/common/markdown.styl","modified":0,"renderable":1},{"_id":"themes/keep/source/css/common/variables.styl","path":"css/common/variables.styl","modified":0,"renderable":1},{"_id":"themes/keep/source/css/layout/archive-content.styl","path":"css/layout/archive-content.styl","modified":0,"renderable":1},{"_id":"themes/keep/source/css/layout/category-content.styl","path":"css/layout/category-content.styl","modified":0,"renderable":1},{"_id":"themes/keep/source/css/layout/article-content.styl","path":"css/layout/article-content.styl","modified":0,"renderable":1},{"_id":"themes/keep/source/css/layout/home-content.styl","path":"css/layout/home-content.styl","modified":0,"renderable":1},{"_id":"themes/keep/source/css/layout/category-list.styl","path":"css/layout/category-list.styl","modified":0,"renderable":1},{"_id":"themes/keep/source/css/layout/page.styl","path":"css/layout/page.styl","modified":0,"renderable":1},{"_id":"themes/keep/source/css/layout/tag-content.styl","path":"css/layout/tag-content.styl","modified":0,"renderable":1},{"_id":"themes/keep/source/js/libs/anime.min.js","path":"js/libs/anime.min.js","modified":0,"renderable":1},{"_id":"themes/keep/source/js/libs/pjax.min.js","path":"js/libs/pjax.min.js","modified":0,"renderable":1},{"_id":"themes/keep/source/css/common/codeblock/code-theme.styl","path":"css/common/codeblock/code-theme.styl","modified":0,"renderable":1},{"_id":"themes/keep/source/css/common/codeblock/copy-code.styl","path":"css/common/codeblock/copy-code.styl","modified":0,"renderable":1},{"_id":"themes/keep/source/css/common/codeblock/highlight.styl","path":"css/common/codeblock/highlight.styl","modified":0,"renderable":1}],"Cache":[{"_id":"source/_posts/go-gc/go-heap/img.png","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1631460881845},{"_id":"source/_posts/k8s/istio/debug-istio/img.png","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1629822478093},{"_id":"source/_posts/doc-dev/ops/pkg/local.repo","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1615298775648},{"_id":"source/.DS_Store","hash":"ae1aa7794b8ac926453607342b2578d5a4842c69","modified":1629822402947},{"_id":"source/_posts/compare.md","hash":"560c95df7043c2810479d7416f13d717cf326d0f","modified":1629822321600},{"_id":"source/_posts/.DS_Store","hash":"b4f9bb17897a0c2dd41025118b0a9d447530c64b","modified":1629822407956},{"_id":"source/_posts/dale.md","hash":"b3e2b8c55f0d5c549b847fde1816d4d17604f241","modified":1629822321601},{"_id":"source/_posts/docker.md","hash":"682e5bb032b630f0e285cd25a91407b4ec1844bc","modified":1629822321602},{"_id":"source/_posts/ebpf.md","hash":"46b9f44df217bbe54ea54224b0d0e2e836c38e6b","modified":1629822321602},{"_id":"source/_posts/go-gc.md","hash":"185ba554fca0e12c992faae1d88ebbe90e3ba36b","modified":1629822321603},{"_id":"source/_posts/lock.md","hash":"af5b8a1e2ad09415ccab8ab67fbecd1faf250688","modified":1629822321618},{"_id":"source/_posts/queue.md","hash":"4e493fec7e0f7e544c8391b75f6d306f5eb11290","modified":1629822321619},{"_id":"source/about/index.md","hash":"4de51e924891fc52dd718d04ebc348a00b25d312","modified":1629822321622},{"_id":"source/_posts/wasm.md","hash":"2b1b6c9d0922f32eb8a92afdd7c8586287f194d5","modified":1629822321621},{"_id":"source/_posts/go-gc/go-heap.md","hash":"56050210d82a63275ae47368cc9590c93d9c00c2","modified":1631460798914},{"_id":"source/_posts/go-gc/go-heap2.md","hash":"889965c3bfebd39f80a14c092873a3ba94b80d78","modified":1631463863472},{"_id":"source/_posts/zsh.md","hash":"68eb78b5b6817de1d12f2b622e7e7f8111ee28ef","modified":1629822321621},{"_id":"source/_posts/analysis.md","hash":"f2154c7aeddae070f5d332759b8c694b50540ec8","modified":1629822321597},{"_id":"source/_posts/k8s/install-k8s.md","hash":"f46f016de04f25365890e7ee23f0b7bc31e24cf8","modified":1629822321604},{"_id":"source/_posts/istio/istio-iptables.md","hash":"d37824a150524b3a7e2a78d39283ea9af69513f3","modified":1629822321604},{"_id":"source/_posts/k8s/istio-use.md","hash":"de83e700d2c0e30b1197026884027cba6f7533ae","modified":1629822321605},{"_id":"source/_posts/k8s/.DS_Store","hash":"95214f2985fc4fc9b782bb8752585937e0124e4f","modified":1629822429952},{"_id":"source/_posts/k8s/lb.md","hash":"29c88e13ca01cc2bc83a5ae555061c3aff9e52a8","modified":1629822321608},{"_id":"source/_posts/k8s/kiali.md","hash":"17356ca36490b9ca05be2ce721bc3b34e2637703","modified":1629822321608},{"_id":"source/_posts/linux/cgroups.md","hash":"43f9582b541aed5c913a03fd0762f1bbc9708c6d","modified":1629822321609},{"_id":"source/_posts/linux/route.md","hash":"da127efda4afe9fcf4dff35d2d3d3341aa82a1d6","modified":1629822321617},{"_id":"source/_posts/linux/lxc.md","hash":"3da219c6bf54fa50b6e1a4fb3fbc6c21432d400a","modified":1629822321610},{"_id":"source/_posts/linux/bridge.md","hash":"51ed016441d7d6a77cb46d8bca6a5415764284a0","modified":1629822321609},{"_id":"source/_posts/linux/namespace.md","hash":"6d4d66fa98940906fb86be7d1be9be33d54b9a24","modified":1629822321610},{"_id":"source/_posts/analysis/.DS_Store","hash":"c6f33e32f338b4c3c24e8b246f0c665cb14e36c0","modified":1617272821288},{"_id":"source/_posts/k8s/istio/Dockerfile.mysql-client","hash":"d466afd4a83fee2ab557cd9e640fcc7eee38ac36","modified":1629822478088},{"_id":"source/_posts/k8s/istio/istio-network.md","hash":"2d5488f255b75c513b0a9ec94c1f9258264502f2","modified":1631463012847},{"_id":"source/_posts/k8s/istio/debug-istio.md","hash":"f20edb1dfe9781b928352ecfa09e4bcfab633401","modified":1631174682167},{"_id":"source/_posts/doc-dev/basics/git.md","hash":"030f9f659ee5a1c28aaaf6c2a3e8fd3b2f14269b","modified":1615299840617},{"_id":"source/_posts/doc-dev/basics/.DS_Store","hash":"a345b3e8b6c8ccf68bf8f8fdf1c24e820b72452d","modified":1615298894481},{"_id":"source/_posts/doc-dev/basics/grpc.md","hash":"f828682005615943d5f1de09cf6e66373f41953f","modified":1615299846656},{"_id":"source/_posts/doc-dev/basics/kafka.md","hash":"1467f2a3a0bc8a782d269a602063fab07f4eb93d","modified":1615299850265},{"_id":"source/_posts/doc-dev/basics/mock.md","hash":"fcb0c56eda741218585606ca8753f77bacf97d6c","modified":1615299866575},{"_id":"source/_posts/doc-dev/basics/mongo.md","hash":"8f126ed74cc8b9aed8da1129f8d3c2614b50e342","modified":1615299872103},{"_id":"source/_posts/doc-dev/basics/redis.md","hash":"299704d72293beef0a0beb751603f4a4366c2892","modified":1615299884266},{"_id":"source/_posts/doc-dev/basics/rabiit.md","hash":"3d7c224a2331f7b3e11161cfab30fa94cda3a14e","modified":1615299879751},{"_id":"source/_posts/doc-dev/basics/sharding-jdbc.md","hash":"3c040845f679abcd08c73714e6a7416db883d5a2","modified":1615299927994},{"_id":"source/_posts/doc-dev/basics/transactional.md","hash":"2bf3a06bedd552ea7a8c185a260e772845881111","modified":1615299928759},{"_id":"source/_posts/doc-dev/basics/validate.md","hash":"97085578adf82895b7d8c92d13e7070709a4a3d2","modified":1615299912163},{"_id":"source/_posts/doc-dev/basics/mybatis-plus.md","hash":"44566f15fd98d9f18c4be0a4da5dc91901728922","modified":1615299927421},{"_id":"source/_posts/doc-dev/standard/Swagger2.md","hash":"def461419fd91b26d40d91bfe786caf07f3ce8a4","modified":1615299989388},{"_id":"source/_posts/doc-dev/ops/k8s-node.md","hash":"904754abd53ee601c21dae908f90bdb7b37a25a9","modified":1615299968687},{"_id":"source/_posts/doc-dev/ops/standard.md","hash":"0933a6277ae0e55f8385632e411ae4d91dc38d67","modified":1615299972864},{"_id":"source/_posts/doc-dev/ops/yum.md","hash":"7a0d854d6a05549e56d6327405722e5c8102fcba","modified":1615299982554},{"_id":"source/_posts/doc-dev/ops/use_dns.md","hash":"8d717dcaaa08a208021a166fb2c8906e6bb08649","modified":1615299976893},{"_id":"source/_posts/k8s/istio/debug-istio/img_2.png","hash":"bbac03ee596ac84fb49a34baab7d136a2a3c0b39","modified":1631174682169},{"_id":"source/_posts/k8s/istio/istio-network/img_2.png","hash":"bbac03ee596ac84fb49a34baab7d136a2a3c0b39","modified":1629908605278},{"_id":"source/_posts/k8s/istio/debug-istio/img_1.png","hash":"0123a63e3dd6f6b377025352b9f52d5be426bcec","modified":1631174682168},{"_id":"source/_posts/doc-dev/basics/pkg/settings.xml","hash":"4576b708706de217aa52cf2f02a6fab822b8b374","modified":1615298775637},{"_id":"source/_posts/k8s/istio/istio-network/img_1.png","hash":"0123a63e3dd6f6b377025352b9f52d5be426bcec","modified":1629908605278},{"_id":"source/_posts/doc-dev/standard/img/hello.jpg","hash":"a787cbd040eee81cbd6af584f17896e5bc2b767c","modified":1615298775651},{"_id":"source/_posts/doc-dev/ops/img/network.jpg","hash":"447c38d72377a6ecf9887659572800c2962534a2","modified":1615298775645},{"_id":"source/_posts/doc-dev/ops/pkg/centos7_init.sh","hash":"8c7bcf6b9c0576da211acf7bbe6b7d3c62c7377a","modified":1615298775648},{"_id":"source/_posts/doc-dev/ops/img/yumlist.png","hash":"ecdbbd8dcf2a637962247a889f108fc203150064","modified":1615298775648},{"_id":"source/_posts/doc-dev/basics/img/NewProject.png","hash":"061df56d377997934b0fa467657adad044da16a3","modified":1615298775628},{"_id":"source/_posts/doc-dev/ops/pkg/syncRepo.sh","hash":"f230f45c6a61bcf10d5e8f4cad667d5146fb3bf1","modified":1615298775649},{"_id":"source/_posts/doc-dev/basics/img/demo-api.png","hash":"0bf50060191fefa51f97ca29b8cea6c15a62f3fc","modified":1615298775629},{"_id":"source/_posts/doc-dev/basics/img/gitlab_settings.png","hash":"60037ce1c26d24473d4fcc4984431ed30e9436b5","modified":1615298775631},{"_id":"source/_posts/doc-dev/basics/img/ProjectMetadata.png","hash":"1dd75f4c65fc0d1472d879cac91fd501f8dba379","modified":1615298775629},{"_id":"source/_posts/go-gc/go-heap/img4.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631460871092},{"_id":"source/_posts/analysis/bookinfo.png","hash":"716f52a8700cb5f37df00d58818cff222d9bc3fc","modified":1629822321598},{"_id":"source/_posts/analysis/iptables.png","hash":"38675626595636471c9496f7d99a125a0091d797","modified":1629822321599},{"_id":"source/_posts/go-gc/go-heap/img6.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631461853992},{"_id":"source/_posts/go-gc/go-heap/img5.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631461575971},{"_id":"source/_posts/linux/namespace/img_3.png","hash":"e04907fe20d1af1f5354eb46fcf4dad04cca14a2","modified":1629822321616},{"_id":"source/_posts/go-gc/go-heap/img8.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631463374671},{"_id":"source/_posts/linux/namespace/img_2.png","hash":"f3fc281b3d2f5d7143443617e445bb4e82a9fad3","modified":1629822321614},{"_id":"source/_posts/linux/namespace/img.png","hash":"243dfe1c5bba4f832da4f2d8ae729f468f8fae16","modified":1629822321612},{"_id":"source/_posts/doc-dev/standard/img/world.jpg","hash":"23a2008a3e54e811fe9d3ef5b3d57dde96d80318","modified":1615298775652},{"_id":"source/_posts/doc-dev/ops/img/add_runner.jpg","hash":"b9e470b644d17dc4d127c5f640c35a58ef111633","modified":1615298775640},{"_id":"source/_posts/doc-dev/ops/img/adv.jpg","hash":"1a6a75d664ae22e96d25c0f033ea0ce48ffd1595","modified":1615298775641},{"_id":"source/_posts/doc-dev/ops/img/dns.jpg","hash":"087fd3a238541290113a541ca9ec7acdce2c4a51","modified":1615298775642},{"_id":"source/_posts/doc-dev/ops/img/job_list.jpg","hash":"a685b56501dec4c81dcafaa84a120c7291206625","modified":1615298775644},{"_id":"source/_posts/doc-dev/ops/img/proper.jpg","hash":"a27202fbb97d234d0af6bb25ade2dece3a6a5867","modified":1615298775646},{"_id":"source/_posts/doc-dev/ops/img/runner_register.jpg","hash":"19c73cda74a8abf8677af51015bc9a655b0bdab3","modified":1615298775647},{"_id":"source/_posts/doc-dev/ops/img/ping.jpg","hash":"d589c9c89c08e740d521bc6bdf0e59ae6163214f","modified":1615298775645},{"_id":"source/_posts/doc-dev/ops/img/unlock_runner.jpg","hash":"69e65f2d3a00afe66fab85b927f27bc9d094e310","modified":1615298775648},{"_id":"source/_posts/doc-dev/basics/img/mongo-insert.png","hash":"dabcb19dc99a3a46073fc54289f11833b4a6aa22","modified":1615298775634},{"_id":"themes/keep/.gitignore","hash":"b49daa26b8121cc0c7074d61b377c8e7e0880d03","modified":1615281394891},{"_id":"themes/keep/.editorconfig","hash":"a1c91f0a086bf92fddb02ccf23578ec2b51c099c","modified":1615281394891},{"_id":"themes/keep/.DS_Store","hash":"80aed7c007d060f38d963ea5a3e471334414e40a","modified":1615296305034},{"_id":"themes/keep/README.md","hash":"5b085072b3f1b404695570876472f6004ccbed61","modified":1629821615746},{"_id":"themes/keep/LICENSE","hash":"98b8bd28e54ab36ee12396687dfdf88807c6cfdd","modified":1615281394892},{"_id":"themes/keep/README_zh-CN.md","hash":"f361ed9d90f1fa5c600c4821cb5f054c86e531b1","modified":1629821615746},{"_id":"themes/keep/_config.yml","hash":"bbcf841ee67373ce36494f40db244bc9dfb6e3c1","modified":1629821615756},{"_id":"themes/keep/package.json","hash":"24c346a8637543d59c78479d3adf88c0a7b729c1","modified":1629821615747},{"_id":"themes/keep/languages/en.yml","hash":"e4f42cfda0ed6ea1715d28fd4b1bba6f89b8cdb0","modified":1615281394893},{"_id":"themes/keep/layout/archive-content.ejs","hash":"cfa8f29b8863534f407136ea3deb18a4b2ff722c","modified":1615281394899},{"_id":"themes/keep/languages/zh-CN.yml","hash":"de8aec3e9960fa489c0a290cda825dfc1e7528dd","modified":1615281394894},{"_id":"themes/keep/layout/archive.ejs","hash":"8456f112fc12bbb1c83cd190d0ce83ee474bd297","modified":1615281394899},{"_id":"source/_posts/doc-dev/basics/img/mvn-version.png","hash":"2c0c5275b2d854d36d43183f2af96c873eccbf24","modified":1615298775636},{"_id":"themes/keep/layout/article-content.ejs","hash":"ae9fc0712b89af58e80b6c6daf749d01624c4a3c","modified":1615281394899},{"_id":"themes/keep/layout/category-content.ejs","hash":"aef0c90a395f909be7d2c358eb41d5558a10406f","modified":1615281394900},{"_id":"themes/keep/layout/category-list.ejs","hash":"a9390b25238332417fd554d32563a4d9999db90f","modified":1615281394900},{"_id":"themes/keep/layout/category.ejs","hash":"8456f112fc12bbb1c83cd190d0ce83ee474bd297","modified":1615281394900},{"_id":"themes/keep/layout/home-content.ejs","hash":"79e16c3baa6569afbc07ac6a5d2e3f37b273016a","modified":1615281394900},{"_id":"themes/keep/layout/index.ejs","hash":"f5fee4e079a9c2c23059ebde4cd89ec723e310c6","modified":1615281394900},{"_id":"themes/keep/layout/layout.ejs","hash":"da9dbeba541ad19fed35c41fe187f4016e41f0db","modified":1615281394901},{"_id":"themes/keep/layout/page.ejs","hash":"4bf34f19bcf18efb5f6e76fcbe7cd36b25ceee6a","modified":1615281394901},{"_id":"themes/keep/layout/tag.ejs","hash":"8456f112fc12bbb1c83cd190d0ce83ee474bd297","modified":1615281394902},{"_id":"themes/keep/layout/tag-content.ejs","hash":"ce4c8192a4ccd6a626af412a7ba258d1edbc0b95","modified":1615281394902},{"_id":"themes/keep/layout/tags.ejs","hash":"8456f112fc12bbb1c83cd190d0ce83ee474bd297","modified":1615281394902},{"_id":"themes/keep/scripts/use-source-data.js","hash":"21f6a49e47b7e4d792d67503079ea5b509f18311","modified":1615281394903},{"_id":"themes/keep/layout/_partial/archive-list.ejs","hash":"7c33e49286d54824cd8f3483e30de5579951edc6","modified":1615281394894},{"_id":"themes/keep/layout/_partial/article-copyright-info.ejs","hash":"77e13720374efb902ee3d4d04d13b62de033a3ae","modified":1615281394894},{"_id":"themes/keep/source/.DS_Store","hash":"495dc0d217dbc3e7cb0c015a4aa9af3e7011d37f","modified":1615297494024},{"_id":"themes/keep/layout/_partial/article-meta-info.ejs","hash":"54f77621034e39809911a184f15006ce80e0f67b","modified":1615281394894},{"_id":"themes/keep/layout/_partial/footer.ejs","hash":"0b00a5b13d71d5f616079fb8d3a7ce66db36c5e9","modified":1615281394896},{"_id":"themes/keep/layout/_partial/head.ejs","hash":"8fb592456f1c22d6b3aaa617fd40494168396d42","modified":1629821615747},{"_id":"themes/keep/layout/_partial/friends-link.ejs","hash":"fe35aa6dabeb31bc677270062eed569f37472c2c","modified":1629821615746},{"_id":"themes/keep/layout/_partial/header.ejs","hash":"627dfa9519ff614d6a79dac942a7b61fa5bfac8c","modified":1629821615747},{"_id":"themes/keep/layout/_partial/image-viewer.ejs","hash":"beb3dec5e08856a29d585fe0eb94a8a6ddade4dd","modified":1615281394897},{"_id":"themes/keep/layout/_partial/home-article-meta-info.ejs","hash":"0aceb1c7c29b65bd5fc2d79a285a564da8c09b63","modified":1615281394896},{"_id":"themes/keep/layout/_partial/paginator.ejs","hash":"cfd4d9a30bd20ee0750b79226cb94562439013bf","modified":1615281394897},{"_id":"themes/keep/layout/_partial/local-search.ejs","hash":"6fbcc0a14467da8362a2eaa490d84acb1336d21b","modified":1615281394897},{"_id":"themes/keep/layout/_partial/page-template.ejs","hash":"8fd596f871326b03e707d7defcc96f639cdd628e","modified":1615281394897},{"_id":"themes/keep/layout/_partial/scripts.ejs","hash":"ad75de7966c4d9d923c9ac8cfbfe26b38fbe7aed","modified":1615281394898},{"_id":"themes/keep/layout/_partial/post-tools.ejs","hash":"e8a303fa393a1716c5ff1f731923781eb12322ab","modified":1615281394898},{"_id":"themes/keep/layout/_partial/progress-bar.ejs","hash":"44af04816b86546e0260e73c2df61353e7404208","modified":1615281394898},{"_id":"themes/keep/layout/_partial/side-tools.ejs","hash":"e55d2034d7e2b8b0c1bd5ac7fdc56ffb8bbd4e60","modified":1615281394898},{"_id":"themes/keep/layout/_partial/tagcloud.ejs","hash":"5968618b53a029922f2255b0c76bf8a9f11712ff","modified":1615281394899},{"_id":"themes/keep/layout/_partial/toc.ejs","hash":"aefc9db612c0fceb4a02fdbed9fa47a6c4e144b5","modified":1615281394899},{"_id":"themes/keep/scripts/filters/link-handle.js","hash":"b39cfa42d156b7ad4d4e8246b6f934cd51d8db55","modified":1615281394903},{"_id":"themes/keep/layout/_partial/first-screen.ejs","hash":"106683de71f01b368c6f0c5417952b54fcdc9611","modified":1615281394895},{"_id":"themes/keep/scripts/helpers/helper.js","hash":"9d657770648def555884eebbcecbf333e405ff8b","modified":1629821615748},{"_id":"themes/keep/scripts/helpers/export-config.js","hash":"e7c5417a1cd61f0b7c3f97030d4a77419c41b8a5","modified":1615281394903},{"_id":"themes/keep/source/css/font-awesome.min.css","hash":"c508528feb9fd540454f838653cd4863b290df2e","modified":1615281394906},{"_id":"themes/keep/scripts/filters/lazyload-handle.js","hash":"7a8fd4996b9720c8d4cdb3042bfe5a1008f7c5fd","modified":1629821615748},{"_id":"themes/keep/source/images/avatar.svg","hash":"59aab758225591324e94d763344ac38eba39d586","modified":1615282919806},{"_id":"themes/keep/source/css/style.styl","hash":"77b61baccadc3f71d1d06598f5c2b7fc506d77d4","modified":1615281394910},{"_id":"themes/keep/source/images/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1617271933603},{"_id":"themes/keep/source/images/loading.svg","hash":"eedfa204e08a60ca5c80c620cfe9a3eaa6201585","modified":1615281394911},{"_id":"themes/keep/source/images/bg.svg","hash":"f3106cd334dc2ceef885c19012bf59a48498af42","modified":1615281394911},{"_id":"themes/keep/source/js/code-copy.js","hash":"3fdabac26f6406a4592336f1f444ec966201b5d9","modified":1615281394911},{"_id":"themes/keep/source/js/back2top.js","hash":"fc8e85f6704e39ae3a613bbec5dd51d449be8010","modified":1615281394911},{"_id":"themes/keep/source/js/header-shrink.js","hash":"167b9b6a9ed63c6cf4081cb3c201dd16bbbfb9ad","modified":1615281394912},{"_id":"themes/keep/source/js/lazyload.js","hash":"95aad532f17d7a8119979fc61ade9e626308a2af","modified":1615281394912},{"_id":"themes/keep/source/js/left-side-toggle.js","hash":"618f7cfc45db4d82b2f1d00d8e9ee936bcf9043b","modified":1615281394912},{"_id":"themes/keep/source/js/local-search.js","hash":"9509ec6d2d7d4466fe37ad624cf606f6639fb3fe","modified":1615281394913},{"_id":"themes/keep/source/js/main.js","hash":"ca8ed228cc0bc234be74428d029cfd047eec0ed6","modified":1615281394913},{"_id":"themes/keep/source/js/toc.js","hash":"ae69bf65d2b30d299b6ca9e2361d3b6e0db3a077","modified":1615281394913},{"_id":"themes/keep/source/js/utils.js","hash":"47c6d222a116498359345777aea383c429975abf","modified":1615281394914},{"_id":"themes/keep/source/js/dark-light-toggle.js","hash":"223e6f1d4e6e70956e4661b58c430e1c68def125","modified":1615281394912},{"_id":"themes/keep/source/webfonts/fa-regular-400.eot","hash":"2baa9a8aa68f1d2d4712b3c7205f9105aaf21879","modified":1615281394923},{"_id":"themes/keep/source/webfonts/fa-regular-400.ttf","hash":"d64e58981a419de52bac110c979887d34e366135","modified":1615281394924},{"_id":"themes/keep/source/webfonts/fa-regular-400.woff","hash":"26afc29d39ab9fac6d0b607be7e76db093ff7c3a","modified":1615281394924},{"_id":"themes/keep/source/webfonts/fa-regular-400.woff2","hash":"fb9648469530a05fa9aac80e47d4d6960472a242","modified":1615281394924},{"_id":"themes/keep/layout/_partial/comment/comment.ejs","hash":"4a7294bbe9aa4be22878e8a638668ed7ade25e2c","modified":1615281394895},{"_id":"themes/keep/layout/_partial/comment/gitalk.ejs","hash":"28a0c8b1da66a9b6863e5444aa0b50c8f6b862f0","modified":1615281394895},{"_id":"themes/keep/layout/_partial/comment/twikoo.ejs","hash":"92d858874543c4ba149acd04374d84e784ba0aaf","modified":1615281394895},{"_id":"themes/keep/layout/_partial/comment/valine.ejs","hash":"467cafd412837af791b4c353646cf44ac4458a3f","modified":1615281394895},{"_id":"themes/keep/source/css/common/animated.styl","hash":"ceb35da27937a5824dea00c0a75de57e10e1dc90","modified":1629821615748},{"_id":"themes/keep/layout/_partial/pjax/pjax.ejs","hash":"949d3fdd4bd215cd7d0c95152c4be630ce227e16","modified":1629821615747},{"_id":"themes/keep/source/css/common/basic.styl","hash":"12fcd65c501ab3899d2694556e1cbfc197e067bb","modified":1629821615749},{"_id":"themes/keep/source/css/common/markdown.styl","hash":"55c6c0f77b608b8e1d9c52bb4fdcee881f55eff8","modified":1629821615749},{"_id":"themes/keep/source/css/common/variables.styl","hash":"8b66a8ae90dbb8ec2e412fcf57ff6c8cee18e949","modified":1629821615749},{"_id":"themes/keep/source/css/common/keep-theme.styl","hash":"9b6bf080299102571a6667ca99a62f53c9684246","modified":1615281394905},{"_id":"themes/keep/source/css/layout/archive-content.styl","hash":"515ebe2a251f3b53f0cf130cdc48b8bb1fb85952","modified":1615281394910},{"_id":"themes/keep/source/css/layout/category-content.styl","hash":"638c3b50d8203c76106f3010fbfeed9a29bfde5c","modified":1615281394910},{"_id":"themes/keep/source/css/layout/page.styl","hash":"f58cede20abbf250dfe7d38f594632c5b46a61e9","modified":1615281394910},{"_id":"themes/keep/source/css/layout/article-content.styl","hash":"327bb874968feaa981093c3f218b48aa34cd1d44","modified":1615281394910},{"_id":"themes/keep/source/css/layout/home-content.styl","hash":"2f2ee2f70020cf5e2ffb5612607bd58772e785a4","modified":1615281394910},{"_id":"themes/keep/source/css/layout/category-list.styl","hash":"bea0a03fe3de16ed08e7b3b541a46d2074561841","modified":1615281394910},{"_id":"themes/keep/source/css/layout/tag-content.styl","hash":"0d1cc0cc0d263f55b9c7245c1dc023abdcfcd69f","modified":1615281394910},{"_id":"themes/keep/source/js/libs/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1615281394912},{"_id":"themes/keep/source/js/libs/pjax.min.js","hash":"57ec40cb4898d7ba74a03603d608af378e5431f8","modified":1615281394913},{"_id":"themes/keep/source/css/common/codeblock/copy-code.styl","hash":"1edcb0ece1bf4b9838c1937e98eaa845de7f4b3b","modified":1615281394904},{"_id":"themes/keep/source/css/layout/_partial/archive-list.styl","hash":"95c41684691a849d102c5a30efb365300d3d5c6d","modified":1615281394906},{"_id":"themes/keep/source/css/common/codeblock/highlight.styl","hash":"64ea39fa5503f6c5a21a9ed7c9d3d5103cccad5a","modified":1615281394905},{"_id":"themes/keep/source/css/layout/_partial/article-copyright-info.styl","hash":"6eaa067231bd9e9faa5de2260b8974142faae510","modified":1615281394906},{"_id":"themes/keep/source/css/layout/_partial/article-meta-info.styl","hash":"91bf4f2f58217c0d0c6d51ad4792e5e0a00c3165","modified":1615281394907},{"_id":"themes/keep/source/css/common/codeblock/code-theme.styl","hash":"fd81f8a76ae4f55bf5da38116bbc4f0e973daad2","modified":1615281394904},{"_id":"themes/keep/source/css/layout/_partial/header.styl","hash":"80cd9c8abd3542c0e521841137e987a658471e05","modified":1629821615749},{"_id":"themes/keep/source/css/layout/_partial/image-viewer.styl","hash":"59525fcc1f88c78abf8c1f0b06e24b16a088698c","modified":1615281394908},{"_id":"themes/keep/source/css/layout/_partial/local-search.styl","hash":"98aa2e22f16b98b2ffdbf36e1ea24363f8e5045b","modified":1615281394908},{"_id":"themes/keep/source/css/layout/_partial/footer.styl","hash":"19a8fc0a01bf1efed637e90530c412d57137dfc4","modified":1615281394908},{"_id":"themes/keep/source/css/layout/_partial/first-screen.styl","hash":"ca67e175a033263256ca3f547747fa413d1c217f","modified":1624861820407},{"_id":"themes/keep/source/css/layout/_partial/page-template.styl","hash":"27d1e19691867a09283facd2983afb9a3404e999","modified":1615281394908},{"_id":"themes/keep/source/css/layout/_partial/post-tools.styl","hash":"f78a13e3b03b19cb72b03db0a5659f8c734e742e","modified":1615281394909},{"_id":"themes/keep/source/css/layout/_partial/paginator.styl","hash":"da5df38b09138af28cb8b3fe9a05aeda9dae5011","modified":1615281394908},{"_id":"themes/keep/source/css/layout/_partial/side-tools.styl","hash":"a68a1e3f21da63ee2d387035e91f9f60e956e234","modified":1615281394909},{"_id":"themes/keep/source/css/layout/_partial/tagcloud.styl","hash":"61016e73c8e420c74800b3afdbd6c2f890400e51","modified":1615281394909},{"_id":"themes/keep/source/css/layout/_partial/comment/comment.styl","hash":"f6d9a37520566e38738fc1184ed76817273c3ee5","modified":1615281394907},{"_id":"themes/keep/source/css/layout/_partial/progress-bar.styl","hash":"a64df5515c60a3a0993c427dc50facee33215f2b","modified":1615281394909},{"_id":"themes/keep/source/css/layout/_partial/comment/gitalk.styl","hash":"b8fccd13e2753c9fe891fb88a6413087048ab830","modified":1615281394907},{"_id":"themes/keep/source/css/layout/_partial/comment/valine.styl","hash":"6b0c7d69fc3f819610576b41e987ec655411ca44","modified":1615281394907},{"_id":"themes/keep/source/css/layout/_partial/toc.styl","hash":"029ac31a21203a8b86027e67a3ff3a977579325d","modified":1615281394909},{"_id":"themes/keep/source/css/layout/_partial/comment/twikoo.styl","hash":"5844874c50a93239031e58b23856698ca9af2725","modified":1615281394907},{"_id":"source/_posts/doc-dev/ops/img/add.jpg","hash":"2adc4aad439d3bc31ae1d0cf999821c2f43af8f5","modified":1615298775639},{"_id":"source/_posts/doc-dev/ops/img/ipv4.jpg","hash":"353772e2085d5ae9a4b0bcaba5064ba854bc4597","modified":1615298775643},{"_id":"source/_posts/doc-dev/basics/img/idea_downloads.png","hash":"4239a202244ec732bab9b6791eb4121ad17e8a26","modified":1615298775632},{"_id":"themes/keep/source/webfonts/fa-brands-400.woff2","hash":"f726c4275bb494a045fde059175f072de06c01df","modified":1615281394922},{"_id":"themes/keep/source/webfonts/fa-brands-400.woff","hash":"a42ac4a94f4e0e9333cdb1b2fb6c13c0ae690ff2","modified":1615281394922},{"_id":"themes/keep/source/webfonts/fa-solid-900.woff2","hash":"9b592048b9062b00f0b2dd782d70a95b7dc69b83","modified":1615281394935},{"_id":"themes/keep/source/webfonts/fa-solid-900.woff","hash":"3b86a0ce15d8d534b65e98560e321a933d310688","modified":1615281394934},{"_id":"source/_posts/doc-dev/basics/img/gitlab_profile_keys_new.png","hash":"6b2804c6e657143313729e605e66cd70b38d672d","modified":1615298775631},{"_id":"themes/keep/source/webfonts/fa-brands-400.eot","hash":"c719f4375679ee58e156434f9ba9727be669cf07","modified":1615281394915},{"_id":"themes/keep/source/webfonts/fa-brands-400.ttf","hash":"9b49c6c5b0cbdef158ae31b2a4e4814555408389","modified":1615281394921},{"_id":"source/_posts/go-gc/go-heap/img1.png","hash":"292d6fee67229a732a895ca32b80d90a3331eba7","modified":1631289037040},{"_id":"source/_posts/go-gc/go-heap/img2.png","hash":"c3f94b3bac4ed7e5204fbcd60ba145726b3d4117","modified":1631289037046},{"_id":"source/_posts/doc-dev/basics/img/mongo-select.png","hash":"1c106de799e72535b62555ffc203071ecebefe42","modified":1615298775635},{"_id":"themes/keep/source/webfonts/fa-regular-400.svg","hash":"c41a688158d577e3a2738137992d49b05b17ab8f","modified":1615281394923},{"_id":"themes/keep/source/webfonts/fa-solid-900.ttf","hash":"d537bf4cc7273ddb3fd754d53f2b241aeafaefe7","modified":1615281394934},{"_id":"source/_posts/doc-dev/basics/img/jdk_downloads.png","hash":"3ac8b9ed98ed6958bf5382207c5674bf88d10a16","modified":1615298775634},{"_id":"themes/keep/source/webfonts/fa-solid-900.eot","hash":"c39b89f7fa7b66931ab02a54002db5ffcbff206c","modified":1615281394926},{"_id":"themes/keep/source/images/bp.jpg","hash":"c4d7d712bcc9b6ace94f394af2c969e45b2b5037","modified":1624861439139},{"_id":"themes/keep/source/webfonts/fa-brands-400.svg","hash":"69a0ff79a9d93a451e9fa90bd79ae7008d2a9da5","modified":1615281394920},{"_id":"themes/keep/source/webfonts/fa-solid-900.svg","hash":"36de6a298660ed3feaab37900f7b28c3e981d80e","modified":1615281394931},{"_id":"themes/keep/source/images/bp.jpeg","hash":"18a96ea39d45d41cf645a42f753b8b24ac67a8b2","modified":1614657556321},{"_id":"public/baidusitemap.xml","hash":"c0e57838aa73189579abfbd064d59b250fea3f39","modified":1631463949188},{"_id":"public/atom.xml","hash":"503a78531f7ef46aa9aeddade8317dc9a31f4c09","modified":1631463949188},{"_id":"public/sitemap.xml","hash":"116fbffdc87c1fb41212e5f8461d0402c434876d","modified":1631463949188},{"_id":"public/content.json","hash":"8e7cf0ebce3d68215ea434341dc1b23ccea6becc","modified":1631463949188},{"_id":"public/about/index.html","hash":"ce3b7881954ab8cf3794ea602305cf700e22fb1b","modified":1631463949188},{"_id":"public/2021/09/10/go-gc/go-heap/index.html","hash":"657cabe9a79bab265523bd85e94bb9130cc8764d","modified":1631463949188},{"_id":"public/2021/07/12/ebpf/index.html","hash":"732fb3bebfcd870c08ae36dcc15acdb76dca01db","modified":1631463949188},{"_id":"public/2021/07/12/dale/index.html","hash":"00686e5a26cdf3dd01901070135f68ab5fef189f","modified":1631463949188},{"_id":"public/2021/06/28/lock/index.html","hash":"b01782c5b9792cf736a540a56ee5e2882cf799f7","modified":1631463949188},{"_id":"public/2021/04/07/k8s/lb/index.html","hash":"2fbf54421cea82502618b798215c7ba48eda3d2e","modified":1631463949188},{"_id":"public/2021/03/16/linux/lxc/index.html","hash":"5c0b30fc6f5f0e742b87d8edd0bc9061791118c1","modified":1631463949188},{"_id":"public/2021/03/14/linux/route/index.html","hash":"1b74c16dd608133ced7d9b2543a7952219f1c6b8","modified":1631463949188},{"_id":"public/2021/03/12/zsh/index.html","hash":"c7db6dc1bd6ee113e01ad9abe63f42eb36b3c93f","modified":1631463949188},{"_id":"public/2021/03/13/linux/bridge/index.html","hash":"1715433b354bb4b4c33be7aad6689a3ed49b650c","modified":1631463949188},{"_id":"public/2020/09/21/docker/index.html","hash":"7560dcfd830a40f019f4f3520146346647222627","modified":1631463949188},{"_id":"public/2020/09/21/queue/index.html","hash":"61e12781c03c12f3ad3010aac7350d4aee2cf6c2","modified":1631463949188},{"_id":"public/2019/03/12/doc-dev/ops/use_dns/index.html","hash":"aa8ec5125ea18ea8f783f42a657dcf794f87da43","modified":1631463949188},{"_id":"public/2019/03/12/doc-dev/ops/k8s-node/index.html","hash":"74d36502d92e472966e98aab5fb52ee3682dd0e8","modified":1631463949188},{"_id":"public/2019/03/12/doc-dev/ops/yum/index.html","hash":"a49f71eeda8e6d785fdcac3feaa7bf4c68e948ea","modified":1631463949188},{"_id":"public/2018/03/12/doc-dev/basics/sharding-jdbc/index.html","hash":"1d17f03cbb0810125f3ac273f81192f0569c102d","modified":1631463949188},{"_id":"public/2018/03/12/doc-dev/basics/transactional/index.html","hash":"8ee1e8c7d1d315795e260798880ed3d9f434d292","modified":1631463949188},{"_id":"public/categories/istio/index.html","hash":"3124597e3bbbee02c556a4d8aca5682878ace269","modified":1631463949188},{"_id":"public/tags/linux/index.html","hash":"aaf7d8f177e75d028c33e19fd51d47569d9648ca","modified":1631463949188},{"_id":"public/tags/docker/index.html","hash":"9463fe3b404ae53321d0616916f942227dfc8760","modified":1631463949188},{"_id":"public/tags/golang/index.html","hash":"a84d06b11824b147c198b2ac3dce8bfbbea8fc9f","modified":1631463949188},{"_id":"public/tags/istio/index.html","hash":"d61d083e4d75ea4e1cda3ef1083cd6618a1ccfe7","modified":1631463949188},{"_id":"public/tags/iptables/index.html","hash":"8980c608dfe11b207ca74ba80db1c78ee139636e","modified":1631463949188},{"_id":"public/tags/go/index.html","hash":"2d74f9431c5f9d76e87a26eef245f45fb46c65d6","modified":1631463949188},{"_id":"public/tags/kubernetes/index.html","hash":"55a3ae91ff5857c3dbf69d0efd1cab695ebd7225","modified":1631463949188},{"_id":"public/tags/kiali/index.html","hash":"49afc73c0a33a522b804f7bdcd411e73635fa633","modified":1631463949188},{"_id":"public/tags/kernal/index.html","hash":"ae42e265e7b7590754ec079d3c0647bd569061be","modified":1631463949188},{"_id":"public/tags/kernel/index.html","hash":"c40c7cf4c74beca754284bac5b4d7c0217accf87","modified":1631463949188},{"_id":"public/tags/network/index.html","hash":"98ddcf6188fa2e8424b0a0ce57247d1e0e875193","modified":1631463949188},{"_id":"public/tags/k8s/index.html","hash":"eb13e8012ab5998cfe4adb9fd81add963bd175b0","modified":1631463949188},{"_id":"public/2021/09/13/go-gc/go-heap2/index.html","hash":"dd6feeec1bdbaa715797a461345c88003f3219bd","modified":1631463949188},{"_id":"public/2021/07/19/istio/istio-iptables/index.html","hash":"9e65eb2f8f7e3457eb6c43dd6190ba63b123a966","modified":1631463949188},{"_id":"public/2021/08/24/k8s/istio/istio-network/index.html","hash":"b1315a3c77009bf81f4caf807a71814580ea0aa5","modified":1631463949188},{"_id":"public/2021/07/12/wasm/index.html","hash":"0e4218b2109eb9762c9cfe3508eccc784769f125","modified":1631463949188},{"_id":"public/2021/05/30/go-gc/index.html","hash":"46e0f0f696dd7e8d075ce59d095a412e13c710b8","modified":1631463949188},{"_id":"public/2021/03/22/k8s/istio/debug-istio/index.html","hash":"36932c70194dfea30e57da14f671de5aa0370239","modified":1631463949188},{"_id":"public/2021/03/12/k8s/install-k8s/index.html","hash":"ac99c87cc9aa2a91dcf99608b63ee17b5ace7032","modified":1631463949188},{"_id":"public/2021/03/10/linux/cgroups/index.html","hash":"be5d0387a57934616c1decf04ab08de909a5480f","modified":1631463949188},{"_id":"public/2021/03/10/linux/namespace/index.html","hash":"9af2d2b478619fa8f0cd9ea1e65479f0602b508b","modified":1631463949188},{"_id":"public/2021/03/09/analysis/index.html","hash":"2257155e63353ffbbd7e0d2148af737c36a5df18","modified":1631463949188},{"_id":"public/2021/01/21/k8s/kiali/index.html","hash":"44d9d59f3b3c6fe5b9523583ef992c391b03e503","modified":1631463949188},{"_id":"public/2021/01/21/k8s/istio-use/index.html","hash":"a2c9ca436eb6e38f5d4cd5d8a736c72dbb0af801","modified":1631463949188},{"_id":"public/2020/03/09/compare/index.html","hash":"27a4f565facbd348a8bf01a169d66847000e6d56","modified":1631463949188},{"_id":"public/2019/03/12/doc-dev/ops/standard/index.html","hash":"26ae2fd10ed3011bb7f25d04af419f369f1d2943","modified":1631463949188},{"_id":"public/2019/03/12/doc-dev/standard/Swagger2/index.html","hash":"c38f1dfb4dcada7d129d0ef8c0558f3845002d4f","modified":1631463949188},{"_id":"public/2018/03/12/doc-dev/basics/validate/index.html","hash":"09106ccf23ded4a1a840484fab21462b25de49d0","modified":1631463949188},{"_id":"public/2018/02/26/doc-dev/basics/mongo/index.html","hash":"b8ef142c97e90be0603fabc333853f125c4d2c9f","modified":1631463949188},{"_id":"public/2018/02/26/doc-dev/basics/mock/index.html","hash":"3005b2b8280cd5d128584bff1a38eaa199dbbb1b","modified":1631463949188},{"_id":"public/2018/02/26/doc-dev/basics/rabiit/index.html","hash":"ae783b2bdd061f47794e6ff0b1c6b191a788d2a5","modified":1631463949188},{"_id":"public/2018/02/26/doc-dev/basics/redis/index.html","hash":"94f5cab2bf3d0be656fba9111fb5a54dc2d2ab20","modified":1631463949188},{"_id":"public/2018/02/23/doc-dev/basics/mybatis-plus/index.html","hash":"787cc88d6ebe92349a83d954ba07cf123b6eb953","modified":1631463949188},{"_id":"public/2018/02/20/doc-dev/basics/git/index.html","hash":"3f23c14a708b0e4b8cbac08962f3c1179d85e29e","modified":1631463949188},{"_id":"public/2018/02/20/doc-dev/basics/kafka/index.html","hash":"c392f7c5abbf0c0a2398e84bbd28cf47f1283311","modified":1631463949188},{"_id":"public/archives/index.html","hash":"952e37a628b8a65ff1451858dadbc9b0c05d7442","modified":1631463949188},{"_id":"public/archives/page/2/index.html","hash":"952e37a628b8a65ff1451858dadbc9b0c05d7442","modified":1631463949188},{"_id":"public/2018/02/20/doc-dev/basics/grpc/index.html","hash":"44646b9e96a50608c31b4a8fb233a46c21bebd11","modified":1631463949188},{"_id":"public/archives/page/3/index.html","hash":"952e37a628b8a65ff1451858dadbc9b0c05d7442","modified":1631463949188},{"_id":"public/archives/page/4/index.html","hash":"952e37a628b8a65ff1451858dadbc9b0c05d7442","modified":1631463949188},{"_id":"public/archives/2018/index.html","hash":"80b469c3b0fe19fc8503a3006c4f092a46110485","modified":1631463949188},{"_id":"public/archives/2018/page/2/index.html","hash":"80b469c3b0fe19fc8503a3006c4f092a46110485","modified":1631463949188},{"_id":"public/archives/2018/02/index.html","hash":"698fca309ffd067e4f19f4ed743e413951254173","modified":1631463949188},{"_id":"public/archives/2018/03/index.html","hash":"65859a142848baec6c88b7d07925cae811c9c337","modified":1631463949188},{"_id":"public/archives/2019/index.html","hash":"c245015009a14ef790a4a0b781f15ed7abd52d63","modified":1631463949188},{"_id":"public/archives/2019/03/index.html","hash":"e086dcb6a1cc3fe8ebdf3c922b351ee4896ecc73","modified":1631463949188},{"_id":"public/archives/2020/index.html","hash":"b7118a221370b724b9ad907cb86d0462d8120dce","modified":1631463949188},{"_id":"public/archives/2020/03/index.html","hash":"10de5ce09a3f328c85322496cbaebda3e81ca4d4","modified":1631463949188},{"_id":"public/archives/2021/index.html","hash":"ef27bf56e85ede165eaeedd8301c9c60e40ba38c","modified":1631463949188},{"_id":"public/archives/2021/page/2/index.html","hash":"ef27bf56e85ede165eaeedd8301c9c60e40ba38c","modified":1631463949188},{"_id":"public/archives/2020/09/index.html","hash":"786a1be529460ef49d838e047960e6925199cf83","modified":1631463949188},{"_id":"public/archives/2021/page/3/index.html","hash":"ef27bf56e85ede165eaeedd8301c9c60e40ba38c","modified":1631463949188},{"_id":"public/archives/2021/03/index.html","hash":"7cb50abdc2c5848efe1ecba255973d2d6ff1150b","modified":1631463949188},{"_id":"public/archives/2021/04/index.html","hash":"306ab999fd7192c238326d2ed6ed6cc6391f7608","modified":1631463949188},{"_id":"public/archives/2021/01/index.html","hash":"ca312a9ac0f216be8dde16fc53d26a180362dc37","modified":1631463949188},{"_id":"public/archives/2021/05/index.html","hash":"d97b80a3959df659818fc8f98a81d2c54ea750c7","modified":1631463949188},{"_id":"public/archives/2021/06/index.html","hash":"1305181f5a9984d904a1358450052de0367191c4","modified":1631463949188},{"_id":"public/archives/2021/07/index.html","hash":"992fef04f8b88c0b9b042732d453d68f21e1902c","modified":1631463949188},{"_id":"public/archives/2021/08/index.html","hash":"6a02859e1eabd0d7b1375f4fada6443a5841d6b8","modified":1631463949188},{"_id":"public/archives/2021/09/index.html","hash":"3abf28701cee6d965e2a9440ec50708805d578a4","modified":1631463949188},{"_id":"public/index.html","hash":"b398cf336d74758aa2f3e2ed35e8c5ee46a20cf4","modified":1631463949188},{"_id":"public/page/2/index.html","hash":"14a99a01fca5c74429aeecaed992fcdb75a6de73","modified":1631463949188},{"_id":"public/page/3/index.html","hash":"b488b863bebb5ecdaac5e0c9d4317ee2b2f196bb","modified":1631463949188},{"_id":"public/page/4/index.html","hash":"0ec3d6d464b027cdbb5405453fd8dce11e8b3450","modified":1631463949188},{"_id":"public/2021/09/10/go-gc/go-heap/img.png","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1631463647209},{"_id":"public/2021/03/22/k8s/istio/debug-istio/img.png","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1631463949188},{"_id":"public/images/avatar.svg","hash":"59aab758225591324e94d763344ac38eba39d586","modified":1631463949188},{"_id":"public/images/loading.svg","hash":"eedfa204e08a60ca5c80c620cfe9a3eaa6201585","modified":1631463949188},{"_id":"public/images/bg.svg","hash":"f3106cd334dc2ceef885c19012bf59a48498af42","modified":1631463949188},{"_id":"public/webfonts/fa-regular-400.eot","hash":"2baa9a8aa68f1d2d4712b3c7205f9105aaf21879","modified":1631463949188},{"_id":"public/webfonts/fa-regular-400.ttf","hash":"d64e58981a419de52bac110c979887d34e366135","modified":1631463949188},{"_id":"public/webfonts/fa-regular-400.woff","hash":"26afc29d39ab9fac6d0b607be7e76db093ff7c3a","modified":1631463949188},{"_id":"public/webfonts/fa-regular-400.woff2","hash":"fb9648469530a05fa9aac80e47d4d6960472a242","modified":1631463949188},{"_id":"public/2021/03/22/k8s/istio/debug-istio/img_1.png","hash":"0123a63e3dd6f6b377025352b9f52d5be426bcec","modified":1631463949188},{"_id":"public/2021/03/22/k8s/istio/debug-istio/img_2.png","hash":"bbac03ee596ac84fb49a34baab7d136a2a3c0b39","modified":1631463949188},{"_id":"public/2021/08/24/k8s/istio/istio-network/img_1.png","hash":"0123a63e3dd6f6b377025352b9f52d5be426bcec","modified":1631463949188},{"_id":"public/2021/08/24/k8s/istio/istio-network/img_2.png","hash":"bbac03ee596ac84fb49a34baab7d136a2a3c0b39","modified":1631463949188},{"_id":"public/webfonts/fa-brands-400.woff","hash":"a42ac4a94f4e0e9333cdb1b2fb6c13c0ae690ff2","modified":1631463949188},{"_id":"public/webfonts/fa-brands-400.woff2","hash":"f726c4275bb494a045fde059175f072de06c01df","modified":1631463949188},{"_id":"public/webfonts/fa-solid-900.woff","hash":"3b86a0ce15d8d534b65e98560e321a933d310688","modified":1631463949188},{"_id":"public/2021/03/09/analysis/bookinfo.png","hash":"716f52a8700cb5f37df00d58818cff222d9bc3fc","modified":1631463949188},{"_id":"public/2021/03/09/analysis/iptables.png","hash":"38675626595636471c9496f7d99a125a0091d797","modified":1631463949188},{"_id":"public/2021/09/10/go-gc/go-heap/img5.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631463647209},{"_id":"public/2021/09/10/go-gc/go-heap/img6.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631463647209},{"_id":"public/2021/03/10/linux/namespace/img_3.png","hash":"e04907fe20d1af1f5354eb46fcf4dad04cca14a2","modified":1631463949188},{"_id":"public/2021/03/10/linux/namespace/img_2.png","hash":"f3fc281b3d2f5d7143443617e445bb4e82a9fad3","modified":1631463949188},{"_id":"public/webfonts/fa-brands-400.eot","hash":"c719f4375679ee58e156434f9ba9727be669cf07","modified":1631463949188},{"_id":"public/webfonts/fa-regular-400.svg","hash":"c41a688158d577e3a2738137992d49b05b17ab8f","modified":1631463949188},{"_id":"public/webfonts/fa-solid-900.woff2","hash":"9b592048b9062b00f0b2dd782d70a95b7dc69b83","modified":1631463949188},{"_id":"public/webfonts/fa-brands-400.ttf","hash":"9b49c6c5b0cbdef158ae31b2a4e4814555408389","modified":1631463949188},{"_id":"public/2021/09/10/go-gc/go-heap/img4.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631463647209},{"_id":"public/2021/09/10/go-gc/go-heap/img8.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631463647209},{"_id":"public/2021/03/10/linux/namespace/img.png","hash":"243dfe1c5bba4f832da4f2d8ae729f468f8fae16","modified":1631463949188},{"_id":"public/js/back2top.js","hash":"fc8e85f6704e39ae3a613bbec5dd51d449be8010","modified":1631463949188},{"_id":"public/js/code-copy.js","hash":"3fdabac26f6406a4592336f1f444ec966201b5d9","modified":1631463949188},{"_id":"public/js/header-shrink.js","hash":"167b9b6a9ed63c6cf4081cb3c201dd16bbbfb9ad","modified":1631463949188},{"_id":"public/js/lazyload.js","hash":"95aad532f17d7a8119979fc61ade9e626308a2af","modified":1631463949188},{"_id":"public/js/left-side-toggle.js","hash":"618f7cfc45db4d82b2f1d00d8e9ee936bcf9043b","modified":1631463949188},{"_id":"public/js/local-search.js","hash":"9509ec6d2d7d4466fe37ad624cf606f6639fb3fe","modified":1631463949188},{"_id":"public/js/main.js","hash":"ca8ed228cc0bc234be74428d029cfd047eec0ed6","modified":1631463949188},{"_id":"public/js/utils.js","hash":"47c6d222a116498359345777aea383c429975abf","modified":1631463949188},{"_id":"public/js/dark-light-toggle.js","hash":"223e6f1d4e6e70956e4661b58c430e1c68def125","modified":1631463949188},{"_id":"public/css/common/basic.css","hash":"77daf45fd570d037d2b6a89fbb7a8c740a37215a","modified":1631463949188},{"_id":"public/css/common/animated.css","hash":"654c7588d80dc8b481a203e3071b3cedd41c7fde","modified":1631463949188},{"_id":"public/css/common/keep-theme.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1631463949188},{"_id":"public/css/common/markdown.css","hash":"8c9fb9f7fb403e76a4446a7e533ebe36dd702483","modified":1631463949188},{"_id":"public/css/layout/archive-content.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1631463949188},{"_id":"public/js/toc.js","hash":"ae69bf65d2b30d299b6ca9e2361d3b6e0db3a077","modified":1631463949188},{"_id":"public/css/common/variables.css","hash":"157311f7b38a76721f2b6a2a9bd5229fac60df41","modified":1631463949188},{"_id":"public/css/layout/article-content.css","hash":"bb2e9b90086c4a014d0dbeb97cd0beedab27fe9c","modified":1631463949188},{"_id":"public/css/layout/home-content.css","hash":"be1438b849ebf82cea573986fbbd1deed5334a72","modified":1631463949188},{"_id":"public/css/layout/category-list.css","hash":"672859a61a4e93c0514772112fb557395306e940","modified":1631463949188},{"_id":"public/css/layout/category-content.css","hash":"9687f9cbe029092b633fb804c28ecdcb54860511","modified":1631463949188},{"_id":"public/css/layout/page.css","hash":"dc57eee2b360ad0e9910d69653d547f033dbbd4c","modified":1631463949188},{"_id":"public/css/layout/tag-content.css","hash":"90b0cff1ef0228035cdca9ade2adef71c6c8fb5e","modified":1631463949188},{"_id":"public/css/common/codeblock/code-theme.css","hash":"0edc6d498dc0abbaadb152b48e9e7bebb6fd15f4","modified":1631463949188},{"_id":"public/css/common/codeblock/copy-code.css","hash":"fa5f022395fe92b6daea063418a32f8c19be6168","modified":1631463949188},{"_id":"public/css/common/codeblock/highlight.css","hash":"a6584196f859d00cdd962f43c809e44ed89319e4","modified":1631463949188},{"_id":"public/2021/05/30/go-gc/go-heap.html","hash":"cfee5b7fcf246357cbf54407197f0555892766fb","modified":1631463949188},{"_id":"public/2021/05/30/go-gc/go-heap2.html","hash":"30d7618fe9006c92a4b06829bd1802351173b415","modified":1631463949188},{"_id":"public/css/style.css","hash":"0032b3dc34fa2f8a49ec6153a765951475af7ecb","modified":1631463949188},{"_id":"public/webfonts/fa-solid-900.eot","hash":"c39b89f7fa7b66931ab02a54002db5ffcbff206c","modified":1631463949188},{"_id":"public/js/libs/anime.min.js","hash":"47cb482a8a488620a793d50ba8f6752324b46af3","modified":1631463949188},{"_id":"public/js/libs/pjax.min.js","hash":"57ec40cb4898d7ba74a03603d608af378e5431f8","modified":1631463949188},{"_id":"public/2021/09/10/go-gc/go-heap/img2.png","hash":"c3f94b3bac4ed7e5204fbcd60ba145726b3d4117","modified":1631463647209},{"_id":"public/css/font-awesome.min.css","hash":"c508528feb9fd540454f838653cd4863b290df2e","modified":1631463949188},{"_id":"public/webfonts/fa-solid-900.ttf","hash":"d537bf4cc7273ddb3fd754d53f2b241aeafaefe7","modified":1631463949188},{"_id":"public/2021/09/10/go-gc/go-heap/img1.png","hash":"292d6fee67229a732a895ca32b80d90a3331eba7","modified":1631463647209},{"_id":"public/images/bp.jpg","hash":"c4d7d712bcc9b6ace94f394af2c969e45b2b5037","modified":1631463949188},{"_id":"public/webfonts/fa-brands-400.svg","hash":"69a0ff79a9d93a451e9fa90bd79ae7008d2a9da5","modified":1631463949188},{"_id":"public/webfonts/fa-solid-900.svg","hash":"36de6a298660ed3feaab37900f7b28c3e981d80e","modified":1631463949188},{"_id":"public/images/bp.jpeg","hash":"18a96ea39d45d41cf645a42f753b8b24ac67a8b2","modified":1631463949188},{"_id":"public/2021/05/30/go-gc/go-heap/img.png","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1631463949188},{"_id":"public/2021/05/30/go-gc/go-heap/img5.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631463727773},{"_id":"public/2021/05/30/go-gc/go-heap/img4.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631463727773},{"_id":"public/2021/05/30/go-gc/go-heap/img6.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631463727773},{"_id":"public/2021/05/30/go-gc/go-heap/img8.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631463727773},{"_id":"public/2021/05/30/go-gc/go-heap/img2.png","hash":"c3f94b3bac4ed7e5204fbcd60ba145726b3d4117","modified":1631463949188},{"_id":"public/2021/05/30/go-gc/go-heap/img1.png","hash":"292d6fee67229a732a895ca32b80d90a3331eba7","modified":1631463949188},{"_id":"source/_posts/go-gc/go-heap2/img6.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631461853992},{"_id":"source/_posts/go-gc/go-heap2/img4.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631460871092},{"_id":"source/_posts/go-gc/go-heap2/img5.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631461575971},{"_id":"source/_posts/go-gc/go-heap2/img8.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631463374671},{"_id":"public/2021/05/30/go-gc/go-heap2/img4.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631463949188},{"_id":"public/2021/05/30/go-gc/go-heap2/img5.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631463949188},{"_id":"public/2021/05/30/go-gc/go-heap2/img8.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631463949188},{"_id":"public/2021/05/30/go-gc/go-heap2/img6.png","hash":"2733a2c888a5bb4217b844a0cbf86e8a0bd030f4","modified":1631463949188}],"Category":[{"name":"istio","_id":"ckthfc0d1000wsmjrbhns05j8"}],"Data":[],"Page":[{"title":"About","_content":"\n## \n\n\n\n\n\n5,golang`istio``kubernetes`.\n  \n\n* \n* \n* \n* \n* \n*  \n*  \n\n---\n\n## \n\n ClareChu\n golang\n \n \n \n     \n\n### ```` \n\n <img src=\"https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1144858812,282004609&fm=26&gp=0.jpg\" width = \"300\" height = \"200\" alt=\"\" /><img src=\"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fc-ssl.duitang.com%2Fuploads%2Fitem%2F201910%2F08%2F20191008145552_xzpug.thumb.700_0.jpg&refer=http%3A%2F%2Fc-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1617892818&t=1a0b7a75ec599265ae9bc3fc5f47e7d5\" width = \"200\" height = \"200\" alt=\"\" />\n\n---\n\n## \n\nQQ: 1062186165\nEmail: 1062186165@qq.com\nGithub: https://github.com/ClareChu\n","source":"about/index.md","raw":"---\ntitle: About\n---\n\n## \n\n\n\n\n\n5,golang`istio``kubernetes`.\n  \n\n* \n* \n* \n* \n* \n*  \n*  \n\n---\n\n## \n\n ClareChu\n golang\n \n \n \n     \n\n### ```` \n\n <img src=\"https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1144858812,282004609&fm=26&gp=0.jpg\" width = \"300\" height = \"200\" alt=\"\" /><img src=\"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fc-ssl.duitang.com%2Fuploads%2Fitem%2F201910%2F08%2F20191008145552_xzpug.thumb.700_0.jpg&refer=http%3A%2F%2Fc-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1617892818&t=1a0b7a75ec599265ae9bc3fc5f47e7d5\" width = \"200\" height = \"200\" alt=\"\" />\n\n---\n\n## \n\nQQ: 1062186165\nEmail: 1062186165@qq.com\nGithub: https://github.com/ClareChu\n","date":"2021-08-24T16:25:21.622Z","updated":"2021-08-24T16:25:21.622Z","path":"about/index.html","comments":1,"layout":"page","_id":"ckthfc0ce0000smjrdl4y7rw9","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<p>5,golang<code>istio</code><code>kubernetes</code>.<br>  </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li> </li>\n<li> </li>\n</ul>\n<hr>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> ClareChu<br> golang<br> <br> <br> <br>     </p>\n<h3 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\" \"></a><code></code><code></code> </h3><p> <img src=\"https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1144858812,282004609&fm=26&gp=0.jpg\" width=\"300\" height=\"200\" alt=\"\"><img src=\"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fc-ssl.duitang.com%2Fuploads%2Fitem%2F201910%2F08%2F20191008145552_xzpug.thumb.700_0.jpg&refer=http%3A%2F%2Fc-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1617892818&t=1a0b7a75ec599265ae9bc3fc5f47e7d5\" width=\"200\" height=\"200\" alt=\"\"></p>\n<hr>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>QQ: 1062186165<br>Email: <a class=\"link\" href=\"mailto:&#49;&#x30;&#x36;&#50;&#x31;&#56;&#x36;&#49;&#x36;&#53;&#x40;&#113;&#113;&#x2e;&#99;&#111;&#x6d;\">&#49;&#x30;&#x36;&#50;&#x31;&#56;&#x36;&#49;&#x36;&#53;&#x40;&#113;&#113;&#x2e;&#99;&#111;&#x6d;<i class=\"fas fa-external-link-alt\"></i></a><br>Github: <a class=\"link\" href=\"https://github.com/ClareChu\">https://github.com/ClareChu<i class=\"fas fa-external-link-alt\"></i></a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p></p>\n<p>5,golang<code>istio</code><code>kubernetes</code>.<br>  </p>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li> </li>\n<li> </li>\n</ul>\n<hr>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> ClareChu<br> golang<br> <br> <br> <br>     </p>\n<h3 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\" \"></a><code></code><code></code> </h3><p> <img src=\"https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1144858812,282004609&fm=26&gp=0.jpg\" width=\"300\" height=\"200\" alt=\"\"><img src=\"https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fc-ssl.duitang.com%2Fuploads%2Fitem%2F201910%2F08%2F20191008145552_xzpug.thumb.700_0.jpg&refer=http%3A%2F%2Fc-ssl.duitang.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1617892818&t=1a0b7a75ec599265ae9bc3fc5f47e7d5\" width=\"200\" height=\"200\" alt=\"\"></p>\n<hr>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>QQ: 1062186165<br>Email: <a class=\"link\" href=\"mailto:&#49;&#x30;&#x36;&#50;&#x31;&#56;&#x36;&#49;&#x36;&#53;&#x40;&#113;&#113;&#x2e;&#99;&#111;&#x6d;\">&#49;&#x30;&#x36;&#50;&#x31;&#56;&#x36;&#49;&#x36;&#53;&#x40;&#113;&#113;&#x2e;&#99;&#111;&#x6d;<i class=\"fas fa-external-link-alt\"></i></a><br>Github: <a class=\"link\" href=\"https://github.com/ClareChu\">https://github.com/ClareChu<i class=\"fas fa-external-link-alt\"></i></a></p>\n"}],"Post":[{"title":"Compare","date":"2020-03-09T10:36:28.000Z","_content":"\n# Compare\n\n\n\n```go\npackage compare\n\nimport (\n\t\"fmt\"\n\t\"github.com/clarechu/algorithms/code/models\"\n)\n\nfunc show(comparable []*models.Comparable) {\n\tfor i := 0; i < len(comparable); i++ {\n\t\tfmt.Println(comparable[i].Value)\n\t}\n}\n\n//isSorted \nfunc isSorted(comparable []*models.Comparable) bool {\n\tfor i := 1; i < len(comparable); i++ {\n\t\tif less(comparable[i], comparable[i-1]) {\n\t\t\treturn false\n\t\t}\n\t}\n\treturn true\n}\n\n//less v > w\nfunc less(v, w *models.Comparable) bool {\n\treturn v.Value < w.Value\n}\n\n//exchange\nfunc exchange(comparable []*models.Comparable, i, j int) {\n\tc := comparable[i]\n\tcomparable[i] = comparable[j]\n\tcomparable[j] = c\n}\n\n```\n\n\n\n```go\n\nfunc selectSort(a []*models.Comparable) {\n\tn := len(a)\n\tfor i := 0; i < n; i++ {\n\t\tmin := i\n\t\tfor j := i + 1; j < n; j++ {\n\t\t\tif less(a[j], a[min]) {\n\t\t\t\tmin = j\n\t\t\t}\n\t\t}\n\t\texchange(a, min, i)\n\t}\n}\n\n```\n\n\n\n\n```go\n\nfunc insertionSort(a []*models.Comparable) {\n\tn := len(a)\n\tfor i := 0; i < n; i++ {\n\t\tfor j := i; j > 0 && less(a[j], a[j-1]); j-- {\n\t\t\texchange(a, j, j-1)\n\t\t}\n\t}\n}\n\n```\n\n\n\n```go\n\n//Merge Sort \nfunc mergeSort(a []*models.Comparable) {\n\tl := len(a)\n\tmSort(a, 0, l-1)\n}\n\nfunc mSort(a []*models.Comparable, lo, hi int) {\n\tif hi <= lo {\n\t\treturn\n\t}\n\tmid := lo + (hi-lo)/2\n\tmSort(a, lo, mid)\n\tmSort(a, mid+1, hi)\n\tmerge(a, lo, mid, hi)\n}\n\n//merge \n// lo \n// min \n// hi \nfunc merge(a []*models.Comparable, lo, mid, hi int) {\n\ti, j := lo, mid+1\n\td := make([]*models.Comparable, 0)\n\tfor _, k := range a {\n\t\td = append(d, k)\n\t}\n\tfor k := lo; k <= hi; k++ {\n\t\t//  \n\t\tif i > mid {\n\t\t\ta[k] = d[j]\n\t\t\tj++\n\t\t\t//  \n\t\t} else if j > hi {\n\t\t\ta[k] = d[i]\n\t\t\ti++\n\n\t\t} else if less(d[j], d[i]) {\n\t\t\ta[k] = d[j]\n\t\t\tj++\n\t\t} else {\n\t\t\ta[k] = d[i]\n\t\t\ti++\n\t\t}\n\t}\n}\n\n```\n\n\n\n\n\n\n```go\nfunc quick(a []*models.Comparable, lo, hi int) {\n\tif lo >= hi {\n\t\treturn\n\t}\n\tk := a[lo]\n\ti, j := lo, hi\n\tfor {\n\t\tfor ; i < j; j-- {\n\t\t\tif less(a[j], k) {\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tif i < j {\n\t\t\ta[i] = a[j]\n\t\t\ti++\n\t\t}\n\t\tfor ; i < j; i++ {\n\t\t\tif less(k, a[i]) {\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tif i < j {\n\t\t\ta[j] = a[i]\n\t\t\tj--\n\t\t}\n\t\tif i >= j {\n\t\t\tbreak\n\t\t}\n\t}\n\ta[i] = k\n\tquick(a, lo, i-1)\n\tquick(a, i+1, hi)\n}\n```","source":"_posts/compare.md","raw":"---\ntitle: Compare\ndate: 2020-03-09 18:36:28\n---\n\n# Compare\n\n\n\n```go\npackage compare\n\nimport (\n\t\"fmt\"\n\t\"github.com/clarechu/algorithms/code/models\"\n)\n\nfunc show(comparable []*models.Comparable) {\n\tfor i := 0; i < len(comparable); i++ {\n\t\tfmt.Println(comparable[i].Value)\n\t}\n}\n\n//isSorted \nfunc isSorted(comparable []*models.Comparable) bool {\n\tfor i := 1; i < len(comparable); i++ {\n\t\tif less(comparable[i], comparable[i-1]) {\n\t\t\treturn false\n\t\t}\n\t}\n\treturn true\n}\n\n//less v > w\nfunc less(v, w *models.Comparable) bool {\n\treturn v.Value < w.Value\n}\n\n//exchange\nfunc exchange(comparable []*models.Comparable, i, j int) {\n\tc := comparable[i]\n\tcomparable[i] = comparable[j]\n\tcomparable[j] = c\n}\n\n```\n\n\n\n```go\n\nfunc selectSort(a []*models.Comparable) {\n\tn := len(a)\n\tfor i := 0; i < n; i++ {\n\t\tmin := i\n\t\tfor j := i + 1; j < n; j++ {\n\t\t\tif less(a[j], a[min]) {\n\t\t\t\tmin = j\n\t\t\t}\n\t\t}\n\t\texchange(a, min, i)\n\t}\n}\n\n```\n\n\n\n\n```go\n\nfunc insertionSort(a []*models.Comparable) {\n\tn := len(a)\n\tfor i := 0; i < n; i++ {\n\t\tfor j := i; j > 0 && less(a[j], a[j-1]); j-- {\n\t\t\texchange(a, j, j-1)\n\t\t}\n\t}\n}\n\n```\n\n\n\n```go\n\n//Merge Sort \nfunc mergeSort(a []*models.Comparable) {\n\tl := len(a)\n\tmSort(a, 0, l-1)\n}\n\nfunc mSort(a []*models.Comparable, lo, hi int) {\n\tif hi <= lo {\n\t\treturn\n\t}\n\tmid := lo + (hi-lo)/2\n\tmSort(a, lo, mid)\n\tmSort(a, mid+1, hi)\n\tmerge(a, lo, mid, hi)\n}\n\n//merge \n// lo \n// min \n// hi \nfunc merge(a []*models.Comparable, lo, mid, hi int) {\n\ti, j := lo, mid+1\n\td := make([]*models.Comparable, 0)\n\tfor _, k := range a {\n\t\td = append(d, k)\n\t}\n\tfor k := lo; k <= hi; k++ {\n\t\t//  \n\t\tif i > mid {\n\t\t\ta[k] = d[j]\n\t\t\tj++\n\t\t\t//  \n\t\t} else if j > hi {\n\t\t\ta[k] = d[i]\n\t\t\ti++\n\n\t\t} else if less(d[j], d[i]) {\n\t\t\ta[k] = d[j]\n\t\t\tj++\n\t\t} else {\n\t\t\ta[k] = d[i]\n\t\t\ti++\n\t\t}\n\t}\n}\n\n```\n\n\n\n\n\n\n```go\nfunc quick(a []*models.Comparable, lo, hi int) {\n\tif lo >= hi {\n\t\treturn\n\t}\n\tk := a[lo]\n\ti, j := lo, hi\n\tfor {\n\t\tfor ; i < j; j-- {\n\t\t\tif less(a[j], k) {\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tif i < j {\n\t\t\ta[i] = a[j]\n\t\t\ti++\n\t\t}\n\t\tfor ; i < j; i++ {\n\t\t\tif less(k, a[i]) {\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t\tif i < j {\n\t\t\ta[j] = a[i]\n\t\t\tj--\n\t\t}\n\t\tif i >= j {\n\t\t\tbreak\n\t\t}\n\t}\n\ta[i] = k\n\tquick(a, lo, i-1)\n\tquick(a, i+1, hi)\n}\n```","slug":"compare","published":1,"updated":"2021-08-24T16:25:21.600Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0ch0001smjr0v7s5jj7","content":"<h1 id=\"Compare\"><a href=\"#Compare\" class=\"headerlink\" title=\"Compare\"></a>Compare</h1><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> compare</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/clarechu/algorithms/code/models&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">show</span><span class=\"params\">(comparable []*models.Comparable)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; <span class=\"built_in\">len</span>(comparable); i++ &#123;</span><br><span class=\"line\">\t\tfmt.Println(comparable[i].Value)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//isSorted </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">isSorted</span><span class=\"params\">(comparable []*models.Comparable)</span> <span class=\"title\">bool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">1</span>; i &lt; <span class=\"built_in\">len</span>(comparable); i++ &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> less(comparable[i], comparable[i<span class=\"number\">-1</span>]) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//less v &gt; w</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">less</span><span class=\"params\">(v, w *models.Comparable)</span> <span class=\"title\">bool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> v.Value &lt; w.Value</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//exchange</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">exchange</span><span class=\"params\">(comparable []*models.Comparable, i, j <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\tc := comparable[i]</span><br><span class=\"line\">\tcomparable[i] = comparable[j]</span><br><span class=\"line\">\tcomparable[j] = c</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">selectSort</span><span class=\"params\">(a []*models.Comparable)</span></span> &#123;</span><br><span class=\"line\">\tn := <span class=\"built_in\">len</span>(a)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; n; i++ &#123;</span><br><span class=\"line\">\t\tmin := i</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> j := i + <span class=\"number\">1</span>; j &lt; n; j++ &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> less(a[j], a[min]) &#123;</span><br><span class=\"line\">\t\t\t\tmin = j</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\texchange(a, min, i)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">insertionSort</span><span class=\"params\">(a []*models.Comparable)</span></span> &#123;</span><br><span class=\"line\">\tn := <span class=\"built_in\">len</span>(a)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; n; i++ &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> j := i; j &gt; <span class=\"number\">0</span> &amp;&amp; less(a[j], a[j<span class=\"number\">-1</span>]); j-- &#123;</span><br><span class=\"line\">\t\t\texchange(a, j, j<span class=\"number\">-1</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Merge Sort </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">mergeSort</span><span class=\"params\">(a []*models.Comparable)</span></span> &#123;</span><br><span class=\"line\">\tl := <span class=\"built_in\">len</span>(a)</span><br><span class=\"line\">\tmSort(a, <span class=\"number\">0</span>, l<span class=\"number\">-1</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">mSort</span><span class=\"params\">(a []*models.Comparable, lo, hi <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> hi &lt;= lo &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tmid := lo + (hi-lo)/<span class=\"number\">2</span></span><br><span class=\"line\">\tmSort(a, lo, mid)</span><br><span class=\"line\">\tmSort(a, mid+<span class=\"number\">1</span>, hi)</span><br><span class=\"line\">\tmerge(a, lo, mid, hi)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//merge </span></span><br><span class=\"line\"><span class=\"comment\">// lo </span></span><br><span class=\"line\"><span class=\"comment\">// min </span></span><br><span class=\"line\"><span class=\"comment\">// hi </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">merge</span><span class=\"params\">(a []*models.Comparable, lo, mid, hi <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\ti, j := lo, mid+<span class=\"number\">1</span></span><br><span class=\"line\">\td := <span class=\"built_in\">make</span>([]*models.Comparable, <span class=\"number\">0</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, k := <span class=\"keyword\">range</span> a &#123;</span><br><span class=\"line\">\t\td = <span class=\"built_in\">append</span>(d, k)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> k := lo; k &lt;= hi; k++ &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//  </span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> i &gt; mid &#123;</span><br><span class=\"line\">\t\t\ta[k] = d[j]</span><br><span class=\"line\">\t\t\tj++</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//  </span></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> j &gt; hi &#123;</span><br><span class=\"line\">\t\t\ta[k] = d[i]</span><br><span class=\"line\">\t\t\ti++</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> less(d[j], d[i]) &#123;</span><br><span class=\"line\">\t\t\ta[k] = d[j]</span><br><span class=\"line\">\t\t\tj++</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\ta[k] = d[i]</span><br><span class=\"line\">\t\t\ti++</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">quick</span><span class=\"params\">(a []*models.Comparable, lo, hi <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> lo &gt;= hi &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tk := a[lo]</span><br><span class=\"line\">\ti, j := lo, hi</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> ; i &lt; j; j-- &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> less(a[j], k) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> i &lt; j &#123;</span><br><span class=\"line\">\t\t\ta[i] = a[j]</span><br><span class=\"line\">\t\t\ti++</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> ; i &lt; j; i++ &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> less(k, a[i]) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> i &lt; j &#123;</span><br><span class=\"line\">\t\t\ta[j] = a[i]</span><br><span class=\"line\">\t\t\tj--</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> i &gt;= j &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\ta[i] = k</span><br><span class=\"line\">\tquick(a, lo, i<span class=\"number\">-1</span>)</span><br><span class=\"line\">\tquick(a, i+<span class=\"number\">1</span>, hi)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Compare\"><a href=\"#Compare\" class=\"headerlink\" title=\"Compare\"></a>Compare</h1><p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> compare</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;github.com/clarechu/algorithms/code/models&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">show</span><span class=\"params\">(comparable []*models.Comparable)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; <span class=\"built_in\">len</span>(comparable); i++ &#123;</span><br><span class=\"line\">\t\tfmt.Println(comparable[i].Value)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//isSorted </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">isSorted</span><span class=\"params\">(comparable []*models.Comparable)</span> <span class=\"title\">bool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">1</span>; i &lt; <span class=\"built_in\">len</span>(comparable); i++ &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> less(comparable[i], comparable[i<span class=\"number\">-1</span>]) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//less v &gt; w</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">less</span><span class=\"params\">(v, w *models.Comparable)</span> <span class=\"title\">bool</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> v.Value &lt; w.Value</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//exchange</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">exchange</span><span class=\"params\">(comparable []*models.Comparable, i, j <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\tc := comparable[i]</span><br><span class=\"line\">\tcomparable[i] = comparable[j]</span><br><span class=\"line\">\tcomparable[j] = c</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">selectSort</span><span class=\"params\">(a []*models.Comparable)</span></span> &#123;</span><br><span class=\"line\">\tn := <span class=\"built_in\">len</span>(a)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; n; i++ &#123;</span><br><span class=\"line\">\t\tmin := i</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> j := i + <span class=\"number\">1</span>; j &lt; n; j++ &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> less(a[j], a[min]) &#123;</span><br><span class=\"line\">\t\t\t\tmin = j</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\texchange(a, min, i)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">insertionSort</span><span class=\"params\">(a []*models.Comparable)</span></span> &#123;</span><br><span class=\"line\">\tn := <span class=\"built_in\">len</span>(a)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; n; i++ &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> j := i; j &gt; <span class=\"number\">0</span> &amp;&amp; less(a[j], a[j<span class=\"number\">-1</span>]); j-- &#123;</span><br><span class=\"line\">\t\t\texchange(a, j, j<span class=\"number\">-1</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//Merge Sort </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">mergeSort</span><span class=\"params\">(a []*models.Comparable)</span></span> &#123;</span><br><span class=\"line\">\tl := <span class=\"built_in\">len</span>(a)</span><br><span class=\"line\">\tmSort(a, <span class=\"number\">0</span>, l<span class=\"number\">-1</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">mSort</span><span class=\"params\">(a []*models.Comparable, lo, hi <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> hi &lt;= lo &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tmid := lo + (hi-lo)/<span class=\"number\">2</span></span><br><span class=\"line\">\tmSort(a, lo, mid)</span><br><span class=\"line\">\tmSort(a, mid+<span class=\"number\">1</span>, hi)</span><br><span class=\"line\">\tmerge(a, lo, mid, hi)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//merge </span></span><br><span class=\"line\"><span class=\"comment\">// lo </span></span><br><span class=\"line\"><span class=\"comment\">// min </span></span><br><span class=\"line\"><span class=\"comment\">// hi </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">merge</span><span class=\"params\">(a []*models.Comparable, lo, mid, hi <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\ti, j := lo, mid+<span class=\"number\">1</span></span><br><span class=\"line\">\td := <span class=\"built_in\">make</span>([]*models.Comparable, <span class=\"number\">0</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, k := <span class=\"keyword\">range</span> a &#123;</span><br><span class=\"line\">\t\td = <span class=\"built_in\">append</span>(d, k)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> k := lo; k &lt;= hi; k++ &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//  </span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> i &gt; mid &#123;</span><br><span class=\"line\">\t\t\ta[k] = d[j]</span><br><span class=\"line\">\t\t\tj++</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//  </span></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> j &gt; hi &#123;</span><br><span class=\"line\">\t\t\ta[k] = d[i]</span><br><span class=\"line\">\t\t\ti++</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> less(d[j], d[i]) &#123;</span><br><span class=\"line\">\t\t\ta[k] = d[j]</span><br><span class=\"line\">\t\t\tj++</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\ta[k] = d[i]</span><br><span class=\"line\">\t\t\ti++</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">quick</span><span class=\"params\">(a []*models.Comparable, lo, hi <span class=\"keyword\">int</span>)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> lo &gt;= hi &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tk := a[lo]</span><br><span class=\"line\">\ti, j := lo, hi</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> ; i &lt; j; j-- &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> less(a[j], k) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> i &lt; j &#123;</span><br><span class=\"line\">\t\t\ta[i] = a[j]</span><br><span class=\"line\">\t\t\ti++</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> ; i &lt; j; i++ &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> less(k, a[i]) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> i &lt; j &#123;</span><br><span class=\"line\">\t\t\ta[j] = a[i]</span><br><span class=\"line\">\t\t\tj--</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> i &gt;= j &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\ta[i] = k</span><br><span class=\"line\">\tquick(a, lo, i<span class=\"number\">-1</span>)</span><br><span class=\"line\">\tquick(a, i+<span class=\"number\">1</span>, hi)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"","date":"2021-07-12T05:31:12.000Z","_content":"\n\n\n\n\ninit(1)init\n\nfork\nwaitwaitpid\n\n\n","source":"_posts/dale.md","raw":"---\ntitle: \ndate: 2021-07-12 13:31:12\ntags:\n- linux\n---\n\n\n\n\n\ninit(1)init\n\nfork\nwaitwaitpid\n\n\n","slug":"dale","published":1,"updated":"2021-08-24T16:25:21.601Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0cj0002smjr4sgi4er4","content":"<p><br><br>init(1)init</p>\n<p>fork<br>waitwaitpid<br></p>\n","site":{"data":{}},"excerpt":"","more":"<p><br><br>init(1)init</p>\n<p>fork<br>waitwaitpid<br></p>\n"},{"title":"docker","date":"2020-09-20T16:00:00.000Z","_content":"docker\n\n## \n\ndockerlvm/docker/docker\n\n### \n\n```bash\nfdisk /dev/vdb\n\n\n\nmkfs.xfs /dev/vdb1\nmkdir /docker\nmount /dev/vdc1 /docker\n```\n\n```bash\n[root@cloud-jumpserver01 ~]# blkid \n/dev/vdc1: UUID=\"27d703ee-41b1-4b7e-860b-aa465b807e39\" TYPE=\"xfs\" \ncat /etc/fstab \nUUID=27d703ee-41b1-4b7e-860b-aa465b807e39 /dev/vdc1               xfs     defaults        1 1\n```\n\n## docker\n\n```bash\ncat /etc/docker/daemon.json \n{\"registry-mirrors\": [\"http://f1361db2.m.daocloud.io\"],\n\"data-root\": \"/docker\"\n}\n```\n\n## \n\n```bash\nsystemctl daemon-reload\nsystemctl restart docker\n```\n\n## \n\n```bash\ndocker info\nDocker Root Dir: /docker\n\n```\n\n```bash\ndocker ps -a\n```\n\ndocker ps -a\n\n## \n\n```bash\ncp -arp /var/lib/docker/* /docker/\n```\n\n\n\n## docker\n\n```bash\nsystemctl restart docker\n```\n\n## \n\n```bash\ndocker ps -a\nCONTAINER ID        IMAGE                            COMMAND             CREATED             STATUS              PORTS                                              NAMES\n11ea907c531e        jumpserver/jms_guacamole:1.5.3   \"/init\"             12 months ago       Up 4 minutes        127.0.0.1:8081->8080/tcp                           jms_guacamole\nc9b5a730f6ec        jumpserver/jms_koko:1.5.3        \"./entrypoint.sh\"   12 months ago       Up 4 minutes        0.0.0.0:2222->2222/tcp, 127.0.0.1:5000->5000/tcp   jms_koko\n```\n","source":"_posts/docker.md","raw":"---\ntitle: docker\ndate: 2020-09-21\n\ntags: \n- docker\n---\ndocker\n\n## \n\ndockerlvm/docker/docker\n\n### \n\n```bash\nfdisk /dev/vdb\n\n\n\nmkfs.xfs /dev/vdb1\nmkdir /docker\nmount /dev/vdc1 /docker\n```\n\n```bash\n[root@cloud-jumpserver01 ~]# blkid \n/dev/vdc1: UUID=\"27d703ee-41b1-4b7e-860b-aa465b807e39\" TYPE=\"xfs\" \ncat /etc/fstab \nUUID=27d703ee-41b1-4b7e-860b-aa465b807e39 /dev/vdc1               xfs     defaults        1 1\n```\n\n## docker\n\n```bash\ncat /etc/docker/daemon.json \n{\"registry-mirrors\": [\"http://f1361db2.m.daocloud.io\"],\n\"data-root\": \"/docker\"\n}\n```\n\n## \n\n```bash\nsystemctl daemon-reload\nsystemctl restart docker\n```\n\n## \n\n```bash\ndocker info\nDocker Root Dir: /docker\n\n```\n\n```bash\ndocker ps -a\n```\n\ndocker ps -a\n\n## \n\n```bash\ncp -arp /var/lib/docker/* /docker/\n```\n\n\n\n## docker\n\n```bash\nsystemctl restart docker\n```\n\n## \n\n```bash\ndocker ps -a\nCONTAINER ID        IMAGE                            COMMAND             CREATED             STATUS              PORTS                                              NAMES\n11ea907c531e        jumpserver/jms_guacamole:1.5.3   \"/init\"             12 months ago       Up 4 minutes        127.0.0.1:8081->8080/tcp                           jms_guacamole\nc9b5a730f6ec        jumpserver/jms_koko:1.5.3        \"./entrypoint.sh\"   12 months ago       Up 4 minutes        0.0.0.0:2222->2222/tcp, 127.0.0.1:5000->5000/tcp   jms_koko\n```\n","slug":"docker","published":1,"updated":"2021-08-24T16:25:21.602Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0cl0003smjr9y3lauip","content":"<p>docker</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>dockerlvm/docker/docker</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fdisk /dev/vdb</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">mkfs.xfs /dev/vdb1</span><br><span class=\"line\">mkdir /docker</span><br><span class=\"line\">mount /dev/vdc1 /docker</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@cloud-jumpserver01 ~]<span class=\"comment\"># blkid </span></span><br><span class=\"line\">/dev/vdc1: UUID=<span class=\"string\">&quot;27d703ee-41b1-4b7e-860b-aa465b807e39&quot;</span> TYPE=<span class=\"string\">&quot;xfs&quot;</span> </span><br><span class=\"line\">cat /etc/fstab </span><br><span class=\"line\">UUID=27d703ee-41b1-4b7e-860b-aa465b807e39 /dev/vdc1               xfs     defaults        1 1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"docker\"><a href=\"#docker\" class=\"headerlink\" title=\"docker\"></a>docker</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /etc/docker/daemon.json </span><br><span class=\"line\">&#123;<span class=\"string\">&quot;registry-mirrors&quot;</span>: [<span class=\"string\">&quot;http://f1361db2.m.daocloud.io&quot;</span>],</span><br><span class=\"line\"><span class=\"string\">&quot;data-root&quot;</span>: <span class=\"string\">&quot;/docker&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker info</span><br><span class=\"line\">Docker Root Dir: /docker</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker ps -a</span><br></pre></td></tr></table></figure>\n\n<p>docker ps -a</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp -arp /var/lib/docker/* /docker/</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h2 id=\"docker\"><a href=\"#docker\" class=\"headerlink\" title=\"docker\"></a>docker</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker ps -a</span><br><span class=\"line\">CONTAINER ID        IMAGE                            COMMAND             CREATED             STATUS              PORTS                                              NAMES</span><br><span class=\"line\">11ea907c531e        jumpserver/jms_guacamole:1.5.3   <span class=\"string\">&quot;/init&quot;</span>             12 months ago       Up 4 minutes        127.0.0.1:8081-&gt;8080/tcp                           jms_guacamole</span><br><span class=\"line\">c9b5a730f6ec        jumpserver/jms_koko:1.5.3        <span class=\"string\">&quot;./entrypoint.sh&quot;</span>   12 months ago       Up 4 minutes        0.0.0.0:2222-&gt;2222/tcp, 127.0.0.1:5000-&gt;5000/tcp   jms_koko</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p>docker</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>dockerlvm/docker/docker</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fdisk /dev/vdb</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">mkfs.xfs /dev/vdb1</span><br><span class=\"line\">mkdir /docker</span><br><span class=\"line\">mount /dev/vdc1 /docker</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@cloud-jumpserver01 ~]<span class=\"comment\"># blkid </span></span><br><span class=\"line\">/dev/vdc1: UUID=<span class=\"string\">&quot;27d703ee-41b1-4b7e-860b-aa465b807e39&quot;</span> TYPE=<span class=\"string\">&quot;xfs&quot;</span> </span><br><span class=\"line\">cat /etc/fstab </span><br><span class=\"line\">UUID=27d703ee-41b1-4b7e-860b-aa465b807e39 /dev/vdc1               xfs     defaults        1 1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"docker\"><a href=\"#docker\" class=\"headerlink\" title=\"docker\"></a>docker</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /etc/docker/daemon.json </span><br><span class=\"line\">&#123;<span class=\"string\">&quot;registry-mirrors&quot;</span>: [<span class=\"string\">&quot;http://f1361db2.m.daocloud.io&quot;</span>],</span><br><span class=\"line\"><span class=\"string\">&quot;data-root&quot;</span>: <span class=\"string\">&quot;/docker&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker info</span><br><span class=\"line\">Docker Root Dir: /docker</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker ps -a</span><br></pre></td></tr></table></figure>\n\n<p>docker ps -a</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp -arp /var/lib/docker/* /docker/</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h2 id=\"docker\"><a href=\"#docker\" class=\"headerlink\" title=\"docker\"></a>docker</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart docker</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker ps -a</span><br><span class=\"line\">CONTAINER ID        IMAGE                            COMMAND             CREATED             STATUS              PORTS                                              NAMES</span><br><span class=\"line\">11ea907c531e        jumpserver/jms_guacamole:1.5.3   <span class=\"string\">&quot;/init&quot;</span>             12 months ago       Up 4 minutes        127.0.0.1:8081-&gt;8080/tcp                           jms_guacamole</span><br><span class=\"line\">c9b5a730f6ec        jumpserver/jms_koko:1.5.3        <span class=\"string\">&quot;./entrypoint.sh&quot;</span>   12 months ago       Up 4 minutes        0.0.0.0:2222-&gt;2222/tcp, 127.0.0.1:5000-&gt;5000/tcp   jms_koko</span><br></pre></td></tr></table></figure>\n"},{"title":"ebpf","date":"2021-07-12T05:31:12.000Z","_content":"","source":"_posts/ebpf.md","raw":"---\ntitle: ebpf \ndate: 2021-07-12 13:31:12\ntags:\n- linux\n---\n","slug":"ebpf","published":1,"updated":"2021-08-24T16:25:21.602Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0cn0005smjr2ggn2kze","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Golang ","date":"2021-05-30T13:58:12.000Z","_content":"\n\nC/C++(new/malloc)\n\n\n(python/Go/java)\n\n\n\ngolang \n\nGo\n\n \n\n\n```go\nfunc F() {\n    temp := make([]int, 0, 20)\n...\n}\n```\n\nmake\n\n\n\n\n```go\nfunc F() []int{\n    a := make([]int, 0, 20)\n    return a\n}\n\n```\n\n\n\n\nGo\n\n\n\n\n\nCPUPUSHRELEASE\n\n\n\n\n\n\n\n\n\n1\n2\n\n\n\n\n\n\ngo \n\n\nstackheap\n\nGolang \n\nGolang stack frame  return\n\nreturn\n\nGo\n\n\n```go\npackage main\n\ntype Student struct {\nName string\nAge  int\n}\n\nfunc StudentRegister(name string, age int) *Student {\ns := new(Student) //s\n\n    s.Name = name\n    s.Age = age\n\n    return s\n}\n\nfunc main() {\nStudentRegister(\"Jim\", 18)\n}\n\n\n```\n\n\n\n StudentRegister()  s s \n\n\n\n```go\ngo build -gcflags=-m\n```\n\n\n -gcflags  Go \n\n-m \n\n\nStudentRegister()9escapes to heap\n\n\n\n\n```go\npackage main\n\nfunc main() {\n\n\ts := make([]int, 1000, 1000)\n\n    for index, _ := range s {\n        s[index] = index\n    }\n}\n\n```\n\n\n1000 \n\n\n\n1000x10\n\n\n\n\n1gcgc\n\n2( ,)\n\n3\n\n\n\n1\n\n2\n\n3Go\n\n4Gogo build -gcflags '-m\n\n5\n\n6","source":"_posts/go-gc.md","raw":"---\ntitle: Golang \ndate: 2021-05-30 21:58:12\ntags:\n- golang\n---\n\n\nC/C++(new/malloc)\n\n\n(python/Go/java)\n\n\n\ngolang \n\nGo\n\n \n\n\n```go\nfunc F() {\n    temp := make([]int, 0, 20)\n...\n}\n```\n\nmake\n\n\n\n\n```go\nfunc F() []int{\n    a := make([]int, 0, 20)\n    return a\n}\n\n```\n\n\n\n\nGo\n\n\n\n\n\nCPUPUSHRELEASE\n\n\n\n\n\n\n\n\n\n1\n2\n\n\n\n\n\n\ngo \n\n\nstackheap\n\nGolang \n\nGolang stack frame  return\n\nreturn\n\nGo\n\n\n```go\npackage main\n\ntype Student struct {\nName string\nAge  int\n}\n\nfunc StudentRegister(name string, age int) *Student {\ns := new(Student) //s\n\n    s.Name = name\n    s.Age = age\n\n    return s\n}\n\nfunc main() {\nStudentRegister(\"Jim\", 18)\n}\n\n\n```\n\n\n\n StudentRegister()  s s \n\n\n\n```go\ngo build -gcflags=-m\n```\n\n\n -gcflags  Go \n\n-m \n\n\nStudentRegister()9escapes to heap\n\n\n\n\n```go\npackage main\n\nfunc main() {\n\n\ts := make([]int, 1000, 1000)\n\n    for index, _ := range s {\n        s[index] = index\n    }\n}\n\n```\n\n\n1000 \n\n\n\n1000x10\n\n\n\n\n1gcgc\n\n2( ,)\n\n3\n\n\n\n1\n\n2\n\n3Go\n\n4Gogo build -gcflags '-m\n\n5\n\n6","slug":"go-gc","published":1,"updated":"2021-08-24T16:25:21.603Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0co0006smjrgpi378wo","content":"<p>C/C++(new/malloc)<br><br><br>(python/Go/java)</p>\n<p>golang </p>\n<p>Go</p>\n<p> </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">F</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    temp := <span class=\"built_in\">make</span>([]<span class=\"keyword\">int</span>, <span class=\"number\">0</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>make</p>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">F</span><span class=\"params\">()</span> []<span class=\"title\">int</span></span>&#123;</span><br><span class=\"line\">    a := <span class=\"built_in\">make</span>([]<span class=\"keyword\">int</span>, <span class=\"number\">0</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<p>Go</p>\n<p></p>\n<p></p>\n<p>CPUPUSHRELEASE</p>\n<p></p>\n<p></p>\n<p></p>\n<p>1<br>2</p>\n<p></p>\n<p>go </p>\n<p>stackheap</p>\n<p>Golang </p>\n<p>Golang stack frame  return</p>\n<p>return</p>\n<p>Go</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Student <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">Name <span class=\"keyword\">string</span></span><br><span class=\"line\">Age  <span class=\"keyword\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">StudentRegister</span><span class=\"params\">(name <span class=\"keyword\">string</span>, age <span class=\"keyword\">int</span>)</span> *<span class=\"title\">Student</span></span> &#123;</span><br><span class=\"line\">s := <span class=\"built_in\">new</span>(Student) <span class=\"comment\">//s</span></span><br><span class=\"line\"></span><br><span class=\"line\">    s.Name = name</span><br><span class=\"line\">    s.Age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> s</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">StudentRegister(<span class=\"string\">&quot;Jim&quot;</span>, <span class=\"number\">18</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p> StudentRegister()  s s </p>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">go</span> build -gcflags=-m</span><br></pre></td></tr></table></figure>\n\n\n<p> -gcflags  Go </p>\n<p>-m </p>\n<p>StudentRegister()9escapes to heap</p>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\ts := <span class=\"built_in\">make</span>([]<span class=\"keyword\">int</span>, <span class=\"number\">1000</span>, <span class=\"number\">1000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> index, _ := <span class=\"keyword\">range</span> s &#123;</span><br><span class=\"line\">        s[index] = index</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p>1000 </p>\n<p></p>\n<p>1000x10</p>\n<p></p>\n<p>1gcgc</p>\n<p>2( ,)</p>\n<p>3</p>\n<p></p>\n<p>1</p>\n<p>2</p>\n<p>3Go</p>\n<p>4Gogo build -gcflags -m</p>\n<p>5</p>\n<p>6</p>\n","site":{"data":{}},"excerpt":"","more":"<p>C/C++(new/malloc)<br><br><br>(python/Go/java)</p>\n<p>golang </p>\n<p>Go</p>\n<p> </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">F</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    temp := <span class=\"built_in\">make</span>([]<span class=\"keyword\">int</span>, <span class=\"number\">0</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>make</p>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">F</span><span class=\"params\">()</span> []<span class=\"title\">int</span></span>&#123;</span><br><span class=\"line\">    a := <span class=\"built_in\">make</span>([]<span class=\"keyword\">int</span>, <span class=\"number\">0</span>, <span class=\"number\">20</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<p>Go</p>\n<p></p>\n<p></p>\n<p>CPUPUSHRELEASE</p>\n<p></p>\n<p></p>\n<p></p>\n<p>1<br>2</p>\n<p></p>\n<p>go </p>\n<p>stackheap</p>\n<p>Golang </p>\n<p>Golang stack frame  return</p>\n<p>return</p>\n<p>Go</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Student <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">Name <span class=\"keyword\">string</span></span><br><span class=\"line\">Age  <span class=\"keyword\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">StudentRegister</span><span class=\"params\">(name <span class=\"keyword\">string</span>, age <span class=\"keyword\">int</span>)</span> *<span class=\"title\">Student</span></span> &#123;</span><br><span class=\"line\">s := <span class=\"built_in\">new</span>(Student) <span class=\"comment\">//s</span></span><br><span class=\"line\"></span><br><span class=\"line\">    s.Name = name</span><br><span class=\"line\">    s.Age = age</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> s</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">StudentRegister(<span class=\"string\">&quot;Jim&quot;</span>, <span class=\"number\">18</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<p> StudentRegister()  s s </p>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">go</span> build -gcflags=-m</span><br></pre></td></tr></table></figure>\n\n\n<p> -gcflags  Go </p>\n<p>-m </p>\n<p>StudentRegister()9escapes to heap</p>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\ts := <span class=\"built_in\">make</span>([]<span class=\"keyword\">int</span>, <span class=\"number\">1000</span>, <span class=\"number\">1000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> index, _ := <span class=\"keyword\">range</span> s &#123;</span><br><span class=\"line\">        s[index] = index</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p>1000 </p>\n<p></p>\n<p>1000x10</p>\n<p></p>\n<p>1gcgc</p>\n<p>2( ,)</p>\n<p>3</p>\n<p></p>\n<p>1</p>\n<p>2</p>\n<p>3Go</p>\n<p>4Gogo build -gcflags -m</p>\n<p>5</p>\n<p>6</p>\n"},{"title":"golang ","date":"2021-06-28T06:43:55.000Z","_content":"\n## (RWMutex)\n\n\n\n\n\n\n\n\n\n\n\n\n1 :  goroutine , \n\n2 :  goroutine , goroutine \n\n```go\nfunc (rw *RWMutex) Lock       //\nfunc (rw *RWMutex) Unlock     //\nfunc (rw *RWMutex) RLock      //\nfunc (rw *RWMutex) RUnlock    //\n```\n\n## (Mutex)\n\nMutex mutual exclusion\n\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"sync\"\n)\n\nfunc add(count *int, wg *sync.WaitGroup) {\n\tfor i := 0; i < 1000; i++ {\n\t\t*count = *count + 1\n\t}\n\twg.Done()\n}\n\nfunc main() {\n\tvar wg sync.WaitGroup\n\tcount := 0\n\twg.Add(3)\n\tgo add(&count, &wg)\n\tgo add(&count, &wg)\n\tgo add(&count, &wg)\n\n\twg.Wait()\n\tfmt.Println(\"count \", count)\n}\n```\n","source":"_posts/lock.md","raw":"---\ntitle: golang \ndate: 2021-06-28 14:43:55\ntags:\n- golang\n---\n\n## (RWMutex)\n\n\n\n\n\n\n\n\n\n\n\n\n1 :  goroutine , \n\n2 :  goroutine , goroutine \n\n```go\nfunc (rw *RWMutex) Lock       //\nfunc (rw *RWMutex) Unlock     //\nfunc (rw *RWMutex) RLock      //\nfunc (rw *RWMutex) RUnlock    //\n```\n\n## (Mutex)\n\nMutex mutual exclusion\n\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"sync\"\n)\n\nfunc add(count *int, wg *sync.WaitGroup) {\n\tfor i := 0; i < 1000; i++ {\n\t\t*count = *count + 1\n\t}\n\twg.Done()\n}\n\nfunc main() {\n\tvar wg sync.WaitGroup\n\tcount := 0\n\twg.Add(3)\n\tgo add(&count, &wg)\n\tgo add(&count, &wg)\n\tgo add(&count, &wg)\n\n\twg.Wait()\n\tfmt.Println(\"count \", count)\n}\n```\n","slug":"lock","published":1,"updated":"2021-08-24T16:25:21.618Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0co0007smjr7u8p8g5j","content":"<h2 id=\"-RWMutex\"><a href=\"#-RWMutex\" class=\"headerlink\" title=\"(RWMutex)\"></a>(RWMutex)</h2><p><br><br><br><br><br><br><br></p>\n<p></p>\n<p>1 :  goroutine , </p>\n<p>2 :  goroutine , goroutine </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(rw *RWMutex)</span> <span class=\"title\">Lock</span>       //</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(rw *RWMutex)</span> <span class=\"title\">Unlock</span>     //</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(rw *RWMutex)</span> <span class=\"title\">RLock</span>      //</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(rw *RWMutex)</span> <span class=\"title\">RUnlock</span>    //</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"-Mutex\"><a href=\"#-Mutex\" class=\"headerlink\" title=\"(Mutex)\"></a>(Mutex)</h2><p>Mutex mutual exclusion<br></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">add</span><span class=\"params\">(count *<span class=\"keyword\">int</span>, wg *sync.WaitGroup)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++ &#123;</span><br><span class=\"line\">\t\t*count = *count + <span class=\"number\">1</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\twg.Done()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> wg sync.WaitGroup</span><br><span class=\"line\">\tcount := <span class=\"number\">0</span></span><br><span class=\"line\">\twg.Add(<span class=\"number\">3</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> add(&amp;count, &amp;wg)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> add(&amp;count, &amp;wg)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> add(&amp;count, &amp;wg)</span><br><span class=\"line\"></span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;count &quot;</span>, count)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"-RWMutex\"><a href=\"#-RWMutex\" class=\"headerlink\" title=\"(RWMutex)\"></a>(RWMutex)</h2><p><br><br><br><br><br><br><br></p>\n<p></p>\n<p>1 :  goroutine , </p>\n<p>2 :  goroutine , goroutine </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(rw *RWMutex)</span> <span class=\"title\">Lock</span>       //</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(rw *RWMutex)</span> <span class=\"title\">Unlock</span>     //</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(rw *RWMutex)</span> <span class=\"title\">RLock</span>      //</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(rw *RWMutex)</span> <span class=\"title\">RUnlock</span>    //</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"-Mutex\"><a href=\"#-Mutex\" class=\"headerlink\" title=\"(Mutex)\"></a>(Mutex)</h2><p>Mutex mutual exclusion<br></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> (</span><br><span class=\"line\">\t<span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;sync&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">add</span><span class=\"params\">(count *<span class=\"keyword\">int</span>, wg *sync.WaitGroup)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++ &#123;</span><br><span class=\"line\">\t\t*count = *count + <span class=\"number\">1</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\twg.Done()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> wg sync.WaitGroup</span><br><span class=\"line\">\tcount := <span class=\"number\">0</span></span><br><span class=\"line\">\twg.Add(<span class=\"number\">3</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> add(&amp;count, &amp;wg)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> add(&amp;count, &amp;wg)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> add(&amp;count, &amp;wg)</span><br><span class=\"line\"></span><br><span class=\"line\">\twg.Wait()</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;count &quot;</span>, count)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"title":"","date":"2020-09-20T16:00:00.000Z","_content":"\n\n\n\n\n# \n\n\n h > 0  h  h - 1  h \n\n\n# \n\n\n\n# \n\n\n\n\n\n\n\n888\n","source":"_posts/queue.md","raw":"---\ntitle: \ndate: 2020-09-21\n\n---\n\n\n\n\n\n# \n\n\n h > 0  h  h - 1  h \n\n\n# \n\n\n\n# \n\n\n\n\n\n\n\n888\n","slug":"queue","published":1,"updated":"2021-08-24T16:25:21.619Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0cp000asmjr62g9hqti","content":"<p></p>\n<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><br> h &gt; 0  h  h - 1  h <br></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<p></p>\n<p></p>\n<p>888</p>\n","site":{"data":{}},"excerpt":"","more":"<p></p>\n<p></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p><br> h &gt; 0  h  h - 1  h <br></p>\n<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p></p>\n<p></p>\n<p></p>\n<p>888</p>\n"},{"title":"wasm","date":"2021-07-12T05:31:12.000Z","_content":"\n\n# wasm\n\n## envoyWASM filter\n\n####  WASM filter\n\n*  -  Envoy \n\n*  -  Envoy \n\n*  -  C/C++  Rust  WASM\n\n*  -  VM Envoy  WASM  Envoy \n\n*  -  API Envoy \n\n#### \n\n*  C++  70%\n*  WASM \n\n### envoy  WASM SDK\n\nEnvoy Proxy  WASM Envoy Proxy WASM  Envoy Proxy WASM SDK WASM SDK \n\n* C++\n* rust\n* AssemblyScript\n* Go\n\nGo Envoy Proxy WASM SDK Envoy  WASM  Envoy Proxy WASM SDK  API Envoy  WASM \n\n WASM  WASM  VM \n\n```go\n\ntype rootContext struct {\n\t// You'd better embed the default root context\n\t// so that you don't need to reimplement all the methods by yourself.\n\tproxywasm.DefaultRootContext\n}\n\ntype httpHeaders struct {\n\t// we must embed the default context so that you need not to reimplement all the methods by yourself\n\tproxywasm.DefaultHttpContext\n\tcontextID uint32\n}\n```\n\n1. wasm\n\n```bash\n  cmd git:(istio-1.9.4-dev)  ./cmd init demo\n buildVersion = unknown, buildGitRevision = unknown, buildStatus = unknown, buildTag  = unknown, buildHub = unknown\nUse the arrow keys to navigate:     \n? What language do you wish to use for the filter: \n   cpp\n    rust\n    assemblyscript\n    tinygo\n\n```\n\n:\n\n```tree\ndemo\n|-- go.mod\n|-- main.go\n|-- runtime-config.json\n```\n\n2.  :\n   httpkey=\"hello\"  value=\"world\"\n```go\n// Override DefaultHttpContext.\nfunc (ctx *httpHeaders) OnHttpResponseHeaders(numHeaders int, endOfStream bool) types.Action {\n\tif err := proxywasm.SetHttpResponseHeader(\"hello\", \"world\"); err != nil {\n\t\tproxywasm.LogCriticalf(\"failed to set response header: %v\", err)\n\t}\n\treturn types.ActionContinue\n}\n```\n\n3. demo\n\ngowasmtinygo\n\nmacos\n\n```bash\nbrew install tinygo\n```\n\n:\n\n```bash\ntinygo build -o filter.wasm -target=wasi -wasm-abi=generic .\n```\n\n `filter.wasm`\n\n4. wasmscp sidecar , :\n\n```bash\nkubectl get po -n demo\n\nNAME                              READY   STATUS    RESTARTS   AGE\ndetails-v1-5588477696-2sw7b       2/2     Running   0          8d\nproductpage-v1-5bd6875444-j75dp   2/2     Running   0          8d\nratings-v1-c9d5c65fc-l65mq        2/2     Running   0          8d\nreviews-v2-c789c7bdc-tsg7q        2/2     Running   0          8d\nreviews-v3-78944b866f-96nbw       2/2     Running   0          8d\n\nkubectl cp filter.wasm -n demo productpage-v1-5bd6875444-j75dp:/var/local/filter.wasm\n\n```\n\n`filter.wasm`\n```bash\n  wasm git:(main)  k exec -it productpage-v1-5bd6875444-j75dp ls /var/local\nDefaulting container name to productpage.\nUse 'kubectl describe pod/productpage-v1-5bd6875444-j75dp -n demo' to see all of the containers in this pod.\nfilter.wasm\n```\n\n/var/local `filter.wasm`\n\n5. envoyfilter\n\n```yaml\nkubectl apply -f-<<EOF\napiVersion: networking.istio.io/v1alpha3\nkind: EnvoyFilter\nmetadata:\n  name: productpage-v1-examplefilter\n  namespace: demo\nspec:\n  configPatches:\n  - applyTo: HTTP_FILTER\n    match:\n      context: SIDECAR_INBOUND\n      proxy:\n        proxyVersion: '^1\\.8.*'\n      listener:\n        portNumber: 8080\n        filterChain:\n          filter:\n            name: envoy.http_connection_manager\n            subFilter:\n              name: envoy.router\n    patch:\n      operation: INSERT_BEFORE\n      value:\n        config:\n          config:\n            name: productpage-demo\n            rootId: my_root_id\n            vmConfig:\n              code:\n                local:\n                  filename: /var/local/filter.wasm\n              runtime: envoy.wasm.runtime.v8\n              vmId: filter\n              allow_precompiled: true\n        name: envoy.filters.http.wasm\n  workloadSelector:\n    labels:\n      app: productpage\n      version: v1\nEOF\n```\n\n1. productpage HTTP  8080 \n\n```bash\nkubectl run curl --image=xxx --restart=Never -it --rm sh\n\n~ # curl -L -v http://productpage.demo:9080\n```\n\n\n\n```yaml\n    * About to connect() to frontpage.backyards-demo port 8080 (#0)\n    *   Trying 10.10.178.38...\n    * Adding handle: conn: 0x10eadbd8\n    * Adding handle: send: 0\n    * Adding handle: recv: 0\n    * Curl_addHandleToPipeline: length: 1\n    * - Conn 0 (0x10eadbd8) send_pipe: 1, recv_pipe: 0\n    * Connected to frontpage.backyards-demo (10.10.178.38) port 8080 (#0)\n    > GET / HTTP/1.1\n    > User-Agent: curl/7.30.0\n    > Host: frontpage.backyards-demo:8080\n    > Accept: */*\n    >\n    < HTTP/1.1 200 OK\n    < content-type: text/plain\n    < date: Thu, 16 Apr 2020 16:32:20 GMT\n    < content-length: 9\n    < x-envoy-upstream-service-time: 10\n    < resp-header-demo: added by our filter\n    < x-envoy-peer-metadata: CjYKDElOU1RBTkNFX0lQUxImGiQxMC4yMC4xLjU3LGZlODA6OmQwNDM6NDdmZjpmZWYwOmVkMjkK2QEKBkxBQkVMUxLOASrLAQoSCgNhcHASCxoJZnJvbnRwYWdlCiEKEXBvZC10ZW1wbGF0ZS1oYXNoEgwaCjU3OGM2NTU0ZDQKJAoZc2VjdXJpdHkuaXN0aW8uaW8vdGxzTW9k\n    ZRIHGgVpc3RpbwouCh9zZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1uYW1lEgsaCWZyb250cGFnZQorCiNzZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1yZXZpc2lvbhIEGgJ2MQoPCgd2ZXJzaW9uEgQaAnYxChoKB01FU0hfSUQSDxoNY2x1c3Rlci5sb2NhbAonCgROQU1FEh8aHWZyb250cGFnZS12MS01N\n    zhjNjU1NGQ0LWxidnFrCh0KCU5BTUVTUEFDRRIQGg5iYWNreWFyZHMtZGVtbwpXCgVPV05FUhJOGkxrdWJlcm5ldGVzOi8vYXBpcy9hcHBzL3YxL25hbWVzcGFjZXMvYmFja3lhcmRzLWRlbW8vZGVwbG95bWVudHMvZnJvbnRwYWdlLXYxCi8KEVBMQVRGT1JNX01FVEFEQVRBEhoqGAoWCgpjbHVzdGVyX2lkEg\n    gaBm1hc3RlcgocCg9TRVJWSUNFX0FDQ09VTlQSCRoHZGVmYXVsdAofCg1XT1JLTE9BRF9OQU1FEg4aDGZyb250cGFnZS12MQ==\n    < x-envoy-peer-metadata-id: sidecar~10.20.1.57~frontpage-v1-578c6554d4-lbvqk.backyards-demo~backyards-demo.svc.cluster.local\n    < x-by-metadata: CjYKDElOU1RBTkNFX0lQUxImGiQxMC4yMC4xLjU3LGZlODA6OmQwNDM6NDdmZjpmZWYwOmVkMjkK2QEKBkxBQkVMUxLOASrLAQoSCgNhcHASCxoJZnJvbnRwYWdlCiEKEXBvZC10ZW1wbGF0ZS1oYXNoEgwaCjU3OGM2NTU0ZDQKJAoZc2VjdXJpdHkuaXN0aW8uaW8vdGxzTW9kZRIHGgVp\n    c3RpbwouCh9zZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1uYW1lEgsaCWZyb250cGFnZQorCiNzZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1yZXZpc2lvbhIEGgJ2MQoPCgd2ZXJzaW9uEgQaAnYxChoKB01FU0hfSUQSDxoNY2x1c3Rlci5sb2NhbAonCgROQU1FEh8aHWZyb250cGFnZS12MS01NzhjNjU1N\n    GQ0LWxidnFrCh0KCU5BTUVTUEFDRRIQGg5iYWNreWFyZHMtZGVtbwpXCgVPV05FUhJOGkxrdWJlcm5ldGVzOi8vYXBpcy9hcHBzL3YxL25hbWVzcGFjZXMvYmFja3lhcmRzLWRlbW8vZGVwbG95bWVudHMvZnJvbnRwYWdlLXYxCi8KEVBMQVRGT1JNX01FVEFEQVRBEhoqGAoWCgpjbHVzdGVyX2lkEggaBm1hc3\n    RlcgocCg9TRVJWSUNFX0FDQ09VTlQSCRoHZGVmYXVsdAofCg1XT1JLTE9BRF9OQU1FEg4aDGZyb250cGFnZS12MQ==\n    * Server istio-envoy is not blacklisted\n    < server: istio-envoy\n    < x-envoy-decorator-operation: frontpage.backyards-demo.svc.cluster.local:8080/*\n    <\n    * Connection #0 to host frontpage.backyards-demo left intact\n    frontpage\n    \n```\n","source":"_posts/wasm.md","raw":"---\ntitle: wasm\ndate: 2021-07-12 13:31:12\ntags:\n- istio\n---\n\n\n# wasm\n\n## envoyWASM filter\n\n####  WASM filter\n\n*  -  Envoy \n\n*  -  Envoy \n\n*  -  C/C++  Rust  WASM\n\n*  -  VM Envoy  WASM  Envoy \n\n*  -  API Envoy \n\n#### \n\n*  C++  70%\n*  WASM \n\n### envoy  WASM SDK\n\nEnvoy Proxy  WASM Envoy Proxy WASM  Envoy Proxy WASM SDK WASM SDK \n\n* C++\n* rust\n* AssemblyScript\n* Go\n\nGo Envoy Proxy WASM SDK Envoy  WASM  Envoy Proxy WASM SDK  API Envoy  WASM \n\n WASM  WASM  VM \n\n```go\n\ntype rootContext struct {\n\t// You'd better embed the default root context\n\t// so that you don't need to reimplement all the methods by yourself.\n\tproxywasm.DefaultRootContext\n}\n\ntype httpHeaders struct {\n\t// we must embed the default context so that you need not to reimplement all the methods by yourself\n\tproxywasm.DefaultHttpContext\n\tcontextID uint32\n}\n```\n\n1. wasm\n\n```bash\n  cmd git:(istio-1.9.4-dev)  ./cmd init demo\n buildVersion = unknown, buildGitRevision = unknown, buildStatus = unknown, buildTag  = unknown, buildHub = unknown\nUse the arrow keys to navigate:     \n? What language do you wish to use for the filter: \n   cpp\n    rust\n    assemblyscript\n    tinygo\n\n```\n\n:\n\n```tree\ndemo\n|-- go.mod\n|-- main.go\n|-- runtime-config.json\n```\n\n2.  :\n   httpkey=\"hello\"  value=\"world\"\n```go\n// Override DefaultHttpContext.\nfunc (ctx *httpHeaders) OnHttpResponseHeaders(numHeaders int, endOfStream bool) types.Action {\n\tif err := proxywasm.SetHttpResponseHeader(\"hello\", \"world\"); err != nil {\n\t\tproxywasm.LogCriticalf(\"failed to set response header: %v\", err)\n\t}\n\treturn types.ActionContinue\n}\n```\n\n3. demo\n\ngowasmtinygo\n\nmacos\n\n```bash\nbrew install tinygo\n```\n\n:\n\n```bash\ntinygo build -o filter.wasm -target=wasi -wasm-abi=generic .\n```\n\n `filter.wasm`\n\n4. wasmscp sidecar , :\n\n```bash\nkubectl get po -n demo\n\nNAME                              READY   STATUS    RESTARTS   AGE\ndetails-v1-5588477696-2sw7b       2/2     Running   0          8d\nproductpage-v1-5bd6875444-j75dp   2/2     Running   0          8d\nratings-v1-c9d5c65fc-l65mq        2/2     Running   0          8d\nreviews-v2-c789c7bdc-tsg7q        2/2     Running   0          8d\nreviews-v3-78944b866f-96nbw       2/2     Running   0          8d\n\nkubectl cp filter.wasm -n demo productpage-v1-5bd6875444-j75dp:/var/local/filter.wasm\n\n```\n\n`filter.wasm`\n```bash\n  wasm git:(main)  k exec -it productpage-v1-5bd6875444-j75dp ls /var/local\nDefaulting container name to productpage.\nUse 'kubectl describe pod/productpage-v1-5bd6875444-j75dp -n demo' to see all of the containers in this pod.\nfilter.wasm\n```\n\n/var/local `filter.wasm`\n\n5. envoyfilter\n\n```yaml\nkubectl apply -f-<<EOF\napiVersion: networking.istio.io/v1alpha3\nkind: EnvoyFilter\nmetadata:\n  name: productpage-v1-examplefilter\n  namespace: demo\nspec:\n  configPatches:\n  - applyTo: HTTP_FILTER\n    match:\n      context: SIDECAR_INBOUND\n      proxy:\n        proxyVersion: '^1\\.8.*'\n      listener:\n        portNumber: 8080\n        filterChain:\n          filter:\n            name: envoy.http_connection_manager\n            subFilter:\n              name: envoy.router\n    patch:\n      operation: INSERT_BEFORE\n      value:\n        config:\n          config:\n            name: productpage-demo\n            rootId: my_root_id\n            vmConfig:\n              code:\n                local:\n                  filename: /var/local/filter.wasm\n              runtime: envoy.wasm.runtime.v8\n              vmId: filter\n              allow_precompiled: true\n        name: envoy.filters.http.wasm\n  workloadSelector:\n    labels:\n      app: productpage\n      version: v1\nEOF\n```\n\n1. productpage HTTP  8080 \n\n```bash\nkubectl run curl --image=xxx --restart=Never -it --rm sh\n\n~ # curl -L -v http://productpage.demo:9080\n```\n\n\n\n```yaml\n    * About to connect() to frontpage.backyards-demo port 8080 (#0)\n    *   Trying 10.10.178.38...\n    * Adding handle: conn: 0x10eadbd8\n    * Adding handle: send: 0\n    * Adding handle: recv: 0\n    * Curl_addHandleToPipeline: length: 1\n    * - Conn 0 (0x10eadbd8) send_pipe: 1, recv_pipe: 0\n    * Connected to frontpage.backyards-demo (10.10.178.38) port 8080 (#0)\n    > GET / HTTP/1.1\n    > User-Agent: curl/7.30.0\n    > Host: frontpage.backyards-demo:8080\n    > Accept: */*\n    >\n    < HTTP/1.1 200 OK\n    < content-type: text/plain\n    < date: Thu, 16 Apr 2020 16:32:20 GMT\n    < content-length: 9\n    < x-envoy-upstream-service-time: 10\n    < resp-header-demo: added by our filter\n    < x-envoy-peer-metadata: CjYKDElOU1RBTkNFX0lQUxImGiQxMC4yMC4xLjU3LGZlODA6OmQwNDM6NDdmZjpmZWYwOmVkMjkK2QEKBkxBQkVMUxLOASrLAQoSCgNhcHASCxoJZnJvbnRwYWdlCiEKEXBvZC10ZW1wbGF0ZS1oYXNoEgwaCjU3OGM2NTU0ZDQKJAoZc2VjdXJpdHkuaXN0aW8uaW8vdGxzTW9k\n    ZRIHGgVpc3RpbwouCh9zZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1uYW1lEgsaCWZyb250cGFnZQorCiNzZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1yZXZpc2lvbhIEGgJ2MQoPCgd2ZXJzaW9uEgQaAnYxChoKB01FU0hfSUQSDxoNY2x1c3Rlci5sb2NhbAonCgROQU1FEh8aHWZyb250cGFnZS12MS01N\n    zhjNjU1NGQ0LWxidnFrCh0KCU5BTUVTUEFDRRIQGg5iYWNreWFyZHMtZGVtbwpXCgVPV05FUhJOGkxrdWJlcm5ldGVzOi8vYXBpcy9hcHBzL3YxL25hbWVzcGFjZXMvYmFja3lhcmRzLWRlbW8vZGVwbG95bWVudHMvZnJvbnRwYWdlLXYxCi8KEVBMQVRGT1JNX01FVEFEQVRBEhoqGAoWCgpjbHVzdGVyX2lkEg\n    gaBm1hc3RlcgocCg9TRVJWSUNFX0FDQ09VTlQSCRoHZGVmYXVsdAofCg1XT1JLTE9BRF9OQU1FEg4aDGZyb250cGFnZS12MQ==\n    < x-envoy-peer-metadata-id: sidecar~10.20.1.57~frontpage-v1-578c6554d4-lbvqk.backyards-demo~backyards-demo.svc.cluster.local\n    < x-by-metadata: CjYKDElOU1RBTkNFX0lQUxImGiQxMC4yMC4xLjU3LGZlODA6OmQwNDM6NDdmZjpmZWYwOmVkMjkK2QEKBkxBQkVMUxLOASrLAQoSCgNhcHASCxoJZnJvbnRwYWdlCiEKEXBvZC10ZW1wbGF0ZS1oYXNoEgwaCjU3OGM2NTU0ZDQKJAoZc2VjdXJpdHkuaXN0aW8uaW8vdGxzTW9kZRIHGgVp\n    c3RpbwouCh9zZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1uYW1lEgsaCWZyb250cGFnZQorCiNzZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1yZXZpc2lvbhIEGgJ2MQoPCgd2ZXJzaW9uEgQaAnYxChoKB01FU0hfSUQSDxoNY2x1c3Rlci5sb2NhbAonCgROQU1FEh8aHWZyb250cGFnZS12MS01NzhjNjU1N\n    GQ0LWxidnFrCh0KCU5BTUVTUEFDRRIQGg5iYWNreWFyZHMtZGVtbwpXCgVPV05FUhJOGkxrdWJlcm5ldGVzOi8vYXBpcy9hcHBzL3YxL25hbWVzcGFjZXMvYmFja3lhcmRzLWRlbW8vZGVwbG95bWVudHMvZnJvbnRwYWdlLXYxCi8KEVBMQVRGT1JNX01FVEFEQVRBEhoqGAoWCgpjbHVzdGVyX2lkEggaBm1hc3\n    RlcgocCg9TRVJWSUNFX0FDQ09VTlQSCRoHZGVmYXVsdAofCg1XT1JLTE9BRF9OQU1FEg4aDGZyb250cGFnZS12MQ==\n    * Server istio-envoy is not blacklisted\n    < server: istio-envoy\n    < x-envoy-decorator-operation: frontpage.backyards-demo.svc.cluster.local:8080/*\n    <\n    * Connection #0 to host frontpage.backyards-demo left intact\n    frontpage\n    \n```\n","slug":"wasm","published":1,"updated":"2021-08-24T16:25:21.621Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0cq000bsmjr9snx7pql","content":"<h1 id=\"wasm\"><a href=\"#wasm\" class=\"headerlink\" title=\"wasm\"></a>wasm</h1><h2 id=\"envoyWASM-filter\"><a href=\"#envoyWASM-filter\" class=\"headerlink\" title=\"envoyWASM filter\"></a>envoyWASM filter</h2><h4 id=\"-WASM-filter\"><a href=\"#-WASM-filter\" class=\"headerlink\" title=\" WASM filter\"></a> WASM filter</h4><ul>\n<li><p> -  Envoy </p>\n</li>\n<li><p> -  Envoy </p>\n</li>\n<li><p> -  C/C++  Rust  WASM</p>\n</li>\n<li><p> -  VM Envoy  WASM  Envoy </p>\n</li>\n<li><p> -  API Envoy </p>\n</li>\n</ul>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li> C++  70%</li>\n<li> WASM </li>\n</ul>\n<h3 id=\"envoy--WASM-SDK\"><a href=\"#envoy--WASM-SDK\" class=\"headerlink\" title=\"envoy  WASM SDK\"></a>envoy  WASM SDK</h3><p>Envoy Proxy  WASM Envoy Proxy WASM  Envoy Proxy WASM SDK WASM SDK </p>\n<ul>\n<li>C++</li>\n<li>rust</li>\n<li>AssemblyScript</li>\n<li>Go</li>\n</ul>\n<p>Go Envoy Proxy WASM SDK Envoy  WASM  Envoy Proxy WASM SDK  API Envoy  WASM <br><br> WASM  WASM  VM </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> rootContext <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// You&#x27;d better embed the default root context</span></span><br><span class=\"line\">\t<span class=\"comment\">// so that you don&#x27;t need to reimplement all the methods by yourself.</span></span><br><span class=\"line\">\tproxywasm.DefaultRootContext</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> httpHeaders <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// we must embed the default context so that you need not to reimplement all the methods by yourself</span></span><br><span class=\"line\">\tproxywasm.DefaultHttpContext</span><br><span class=\"line\">\tcontextID <span class=\"keyword\">uint32</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>wasm</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  cmd git:(istio-1.9.4-dev)  ./cmd init demo</span><br><span class=\"line\"> buildVersion = unknown, buildGitRevision = unknown, buildStatus = unknown, buildTag  = unknown, buildHub = unknown</span><br><span class=\"line\">Use the arrow keys to navigate:     </span><br><span class=\"line\">? What language <span class=\"keyword\">do</span> you wish to use <span class=\"keyword\">for</span> the filter: </span><br><span class=\"line\">   cpp</span><br><span class=\"line\">    rust</span><br><span class=\"line\">    assemblyscript</span><br><span class=\"line\">    tinygo</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">demo</span><br><span class=\"line\">|-- go.mod</span><br><span class=\"line\">|-- main.go</span><br><span class=\"line\">|-- runtime-config.json</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><p> :<br>httpkey=hello  value=world</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Override DefaultHttpContext.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(ctx *httpHeaders)</span> <span class=\"title\">OnHttpResponseHeaders</span><span class=\"params\">(numHeaders <span class=\"keyword\">int</span>, endOfStream <span class=\"keyword\">bool</span>)</span> <span class=\"title\">types</span>.<span class=\"title\">Action</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err := proxywasm.SetHttpResponseHeader(<span class=\"string\">&quot;hello&quot;</span>, <span class=\"string\">&quot;world&quot;</span>); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tproxywasm.LogCriticalf(<span class=\"string\">&quot;failed to set response header: %v&quot;</span>, err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> types.ActionContinue</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>demo</p>\n</li>\n</ol>\n<p>gowasmtinygo</p>\n<p>macos</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install tinygo</span><br></pre></td></tr></table></figure>\n\n<p>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tinygo build -o filter.wasm -target=wasi -wasm-abi=generic .</span><br></pre></td></tr></table></figure>\n\n<p> <code>filter.wasm</code></p>\n<ol start=\"4\">\n<li>wasmscp sidecar , :</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get po -n demo</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                              READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">details-v1-5588477696-2sw7b       2/2     Running   0          8d</span><br><span class=\"line\">productpage-v1-5bd6875444-j75dp   2/2     Running   0          8d</span><br><span class=\"line\">ratings-v1-c9d5c65fc-l65mq        2/2     Running   0          8d</span><br><span class=\"line\">reviews-v2-c789c7bdc-tsg7q        2/2     Running   0          8d</span><br><span class=\"line\">reviews-v3-78944b866f-96nbw       2/2     Running   0          8d</span><br><span class=\"line\"></span><br><span class=\"line\">kubectl cp filter.wasm -n demo productpage-v1-5bd6875444-j75dp:/var/<span class=\"built_in\">local</span>/filter.wasm</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>filter.wasm</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  wasm git:(main)  k <span class=\"built_in\">exec</span> -it productpage-v1-5bd6875444-j75dp ls /var/<span class=\"built_in\">local</span></span><br><span class=\"line\">Defaulting container name to productpage.</span><br><span class=\"line\">Use <span class=\"string\">&#x27;kubectl describe pod/productpage-v1-5bd6875444-j75dp -n demo&#x27;</span> to see all of the containers <span class=\"keyword\">in</span> this pod.</span><br><span class=\"line\">filter.wasm</span><br></pre></td></tr></table></figure>\n\n<p>/var/local <code>filter.wasm</code></p>\n<ol start=\"5\">\n<li>envoyfilter</li>\n</ol>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">apply</span> <span class=\"string\">-f-&lt;&lt;EOF</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.istio.io/v1alpha3</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">EnvoyFilter</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">productpage-v1-examplefilter</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">configPatches:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">applyTo:</span> <span class=\"string\">HTTP_FILTER</span></span><br><span class=\"line\">    <span class=\"attr\">match:</span></span><br><span class=\"line\">      <span class=\"attr\">context:</span> <span class=\"string\">SIDECAR_INBOUND</span></span><br><span class=\"line\">      <span class=\"attr\">proxy:</span></span><br><span class=\"line\">        <span class=\"attr\">proxyVersion:</span> <span class=\"string\">&#x27;^1\\.8.*&#x27;</span></span><br><span class=\"line\">      <span class=\"attr\">listener:</span></span><br><span class=\"line\">        <span class=\"attr\">portNumber:</span> <span class=\"number\">8080</span></span><br><span class=\"line\">        <span class=\"attr\">filterChain:</span></span><br><span class=\"line\">          <span class=\"attr\">filter:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">envoy.http_connection_manager</span></span><br><span class=\"line\">            <span class=\"attr\">subFilter:</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">envoy.router</span></span><br><span class=\"line\">    <span class=\"attr\">patch:</span></span><br><span class=\"line\">      <span class=\"attr\">operation:</span> <span class=\"string\">INSERT_BEFORE</span></span><br><span class=\"line\">      <span class=\"attr\">value:</span></span><br><span class=\"line\">        <span class=\"attr\">config:</span></span><br><span class=\"line\">          <span class=\"attr\">config:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">productpage-demo</span></span><br><span class=\"line\">            <span class=\"attr\">rootId:</span> <span class=\"string\">my_root_id</span></span><br><span class=\"line\">            <span class=\"attr\">vmConfig:</span></span><br><span class=\"line\">              <span class=\"attr\">code:</span></span><br><span class=\"line\">                <span class=\"attr\">local:</span></span><br><span class=\"line\">                  <span class=\"attr\">filename:</span> <span class=\"string\">/var/local/filter.wasm</span></span><br><span class=\"line\">              <span class=\"attr\">runtime:</span> <span class=\"string\">envoy.wasm.runtime.v8</span></span><br><span class=\"line\">              <span class=\"attr\">vmId:</span> <span class=\"string\">filter</span></span><br><span class=\"line\">              <span class=\"attr\">allow_precompiled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">envoy.filters.http.wasm</span></span><br><span class=\"line\">  <span class=\"attr\">workloadSelector:</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">productpage</span></span><br><span class=\"line\">      <span class=\"attr\">version:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>productpage HTTP  8080 </li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl run curl --image=xxx --restart=Never -it --rm sh</span><br><span class=\"line\"></span><br><span class=\"line\">~ <span class=\"comment\"># curl -L -v http://productpage.demo:9080</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">About</span> <span class=\"string\">to</span> <span class=\"string\">connect()</span> <span class=\"string\">to</span> <span class=\"string\">frontpage.backyards-demo</span> <span class=\"string\">port</span> <span class=\"number\">8080</span> <span class=\"string\">(#0)</span></span><br><span class=\"line\"><span class=\"string\">*</span>   <span class=\"string\">Trying</span> <span class=\"number\">10.10</span><span class=\"number\">.178</span><span class=\"number\">.38</span><span class=\"string\">...</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"attr\">Adding handle: conn:</span> <span class=\"number\">0x10eadbd8</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"attr\">Adding handle: send:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"attr\">Adding handle: recv:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"attr\">Curl_addHandleToPipeline: length:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"bullet\">-</span> <span class=\"string\">Conn</span> <span class=\"number\">0</span> <span class=\"string\">(0x10eadbd8)</span> <span class=\"attr\">send_pipe:</span> <span class=\"number\">1</span><span class=\"string\">,</span> <span class=\"attr\">recv_pipe:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">Connected</span> <span class=\"string\">to</span> <span class=\"string\">frontpage.backyards-demo</span> <span class=\"string\">(10.10.178.38)</span> <span class=\"string\">port</span> <span class=\"number\">8080</span> <span class=\"string\">(#0)</span></span><br><span class=\"line\"><span class=\"string\">&gt;</span> <span class=\"string\">GET</span> <span class=\"string\">/</span> <span class=\"string\">HTTP/1.1</span></span><br><span class=\"line\"><span class=\"string\">&gt;</span> <span class=\"attr\">User-Agent:</span> <span class=\"string\">curl/7.30.0</span></span><br><span class=\"line\"><span class=\"string\">&gt;</span> <span class=\"attr\">Host:</span> <span class=\"string\">frontpage.backyards-demo:8080</span></span><br><span class=\"line\"><span class=\"string\">&gt;</span> <span class=\"attr\">Accept:</span> <span class=\"string\">*/*</span></span><br><span class=\"line\"><span class=\"string\">&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"string\">HTTP/1.1</span> <span class=\"number\">200</span> <span class=\"string\">OK</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">content-type:</span> <span class=\"string\">text/plain</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">date:</span> <span class=\"string\">Thu,</span> <span class=\"number\">16</span> <span class=\"string\">Apr</span> <span class=\"number\">2020 16:32:20 </span><span class=\"string\">GMT</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">content-length:</span> <span class=\"number\">9</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">x-envoy-upstream-service-time:</span> <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">resp-header-demo:</span> <span class=\"string\">added</span> <span class=\"string\">by</span> <span class=\"string\">our</span> <span class=\"string\">filter</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">x-envoy-peer-metadata:</span> <span class=\"string\">CjYKDElOU1RBTkNFX0lQUxImGiQxMC4yMC4xLjU3LGZlODA6OmQwNDM6NDdmZjpmZWYwOmVkMjkK2QEKBkxBQkVMUxLOASrLAQoSCgNhcHASCxoJZnJvbnRwYWdlCiEKEXBvZC10ZW1wbGF0ZS1oYXNoEgwaCjU3OGM2NTU0ZDQKJAoZc2VjdXJpdHkuaXN0aW8uaW8vdGxzTW9k</span></span><br><span class=\"line\"><span class=\"string\">ZRIHGgVpc3RpbwouCh9zZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1uYW1lEgsaCWZyb250cGFnZQorCiNzZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1yZXZpc2lvbhIEGgJ2MQoPCgd2ZXJzaW9uEgQaAnYxChoKB01FU0hfSUQSDxoNY2x1c3Rlci5sb2NhbAonCgROQU1FEh8aHWZyb250cGFnZS12MS01N</span></span><br><span class=\"line\"><span class=\"string\">zhjNjU1NGQ0LWxidnFrCh0KCU5BTUVTUEFDRRIQGg5iYWNreWFyZHMtZGVtbwpXCgVPV05FUhJOGkxrdWJlcm5ldGVzOi8vYXBpcy9hcHBzL3YxL25hbWVzcGFjZXMvYmFja3lhcmRzLWRlbW8vZGVwbG95bWVudHMvZnJvbnRwYWdlLXYxCi8KEVBMQVRGT1JNX01FVEFEQVRBEhoqGAoWCgpjbHVzdGVyX2lkEg</span></span><br><span class=\"line\"><span class=\"string\">gaBm1hc3RlcgocCg9TRVJWSUNFX0FDQ09VTlQSCRoHZGVmYXVsdAofCg1XT1JLTE9BRF9OQU1FEg4aDGZyb250cGFnZS12MQ==</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">x-envoy-peer-metadata-id:</span> <span class=\"string\">sidecar~10.20.1.57~frontpage-v1-578c6554d4-lbvqk.backyards-demo~backyards-demo.svc.cluster.local</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">x-by-metadata:</span> <span class=\"string\">CjYKDElOU1RBTkNFX0lQUxImGiQxMC4yMC4xLjU3LGZlODA6OmQwNDM6NDdmZjpmZWYwOmVkMjkK2QEKBkxBQkVMUxLOASrLAQoSCgNhcHASCxoJZnJvbnRwYWdlCiEKEXBvZC10ZW1wbGF0ZS1oYXNoEgwaCjU3OGM2NTU0ZDQKJAoZc2VjdXJpdHkuaXN0aW8uaW8vdGxzTW9kZRIHGgVp</span></span><br><span class=\"line\"><span class=\"string\">c3RpbwouCh9zZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1uYW1lEgsaCWZyb250cGFnZQorCiNzZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1yZXZpc2lvbhIEGgJ2MQoPCgd2ZXJzaW9uEgQaAnYxChoKB01FU0hfSUQSDxoNY2x1c3Rlci5sb2NhbAonCgROQU1FEh8aHWZyb250cGFnZS12MS01NzhjNjU1N</span></span><br><span class=\"line\"><span class=\"string\">GQ0LWxidnFrCh0KCU5BTUVTUEFDRRIQGg5iYWNreWFyZHMtZGVtbwpXCgVPV05FUhJOGkxrdWJlcm5ldGVzOi8vYXBpcy9hcHBzL3YxL25hbWVzcGFjZXMvYmFja3lhcmRzLWRlbW8vZGVwbG95bWVudHMvZnJvbnRwYWdlLXYxCi8KEVBMQVRGT1JNX01FVEFEQVRBEhoqGAoWCgpjbHVzdGVyX2lkEggaBm1hc3</span></span><br><span class=\"line\"><span class=\"string\">RlcgocCg9TRVJWSUNFX0FDQ09VTlQSCRoHZGVmYXVsdAofCg1XT1JLTE9BRF9OQU1FEg4aDGZyb250cGFnZS12MQ==</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">Server</span> <span class=\"string\">istio-envoy</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">blacklisted</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">server:</span> <span class=\"string\">istio-envoy</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">x-envoy-decorator-operation:</span> <span class=\"string\">frontpage.backyards-demo.svc.cluster.local:8080/*</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">Connection</span> <span class=\"comment\">#0 to host frontpage.backyards-demo left intact</span></span><br><span class=\"line\"><span class=\"string\">frontpage</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"wasm\"><a href=\"#wasm\" class=\"headerlink\" title=\"wasm\"></a>wasm</h1><h2 id=\"envoyWASM-filter\"><a href=\"#envoyWASM-filter\" class=\"headerlink\" title=\"envoyWASM filter\"></a>envoyWASM filter</h2><h4 id=\"-WASM-filter\"><a href=\"#-WASM-filter\" class=\"headerlink\" title=\" WASM filter\"></a> WASM filter</h4><ul>\n<li><p> -  Envoy </p>\n</li>\n<li><p> -  Envoy </p>\n</li>\n<li><p> -  C/C++  Rust  WASM</p>\n</li>\n<li><p> -  VM Envoy  WASM  Envoy </p>\n</li>\n<li><p> -  API Envoy </p>\n</li>\n</ul>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><ul>\n<li> C++  70%</li>\n<li> WASM </li>\n</ul>\n<h3 id=\"envoy--WASM-SDK\"><a href=\"#envoy--WASM-SDK\" class=\"headerlink\" title=\"envoy  WASM SDK\"></a>envoy  WASM SDK</h3><p>Envoy Proxy  WASM Envoy Proxy WASM  Envoy Proxy WASM SDK WASM SDK </p>\n<ul>\n<li>C++</li>\n<li>rust</li>\n<li>AssemblyScript</li>\n<li>Go</li>\n</ul>\n<p>Go Envoy Proxy WASM SDK Envoy  WASM  Envoy Proxy WASM SDK  API Envoy  WASM <br><br> WASM  WASM  VM </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> rootContext <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// You&#x27;d better embed the default root context</span></span><br><span class=\"line\">\t<span class=\"comment\">// so that you don&#x27;t need to reimplement all the methods by yourself.</span></span><br><span class=\"line\">\tproxywasm.DefaultRootContext</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> httpHeaders <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// we must embed the default context so that you need not to reimplement all the methods by yourself</span></span><br><span class=\"line\">\tproxywasm.DefaultHttpContext</span><br><span class=\"line\">\tcontextID <span class=\"keyword\">uint32</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>wasm</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  cmd git:(istio-1.9.4-dev)  ./cmd init demo</span><br><span class=\"line\"> buildVersion = unknown, buildGitRevision = unknown, buildStatus = unknown, buildTag  = unknown, buildHub = unknown</span><br><span class=\"line\">Use the arrow keys to navigate:     </span><br><span class=\"line\">? What language <span class=\"keyword\">do</span> you wish to use <span class=\"keyword\">for</span> the filter: </span><br><span class=\"line\">   cpp</span><br><span class=\"line\">    rust</span><br><span class=\"line\">    assemblyscript</span><br><span class=\"line\">    tinygo</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">demo</span><br><span class=\"line\">|-- go.mod</span><br><span class=\"line\">|-- main.go</span><br><span class=\"line\">|-- runtime-config.json</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><p> :<br>httpkey=hello  value=world</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Override DefaultHttpContext.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(ctx *httpHeaders)</span> <span class=\"title\">OnHttpResponseHeaders</span><span class=\"params\">(numHeaders <span class=\"keyword\">int</span>, endOfStream <span class=\"keyword\">bool</span>)</span> <span class=\"title\">types</span>.<span class=\"title\">Action</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err := proxywasm.SetHttpResponseHeader(<span class=\"string\">&quot;hello&quot;</span>, <span class=\"string\">&quot;world&quot;</span>); err != <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\tproxywasm.LogCriticalf(<span class=\"string\">&quot;failed to set response header: %v&quot;</span>, err)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> types.ActionContinue</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>demo</p>\n</li>\n</ol>\n<p>gowasmtinygo</p>\n<p>macos</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install tinygo</span><br></pre></td></tr></table></figure>\n\n<p>:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tinygo build -o filter.wasm -target=wasi -wasm-abi=generic .</span><br></pre></td></tr></table></figure>\n\n<p> <code>filter.wasm</code></p>\n<ol start=\"4\">\n<li>wasmscp sidecar , :</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl get po -n demo</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                              READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">details-v1-5588477696-2sw7b       2/2     Running   0          8d</span><br><span class=\"line\">productpage-v1-5bd6875444-j75dp   2/2     Running   0          8d</span><br><span class=\"line\">ratings-v1-c9d5c65fc-l65mq        2/2     Running   0          8d</span><br><span class=\"line\">reviews-v2-c789c7bdc-tsg7q        2/2     Running   0          8d</span><br><span class=\"line\">reviews-v3-78944b866f-96nbw       2/2     Running   0          8d</span><br><span class=\"line\"></span><br><span class=\"line\">kubectl cp filter.wasm -n demo productpage-v1-5bd6875444-j75dp:/var/<span class=\"built_in\">local</span>/filter.wasm</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>filter.wasm</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  wasm git:(main)  k <span class=\"built_in\">exec</span> -it productpage-v1-5bd6875444-j75dp ls /var/<span class=\"built_in\">local</span></span><br><span class=\"line\">Defaulting container name to productpage.</span><br><span class=\"line\">Use <span class=\"string\">&#x27;kubectl describe pod/productpage-v1-5bd6875444-j75dp -n demo&#x27;</span> to see all of the containers <span class=\"keyword\">in</span> this pod.</span><br><span class=\"line\">filter.wasm</span><br></pre></td></tr></table></figure>\n\n<p>/var/local <code>filter.wasm</code></p>\n<ol start=\"5\">\n<li>envoyfilter</li>\n</ol>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">apply</span> <span class=\"string\">-f-&lt;&lt;EOF</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.istio.io/v1alpha3</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">EnvoyFilter</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">productpage-v1-examplefilter</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">configPatches:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">applyTo:</span> <span class=\"string\">HTTP_FILTER</span></span><br><span class=\"line\">    <span class=\"attr\">match:</span></span><br><span class=\"line\">      <span class=\"attr\">context:</span> <span class=\"string\">SIDECAR_INBOUND</span></span><br><span class=\"line\">      <span class=\"attr\">proxy:</span></span><br><span class=\"line\">        <span class=\"attr\">proxyVersion:</span> <span class=\"string\">&#x27;^1\\.8.*&#x27;</span></span><br><span class=\"line\">      <span class=\"attr\">listener:</span></span><br><span class=\"line\">        <span class=\"attr\">portNumber:</span> <span class=\"number\">8080</span></span><br><span class=\"line\">        <span class=\"attr\">filterChain:</span></span><br><span class=\"line\">          <span class=\"attr\">filter:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">envoy.http_connection_manager</span></span><br><span class=\"line\">            <span class=\"attr\">subFilter:</span></span><br><span class=\"line\">              <span class=\"attr\">name:</span> <span class=\"string\">envoy.router</span></span><br><span class=\"line\">    <span class=\"attr\">patch:</span></span><br><span class=\"line\">      <span class=\"attr\">operation:</span> <span class=\"string\">INSERT_BEFORE</span></span><br><span class=\"line\">      <span class=\"attr\">value:</span></span><br><span class=\"line\">        <span class=\"attr\">config:</span></span><br><span class=\"line\">          <span class=\"attr\">config:</span></span><br><span class=\"line\">            <span class=\"attr\">name:</span> <span class=\"string\">productpage-demo</span></span><br><span class=\"line\">            <span class=\"attr\">rootId:</span> <span class=\"string\">my_root_id</span></span><br><span class=\"line\">            <span class=\"attr\">vmConfig:</span></span><br><span class=\"line\">              <span class=\"attr\">code:</span></span><br><span class=\"line\">                <span class=\"attr\">local:</span></span><br><span class=\"line\">                  <span class=\"attr\">filename:</span> <span class=\"string\">/var/local/filter.wasm</span></span><br><span class=\"line\">              <span class=\"attr\">runtime:</span> <span class=\"string\">envoy.wasm.runtime.v8</span></span><br><span class=\"line\">              <span class=\"attr\">vmId:</span> <span class=\"string\">filter</span></span><br><span class=\"line\">              <span class=\"attr\">allow_precompiled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">envoy.filters.http.wasm</span></span><br><span class=\"line\">  <span class=\"attr\">workloadSelector:</span></span><br><span class=\"line\">    <span class=\"attr\">labels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">productpage</span></span><br><span class=\"line\">      <span class=\"attr\">version:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>productpage HTTP  8080 </li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl run curl --image=xxx --restart=Never -it --rm sh</span><br><span class=\"line\"></span><br><span class=\"line\">~ <span class=\"comment\"># curl -L -v http://productpage.demo:9080</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">About</span> <span class=\"string\">to</span> <span class=\"string\">connect()</span> <span class=\"string\">to</span> <span class=\"string\">frontpage.backyards-demo</span> <span class=\"string\">port</span> <span class=\"number\">8080</span> <span class=\"string\">(#0)</span></span><br><span class=\"line\"><span class=\"string\">*</span>   <span class=\"string\">Trying</span> <span class=\"number\">10.10</span><span class=\"number\">.178</span><span class=\"number\">.38</span><span class=\"string\">...</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"attr\">Adding handle: conn:</span> <span class=\"number\">0x10eadbd8</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"attr\">Adding handle: send:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"attr\">Adding handle: recv:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"attr\">Curl_addHandleToPipeline: length:</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"bullet\">-</span> <span class=\"string\">Conn</span> <span class=\"number\">0</span> <span class=\"string\">(0x10eadbd8)</span> <span class=\"attr\">send_pipe:</span> <span class=\"number\">1</span><span class=\"string\">,</span> <span class=\"attr\">recv_pipe:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">Connected</span> <span class=\"string\">to</span> <span class=\"string\">frontpage.backyards-demo</span> <span class=\"string\">(10.10.178.38)</span> <span class=\"string\">port</span> <span class=\"number\">8080</span> <span class=\"string\">(#0)</span></span><br><span class=\"line\"><span class=\"string\">&gt;</span> <span class=\"string\">GET</span> <span class=\"string\">/</span> <span class=\"string\">HTTP/1.1</span></span><br><span class=\"line\"><span class=\"string\">&gt;</span> <span class=\"attr\">User-Agent:</span> <span class=\"string\">curl/7.30.0</span></span><br><span class=\"line\"><span class=\"string\">&gt;</span> <span class=\"attr\">Host:</span> <span class=\"string\">frontpage.backyards-demo:8080</span></span><br><span class=\"line\"><span class=\"string\">&gt;</span> <span class=\"attr\">Accept:</span> <span class=\"string\">*/*</span></span><br><span class=\"line\"><span class=\"string\">&gt;</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"string\">HTTP/1.1</span> <span class=\"number\">200</span> <span class=\"string\">OK</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">content-type:</span> <span class=\"string\">text/plain</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">date:</span> <span class=\"string\">Thu,</span> <span class=\"number\">16</span> <span class=\"string\">Apr</span> <span class=\"number\">2020 16:32:20 </span><span class=\"string\">GMT</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">content-length:</span> <span class=\"number\">9</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">x-envoy-upstream-service-time:</span> <span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">resp-header-demo:</span> <span class=\"string\">added</span> <span class=\"string\">by</span> <span class=\"string\">our</span> <span class=\"string\">filter</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">x-envoy-peer-metadata:</span> <span class=\"string\">CjYKDElOU1RBTkNFX0lQUxImGiQxMC4yMC4xLjU3LGZlODA6OmQwNDM6NDdmZjpmZWYwOmVkMjkK2QEKBkxBQkVMUxLOASrLAQoSCgNhcHASCxoJZnJvbnRwYWdlCiEKEXBvZC10ZW1wbGF0ZS1oYXNoEgwaCjU3OGM2NTU0ZDQKJAoZc2VjdXJpdHkuaXN0aW8uaW8vdGxzTW9k</span></span><br><span class=\"line\"><span class=\"string\">ZRIHGgVpc3RpbwouCh9zZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1uYW1lEgsaCWZyb250cGFnZQorCiNzZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1yZXZpc2lvbhIEGgJ2MQoPCgd2ZXJzaW9uEgQaAnYxChoKB01FU0hfSUQSDxoNY2x1c3Rlci5sb2NhbAonCgROQU1FEh8aHWZyb250cGFnZS12MS01N</span></span><br><span class=\"line\"><span class=\"string\">zhjNjU1NGQ0LWxidnFrCh0KCU5BTUVTUEFDRRIQGg5iYWNreWFyZHMtZGVtbwpXCgVPV05FUhJOGkxrdWJlcm5ldGVzOi8vYXBpcy9hcHBzL3YxL25hbWVzcGFjZXMvYmFja3lhcmRzLWRlbW8vZGVwbG95bWVudHMvZnJvbnRwYWdlLXYxCi8KEVBMQVRGT1JNX01FVEFEQVRBEhoqGAoWCgpjbHVzdGVyX2lkEg</span></span><br><span class=\"line\"><span class=\"string\">gaBm1hc3RlcgocCg9TRVJWSUNFX0FDQ09VTlQSCRoHZGVmYXVsdAofCg1XT1JLTE9BRF9OQU1FEg4aDGZyb250cGFnZS12MQ==</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">x-envoy-peer-metadata-id:</span> <span class=\"string\">sidecar~10.20.1.57~frontpage-v1-578c6554d4-lbvqk.backyards-demo~backyards-demo.svc.cluster.local</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">x-by-metadata:</span> <span class=\"string\">CjYKDElOU1RBTkNFX0lQUxImGiQxMC4yMC4xLjU3LGZlODA6OmQwNDM6NDdmZjpmZWYwOmVkMjkK2QEKBkxBQkVMUxLOASrLAQoSCgNhcHASCxoJZnJvbnRwYWdlCiEKEXBvZC10ZW1wbGF0ZS1oYXNoEgwaCjU3OGM2NTU0ZDQKJAoZc2VjdXJpdHkuaXN0aW8uaW8vdGxzTW9kZRIHGgVp</span></span><br><span class=\"line\"><span class=\"string\">c3RpbwouCh9zZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1uYW1lEgsaCWZyb250cGFnZQorCiNzZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1yZXZpc2lvbhIEGgJ2MQoPCgd2ZXJzaW9uEgQaAnYxChoKB01FU0hfSUQSDxoNY2x1c3Rlci5sb2NhbAonCgROQU1FEh8aHWZyb250cGFnZS12MS01NzhjNjU1N</span></span><br><span class=\"line\"><span class=\"string\">GQ0LWxidnFrCh0KCU5BTUVTUEFDRRIQGg5iYWNreWFyZHMtZGVtbwpXCgVPV05FUhJOGkxrdWJlcm5ldGVzOi8vYXBpcy9hcHBzL3YxL25hbWVzcGFjZXMvYmFja3lhcmRzLWRlbW8vZGVwbG95bWVudHMvZnJvbnRwYWdlLXYxCi8KEVBMQVRGT1JNX01FVEFEQVRBEhoqGAoWCgpjbHVzdGVyX2lkEggaBm1hc3</span></span><br><span class=\"line\"><span class=\"string\">RlcgocCg9TRVJWSUNFX0FDQ09VTlQSCRoHZGVmYXVsdAofCg1XT1JLTE9BRF9OQU1FEg4aDGZyb250cGFnZS12MQ==</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">Server</span> <span class=\"string\">istio-envoy</span> <span class=\"string\">is</span> <span class=\"string\">not</span> <span class=\"string\">blacklisted</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">server:</span> <span class=\"string\">istio-envoy</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span> <span class=\"attr\">x-envoy-decorator-operation:</span> <span class=\"string\">frontpage.backyards-demo.svc.cluster.local:8080/*</span></span><br><span class=\"line\"><span class=\"string\">&lt;</span></span><br><span class=\"line\"><span class=\"string\">*</span> <span class=\"string\">Connection</span> <span class=\"comment\">#0 to host frontpage.backyards-demo left intact</span></span><br><span class=\"line\"><span class=\"string\">frontpage</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n"},{"title":"zsh","date":"2021-03-12T06:16:56.000Z","_content":"\n## Linux zsh\n\n1.1 zsh\n\n```bash\n$ sudo apt-get install -y zsh\n```\n\n1.2 oh-my-zsh\n\n```bash\n$ sh -c \"$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\"\n```\n\n1.3 powerline font\n\n```bash\n\n$ sudo apt-get install fonts-powerline\n```\n\n1.4 zsh ~/.zshrcagnoster\n\n```bash\n1 # Set name of the theme to load --- if set to \"random\", it will\n2 # load a random theme each time oh-my-zsh is loaded, in which case,\n3 # to know which specific one was loaded, run: echo $RANDOM_THEME\n4 # See https://github.com/ohmyzsh/ohmyzsh/wiki/Themes\n5 ZSH_THEME=\"agnoster\"\n```\n","source":"_posts/zsh.md","raw":"---\ntitle: zsh\ndate: 2021-03-12 14:16:56\ntags:\n- linux\n---\n\n## Linux zsh\n\n1.1 zsh\n\n```bash\n$ sudo apt-get install -y zsh\n```\n\n1.2 oh-my-zsh\n\n```bash\n$ sh -c \"$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\"\n```\n\n1.3 powerline font\n\n```bash\n\n$ sudo apt-get install fonts-powerline\n```\n\n1.4 zsh ~/.zshrcagnoster\n\n```bash\n1 # Set name of the theme to load --- if set to \"random\", it will\n2 # load a random theme each time oh-my-zsh is loaded, in which case,\n3 # to know which specific one was loaded, run: echo $RANDOM_THEME\n4 # See https://github.com/ohmyzsh/ohmyzsh/wiki/Themes\n5 ZSH_THEME=\"agnoster\"\n```\n","slug":"zsh","published":1,"updated":"2021-08-24T16:25:21.621Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0cs000dsmjr1doy7zqn","content":"<h2 id=\"Linux-zsh\"><a href=\"#Linux-zsh\" class=\"headerlink\" title=\"Linux zsh\"></a>Linux zsh</h2><p>1.1 zsh</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt-get install -y zsh</span><br></pre></td></tr></table></figure>\n\n<p>1.2 oh-my-zsh</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sh -c <span class=\"string\">&quot;<span class=\"subst\">$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>1.3 powerline font</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ sudo apt-get install fonts-powerline</span><br></pre></td></tr></table></figure>\n\n<p>1.4 zsh ~/.zshrcagnoster</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 <span class=\"comment\"># Set name of the theme to load --- if set to &quot;random&quot;, it will</span></span><br><span class=\"line\">2 <span class=\"comment\"># load a random theme each time oh-my-zsh is loaded, in which case,</span></span><br><span class=\"line\">3 <span class=\"comment\"># to know which specific one was loaded, run: echo $RANDOM_THEME</span></span><br><span class=\"line\">4 <span class=\"comment\"># See https://github.com/ohmyzsh/ohmyzsh/wiki/Themes</span></span><br><span class=\"line\">5 ZSH_THEME=<span class=\"string\">&quot;agnoster&quot;</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Linux-zsh\"><a href=\"#Linux-zsh\" class=\"headerlink\" title=\"Linux zsh\"></a>Linux zsh</h2><p>1.1 zsh</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo apt-get install -y zsh</span><br></pre></td></tr></table></figure>\n\n<p>1.2 oh-my-zsh</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sh -c <span class=\"string\">&quot;<span class=\"subst\">$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>1.3 powerline font</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ sudo apt-get install fonts-powerline</span><br></pre></td></tr></table></figure>\n\n<p>1.4 zsh ~/.zshrcagnoster</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1 <span class=\"comment\"># Set name of the theme to load --- if set to &quot;random&quot;, it will</span></span><br><span class=\"line\">2 <span class=\"comment\"># load a random theme each time oh-my-zsh is loaded, in which case,</span></span><br><span class=\"line\">3 <span class=\"comment\"># to know which specific one was loaded, run: echo $RANDOM_THEME</span></span><br><span class=\"line\">4 <span class=\"comment\"># See https://github.com/ohmyzsh/ohmyzsh/wiki/Themes</span></span><br><span class=\"line\">5 ZSH_THEME=<span class=\"string\">&quot;agnoster&quot;</span></span><br></pre></td></tr></table></figure>\n"},{"title":"iptables ","date":"2021-03-09T11:03:03.000Z","_content":"\n\n# iptables \n\niptablesiptables\"\"\"\"netfilter\n\nnetfilterframeworknetfilter\n\niptables\n\niptables tables chains\niptablesiptablesIptablesfilter,nat mangle.chains\n\n![](analysis/iptables.png)\n\n#### \niptablestarget\n\n\n\n* `ACCEPT`\n\n* `DROP`\n\n* `REJECT`\n\n* `SNAT`\n\n* `MASQUERADE`SNATip\n\n* `DNAT`\n\n* `REDIRECT`\n\n* `LOG`/var/log/messages\n\n### iptables4\n\n\n#### 1. Filter\n\n```bash\nFilter\n\n\n\niptableschains\n\nINPUT  \n\nFORWARD  NAT\n\nOUTPUT  \n```\n\n#### 2. NAT\n\n```bash\nNAT\n\nIPportIPIPNatchains\n\nOUTPUT\n\n\n\nPREROUTING\n\nDNATIPIPIP\n\nPOSTROUTING\n\nSNAT\n```\n\n#### 3. Mangle\n\n```bash\nMangle\n\nTTLTOSMARK5chains\n\nINPUT\n\nfilterINPUT\n\nFORWARD\n\nfilterFORWARD\n\nOUTPUT  fileterOUTPUT\n\nPREROUTING  natPREROUTING\n\nPOSTOUTING  natPOSTOUTING\n\n```\n\n#### 4. Raw\n\n```bash\n\n\n```\n\n\n\n### \n\n```bash\n-t `table`\n\n-A`Append`\n\n-D `delete`\n\n-I`insert`\n\n-R`replace`\n\n-L``\n\n-F`flush`\n\n-Z\n\n-N\n\n-P`policy`\n\n-h`help`\n\n-p`proto\tprotocol: by number or name, eg. tcp`\n\n-sip`source`\n\n-dip`destination`\n\n-j`jump`\n\n-i`input`\n\n-o`onput`\n\n--sport`source port`\n\n--dport`destination port`\n\n80HTTP\n```\n\n#### \n\n```bash\n\n$ iptables -A INPUT -i eth1 -p tcp --dport 80 -d 1.2.3.4 -j ACCEPT\n\n```\n\n-A iptables Filter \n\n-i iptables\n\n-p TCP\n\ndport 80\n\n-d IP1.2.3.4IPeth1IP\n\n-j JUMP\n\n\n\n```bash\n# --line-number \n$ iptables -nL  --line-number\n\n# iptables\n$ iptables -I INPUT 4 -p tcp --dport 1234 -j ACCEPT\n\n```\n\nINPUT\n\n```bash\n$ iptables -P INPUT DROP\n$ iptables -P OUTPUT DROP\n```\n\n\n\n\n### nc\n\n-  shell\n\n```bash\nncat -v -lp 8080\n```\n\n#### \n\n```bash\n[root@localhost ~]$ ncat -v -lp 8080\nNcat: Version 7.50 ( https://nmap.org/ncat )\nNcat: Listening on :::8080\nNcat: Listening on 0.0.0.0:8080\nNcat: Connection from 127.0.0.1.\nNcat: Connection from 127.0.0.1:45996.\nxxx\nxxx\n```\n\n##### \n\n```bash\n[root@localhost ~]$ nc -v 127.0.0.1 8080\nNcat: Version 7.50 ( https://nmap.org/ncat )\nNcat: Connected to 127.0.0.1:8080.\nxxx\nxxx\n```\n\n### NAT \n\nnat\n\n\n\n```bash\n\n#  8080 80 \n\n $  iptables -t nat -A PREROUTING -p tcp --dport 8080 -j REDERECT --to-ports 8000\n\n# \n\n\n\n$ iptables -A INPUT -p tcp --dport 8000 -j ACCEPT\n\n$ iptables -A OUTPUT -p tcp --sport 8000 -j ACCEPT\n\n\n```\n\n#### \n\n##### \n\n 10.10.13.111     10.10.13.11110.10.13.110  ,\n\n```bash\niptables -t nat -I PREROUTING -p tcp --dport 8001 -d 10.10.13.111 -j DNAT --to-destination 10.10.13.110\n\niptables -t nat -I POSTROUTING -p tcp --dport 8001 -d 10.10.13.110 -j SNAT --to-destination 10.10.13.111\n```\n","source":"_posts/analysis.md","raw":"---\ntitle: iptables \ndate: 2021-03-09 19:03:03\ntags:\n- iptables\n---\n\n\n# iptables \n\niptablesiptables\"\"\"\"netfilter\n\nnetfilterframeworknetfilter\n\niptables\n\niptables tables chains\niptablesiptablesIptablesfilter,nat mangle.chains\n\n![](analysis/iptables.png)\n\n#### \niptablestarget\n\n\n\n* `ACCEPT`\n\n* `DROP`\n\n* `REJECT`\n\n* `SNAT`\n\n* `MASQUERADE`SNATip\n\n* `DNAT`\n\n* `REDIRECT`\n\n* `LOG`/var/log/messages\n\n### iptables4\n\n\n#### 1. Filter\n\n```bash\nFilter\n\n\n\niptableschains\n\nINPUT  \n\nFORWARD  NAT\n\nOUTPUT  \n```\n\n#### 2. NAT\n\n```bash\nNAT\n\nIPportIPIPNatchains\n\nOUTPUT\n\n\n\nPREROUTING\n\nDNATIPIPIP\n\nPOSTROUTING\n\nSNAT\n```\n\n#### 3. Mangle\n\n```bash\nMangle\n\nTTLTOSMARK5chains\n\nINPUT\n\nfilterINPUT\n\nFORWARD\n\nfilterFORWARD\n\nOUTPUT  fileterOUTPUT\n\nPREROUTING  natPREROUTING\n\nPOSTOUTING  natPOSTOUTING\n\n```\n\n#### 4. Raw\n\n```bash\n\n\n```\n\n\n\n### \n\n```bash\n-t `table`\n\n-A`Append`\n\n-D `delete`\n\n-I`insert`\n\n-R`replace`\n\n-L``\n\n-F`flush`\n\n-Z\n\n-N\n\n-P`policy`\n\n-h`help`\n\n-p`proto\tprotocol: by number or name, eg. tcp`\n\n-sip`source`\n\n-dip`destination`\n\n-j`jump`\n\n-i`input`\n\n-o`onput`\n\n--sport`source port`\n\n--dport`destination port`\n\n80HTTP\n```\n\n#### \n\n```bash\n\n$ iptables -A INPUT -i eth1 -p tcp --dport 80 -d 1.2.3.4 -j ACCEPT\n\n```\n\n-A iptables Filter \n\n-i iptables\n\n-p TCP\n\ndport 80\n\n-d IP1.2.3.4IPeth1IP\n\n-j JUMP\n\n\n\n```bash\n# --line-number \n$ iptables -nL  --line-number\n\n# iptables\n$ iptables -I INPUT 4 -p tcp --dport 1234 -j ACCEPT\n\n```\n\nINPUT\n\n```bash\n$ iptables -P INPUT DROP\n$ iptables -P OUTPUT DROP\n```\n\n\n\n\n### nc\n\n-  shell\n\n```bash\nncat -v -lp 8080\n```\n\n#### \n\n```bash\n[root@localhost ~]$ ncat -v -lp 8080\nNcat: Version 7.50 ( https://nmap.org/ncat )\nNcat: Listening on :::8080\nNcat: Listening on 0.0.0.0:8080\nNcat: Connection from 127.0.0.1.\nNcat: Connection from 127.0.0.1:45996.\nxxx\nxxx\n```\n\n##### \n\n```bash\n[root@localhost ~]$ nc -v 127.0.0.1 8080\nNcat: Version 7.50 ( https://nmap.org/ncat )\nNcat: Connected to 127.0.0.1:8080.\nxxx\nxxx\n```\n\n### NAT \n\nnat\n\n\n\n```bash\n\n#  8080 80 \n\n $  iptables -t nat -A PREROUTING -p tcp --dport 8080 -j REDERECT --to-ports 8000\n\n# \n\n\n\n$ iptables -A INPUT -p tcp --dport 8000 -j ACCEPT\n\n$ iptables -A OUTPUT -p tcp --sport 8000 -j ACCEPT\n\n\n```\n\n#### \n\n##### \n\n 10.10.13.111     10.10.13.11110.10.13.110  ,\n\n```bash\niptables -t nat -I PREROUTING -p tcp --dport 8001 -d 10.10.13.111 -j DNAT --to-destination 10.10.13.110\n\niptables -t nat -I POSTROUTING -p tcp --dport 8001 -d 10.10.13.110 -j SNAT --to-destination 10.10.13.111\n```\n","slug":"analysis","published":1,"updated":"2021-08-24T16:25:21.597Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0ct000fsmjrc2lcefkq","content":"<h1 id=\"iptables-\"><a href=\"#iptables-\" class=\"headerlink\" title=\"iptables \"></a>iptables </h1><p>iptablesiptablesnetfilter</p>\n<p>netfilterframeworknetfilter</p>\n<p>iptables</p>\n<p>iptables tables chains<br>iptablesiptablesIptablesfilter,nat mangle.chains</p>\n<p><img src=\"/2021/03/09/analysis/iptables.png\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>iptablestarget</p>\n<p></p>\n<ul>\n<li><p><code>ACCEPT</code></p>\n</li>\n<li><p><code>DROP</code></p>\n</li>\n<li><p><code>REJECT</code></p>\n</li>\n<li><p><code>SNAT</code></p>\n</li>\n<li><p><code>MASQUERADE</code>SNATip</p>\n</li>\n<li><p><code>DNAT</code></p>\n</li>\n<li><p><code>REDIRECT</code></p>\n</li>\n<li><p><code>LOG</code>/var/log/messages</p>\n</li>\n</ul>\n<h3 id=\"iptables4\"><a href=\"#iptables4\" class=\"headerlink\" title=\"iptables4\"></a>iptables4</h3><h4 id=\"1-Filter\"><a href=\"#1-Filter\" class=\"headerlink\" title=\"1. Filter\"></a>1. Filter</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Filter</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">iptableschains</span><br><span class=\"line\"></span><br><span class=\"line\">INPUT  </span><br><span class=\"line\"></span><br><span class=\"line\">FORWARD  NAT</span><br><span class=\"line\"></span><br><span class=\"line\">OUTPUT  </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-NAT\"><a href=\"#2-NAT\" class=\"headerlink\" title=\"2. NAT\"></a>2. NAT</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NAT</span><br><span class=\"line\"></span><br><span class=\"line\">IPportIPIPNatchains</span><br><span class=\"line\"></span><br><span class=\"line\">OUTPUT</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PREROUTING</span><br><span class=\"line\"></span><br><span class=\"line\">DNATIPIPIP</span><br><span class=\"line\"></span><br><span class=\"line\">POSTROUTING</span><br><span class=\"line\"></span><br><span class=\"line\">SNAT</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-Mangle\"><a href=\"#3-Mangle\" class=\"headerlink\" title=\"3. Mangle\"></a>3. Mangle</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Mangle</span><br><span class=\"line\"></span><br><span class=\"line\">TTLTOSMARK5chains</span><br><span class=\"line\"></span><br><span class=\"line\">INPUT</span><br><span class=\"line\"></span><br><span class=\"line\">filterINPUT</span><br><span class=\"line\"></span><br><span class=\"line\">FORWARD</span><br><span class=\"line\"></span><br><span class=\"line\">filterFORWARD</span><br><span class=\"line\"></span><br><span class=\"line\">OUTPUT  fileterOUTPUT</span><br><span class=\"line\"></span><br><span class=\"line\">PREROUTING  natPREROUTING</span><br><span class=\"line\"></span><br><span class=\"line\">POSTOUTING  natPOSTOUTING</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-Raw\"><a href=\"#4-Raw\" class=\"headerlink\" title=\"4. Raw\"></a>4. Raw</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-t `table`</span><br><span class=\"line\"></span><br><span class=\"line\">-A`Append`</span><br><span class=\"line\"></span><br><span class=\"line\">-D `delete`</span><br><span class=\"line\"></span><br><span class=\"line\">-I`insert`</span><br><span class=\"line\"></span><br><span class=\"line\">-R`replace`</span><br><span class=\"line\"></span><br><span class=\"line\">-L``</span><br><span class=\"line\"></span><br><span class=\"line\">-F`flush`</span><br><span class=\"line\"></span><br><span class=\"line\">-Z</span><br><span class=\"line\"></span><br><span class=\"line\">-N</span><br><span class=\"line\"></span><br><span class=\"line\">-P`policy`</span><br><span class=\"line\"></span><br><span class=\"line\">-h`<span class=\"built_in\">help</span>`</span><br><span class=\"line\"></span><br><span class=\"line\">-p`proto\tprotocol: by number or name, eg. tcp`</span><br><span class=\"line\"></span><br><span class=\"line\">-sip`<span class=\"built_in\">source</span>`</span><br><span class=\"line\"></span><br><span class=\"line\">-dip`destination`</span><br><span class=\"line\"></span><br><span class=\"line\">-j`jump`</span><br><span class=\"line\"></span><br><span class=\"line\">-i`input`</span><br><span class=\"line\"></span><br><span class=\"line\">-o`onput`</span><br><span class=\"line\"></span><br><span class=\"line\">--sport`<span class=\"built_in\">source</span> port`</span><br><span class=\"line\"></span><br><span class=\"line\">--dport`destination port`</span><br><span class=\"line\"></span><br><span class=\"line\">80HTTP</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ iptables -A INPUT -i eth1 -p tcp --dport 80 -d 1.2.3.4 -j ACCEPT</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>-A iptables Filter </p>\n<p>-i iptables</p>\n<p>-p TCP</p>\n<p>dport 80</p>\n<p>-d IP1.2.3.4IPeth1IP</p>\n<p>-j JUMP</p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># --line-number </span></span><br><span class=\"line\">$ iptables -nL  --line-number</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># iptables</span></span><br><span class=\"line\">$ iptables -I INPUT 4 -p tcp --dport 1234 -j ACCEPT</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>INPUT</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ iptables -P INPUT DROP</span><br><span class=\"line\">$ iptables -P OUTPUT DROP</span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<h3 id=\"nc\"><a href=\"#nc\" class=\"headerlink\" title=\"nc\"></a>nc</h3><p>-  shell</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ncat -v -lp 8080</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]$ ncat -v -lp 8080</span><br><span class=\"line\">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class=\"line\">Ncat: Listening on :::8080</span><br><span class=\"line\">Ncat: Listening on 0.0.0.0:8080</span><br><span class=\"line\">Ncat: Connection from 127.0.0.1.</span><br><span class=\"line\">Ncat: Connection from 127.0.0.1:45996.</span><br><span class=\"line\">xxx</span><br><span class=\"line\">xxx</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]$ nc -v 127.0.0.1 8080</span><br><span class=\"line\">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class=\"line\">Ncat: Connected to 127.0.0.1:8080.</span><br><span class=\"line\">xxx</span><br><span class=\"line\">xxx</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"NAT-\"><a href=\"#NAT-\" class=\"headerlink\" title=\"NAT \"></a>NAT </h3><p>nat</p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  8080 80 </span></span><br><span class=\"line\"></span><br><span class=\"line\"> $  iptables -t nat -A PREROUTING -p tcp --dport 8080 -j REDERECT --to-ports 8000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ iptables -A INPUT -p tcp --dport 8000 -j ACCEPT</span><br><span class=\"line\"></span><br><span class=\"line\">$ iptables -A OUTPUT -p tcp --sport 8000 -j ACCEPT</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p> 10.10.13.111     10.10.13.11110.10.13.110  ,</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -t nat -I PREROUTING -p tcp --dport 8001 -d 10.10.13.111 -j DNAT --to-destination 10.10.13.110</span><br><span class=\"line\"></span><br><span class=\"line\">iptables -t nat -I POSTROUTING -p tcp --dport 8001 -d 10.10.13.110 -j SNAT --to-destination 10.10.13.111</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"iptables-\"><a href=\"#iptables-\" class=\"headerlink\" title=\"iptables \"></a>iptables </h1><p>iptablesiptablesnetfilter</p>\n<p>netfilterframeworknetfilter</p>\n<p>iptables</p>\n<p>iptables tables chains<br>iptablesiptablesIptablesfilter,nat mangle.chains</p>\n<p><img src=\"/2021/03/09/analysis/iptables.png\"></p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><p>iptablestarget</p>\n<p></p>\n<ul>\n<li><p><code>ACCEPT</code></p>\n</li>\n<li><p><code>DROP</code></p>\n</li>\n<li><p><code>REJECT</code></p>\n</li>\n<li><p><code>SNAT</code></p>\n</li>\n<li><p><code>MASQUERADE</code>SNATip</p>\n</li>\n<li><p><code>DNAT</code></p>\n</li>\n<li><p><code>REDIRECT</code></p>\n</li>\n<li><p><code>LOG</code>/var/log/messages</p>\n</li>\n</ul>\n<h3 id=\"iptables4\"><a href=\"#iptables4\" class=\"headerlink\" title=\"iptables4\"></a>iptables4</h3><h4 id=\"1-Filter\"><a href=\"#1-Filter\" class=\"headerlink\" title=\"1. Filter\"></a>1. Filter</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Filter</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">iptableschains</span><br><span class=\"line\"></span><br><span class=\"line\">INPUT  </span><br><span class=\"line\"></span><br><span class=\"line\">FORWARD  NAT</span><br><span class=\"line\"></span><br><span class=\"line\">OUTPUT  </span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-NAT\"><a href=\"#2-NAT\" class=\"headerlink\" title=\"2. NAT\"></a>2. NAT</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NAT</span><br><span class=\"line\"></span><br><span class=\"line\">IPportIPIPNatchains</span><br><span class=\"line\"></span><br><span class=\"line\">OUTPUT</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PREROUTING</span><br><span class=\"line\"></span><br><span class=\"line\">DNATIPIPIP</span><br><span class=\"line\"></span><br><span class=\"line\">POSTROUTING</span><br><span class=\"line\"></span><br><span class=\"line\">SNAT</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3-Mangle\"><a href=\"#3-Mangle\" class=\"headerlink\" title=\"3. Mangle\"></a>3. Mangle</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Mangle</span><br><span class=\"line\"></span><br><span class=\"line\">TTLTOSMARK5chains</span><br><span class=\"line\"></span><br><span class=\"line\">INPUT</span><br><span class=\"line\"></span><br><span class=\"line\">filterINPUT</span><br><span class=\"line\"></span><br><span class=\"line\">FORWARD</span><br><span class=\"line\"></span><br><span class=\"line\">filterFORWARD</span><br><span class=\"line\"></span><br><span class=\"line\">OUTPUT  fileterOUTPUT</span><br><span class=\"line\"></span><br><span class=\"line\">PREROUTING  natPREROUTING</span><br><span class=\"line\"></span><br><span class=\"line\">POSTOUTING  natPOSTOUTING</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-Raw\"><a href=\"#4-Raw\" class=\"headerlink\" title=\"4. Raw\"></a>4. Raw</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-t `table`</span><br><span class=\"line\"></span><br><span class=\"line\">-A`Append`</span><br><span class=\"line\"></span><br><span class=\"line\">-D `delete`</span><br><span class=\"line\"></span><br><span class=\"line\">-I`insert`</span><br><span class=\"line\"></span><br><span class=\"line\">-R`replace`</span><br><span class=\"line\"></span><br><span class=\"line\">-L``</span><br><span class=\"line\"></span><br><span class=\"line\">-F`flush`</span><br><span class=\"line\"></span><br><span class=\"line\">-Z</span><br><span class=\"line\"></span><br><span class=\"line\">-N</span><br><span class=\"line\"></span><br><span class=\"line\">-P`policy`</span><br><span class=\"line\"></span><br><span class=\"line\">-h`<span class=\"built_in\">help</span>`</span><br><span class=\"line\"></span><br><span class=\"line\">-p`proto\tprotocol: by number or name, eg. tcp`</span><br><span class=\"line\"></span><br><span class=\"line\">-sip`<span class=\"built_in\">source</span>`</span><br><span class=\"line\"></span><br><span class=\"line\">-dip`destination`</span><br><span class=\"line\"></span><br><span class=\"line\">-j`jump`</span><br><span class=\"line\"></span><br><span class=\"line\">-i`input`</span><br><span class=\"line\"></span><br><span class=\"line\">-o`onput`</span><br><span class=\"line\"></span><br><span class=\"line\">--sport`<span class=\"built_in\">source</span> port`</span><br><span class=\"line\"></span><br><span class=\"line\">--dport`destination port`</span><br><span class=\"line\"></span><br><span class=\"line\">80HTTP</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ iptables -A INPUT -i eth1 -p tcp --dport 80 -d 1.2.3.4 -j ACCEPT</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>-A iptables Filter </p>\n<p>-i iptables</p>\n<p>-p TCP</p>\n<p>dport 80</p>\n<p>-d IP1.2.3.4IPeth1IP</p>\n<p>-j JUMP</p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># --line-number </span></span><br><span class=\"line\">$ iptables -nL  --line-number</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># iptables</span></span><br><span class=\"line\">$ iptables -I INPUT 4 -p tcp --dport 1234 -j ACCEPT</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>INPUT</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ iptables -P INPUT DROP</span><br><span class=\"line\">$ iptables -P OUTPUT DROP</span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<h3 id=\"nc\"><a href=\"#nc\" class=\"headerlink\" title=\"nc\"></a>nc</h3><p>-  shell</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ncat -v -lp 8080</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]$ ncat -v -lp 8080</span><br><span class=\"line\">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class=\"line\">Ncat: Listening on :::8080</span><br><span class=\"line\">Ncat: Listening on 0.0.0.0:8080</span><br><span class=\"line\">Ncat: Connection from 127.0.0.1.</span><br><span class=\"line\">Ncat: Connection from 127.0.0.1:45996.</span><br><span class=\"line\">xxx</span><br><span class=\"line\">xxx</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]$ nc -v 127.0.0.1 8080</span><br><span class=\"line\">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class=\"line\">Ncat: Connected to 127.0.0.1:8080.</span><br><span class=\"line\">xxx</span><br><span class=\"line\">xxx</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"NAT-\"><a href=\"#NAT-\" class=\"headerlink\" title=\"NAT \"></a>NAT </h3><p>nat</p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  8080 80 </span></span><br><span class=\"line\"></span><br><span class=\"line\"> $  iptables -t nat -A PREROUTING -p tcp --dport 8080 -j REDERECT --to-ports 8000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ iptables -A INPUT -p tcp --dport 8000 -j ACCEPT</span><br><span class=\"line\"></span><br><span class=\"line\">$ iptables -A OUTPUT -p tcp --sport 8000 -j ACCEPT</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p> 10.10.13.111     10.10.13.11110.10.13.110  ,</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">iptables -t nat -I PREROUTING -p tcp --dport 8001 -d 10.10.13.111 -j DNAT --to-destination 10.10.13.110</span><br><span class=\"line\"></span><br><span class=\"line\">iptables -t nat -I POSTROUTING -p tcp --dport 8001 -d 10.10.13.110 -j SNAT --to-destination 10.10.13.111</span><br></pre></td></tr></table></figure>\n"},{"title":"gocpu ()","date":"2021-09-12T16:20:13.000Z","_content":"\ngocpu, , , \n\n, prometheus, promql ,  6h simple ,\n, go 10-11 ,\n, , \n\n```prom\ncontainer_memory_usage_bytes{container=\"simple\"}\n```\n\n![img.png](go-heap2/img4.png)\n\n,  pprof, pprof  ,\n79399gorouting, gorouting\n\n![img.png](go-heap2/img5.png)\n\npipeline.go 61 \n\n![img.png](go-heap2/img6.png)\n\n```go\nfunc FilterService(itemChan <-chan ingress.Access, services []string) <-chan ingress.Access {\nchannel := make(chan ingress.Access)\ngo func () {\ndefer close(channel)\ndata := <-itemChan\nif data == nil {\nreturn\n}\nfor _, service := range services {\nif data.ServiceName() == service {\n// gorouting\nchannel <- data\n}\n}\n}()\nreturn channel\n}\n\n```\n\n channel\n\n### :\n\na b := <-a\n\n```go\n\n\nfunc cc() {\n    a := make(chan int)\n    go func() {\n        time.Sleep(1 * time.Second)\n        a <- 1\n        close(a)\n    }()\n    fmt.Println(\"sleep !!!\")\n    time.Sleep(3 * time.Second)\n    a = nil\n    b := <-a\n    fmt.Printf(\"b :%d \\n\", b)\n    fmt.Println(\"complete !!!\")\n}\n\n\n```\n\n### :\n\n\nsize 0 channel , channel 0, \n\n```go\n\nfunc cc1() {\n\ta := make(chan int)\n\tmu := sync.WaitGroup{}\n\tmu.Add(2)\n\tgo func() {\n\t\tdefer close(a)\n\t\ttime.Sleep(10 * time.Second)\n\t\ta <- 1\n\t\tmu.Done()\n\t}()\n\tgo func() {\n\t\tticker := time.NewTicker(1 * time.Second)\n\t\tselect {\n\t\tcase cc := <-a:\n\t\t\tfmt.Println(\"xx\", cc)\n\t\tcase <-ticker.C:\n\t\t\tfmt.Println(\"ticker\")\n\t\t}\n\t\tmu.Done()\n\t}()\n\tmu.Wait()\n\tfmt.Println(\"complete !!!\")\n}\n\n```\n\n\n### \n\n channel data\ndatachannel, select data,\ntick 12s, 12s , \nopentracing\n\n```go\n\nfunc CalculateQPS(data <-chan ingress.Access, timeTick <-chan time.Time,\n\tqpsRecord map[string]*metrics.Calculate) <-chan *serviceInfo {\n\tchannel := make(chan *serviceInfo)\n\tgo func() {\n\t\tdefer close(channel)\n\t\tselect {\n\t\tcase item := <-data:\n\t\t\tif item == nil {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif record, exist := qpsRecord[item.ServiceName()]; exist {\n\t\t\t\trecord.Update(item.Upstream(), item.AccessTime())\n\t\t\t} else {\n\t\t\t\tqpsRecord[item.ServiceName()] = metrics.NewCalculate(item.Upstream(), item.AccessTime())\n\t\t\t}\n\t\tcase <-timeTick:\n\t\t\tfor service, calculate := range qpsRecord {\n\t\t\t\tchannel <- &serviceInfo{Name: service, AvgQps: calculate.AvgQps(), PodCount: calculate.GetPodCount()}\n\t\t\t}\n\t\t}\n\t}()\n\treturn channel\n}\n\n```\n\n\n12us, \n\n![img.png](go-heap2/img8.png)\n\n\n, , gorouting  cpu \n cpu","source":"_posts/go-gc/go-heap2.md","raw":"---\ntitle: gocpu ()\ndate: 2021-09-13 00:20:13 \ntags:\n- go\n\n---\n\ngocpu, , , \n\n, prometheus, promql ,  6h simple ,\n, go 10-11 ,\n, , \n\n```prom\ncontainer_memory_usage_bytes{container=\"simple\"}\n```\n\n![img.png](go-heap2/img4.png)\n\n,  pprof, pprof  ,\n79399gorouting, gorouting\n\n![img.png](go-heap2/img5.png)\n\npipeline.go 61 \n\n![img.png](go-heap2/img6.png)\n\n```go\nfunc FilterService(itemChan <-chan ingress.Access, services []string) <-chan ingress.Access {\nchannel := make(chan ingress.Access)\ngo func () {\ndefer close(channel)\ndata := <-itemChan\nif data == nil {\nreturn\n}\nfor _, service := range services {\nif data.ServiceName() == service {\n// gorouting\nchannel <- data\n}\n}\n}()\nreturn channel\n}\n\n```\n\n channel\n\n### :\n\na b := <-a\n\n```go\n\n\nfunc cc() {\n    a := make(chan int)\n    go func() {\n        time.Sleep(1 * time.Second)\n        a <- 1\n        close(a)\n    }()\n    fmt.Println(\"sleep !!!\")\n    time.Sleep(3 * time.Second)\n    a = nil\n    b := <-a\n    fmt.Printf(\"b :%d \\n\", b)\n    fmt.Println(\"complete !!!\")\n}\n\n\n```\n\n### :\n\n\nsize 0 channel , channel 0, \n\n```go\n\nfunc cc1() {\n\ta := make(chan int)\n\tmu := sync.WaitGroup{}\n\tmu.Add(2)\n\tgo func() {\n\t\tdefer close(a)\n\t\ttime.Sleep(10 * time.Second)\n\t\ta <- 1\n\t\tmu.Done()\n\t}()\n\tgo func() {\n\t\tticker := time.NewTicker(1 * time.Second)\n\t\tselect {\n\t\tcase cc := <-a:\n\t\t\tfmt.Println(\"xx\", cc)\n\t\tcase <-ticker.C:\n\t\t\tfmt.Println(\"ticker\")\n\t\t}\n\t\tmu.Done()\n\t}()\n\tmu.Wait()\n\tfmt.Println(\"complete !!!\")\n}\n\n```\n\n\n### \n\n channel data\ndatachannel, select data,\ntick 12s, 12s , \nopentracing\n\n```go\n\nfunc CalculateQPS(data <-chan ingress.Access, timeTick <-chan time.Time,\n\tqpsRecord map[string]*metrics.Calculate) <-chan *serviceInfo {\n\tchannel := make(chan *serviceInfo)\n\tgo func() {\n\t\tdefer close(channel)\n\t\tselect {\n\t\tcase item := <-data:\n\t\t\tif item == nil {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tif record, exist := qpsRecord[item.ServiceName()]; exist {\n\t\t\t\trecord.Update(item.Upstream(), item.AccessTime())\n\t\t\t} else {\n\t\t\t\tqpsRecord[item.ServiceName()] = metrics.NewCalculate(item.Upstream(), item.AccessTime())\n\t\t\t}\n\t\tcase <-timeTick:\n\t\t\tfor service, calculate := range qpsRecord {\n\t\t\t\tchannel <- &serviceInfo{Name: service, AvgQps: calculate.AvgQps(), PodCount: calculate.GetPodCount()}\n\t\t\t}\n\t\t}\n\t}()\n\treturn channel\n}\n\n```\n\n\n12us, \n\n![img.png](go-heap2/img8.png)\n\n\n, , gorouting  cpu \n cpu","slug":"go-gc/go-heap2","published":1,"updated":"2021-09-12T16:24:23.472Z","_id":"ckthfc0cu000ismjrfzridd9g","comments":1,"layout":"post","photos":[],"link":"","content":"<p>gocpu, , , </p>\n<p>, prometheus, promql ,  6h simple ,<br>, go 10-11 ,<br>, , </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">container_memory_usage_bytes&#123;container&#x3D;&quot;simple&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2021/09/13/go-gc/go-heap2/img4.png\" alt=\"img.png\"></p>\n<p>,  pprof, pprof  ,<br>79399gorouting, gorouting</p>\n<p><img src=\"/2021/09/13/go-gc/go-heap2/img5.png\" alt=\"img.png\"></p>\n<p>pipeline.go 61 </p>\n<p><img src=\"/2021/09/13/go-gc/go-heap2/img6.png\" alt=\"img.png\"></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">FilterService</span><span class=\"params\">(itemChan &lt;-<span class=\"keyword\">chan</span> ingress.Access, services []<span class=\"keyword\">string</span>)</span> &lt;-<span class=\"title\">chan</span> <span class=\"title\">ingress</span>.<span class=\"title\">Access</span></span> &#123;</span><br><span class=\"line\">channel := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> ingress.Access)</span><br><span class=\"line\"><span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(channel)</span><br><span class=\"line\">data := &lt;-itemChan</span><br><span class=\"line\"><span class=\"keyword\">if</span> data == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">for</span> _, service := <span class=\"keyword\">range</span> services &#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span> data.ServiceName() == service &#123;</span><br><span class=\"line\"><span class=\"comment\">// gorouting</span></span><br><span class=\"line\">channel &lt;- data</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;()</span><br><span class=\"line\"><span class=\"keyword\">return</span> channel</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> channel</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\":\"></a>:</h3><p>a b := &lt;-a</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">cc</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    a := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"keyword\">int</span>)</span><br><span class=\"line\">    <span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        time.Sleep(<span class=\"number\">1</span> * time.Second)</span><br><span class=\"line\">        a &lt;- <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"built_in\">close</span>(a)</span><br><span class=\"line\">    &#125;()</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;sleep !!!&quot;</span>)</span><br><span class=\"line\">    time.Sleep(<span class=\"number\">3</span> * time.Second)</span><br><span class=\"line\">    a = <span class=\"literal\">nil</span></span><br><span class=\"line\">    b := &lt;-a</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;b :%d \\n&quot;</span>, b)</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;complete !!!&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\":\"></a>:</h3><p>size 0 channel , channel 0, </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">cc1</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\ta := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"keyword\">int</span>)</span><br><span class=\"line\">\tmu := sync.WaitGroup&#123;&#125;</span><br><span class=\"line\">\tmu.Add(<span class=\"number\">2</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(a)</span><br><span class=\"line\">\t\ttime.Sleep(<span class=\"number\">10</span> * time.Second)</span><br><span class=\"line\">\t\ta &lt;- <span class=\"number\">1</span></span><br><span class=\"line\">\t\tmu.Done()</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\tticker := time.NewTicker(<span class=\"number\">1</span> * time.Second)</span><br><span class=\"line\">\t\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> cc := &lt;-a:</span><br><span class=\"line\">\t\t\tfmt.Println(<span class=\"string\">&quot;xx&quot;</span>, cc)</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> &lt;-ticker.C:</span><br><span class=\"line\">\t\t\tfmt.Println(<span class=\"string\">&quot;ticker&quot;</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tmu.Done()</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\tmu.Wait()</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;complete !!!&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> channel data<br>datachannel, select data,<br>tick 12s, 12s , <br>opentracing</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">CalculateQPS</span><span class=\"params\">(data &lt;-<span class=\"keyword\">chan</span> ingress.Access, timeTick &lt;-<span class=\"keyword\">chan</span> time.Time,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\tqpsRecord <span class=\"keyword\">map</span>[<span class=\"keyword\">string</span>]*metrics.Calculate)</span> &lt;-<span class=\"title\">chan</span> *<span class=\"title\">serviceInfo</span></span> &#123;</span><br><span class=\"line\">\tchannel := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> *serviceInfo)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(channel)</span><br><span class=\"line\">\t\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> item := &lt;-data:</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> item == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> record, exist := qpsRecord[item.ServiceName()]; exist &#123;</span><br><span class=\"line\">\t\t\t\trecord.Update(item.Upstream(), item.AccessTime())</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\tqpsRecord[item.ServiceName()] = metrics.NewCalculate(item.Upstream(), item.AccessTime())</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> &lt;-timeTick:</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> service, calculate := <span class=\"keyword\">range</span> qpsRecord &#123;</span><br><span class=\"line\">\t\t\t\tchannel &lt;- &amp;serviceInfo&#123;Name: service, AvgQps: calculate.AvgQps(), PodCount: calculate.GetPodCount()&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> channel</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p>12us, </p>\n<p><img src=\"/2021/09/13/go-gc/go-heap2/img8.png\" alt=\"img.png\"></p>\n<p>, , gorouting  cpu <br> cpu</p>\n","site":{"data":{}},"excerpt":"","more":"<p>gocpu, , , </p>\n<p>, prometheus, promql ,  6h simple ,<br>, go 10-11 ,<br>, , </p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">container_memory_usage_bytes&#123;container&#x3D;&quot;simple&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2021/09/13/go-gc/go-heap2/img4.png\" alt=\"img.png\"></p>\n<p>,  pprof, pprof  ,<br>79399gorouting, gorouting</p>\n<p><img src=\"/2021/09/13/go-gc/go-heap2/img5.png\" alt=\"img.png\"></p>\n<p>pipeline.go 61 </p>\n<p><img src=\"/2021/09/13/go-gc/go-heap2/img6.png\" alt=\"img.png\"></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">FilterService</span><span class=\"params\">(itemChan &lt;-<span class=\"keyword\">chan</span> ingress.Access, services []<span class=\"keyword\">string</span>)</span> &lt;-<span class=\"title\">chan</span> <span class=\"title\">ingress</span>.<span class=\"title\">Access</span></span> &#123;</span><br><span class=\"line\">channel := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> ingress.Access)</span><br><span class=\"line\"><span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(channel)</span><br><span class=\"line\">data := &lt;-itemChan</span><br><span class=\"line\"><span class=\"keyword\">if</span> data == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">for</span> _, service := <span class=\"keyword\">range</span> services &#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span> data.ServiceName() == service &#123;</span><br><span class=\"line\"><span class=\"comment\">// gorouting</span></span><br><span class=\"line\">channel &lt;- data</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;()</span><br><span class=\"line\"><span class=\"keyword\">return</span> channel</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> channel</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\":\"></a>:</h3><p>a b := &lt;-a</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">cc</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    a := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"keyword\">int</span>)</span><br><span class=\"line\">    <span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">        time.Sleep(<span class=\"number\">1</span> * time.Second)</span><br><span class=\"line\">        a &lt;- <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"built_in\">close</span>(a)</span><br><span class=\"line\">    &#125;()</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;sleep !!!&quot;</span>)</span><br><span class=\"line\">    time.Sleep(<span class=\"number\">3</span> * time.Second)</span><br><span class=\"line\">    a = <span class=\"literal\">nil</span></span><br><span class=\"line\">    b := &lt;-a</span><br><span class=\"line\">    fmt.Printf(<span class=\"string\">&quot;b :%d \\n&quot;</span>, b)</span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;complete !!!&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\":\"></a>:</h3><p>size 0 channel , channel 0, </p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">cc1</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\ta := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> <span class=\"keyword\">int</span>)</span><br><span class=\"line\">\tmu := sync.WaitGroup&#123;&#125;</span><br><span class=\"line\">\tmu.Add(<span class=\"number\">2</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(a)</span><br><span class=\"line\">\t\ttime.Sleep(<span class=\"number\">10</span> * time.Second)</span><br><span class=\"line\">\t\ta &lt;- <span class=\"number\">1</span></span><br><span class=\"line\">\t\tmu.Done()</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\tticker := time.NewTicker(<span class=\"number\">1</span> * time.Second)</span><br><span class=\"line\">\t\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> cc := &lt;-a:</span><br><span class=\"line\">\t\t\tfmt.Println(<span class=\"string\">&quot;xx&quot;</span>, cc)</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> &lt;-ticker.C:</span><br><span class=\"line\">\t\t\tfmt.Println(<span class=\"string\">&quot;ticker&quot;</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tmu.Done()</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\tmu.Wait()</span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;complete !!!&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p> channel data<br>datachannel, select data,<br>tick 12s, 12s , <br>opentracing</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">CalculateQPS</span><span class=\"params\">(data &lt;-<span class=\"keyword\">chan</span> ingress.Access, timeTick &lt;-<span class=\"keyword\">chan</span> time.Time,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\tqpsRecord <span class=\"keyword\">map</span>[<span class=\"keyword\">string</span>]*metrics.Calculate)</span> &lt;-<span class=\"title\">chan</span> *<span class=\"title\">serviceInfo</span></span> &#123;</span><br><span class=\"line\">\tchannel := <span class=\"built_in\">make</span>(<span class=\"keyword\">chan</span> *serviceInfo)</span><br><span class=\"line\">\t<span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> <span class=\"built_in\">close</span>(channel)</span><br><span class=\"line\">\t\t<span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> item := &lt;-data:</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> item == <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> record, exist := qpsRecord[item.ServiceName()]; exist &#123;</span><br><span class=\"line\">\t\t\t\trecord.Update(item.Upstream(), item.AccessTime())</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\tqpsRecord[item.ServiceName()] = metrics.NewCalculate(item.Upstream(), item.AccessTime())</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> &lt;-timeTick:</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> service, calculate := <span class=\"keyword\">range</span> qpsRecord &#123;</span><br><span class=\"line\">\t\t\t\tchannel &lt;- &amp;serviceInfo&#123;Name: service, AvgQps: calculate.AvgQps(), PodCount: calculate.GetPodCount()&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;()</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> channel</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p>12us, </p>\n<p><img src=\"/2021/09/13/go-gc/go-heap2/img8.png\" alt=\"img.png\"></p>\n<p>, , gorouting  cpu <br> cpu</p>\n"},{"title":"gocpu ()","date":"2021-09-10T15:23:13.000Z","_content":"\n\n, , , cpu\ncpu\n\ngo,\n\nmain\n```go\nimport _ \"net/http/pprof\"\n\nfunc main() {\n    //pprof\n    go func() {\n      http.ListenAndServe(\"0.0.0.0:6060\", nil)\n    }()\n}\n```\n\nlocalhost:6060 \n\n![img.png](go-heap/img.png)\n\nallocs \nblock \ncmdline \ngoroutine  goroutine \nheap gc GET  GC\nmutex \nprofileCPU  seconds GET  go tool pprof \nthreadcreate \ntrace seconds GET  go tool trace \n\n\n## \n\n, go \n\n![img1.png](go-heap/img1.png)\n\nuber `go-torch`\n\n```bash\ngo get github.com/uber/go-torch\n```\n\nflamegraph https://github.com/brendangregg/FlameGraph\n\n\n```bash\nbrew install flamegraph\n\n# \ngo-torch -u http://10.10.13.118:31795/debug/pprof\n\n#svg\n\n```\n![img2.png](go-heap/img2.png)\n\n\n\n```go\nsimple-hpa/src/handler.(*nginxDataHandler).parseData.func1\n43.42%\n```","source":"_posts/go-gc/go-heap.md","raw":"---\ntitle: gocpu ()\ndate: 2021-09-10 23:23:13\ntags:\n- go\n---\n\n\n, , , cpu\ncpu\n\ngo,\n\nmain\n```go\nimport _ \"net/http/pprof\"\n\nfunc main() {\n    //pprof\n    go func() {\n      http.ListenAndServe(\"0.0.0.0:6060\", nil)\n    }()\n}\n```\n\nlocalhost:6060 \n\n![img.png](go-heap/img.png)\n\nallocs \nblock \ncmdline \ngoroutine  goroutine \nheap gc GET  GC\nmutex \nprofileCPU  seconds GET  go tool pprof \nthreadcreate \ntrace seconds GET  go tool trace \n\n\n## \n\n, go \n\n![img1.png](go-heap/img1.png)\n\nuber `go-torch`\n\n```bash\ngo get github.com/uber/go-torch\n```\n\nflamegraph https://github.com/brendangregg/FlameGraph\n\n\n```bash\nbrew install flamegraph\n\n# \ngo-torch -u http://10.10.13.118:31795/debug/pprof\n\n#svg\n\n```\n![img2.png](go-heap/img2.png)\n\n\n\n```go\nsimple-hpa/src/handler.(*nginxDataHandler).parseData.func1\n43.42%\n```","slug":"go-gc/go-heap","published":1,"updated":"2021-09-12T15:33:18.914Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0cv000ksmjrf2te51ms","content":"<p>, , , cpu<br>cpu</p>\n<p>go,</p>\n<p>main</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> _ <span class=\"string\">&quot;net/http/pprof&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//pprof</span></span><br><span class=\"line\">    <span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">      http.ListenAndServe(<span class=\"string\">&quot;0.0.0.0:6060&quot;</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">    &#125;()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>localhost:6060 </p>\n<p><img src=\"/2021/09/10/go-gc/go-heap/img.png\" alt=\"img.png\"></p>\n<p>allocs <br>block <br>cmdline <br>goroutine  goroutine <br>heap gc GET  GC<br>mutex <br>profileCPU  seconds GET  go tool pprof <br>threadcreate <br>trace seconds GET  go tool trace </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>, go </p>\n<p><img src=\"/2021/09/10/go-gc/go-heap/img1.png\" alt=\"img1.png\"></p>\n<p>uber <code>go-torch</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get github.com/uber/go-torch</span><br></pre></td></tr></table></figure>\n\n<p>flamegraph <a class=\"link\" href=\"https://github.com/brendangregg/FlameGraph\">https://github.com/brendangregg/FlameGraph<i class=\"fas fa-external-link-alt\"></i></a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install flamegraph</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">go-torch -u http://10.10.13.118:31795/debug/pprof</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#svg</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img src=\"/2021/09/10/go-gc/go-heap/img2.png\" alt=\"img2.png\"></p>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">simple-hpa/src/handler.(*nginxDataHandler).parseData.func1</span><br><span class=\"line\"><span class=\"number\">43.42</span>%</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p>, , , cpu<br>cpu</p>\n<p>go,</p>\n<p>main</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> _ <span class=\"string\">&quot;net/http/pprof&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//pprof</span></span><br><span class=\"line\">    <span class=\"keyword\">go</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">      http.ListenAndServe(<span class=\"string\">&quot;0.0.0.0:6060&quot;</span>, <span class=\"literal\">nil</span>)</span><br><span class=\"line\">    &#125;()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>localhost:6060 </p>\n<p><img src=\"/2021/09/10/go-gc/go-heap/img.png\" alt=\"img.png\"></p>\n<p>allocs <br>block <br>cmdline <br>goroutine  goroutine <br>heap gc GET  GC<br>mutex <br>profileCPU  seconds GET  go tool pprof <br>threadcreate <br>trace seconds GET  go tool trace </p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>, go </p>\n<p><img src=\"/2021/09/10/go-gc/go-heap/img1.png\" alt=\"img1.png\"></p>\n<p>uber <code>go-torch</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">go get github.com/uber/go-torch</span><br></pre></td></tr></table></figure>\n\n<p>flamegraph <a class=\"link\" href=\"https://github.com/brendangregg/FlameGraph\">https://github.com/brendangregg/FlameGraph<i class=\"fas fa-external-link-alt\"></i></a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install flamegraph</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">go-torch -u http://10.10.13.118:31795/debug/pprof</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#svg</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img src=\"/2021/09/10/go-gc/go-heap/img2.png\" alt=\"img2.png\"></p>\n<p></p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">simple-hpa/src/handler.(*nginxDataHandler).parseData.func1</span><br><span class=\"line\"><span class=\"number\">43.42</span>%</span><br></pre></td></tr></table></figure>"},{"title":"k8s","date":"2021-03-12T05:13:13.000Z","_content":"\nk8s\nk8s\n\n \n\n \n```bash\n\n10.10.13.113 master\n\n10.10.13.114 node01\n\n10.10.13.115 node02\n\n```\n\n1. ansible\n\n```bash\n#  RSA \n$ ssh-keygen -t rsa -b 2048 -N '' -f ~/.ssh/id_rsa\n\n$ ssh-copy-id root@$IPs #$IPsyes root\n\n/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: \"/Users/clare/.ssh/id_rsa.pub\"\n/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed\n/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys\nroot@xxx.xxx.xxx.xxx's password:\n\nNumber of key(s) added:        1\n\nNow try logging into the machine, with:   \"ssh 'root@xxx.xxx.xxx.xxx'\"\nand check to make sure that only the key(s) you wanted were added.\n```\n\n```bash\n# \n\n$ ssh root@$IPs\n\n```\n\n3.1 ansible (kubeaszansible)\n```bash\n\n# pip 21.0python2python3.5\n# To install pip for Python 2.7 install it from https://bootstrap.pypa.io/2.7/ :\ncurl -O https://bootstrap.pypa.io/2.7/get-pip.py\npython get-pip.py\npython -m pip install --upgrade \"pip < 21.0\"\n\n# pipansible(pip)\npip install ansible -i https://mirrors.aliyun.com/pypi/simple/\n```\n\n### `ezdown`\n\n```bash\n# ezdownkubeasz3.0.0\n$ export release=3.0.0\n\n$ curl -C- -fLO --retry 3 https://github.com/easzlab/kubeasz/releases/download/${release}/ezdown\n\n$ chmod +x ./ezdown\n\n# \n$ chmod +x ezdown\n\n# \n# k kubernetes\n$ ./ezdown -D -k v1.18.3\n\n```\n\n4.2 \n\n```bash\n\nezctl new k8s-01\n2021-01-19 10:48:23 DEBUG generate custom cluster files in /etc/kubeasz/clusters/k8s-01\n2021-01-19 10:48:23 DEBUG set version of common plugins\n2021-01-19 10:48:23 DEBUG cluster k8s-01: files successfully created.\n2021-01-19 10:48:23 INFO next steps 1: to config '/etc/kubeasz/clusters/k8s-01/hosts'\n2021-01-19 10:48:23 INFO next steps 2: to config '/etc/kubeasz/clusters/k8s-01/config.yml'\n'/etc/kubeasz/clusters/k8s-01/hosts'  '/etc/kubeasz/clusters/k8s-01/config.yml': hosts config.yml \n```\n\n4.3     \n\n### \n\n```bash\n$ ezctl setup k8s-01 all\n\n#  ezctl help setup \n# ezctl setup k8s-01 01\n# ezctl setup k8s-01 02\n# ezctl setup k8s-01 03\n# ezctl setup k8s-01 04\n```\n\n\n","source":"_posts/k8s/install-k8s.md","raw":"---\ntitle: k8s\ndate: 2021-03-12 13:13:13\ntags:\n- kubernetes\n---\n\nk8s\nk8s\n\n \n\n \n```bash\n\n10.10.13.113 master\n\n10.10.13.114 node01\n\n10.10.13.115 node02\n\n```\n\n1. ansible\n\n```bash\n#  RSA \n$ ssh-keygen -t rsa -b 2048 -N '' -f ~/.ssh/id_rsa\n\n$ ssh-copy-id root@$IPs #$IPsyes root\n\n/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: \"/Users/clare/.ssh/id_rsa.pub\"\n/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed\n/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys\nroot@xxx.xxx.xxx.xxx's password:\n\nNumber of key(s) added:        1\n\nNow try logging into the machine, with:   \"ssh 'root@xxx.xxx.xxx.xxx'\"\nand check to make sure that only the key(s) you wanted were added.\n```\n\n```bash\n# \n\n$ ssh root@$IPs\n\n```\n\n3.1 ansible (kubeaszansible)\n```bash\n\n# pip 21.0python2python3.5\n# To install pip for Python 2.7 install it from https://bootstrap.pypa.io/2.7/ :\ncurl -O https://bootstrap.pypa.io/2.7/get-pip.py\npython get-pip.py\npython -m pip install --upgrade \"pip < 21.0\"\n\n# pipansible(pip)\npip install ansible -i https://mirrors.aliyun.com/pypi/simple/\n```\n\n### `ezdown`\n\n```bash\n# ezdownkubeasz3.0.0\n$ export release=3.0.0\n\n$ curl -C- -fLO --retry 3 https://github.com/easzlab/kubeasz/releases/download/${release}/ezdown\n\n$ chmod +x ./ezdown\n\n# \n$ chmod +x ezdown\n\n# \n# k kubernetes\n$ ./ezdown -D -k v1.18.3\n\n```\n\n4.2 \n\n```bash\n\nezctl new k8s-01\n2021-01-19 10:48:23 DEBUG generate custom cluster files in /etc/kubeasz/clusters/k8s-01\n2021-01-19 10:48:23 DEBUG set version of common plugins\n2021-01-19 10:48:23 DEBUG cluster k8s-01: files successfully created.\n2021-01-19 10:48:23 INFO next steps 1: to config '/etc/kubeasz/clusters/k8s-01/hosts'\n2021-01-19 10:48:23 INFO next steps 2: to config '/etc/kubeasz/clusters/k8s-01/config.yml'\n'/etc/kubeasz/clusters/k8s-01/hosts'  '/etc/kubeasz/clusters/k8s-01/config.yml': hosts config.yml \n```\n\n4.3     \n\n### \n\n```bash\n$ ezctl setup k8s-01 all\n\n#  ezctl help setup \n# ezctl setup k8s-01 01\n# ezctl setup k8s-01 02\n# ezctl setup k8s-01 03\n# ezctl setup k8s-01 04\n```\n\n\n","slug":"k8s/install-k8s","published":1,"updated":"2021-08-24T16:25:21.604Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0cw000msmjra3xc6f09","content":"<p>k8s<br>k8s</p>\n<p> </p>\n<p> </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">10.10.13.113 master</span><br><span class=\"line\"></span><br><span class=\"line\">10.10.13.114 node01</span><br><span class=\"line\"></span><br><span class=\"line\">10.10.13.115 node02</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>ansible</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  RSA </span></span><br><span class=\"line\">$ ssh-keygen -t rsa -b 2048 -N <span class=\"string\">&#x27;&#x27;</span> -f ~/.ssh/id_rsa</span><br><span class=\"line\"></span><br><span class=\"line\">$ ssh-copy-id root@<span class=\"variable\">$IPs</span> <span class=\"comment\">#$IPsyes root</span></span><br><span class=\"line\"></span><br><span class=\"line\">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: <span class=\"string\">&quot;/Users/clare/.ssh/id_rsa.pub&quot;</span></span><br><span class=\"line\">/usr/bin/ssh-copy-id: INFO: attempting to <span class=\"built_in\">log</span> <span class=\"keyword\">in</span> with the new key(s), to filter out any that are already installed</span><br><span class=\"line\">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- <span class=\"keyword\">if</span> you are prompted now it is to install the new keys</span><br><span class=\"line\">root@xxx.xxx.xxx.xxx<span class=\"string\">&#x27;s password:</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Number of key(s) added:        1</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Now try logging into the machine, with:   &quot;ssh &#x27;</span>root@xxx.xxx.xxx.xxx<span class=\"string\">&#x27;&quot;</span></span><br><span class=\"line\"><span class=\"string\">and check to make sure that only the key(s) you wanted were added.</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\">$ ssh root@<span class=\"variable\">$IPs</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>3.1 ansible (kubeaszansible)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># pip 21.0python2python3.5</span></span><br><span class=\"line\"><span class=\"comment\"># To install pip for Python 2.7 install it from https://bootstrap.pypa.io/2.7/ :</span></span><br><span class=\"line\">curl -O https://bootstrap.pypa.io/2.7/get-pip.py</span><br><span class=\"line\">python get-pip.py</span><br><span class=\"line\">python -m pip install --upgrade <span class=\"string\">&quot;pip &lt; 21.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># pipansible(pip)</span></span><br><span class=\"line\">pip install ansible -i https://mirrors.aliyun.com/pypi/simple/</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ezdown\"><a href=\"#ezdown\" class=\"headerlink\" title=\"ezdown\"></a><code>ezdown</code></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ezdownkubeasz3.0.0</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> release=3.0.0</span><br><span class=\"line\"></span><br><span class=\"line\">$ curl -C- -fLO --retry 3 https://github.com/easzlab/kubeasz/releases/download/<span class=\"variable\">$&#123;release&#125;</span>/ezdown</span><br><span class=\"line\"></span><br><span class=\"line\">$ chmod +x ./ezdown</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">$ chmod +x ezdown</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"comment\"># k kubernetes</span></span><br><span class=\"line\">$ ./ezdown -D -k v1.18.3</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>4.2 </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">ezctl new k8s-01</span><br><span class=\"line\">2021-01-19 10:48:23 DEBUG generate custom cluster files <span class=\"keyword\">in</span> /etc/kubeasz/clusters/k8s-01</span><br><span class=\"line\">2021-01-19 10:48:23 DEBUG <span class=\"built_in\">set</span> version of common plugins</span><br><span class=\"line\">2021-01-19 10:48:23 DEBUG cluster k8s-01: files successfully created.</span><br><span class=\"line\">2021-01-19 10:48:23 INFO next steps 1: to config <span class=\"string\">&#x27;/etc/kubeasz/clusters/k8s-01/hosts&#x27;</span></span><br><span class=\"line\">2021-01-19 10:48:23 INFO next steps 2: to config <span class=\"string\">&#x27;/etc/kubeasz/clusters/k8s-01/config.yml&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;/etc/kubeasz/clusters/k8s-01/hosts&#x27;</span>  <span class=\"string\">&#x27;/etc/kubeasz/clusters/k8s-01/config.yml&#x27;</span>: hosts config.yml </span><br></pre></td></tr></table></figure>\n\n<p>4.3     </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ezctl setup k8s-01 all</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  ezctl help setup </span></span><br><span class=\"line\"><span class=\"comment\"># ezctl setup k8s-01 01</span></span><br><span class=\"line\"><span class=\"comment\"># ezctl setup k8s-01 02</span></span><br><span class=\"line\"><span class=\"comment\"># ezctl setup k8s-01 03</span></span><br><span class=\"line\"><span class=\"comment\"># ezctl setup k8s-01 04</span></span><br></pre></td></tr></table></figure>\n\n\n","site":{"data":{}},"excerpt":"","more":"<p>k8s<br>k8s</p>\n<p> </p>\n<p> </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">10.10.13.113 master</span><br><span class=\"line\"></span><br><span class=\"line\">10.10.13.114 node01</span><br><span class=\"line\"></span><br><span class=\"line\">10.10.13.115 node02</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>ansible</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  RSA </span></span><br><span class=\"line\">$ ssh-keygen -t rsa -b 2048 -N <span class=\"string\">&#x27;&#x27;</span> -f ~/.ssh/id_rsa</span><br><span class=\"line\"></span><br><span class=\"line\">$ ssh-copy-id root@<span class=\"variable\">$IPs</span> <span class=\"comment\">#$IPsyes root</span></span><br><span class=\"line\"></span><br><span class=\"line\">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: <span class=\"string\">&quot;/Users/clare/.ssh/id_rsa.pub&quot;</span></span><br><span class=\"line\">/usr/bin/ssh-copy-id: INFO: attempting to <span class=\"built_in\">log</span> <span class=\"keyword\">in</span> with the new key(s), to filter out any that are already installed</span><br><span class=\"line\">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- <span class=\"keyword\">if</span> you are prompted now it is to install the new keys</span><br><span class=\"line\">root@xxx.xxx.xxx.xxx<span class=\"string\">&#x27;s password:</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Number of key(s) added:        1</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Now try logging into the machine, with:   &quot;ssh &#x27;</span>root@xxx.xxx.xxx.xxx<span class=\"string\">&#x27;&quot;</span></span><br><span class=\"line\"><span class=\"string\">and check to make sure that only the key(s) you wanted were added.</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\">$ ssh root@<span class=\"variable\">$IPs</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>3.1 ansible (kubeaszansible)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># pip 21.0python2python3.5</span></span><br><span class=\"line\"><span class=\"comment\"># To install pip for Python 2.7 install it from https://bootstrap.pypa.io/2.7/ :</span></span><br><span class=\"line\">curl -O https://bootstrap.pypa.io/2.7/get-pip.py</span><br><span class=\"line\">python get-pip.py</span><br><span class=\"line\">python -m pip install --upgrade <span class=\"string\">&quot;pip &lt; 21.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># pipansible(pip)</span></span><br><span class=\"line\">pip install ansible -i https://mirrors.aliyun.com/pypi/simple/</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"ezdown\"><a href=\"#ezdown\" class=\"headerlink\" title=\"ezdown\"></a><code>ezdown</code></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ezdownkubeasz3.0.0</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> release=3.0.0</span><br><span class=\"line\"></span><br><span class=\"line\">$ curl -C- -fLO --retry 3 https://github.com/easzlab/kubeasz/releases/download/<span class=\"variable\">$&#123;release&#125;</span>/ezdown</span><br><span class=\"line\"></span><br><span class=\"line\">$ chmod +x ./ezdown</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">$ chmod +x ezdown</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"comment\"># k kubernetes</span></span><br><span class=\"line\">$ ./ezdown -D -k v1.18.3</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>4.2 </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">ezctl new k8s-01</span><br><span class=\"line\">2021-01-19 10:48:23 DEBUG generate custom cluster files <span class=\"keyword\">in</span> /etc/kubeasz/clusters/k8s-01</span><br><span class=\"line\">2021-01-19 10:48:23 DEBUG <span class=\"built_in\">set</span> version of common plugins</span><br><span class=\"line\">2021-01-19 10:48:23 DEBUG cluster k8s-01: files successfully created.</span><br><span class=\"line\">2021-01-19 10:48:23 INFO next steps 1: to config <span class=\"string\">&#x27;/etc/kubeasz/clusters/k8s-01/hosts&#x27;</span></span><br><span class=\"line\">2021-01-19 10:48:23 INFO next steps 2: to config <span class=\"string\">&#x27;/etc/kubeasz/clusters/k8s-01/config.yml&#x27;</span></span><br><span class=\"line\"><span class=\"string\">&#x27;/etc/kubeasz/clusters/k8s-01/hosts&#x27;</span>  <span class=\"string\">&#x27;/etc/kubeasz/clusters/k8s-01/config.yml&#x27;</span>: hosts config.yml </span><br></pre></td></tr></table></figure>\n\n<p>4.3     </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ezctl setup k8s-01 all</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  ezctl help setup </span></span><br><span class=\"line\"><span class=\"comment\"># ezctl setup k8s-01 01</span></span><br><span class=\"line\"><span class=\"comment\"># ezctl setup k8s-01 02</span></span><br><span class=\"line\"><span class=\"comment\"># ezctl setup k8s-01 03</span></span><br><span class=\"line\"><span class=\"comment\"># ezctl setup k8s-01 04</span></span><br></pre></td></tr></table></figure>\n\n\n"},{"title":"istio ","date":"2021-01-20T16:00:00.000Z","_content":"\nistio \n\n### \n\n\n\n1. kubernetes pod <font face=\"\" color=green size=3></font>\n2. 1.6 istio, pod\n3.  \n\n###  bookinfo\n\nistio `BookInfo`\n\nBookinfo\n\nproductpageproductpagedetailsreviews\ndetailsdetails\nreviewsreviewsratings\nratingsratings\nreviews3\n\nv1ratings\nv2ratings15\nv3ratings15\n\n\n\n![bookInfo](/uploads/istio/images/m_88841685b364bda18fb333e9acb97366_r.png)\n\nbookinfo bookinfo \nsidecar,namespace `istio-injection=enabled`labels istionamespacepodsidecar\n\nbookinfo demonamespace\n\n```bash\n\n$ kubectl label namespace demo istio-injection=enabled\n```\n\nlabels\n\n```bash\n$ kubectl get namespace demo --show-labels\n```\n\n `istio-injection=enabled`labels \n\n```text\nNAME   STATUS   AGE   LABELS\ndemo   Active   24s   istio-injection=enabled\n```\n\n BookInfo\n\n```bash\n$ kubectl apply -f istio/bookinfo.yml\n```\n\n  sidecar\n\n```bash\n$ kubectl get po -n demo\n```\n\n service pod Running \n\n```bash\n$ kubectl get service -n demo \n\nNAME          TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\ndetails       ClusterIP   10.0.0.31    <none>        9080/TCP   6m\nkubernetes    ClusterIP   10.0.0.1     <none>        443/TCP    7d\nproductpage   ClusterIP   10.0.0.120   <none>        9080/TCP   6m\nratings       ClusterIP   10.0.0.15    <none>        9080/TCP   6m\nreviews       ClusterIP   10.0.0.170   <none>        9080/TCP   6m\n\n\n$ kubectl get pods -n demo\n\nNAME                             READY     STATUS    RESTARTS   AGE\ndetails-v1-1520924117-48z17      2/2       Running   0          6m\nproductpage-v1-560495357-jk1lz   2/2       Running   0          6m\nratings-v1-734492171-rnr5l       2/2       Running   0          6m\nreviews-v1-874083890-f0qf0       2/2       Running   0          6m\nreviews-v2-1343845940-b34q5      2/2       Running   0          6m\nreviews-v3-1813607990-8ch52      2/2       Running   0          6m\n``` \n\npod ready  2/2  sidecar\n\n### \n\n\n##### \n\n\n\nistio Bookinforeviews/productpageBookinfoIstio\n\n\n\n```yaml\napiVersion: networking.istio.io/v1beta1\nkind: Gateway\nmetadata:\n  name: bookinfo-gateway\n  namespace: demo\nspec:\n  selector:\n    istio: ingressgateway # istio-system istio-ingressgateway labels\n  servers:\n  - hosts:\n    - '*' # \n    port:\n      name: http \n      number: 80 # \n      protocol: HTTP # \n\n---\napiVersion: networking.istio.io/v1beta1\nkind: VirtualService\nmetadata:\n  name: bookinfo\n  namespace: demo\nspec:\n  gateways:\n  - bookinfo-gateway # gateway\n  hosts:\n  - '*' # svc \n  http:\n  - match:\n    - uri:\n        exact: /productpage #  \n    - uri:\n        prefix: /static # \n    - uri:\n        exact: /login \n    - uri:\n        exact: /logout\n    - uri:\n        prefix: /api/v1/products\n    route:\n    - destination:\n        host: productpage #  svc\n        port:\n          number: 9080 # \n\n\n```\n\n\n\n gateway \n\n|   |   |   |    |\n| ------------ | ------------ | ------------ | ------------ |\n|  selector  | map<string, string>  | Pod / VM   foo barpod istiod`PILOTSCOPEGATEWAYTONAMESPACE` true    |  yes |\n|  hosts | []string  |  HTTPTLSSNITCP /dnsName dnsNameFQDNprod / *.example.com dnsName*prod / *VirtualService* * / foo.example.com./foo.example.comSidecar /* / DestinationRule  * .example.comdev.example.comprod.example.comVirtualService example.comnewexample.comVirtualServiceexportTo* exportTo VirtualServiceDestinationRuleServiceEntryexportTo | yes  |\n|port |port || yes|\n\n\n\n\n\n```bash\n\n  ~ kubectl get gw -n demo\nNAME               AGE\nbookinfo-gateway   11m\n  ~ kubectl get vs -n demo\nNAME                         GATEWAYS             HOSTS                                  AGE\nbookinfo                     [bookinfo-gateway]   [*]                                    11m\n```\n\n##### VirtualService\n\n/\n\nVirtualService \n\n\n|   |   |   |    |\n| ------------ | ------------ | ------------ | ------------ |\n| hosts   | string[]  | hostsHTTPTCPIP  |  no |\n| gateways   | string[]  | sidecar<gateway namespace>/<gateway name>; VirtualService  |  no |\n|  subset |  string | DestinationRule  | node  |\n|  port  | PortSelector  | |  no |\n| http   |  HTTPRoute[] | HTTPHTTP http-  / http2-  / grpc- *HTTP / HTTP2 / GRPC / TLSHTTPSHTTP / HTTP2 /GRPC|  no |\n| tls   | TLSRoute[]  | TLSHTTPSClientHelloSNITLSHTTPS / TLS TLS https-  tls- HTTPS / TLS https-  tls- TCP  | no  |\n| tcp  | TCPRoute[]  | TCPTCPHTTPTLS  | no  |\n\n\n##### HTTP\n\nHTTP / 1.1HTTP2gRPCVirtualService\n\n|   |   |   |    |\n| ------------ | ------------ | ------------ | ------------ |\n| name  | string   |  / | no  |\n| match   | HTTPMatchRequest[]  | ANDOR  |  no |\n| route   |  HTTPRouteDestination[] |  HTTP | no  |\n| redirect   | HTTPRedirect  |  HTTP/HTTP 301URIAuthority | no  |\n|  rewrite  | HTTPRewrite  |  HTTP URIAuthority | no |\n| timeout  | \tDuration|HTTP  |  no|\n|retries|HTTPRetry | HTTP| no |\n|headers|Headers||no|\n|fault|\tHTTPFaultInjection|HTTP||\n|mirror|Destination|HTTP/|no|\n\nhttp tcp tls  \n\n:\n\n![](/uploads/istio/images/m_f048c09d102e39ddf43a9d3e0ae81d47_r.png)\n\n `reviews` \n\n##### \n\nBookinforeviews:v2ratings7sjasonBookinfo\n\n```yaml\n$ kubectl get virtualservice ratings -o yaml\napiVersion: networking.istio.io/v1beta1\nkind: VirtualService\nmetadata:\n  name: bookinfo-fault-injection\n  namespace: demo\nspec:\n  hosts:\n  - ratings\n  http:\n  - fault:\n      delay:\n        fixedDelay: 7s\n        percentage:\n          value: 100\n    match:\n    - headers:\n        end-user:\n          exact: jason\n    route:\n    - destination:\n        host: ratings\n        subset: v1\n  - route:\n    - destination:\n        host: ratings\n        subset: v1\n```\n\n\n\n`productpage`6\n\n<font face=\"\" color=red size=3>:</font>IstiopodTCPHTTP\n\nHTTPTCP\n\n\n\n##### \n\nIstio10reviews:v190 reviews:v3100reviews:v3\n\n\n\n```bash\napiVersion: networking.istio.io/v1beta1\nkind: VirtualService\nmetadata:\n  name: bookinfo-traffic-injection\n  namespace: demo\nspec:\n  hosts:\n  - reviews\n  http:\n  - route:\n    - destination:\n        host: reviews\n        subset: v1 # DestinationRule \n      weight: 10\n    - destination:\n        host: reviews\n        subset: v3\n      weight: 90\n---\n\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: bookinfo-traffic-injection\n  namespace: demo\nspec:\n  host: reviews\n  subsets:\n  - name: v1 # subset\n    labels:\n      version: v1 # pod labelsversion\n  - name: v2\n    labels:\n      version: v2\n  - name: v3\n    labels:\n      version: v3\n```\n\n\n\n```yaml\n$ kubectl apply -f bookinfo-traffic-injection.yaml\n```\n\n\nistio-systemkialisvc`nodeport`   admin/admin\n\n![](/uploads/istio/images/m_2d6a4a0feac0159ee65ac3aee53ecaaf_r.png)\n\n`reviews`pod 33%\n\n\n\n\n\nkiali\n\n![](/uploads/istio/images/m_010ffca5e15ec7eb30397a2e97db1268_r.png)\n\n`reviews`\n\n`v1 --->14.3% v2 ---> 0% ,  v3 ---> 85.7%`\n\nistioistio?\n\n<font face=\"\" color=red size=3>:</font> istio \n\n##### \n\n##### \n\n##### \n\n##### \n\nistio \n\n\n#### \n\n##### \n\n##### \n\n### ","source":"_posts/k8s/istio-use.md","raw":"---\ntitle: istio \ndate: 2021-01-21\ntags:\n- istio\n---\n\nistio \n\n### \n\n\n\n1. kubernetes pod <font face=\"\" color=green size=3></font>\n2. 1.6 istio, pod\n3.  \n\n###  bookinfo\n\nistio `BookInfo`\n\nBookinfo\n\nproductpageproductpagedetailsreviews\ndetailsdetails\nreviewsreviewsratings\nratingsratings\nreviews3\n\nv1ratings\nv2ratings15\nv3ratings15\n\n\n\n![bookInfo](/uploads/istio/images/m_88841685b364bda18fb333e9acb97366_r.png)\n\nbookinfo bookinfo \nsidecar,namespace `istio-injection=enabled`labels istionamespacepodsidecar\n\nbookinfo demonamespace\n\n```bash\n\n$ kubectl label namespace demo istio-injection=enabled\n```\n\nlabels\n\n```bash\n$ kubectl get namespace demo --show-labels\n```\n\n `istio-injection=enabled`labels \n\n```text\nNAME   STATUS   AGE   LABELS\ndemo   Active   24s   istio-injection=enabled\n```\n\n BookInfo\n\n```bash\n$ kubectl apply -f istio/bookinfo.yml\n```\n\n  sidecar\n\n```bash\n$ kubectl get po -n demo\n```\n\n service pod Running \n\n```bash\n$ kubectl get service -n demo \n\nNAME          TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\ndetails       ClusterIP   10.0.0.31    <none>        9080/TCP   6m\nkubernetes    ClusterIP   10.0.0.1     <none>        443/TCP    7d\nproductpage   ClusterIP   10.0.0.120   <none>        9080/TCP   6m\nratings       ClusterIP   10.0.0.15    <none>        9080/TCP   6m\nreviews       ClusterIP   10.0.0.170   <none>        9080/TCP   6m\n\n\n$ kubectl get pods -n demo\n\nNAME                             READY     STATUS    RESTARTS   AGE\ndetails-v1-1520924117-48z17      2/2       Running   0          6m\nproductpage-v1-560495357-jk1lz   2/2       Running   0          6m\nratings-v1-734492171-rnr5l       2/2       Running   0          6m\nreviews-v1-874083890-f0qf0       2/2       Running   0          6m\nreviews-v2-1343845940-b34q5      2/2       Running   0          6m\nreviews-v3-1813607990-8ch52      2/2       Running   0          6m\n``` \n\npod ready  2/2  sidecar\n\n### \n\n\n##### \n\n\n\nistio Bookinforeviews/productpageBookinfoIstio\n\n\n\n```yaml\napiVersion: networking.istio.io/v1beta1\nkind: Gateway\nmetadata:\n  name: bookinfo-gateway\n  namespace: demo\nspec:\n  selector:\n    istio: ingressgateway # istio-system istio-ingressgateway labels\n  servers:\n  - hosts:\n    - '*' # \n    port:\n      name: http \n      number: 80 # \n      protocol: HTTP # \n\n---\napiVersion: networking.istio.io/v1beta1\nkind: VirtualService\nmetadata:\n  name: bookinfo\n  namespace: demo\nspec:\n  gateways:\n  - bookinfo-gateway # gateway\n  hosts:\n  - '*' # svc \n  http:\n  - match:\n    - uri:\n        exact: /productpage #  \n    - uri:\n        prefix: /static # \n    - uri:\n        exact: /login \n    - uri:\n        exact: /logout\n    - uri:\n        prefix: /api/v1/products\n    route:\n    - destination:\n        host: productpage #  svc\n        port:\n          number: 9080 # \n\n\n```\n\n\n\n gateway \n\n|   |   |   |    |\n| ------------ | ------------ | ------------ | ------------ |\n|  selector  | map<string, string>  | Pod / VM   foo barpod istiod`PILOTSCOPEGATEWAYTONAMESPACE` true    |  yes |\n|  hosts | []string  |  HTTPTLSSNITCP /dnsName dnsNameFQDNprod / *.example.com dnsName*prod / *VirtualService* * / foo.example.com./foo.example.comSidecar /* / DestinationRule  * .example.comdev.example.comprod.example.comVirtualService example.comnewexample.comVirtualServiceexportTo* exportTo VirtualServiceDestinationRuleServiceEntryexportTo | yes  |\n|port |port || yes|\n\n\n\n\n\n```bash\n\n  ~ kubectl get gw -n demo\nNAME               AGE\nbookinfo-gateway   11m\n  ~ kubectl get vs -n demo\nNAME                         GATEWAYS             HOSTS                                  AGE\nbookinfo                     [bookinfo-gateway]   [*]                                    11m\n```\n\n##### VirtualService\n\n/\n\nVirtualService \n\n\n|   |   |   |    |\n| ------------ | ------------ | ------------ | ------------ |\n| hosts   | string[]  | hostsHTTPTCPIP  |  no |\n| gateways   | string[]  | sidecar<gateway namespace>/<gateway name>; VirtualService  |  no |\n|  subset |  string | DestinationRule  | node  |\n|  port  | PortSelector  | |  no |\n| http   |  HTTPRoute[] | HTTPHTTP http-  / http2-  / grpc- *HTTP / HTTP2 / GRPC / TLSHTTPSHTTP / HTTP2 /GRPC|  no |\n| tls   | TLSRoute[]  | TLSHTTPSClientHelloSNITLSHTTPS / TLS TLS https-  tls- HTTPS / TLS https-  tls- TCP  | no  |\n| tcp  | TCPRoute[]  | TCPTCPHTTPTLS  | no  |\n\n\n##### HTTP\n\nHTTP / 1.1HTTP2gRPCVirtualService\n\n|   |   |   |    |\n| ------------ | ------------ | ------------ | ------------ |\n| name  | string   |  / | no  |\n| match   | HTTPMatchRequest[]  | ANDOR  |  no |\n| route   |  HTTPRouteDestination[] |  HTTP | no  |\n| redirect   | HTTPRedirect  |  HTTP/HTTP 301URIAuthority | no  |\n|  rewrite  | HTTPRewrite  |  HTTP URIAuthority | no |\n| timeout  | \tDuration|HTTP  |  no|\n|retries|HTTPRetry | HTTP| no |\n|headers|Headers||no|\n|fault|\tHTTPFaultInjection|HTTP||\n|mirror|Destination|HTTP/|no|\n\nhttp tcp tls  \n\n:\n\n![](/uploads/istio/images/m_f048c09d102e39ddf43a9d3e0ae81d47_r.png)\n\n `reviews` \n\n##### \n\nBookinforeviews:v2ratings7sjasonBookinfo\n\n```yaml\n$ kubectl get virtualservice ratings -o yaml\napiVersion: networking.istio.io/v1beta1\nkind: VirtualService\nmetadata:\n  name: bookinfo-fault-injection\n  namespace: demo\nspec:\n  hosts:\n  - ratings\n  http:\n  - fault:\n      delay:\n        fixedDelay: 7s\n        percentage:\n          value: 100\n    match:\n    - headers:\n        end-user:\n          exact: jason\n    route:\n    - destination:\n        host: ratings\n        subset: v1\n  - route:\n    - destination:\n        host: ratings\n        subset: v1\n```\n\n\n\n`productpage`6\n\n<font face=\"\" color=red size=3>:</font>IstiopodTCPHTTP\n\nHTTPTCP\n\n\n\n##### \n\nIstio10reviews:v190 reviews:v3100reviews:v3\n\n\n\n```bash\napiVersion: networking.istio.io/v1beta1\nkind: VirtualService\nmetadata:\n  name: bookinfo-traffic-injection\n  namespace: demo\nspec:\n  hosts:\n  - reviews\n  http:\n  - route:\n    - destination:\n        host: reviews\n        subset: v1 # DestinationRule \n      weight: 10\n    - destination:\n        host: reviews\n        subset: v3\n      weight: 90\n---\n\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: bookinfo-traffic-injection\n  namespace: demo\nspec:\n  host: reviews\n  subsets:\n  - name: v1 # subset\n    labels:\n      version: v1 # pod labelsversion\n  - name: v2\n    labels:\n      version: v2\n  - name: v3\n    labels:\n      version: v3\n```\n\n\n\n```yaml\n$ kubectl apply -f bookinfo-traffic-injection.yaml\n```\n\n\nistio-systemkialisvc`nodeport`   admin/admin\n\n![](/uploads/istio/images/m_2d6a4a0feac0159ee65ac3aee53ecaaf_r.png)\n\n`reviews`pod 33%\n\n\n\n\n\nkiali\n\n![](/uploads/istio/images/m_010ffca5e15ec7eb30397a2e97db1268_r.png)\n\n`reviews`\n\n`v1 --->14.3% v2 ---> 0% ,  v3 ---> 85.7%`\n\nistioistio?\n\n<font face=\"\" color=red size=3>:</font> istio \n\n##### \n\n##### \n\n##### \n\n##### \n\nistio \n\n\n#### \n\n##### \n\n##### \n\n### ","slug":"k8s/istio-use","published":1,"updated":"2021-08-24T16:25:21.605Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0cx000osmjrhmk17jwm","content":"<p>istio </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ol>\n<li>kubernetes pod <font face=\"\" color=\"green\" size=\"3\"></font></li>\n<li>1.6 istio, pod</li>\n<li> </li>\n</ol>\n<h3 id=\"-bookinfo\"><a href=\"#-bookinfo\" class=\"headerlink\" title=\" bookinfo\"></a> bookinfo</h3><p>istio <code>BookInfo</code></p>\n<p>Bookinfo</p>\n<p>productpageproductpagedetailsreviews<br>detailsdetails<br>reviewsreviewsratings<br>ratingsratings<br>reviews3</p>\n<p>v1ratings<br>v2ratings15<br>v3ratings15</p>\n<p></p>\n<p><img src=\"/uploads/istio/images/m_88841685b364bda18fb333e9acb97366_r.png\" alt=\"bookInfo\"></p>\n<p>bookinfo bookinfo <br>sidecar,namespace <code>istio-injection=enabled</code>labels istionamespacepodsidecar</p>\n<p>bookinfo demonamespace</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ kubectl label namespace demo istio-injection=enabled</span><br></pre></td></tr></table></figure>\n\n<p>labels</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get namespace demo --show-labels</span><br></pre></td></tr></table></figure>\n\n<p> <code>istio-injection=enabled</code>labels </p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NAME   STATUS   AGE   LABELS</span><br><span class=\"line\">demo   Active   24s   istio-injection=enabled</span><br></pre></td></tr></table></figure>\n\n<p> BookInfo</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl apply -f istio/bookinfo.yml</span><br></pre></td></tr></table></figure>\n\n<p>  sidecar</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get po -n demo</span><br></pre></td></tr></table></figure>\n\n<p> service pod Running </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get service -n demo </span><br><span class=\"line\"></span><br><span class=\"line\">NAME          TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE</span><br><span class=\"line\">details       ClusterIP   10.0.0.31    &lt;none&gt;        9080/TCP   6m</span><br><span class=\"line\">kubernetes    ClusterIP   10.0.0.1     &lt;none&gt;        443/TCP    7d</span><br><span class=\"line\">productpage   ClusterIP   10.0.0.120   &lt;none&gt;        9080/TCP   6m</span><br><span class=\"line\">ratings       ClusterIP   10.0.0.15    &lt;none&gt;        9080/TCP   6m</span><br><span class=\"line\">reviews       ClusterIP   10.0.0.170   &lt;none&gt;        9080/TCP   6m</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods -n demo</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                             READY     STATUS    RESTARTS   AGE</span><br><span class=\"line\">details-v1-1520924117-48z17      2/2       Running   0          6m</span><br><span class=\"line\">productpage-v1-560495357-jk1lz   2/2       Running   0          6m</span><br><span class=\"line\">ratings-v1-734492171-rnr5l       2/2       Running   0          6m</span><br><span class=\"line\">reviews-v1-874083890-f0qf0       2/2       Running   0          6m</span><br><span class=\"line\">reviews-v2-1343845940-b34q5      2/2       Running   0          6m</span><br><span class=\"line\">reviews-v3-1813607990-8ch52      2/2       Running   0          6m</span><br></pre></td></tr></table></figure>\n\n<p>pod ready  2/2  sidecar</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p></p>\n<p>istio Bookinforeviews/productpageBookinfoIstio</p>\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.istio.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Gateway</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">bookinfo-gateway</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">istio:</span> <span class=\"string\">ingressgateway</span> <span class=\"comment\"># istio-system istio-ingressgateway labels</span></span><br><span class=\"line\">  <span class=\"attr\">servers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">hosts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span> <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">port:</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">http</span> </span><br><span class=\"line\">      <span class=\"attr\">number:</span> <span class=\"number\">80</span> <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">protocol:</span> <span class=\"string\">HTTP</span> <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.istio.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">VirtualService</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">bookinfo</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">gateways:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">bookinfo-gateway</span> <span class=\"comment\"># gateway</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span> <span class=\"comment\"># svc </span></span><br><span class=\"line\">  <span class=\"attr\">http:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">match:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">uri:</span></span><br><span class=\"line\">        <span class=\"attr\">exact:</span> <span class=\"string\">/productpage</span> <span class=\"comment\">#  </span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">uri:</span></span><br><span class=\"line\">        <span class=\"attr\">prefix:</span> <span class=\"string\">/static</span> <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">uri:</span></span><br><span class=\"line\">        <span class=\"attr\">exact:</span> <span class=\"string\">/login</span> </span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">uri:</span></span><br><span class=\"line\">        <span class=\"attr\">exact:</span> <span class=\"string\">/logout</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">uri:</span></span><br><span class=\"line\">        <span class=\"attr\">prefix:</span> <span class=\"string\">/api/v1/products</span></span><br><span class=\"line\">    <span class=\"attr\">route:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">destination:</span></span><br><span class=\"line\">        <span class=\"attr\">host:</span> <span class=\"string\">productpage</span> <span class=\"comment\">#  svc</span></span><br><span class=\"line\">        <span class=\"attr\">port:</span></span><br><span class=\"line\">          <span class=\"attr\">number:</span> <span class=\"number\">9080</span> <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p> gateway </p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>selector</td>\n<td>map&lt;string, string&gt;</td>\n<td>Pod / VM   foo barpod istiod<code>PILOTSCOPEGATEWAYTONAMESPACE</code> true  </td>\n<td>yes</td>\n</tr>\n<tr>\n<td>hosts</td>\n<td>[]string</td>\n<td> HTTPTLSSNITCP /dnsName dnsNameFQDNprod / <em>.example.com dnsName</em>prod / <em>VirtualService</em> * / foo.example.com./foo.example.comSidecar /* / DestinationRule  * .example.comdev.example.comprod.example.comVirtualService example.comnewexample.comVirtualServiceexportTo* exportTo VirtualServiceDestinationRuleServiceEntryexportTo</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>port</td>\n<td>port</td>\n<td></td>\n<td>yes</td>\n</tr>\n</tbody></table>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">  ~ kubectl get gw -n demo</span><br><span class=\"line\">NAME               AGE</span><br><span class=\"line\">bookinfo-gateway   11m</span><br><span class=\"line\">  ~ kubectl get vs -n demo</span><br><span class=\"line\">NAME                         GATEWAYS             HOSTS                                  AGE</span><br><span class=\"line\">bookinfo                     [bookinfo-gateway]   [*]                                    11m</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"VirtualService\"><a href=\"#VirtualService\" class=\"headerlink\" title=\"VirtualService\"></a>VirtualService</h5><p>/</p>\n<p>VirtualService </p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>hosts</td>\n<td>string[]</td>\n<td>hostsHTTPTCPIP</td>\n<td>no</td>\n</tr>\n<tr>\n<td>gateways</td>\n<td>string[]</td>\n<td>sidecar<gateway namespace>/<gateway name>; VirtualService</gateway></gateway></td>\n<td>no</td>\n</tr>\n<tr>\n<td>subset</td>\n<td>string</td>\n<td>DestinationRule</td>\n<td>node</td>\n</tr>\n<tr>\n<td>port</td>\n<td>PortSelector</td>\n<td></td>\n<td>no</td>\n</tr>\n<tr>\n<td>http</td>\n<td>HTTPRoute[]</td>\n<td>HTTPHTTP http-  / http2-  / grpc- *HTTP / HTTP2 / GRPC / TLSHTTPSHTTP / HTTP2 /GRPC</td>\n<td>no</td>\n</tr>\n<tr>\n<td>tls</td>\n<td>TLSRoute[]</td>\n<td>TLSHTTPSClientHelloSNITLSHTTPS / TLS TLS https-  tls- HTTPS / TLS https-  tls- TCP</td>\n<td>no</td>\n</tr>\n<tr>\n<td>tcp</td>\n<td>TCPRoute[]</td>\n<td>TCPTCPHTTPTLS</td>\n<td>no</td>\n</tr>\n</tbody></table>\n<h5 id=\"HTTP\"><a href=\"#HTTP\" class=\"headerlink\" title=\"HTTP\"></a>HTTP</h5><p>HTTP / 1.1HTTP2gRPCVirtualService</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>name</td>\n<td>string</td>\n<td>/</td>\n<td>no</td>\n</tr>\n<tr>\n<td>match</td>\n<td>HTTPMatchRequest[]</td>\n<td>ANDOR</td>\n<td>no</td>\n</tr>\n<tr>\n<td>route</td>\n<td>HTTPRouteDestination[]</td>\n<td>HTTP</td>\n<td>no</td>\n</tr>\n<tr>\n<td>redirect</td>\n<td>HTTPRedirect</td>\n<td>HTTP/HTTP 301URIAuthority</td>\n<td>no</td>\n</tr>\n<tr>\n<td>rewrite</td>\n<td>HTTPRewrite</td>\n<td>HTTP URIAuthority</td>\n<td>no</td>\n</tr>\n<tr>\n<td>timeout</td>\n<td>Duration</td>\n<td>HTTP</td>\n<td>no</td>\n</tr>\n<tr>\n<td>retries</td>\n<td>HTTPRetry</td>\n<td>HTTP</td>\n<td>no</td>\n</tr>\n<tr>\n<td>headers</td>\n<td>Headers</td>\n<td></td>\n<td>no</td>\n</tr>\n<tr>\n<td>fault</td>\n<td>HTTPFaultInjection</td>\n<td>HTTP</td>\n<td></td>\n</tr>\n<tr>\n<td>mirror</td>\n<td>Destination</td>\n<td>HTTP/</td>\n<td>no</td>\n</tr>\n</tbody></table>\n<p>http tcp tls  </p>\n<p>:</p>\n<p><img src=\"/uploads/istio/images/m_f048c09d102e39ddf43a9d3e0ae81d47_r.png\"></p>\n<p> <code>reviews</code> </p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>Bookinforeviews:v2ratings7sjasonBookinfo</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">$</span> <span class=\"string\">kubectl</span> <span class=\"string\">get</span> <span class=\"string\">virtualservice</span> <span class=\"string\">ratings</span> <span class=\"string\">-o</span> <span class=\"string\">yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.istio.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">VirtualService</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">bookinfo-fault-injection</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">ratings</span></span><br><span class=\"line\">  <span class=\"attr\">http:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">fault:</span></span><br><span class=\"line\">      <span class=\"attr\">delay:</span></span><br><span class=\"line\">        <span class=\"attr\">fixedDelay:</span> <span class=\"string\">7s</span></span><br><span class=\"line\">        <span class=\"attr\">percentage:</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"number\">100</span></span><br><span class=\"line\">    <span class=\"attr\">match:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">headers:</span></span><br><span class=\"line\">        <span class=\"attr\">end-user:</span></span><br><span class=\"line\">          <span class=\"attr\">exact:</span> <span class=\"string\">jason</span></span><br><span class=\"line\">    <span class=\"attr\">route:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">destination:</span></span><br><span class=\"line\">        <span class=\"attr\">host:</span> <span class=\"string\">ratings</span></span><br><span class=\"line\">        <span class=\"attr\">subset:</span> <span class=\"string\">v1</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">route:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">destination:</span></span><br><span class=\"line\">        <span class=\"attr\">host:</span> <span class=\"string\">ratings</span></span><br><span class=\"line\">        <span class=\"attr\">subset:</span> <span class=\"string\">v1</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><code>productpage</code>6</p>\n<p><font face=\"\" color=\"red\" size=\"3\">:</font>IstiopodTCPHTTP</p>\n<p>HTTPTCP</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>Istio10reviews:v190 reviews:v3100reviews:v3</p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: networking.istio.io/v1beta1</span><br><span class=\"line\">kind: VirtualService</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: bookinfo-traffic-injection</span><br><span class=\"line\">  namespace: demo</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  hosts:</span><br><span class=\"line\">  - reviews</span><br><span class=\"line\">  http:</span><br><span class=\"line\">  - route:</span><br><span class=\"line\">    - destination:</span><br><span class=\"line\">        host: reviews</span><br><span class=\"line\">        subset: v1 <span class=\"comment\"># DestinationRule </span></span><br><span class=\"line\">      weight: 10</span><br><span class=\"line\">    - destination:</span><br><span class=\"line\">        host: reviews</span><br><span class=\"line\">        subset: v3</span><br><span class=\"line\">      weight: 90</span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: networking.istio.io/v1alpha3</span><br><span class=\"line\">kind: DestinationRule</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: bookinfo-traffic-injection</span><br><span class=\"line\">  namespace: demo</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  host: reviews</span><br><span class=\"line\">  subsets:</span><br><span class=\"line\">  - name: v1 <span class=\"comment\"># subset</span></span><br><span class=\"line\">    labels:</span><br><span class=\"line\">      version: v1 <span class=\"comment\"># pod labelsversion</span></span><br><span class=\"line\">  - name: v2</span><br><span class=\"line\">    labels:</span><br><span class=\"line\">      version: v2</span><br><span class=\"line\">  - name: v3</span><br><span class=\"line\">    labels:</span><br><span class=\"line\">      version: v3</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">$</span> <span class=\"string\">kubectl</span> <span class=\"string\">apply</span> <span class=\"string\">-f</span> <span class=\"string\">bookinfo-traffic-injection.yaml</span></span><br></pre></td></tr></table></figure>\n\n\n<p>istio-systemkialisvc<code>nodeport</code>   admin/admin</p>\n<p><img src=\"/uploads/istio/images/m_2d6a4a0feac0159ee65ac3aee53ecaaf_r.png\"></p>\n<p><code>reviews</code>pod 33%</p>\n<p></p>\n<p></p>\n<p>kiali</p>\n<p><img src=\"/uploads/istio/images/m_010ffca5e15ec7eb30397a2e97db1268_r.png\"></p>\n<p><code>reviews</code></p>\n<p><code>v1 ---&gt;14.3% v2 ---&gt; 0% ,  v3 ---&gt; 85.7%</code></p>\n<p>istioistio?</p>\n<p><font face=\"\" color=\"red\" size=\"3\">:</font> istio </p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>istio </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>","site":{"data":{}},"excerpt":"","more":"<p>istio </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p></p>\n<ol>\n<li>kubernetes pod <font face=\"\" color=\"green\" size=\"3\"></font></li>\n<li>1.6 istio, pod</li>\n<li> </li>\n</ol>\n<h3 id=\"-bookinfo\"><a href=\"#-bookinfo\" class=\"headerlink\" title=\" bookinfo\"></a> bookinfo</h3><p>istio <code>BookInfo</code></p>\n<p>Bookinfo</p>\n<p>productpageproductpagedetailsreviews<br>detailsdetails<br>reviewsreviewsratings<br>ratingsratings<br>reviews3</p>\n<p>v1ratings<br>v2ratings15<br>v3ratings15</p>\n<p></p>\n<p><img src=\"/uploads/istio/images/m_88841685b364bda18fb333e9acb97366_r.png\" alt=\"bookInfo\"></p>\n<p>bookinfo bookinfo <br>sidecar,namespace <code>istio-injection=enabled</code>labels istionamespacepodsidecar</p>\n<p>bookinfo demonamespace</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ kubectl label namespace demo istio-injection=enabled</span><br></pre></td></tr></table></figure>\n\n<p>labels</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get namespace demo --show-labels</span><br></pre></td></tr></table></figure>\n\n<p> <code>istio-injection=enabled</code>labels </p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NAME   STATUS   AGE   LABELS</span><br><span class=\"line\">demo   Active   24s   istio-injection=enabled</span><br></pre></td></tr></table></figure>\n\n<p> BookInfo</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl apply -f istio/bookinfo.yml</span><br></pre></td></tr></table></figure>\n\n<p>  sidecar</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get po -n demo</span><br></pre></td></tr></table></figure>\n\n<p> service pod Running </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl get service -n demo </span><br><span class=\"line\"></span><br><span class=\"line\">NAME          TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE</span><br><span class=\"line\">details       ClusterIP   10.0.0.31    &lt;none&gt;        9080/TCP   6m</span><br><span class=\"line\">kubernetes    ClusterIP   10.0.0.1     &lt;none&gt;        443/TCP    7d</span><br><span class=\"line\">productpage   ClusterIP   10.0.0.120   &lt;none&gt;        9080/TCP   6m</span><br><span class=\"line\">ratings       ClusterIP   10.0.0.15    &lt;none&gt;        9080/TCP   6m</span><br><span class=\"line\">reviews       ClusterIP   10.0.0.170   &lt;none&gt;        9080/TCP   6m</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl get pods -n demo</span><br><span class=\"line\"></span><br><span class=\"line\">NAME                             READY     STATUS    RESTARTS   AGE</span><br><span class=\"line\">details-v1-1520924117-48z17      2/2       Running   0          6m</span><br><span class=\"line\">productpage-v1-560495357-jk1lz   2/2       Running   0          6m</span><br><span class=\"line\">ratings-v1-734492171-rnr5l       2/2       Running   0          6m</span><br><span class=\"line\">reviews-v1-874083890-f0qf0       2/2       Running   0          6m</span><br><span class=\"line\">reviews-v2-1343845940-b34q5      2/2       Running   0          6m</span><br><span class=\"line\">reviews-v3-1813607990-8ch52      2/2       Running   0          6m</span><br></pre></td></tr></table></figure>\n\n<p>pod ready  2/2  sidecar</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p></p>\n<p>istio Bookinforeviews/productpageBookinfoIstio</p>\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.istio.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Gateway</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">bookinfo-gateway</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">istio:</span> <span class=\"string\">ingressgateway</span> <span class=\"comment\"># istio-system istio-ingressgateway labels</span></span><br><span class=\"line\">  <span class=\"attr\">servers:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">hosts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span> <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"attr\">port:</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">http</span> </span><br><span class=\"line\">      <span class=\"attr\">number:</span> <span class=\"number\">80</span> <span class=\"comment\"># </span></span><br><span class=\"line\">      <span class=\"attr\">protocol:</span> <span class=\"string\">HTTP</span> <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.istio.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">VirtualService</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">bookinfo</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">gateways:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">bookinfo-gateway</span> <span class=\"comment\"># gateway</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span> <span class=\"comment\"># svc </span></span><br><span class=\"line\">  <span class=\"attr\">http:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">match:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">uri:</span></span><br><span class=\"line\">        <span class=\"attr\">exact:</span> <span class=\"string\">/productpage</span> <span class=\"comment\">#  </span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">uri:</span></span><br><span class=\"line\">        <span class=\"attr\">prefix:</span> <span class=\"string\">/static</span> <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">uri:</span></span><br><span class=\"line\">        <span class=\"attr\">exact:</span> <span class=\"string\">/login</span> </span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">uri:</span></span><br><span class=\"line\">        <span class=\"attr\">exact:</span> <span class=\"string\">/logout</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">uri:</span></span><br><span class=\"line\">        <span class=\"attr\">prefix:</span> <span class=\"string\">/api/v1/products</span></span><br><span class=\"line\">    <span class=\"attr\">route:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">destination:</span></span><br><span class=\"line\">        <span class=\"attr\">host:</span> <span class=\"string\">productpage</span> <span class=\"comment\">#  svc</span></span><br><span class=\"line\">        <span class=\"attr\">port:</span></span><br><span class=\"line\">          <span class=\"attr\">number:</span> <span class=\"number\">9080</span> <span class=\"comment\"># </span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p> gateway </p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>selector</td>\n<td>map&lt;string, string&gt;</td>\n<td>Pod / VM   foo barpod istiod<code>PILOTSCOPEGATEWAYTONAMESPACE</code> true  </td>\n<td>yes</td>\n</tr>\n<tr>\n<td>hosts</td>\n<td>[]string</td>\n<td> HTTPTLSSNITCP /dnsName dnsNameFQDNprod / <em>.example.com dnsName</em>prod / <em>VirtualService</em> * / foo.example.com./foo.example.comSidecar /* / DestinationRule  * .example.comdev.example.comprod.example.comVirtualService example.comnewexample.comVirtualServiceexportTo* exportTo VirtualServiceDestinationRuleServiceEntryexportTo</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>port</td>\n<td>port</td>\n<td></td>\n<td>yes</td>\n</tr>\n</tbody></table>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">  ~ kubectl get gw -n demo</span><br><span class=\"line\">NAME               AGE</span><br><span class=\"line\">bookinfo-gateway   11m</span><br><span class=\"line\">  ~ kubectl get vs -n demo</span><br><span class=\"line\">NAME                         GATEWAYS             HOSTS                                  AGE</span><br><span class=\"line\">bookinfo                     [bookinfo-gateway]   [*]                                    11m</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"VirtualService\"><a href=\"#VirtualService\" class=\"headerlink\" title=\"VirtualService\"></a>VirtualService</h5><p>/</p>\n<p>VirtualService </p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>hosts</td>\n<td>string[]</td>\n<td>hostsHTTPTCPIP</td>\n<td>no</td>\n</tr>\n<tr>\n<td>gateways</td>\n<td>string[]</td>\n<td>sidecar<gateway namespace>/<gateway name>; VirtualService</gateway></gateway></td>\n<td>no</td>\n</tr>\n<tr>\n<td>subset</td>\n<td>string</td>\n<td>DestinationRule</td>\n<td>node</td>\n</tr>\n<tr>\n<td>port</td>\n<td>PortSelector</td>\n<td></td>\n<td>no</td>\n</tr>\n<tr>\n<td>http</td>\n<td>HTTPRoute[]</td>\n<td>HTTPHTTP http-  / http2-  / grpc- *HTTP / HTTP2 / GRPC / TLSHTTPSHTTP / HTTP2 /GRPC</td>\n<td>no</td>\n</tr>\n<tr>\n<td>tls</td>\n<td>TLSRoute[]</td>\n<td>TLSHTTPSClientHelloSNITLSHTTPS / TLS TLS https-  tls- HTTPS / TLS https-  tls- TCP</td>\n<td>no</td>\n</tr>\n<tr>\n<td>tcp</td>\n<td>TCPRoute[]</td>\n<td>TCPTCPHTTPTLS</td>\n<td>no</td>\n</tr>\n</tbody></table>\n<h5 id=\"HTTP\"><a href=\"#HTTP\" class=\"headerlink\" title=\"HTTP\"></a>HTTP</h5><p>HTTP / 1.1HTTP2gRPCVirtualService</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>name</td>\n<td>string</td>\n<td>/</td>\n<td>no</td>\n</tr>\n<tr>\n<td>match</td>\n<td>HTTPMatchRequest[]</td>\n<td>ANDOR</td>\n<td>no</td>\n</tr>\n<tr>\n<td>route</td>\n<td>HTTPRouteDestination[]</td>\n<td>HTTP</td>\n<td>no</td>\n</tr>\n<tr>\n<td>redirect</td>\n<td>HTTPRedirect</td>\n<td>HTTP/HTTP 301URIAuthority</td>\n<td>no</td>\n</tr>\n<tr>\n<td>rewrite</td>\n<td>HTTPRewrite</td>\n<td>HTTP URIAuthority</td>\n<td>no</td>\n</tr>\n<tr>\n<td>timeout</td>\n<td>Duration</td>\n<td>HTTP</td>\n<td>no</td>\n</tr>\n<tr>\n<td>retries</td>\n<td>HTTPRetry</td>\n<td>HTTP</td>\n<td>no</td>\n</tr>\n<tr>\n<td>headers</td>\n<td>Headers</td>\n<td></td>\n<td>no</td>\n</tr>\n<tr>\n<td>fault</td>\n<td>HTTPFaultInjection</td>\n<td>HTTP</td>\n<td></td>\n</tr>\n<tr>\n<td>mirror</td>\n<td>Destination</td>\n<td>HTTP/</td>\n<td>no</td>\n</tr>\n</tbody></table>\n<p>http tcp tls  </p>\n<p>:</p>\n<p><img src=\"/uploads/istio/images/m_f048c09d102e39ddf43a9d3e0ae81d47_r.png\"></p>\n<p> <code>reviews</code> </p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>Bookinforeviews:v2ratings7sjasonBookinfo</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">$</span> <span class=\"string\">kubectl</span> <span class=\"string\">get</span> <span class=\"string\">virtualservice</span> <span class=\"string\">ratings</span> <span class=\"string\">-o</span> <span class=\"string\">yaml</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.istio.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">VirtualService</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">bookinfo-fault-injection</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">demo</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">ratings</span></span><br><span class=\"line\">  <span class=\"attr\">http:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">fault:</span></span><br><span class=\"line\">      <span class=\"attr\">delay:</span></span><br><span class=\"line\">        <span class=\"attr\">fixedDelay:</span> <span class=\"string\">7s</span></span><br><span class=\"line\">        <span class=\"attr\">percentage:</span></span><br><span class=\"line\">          <span class=\"attr\">value:</span> <span class=\"number\">100</span></span><br><span class=\"line\">    <span class=\"attr\">match:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">headers:</span></span><br><span class=\"line\">        <span class=\"attr\">end-user:</span></span><br><span class=\"line\">          <span class=\"attr\">exact:</span> <span class=\"string\">jason</span></span><br><span class=\"line\">    <span class=\"attr\">route:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">destination:</span></span><br><span class=\"line\">        <span class=\"attr\">host:</span> <span class=\"string\">ratings</span></span><br><span class=\"line\">        <span class=\"attr\">subset:</span> <span class=\"string\">v1</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">route:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">destination:</span></span><br><span class=\"line\">        <span class=\"attr\">host:</span> <span class=\"string\">ratings</span></span><br><span class=\"line\">        <span class=\"attr\">subset:</span> <span class=\"string\">v1</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><code>productpage</code>6</p>\n<p><font face=\"\" color=\"red\" size=\"3\">:</font>IstiopodTCPHTTP</p>\n<p>HTTPTCP</p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>Istio10reviews:v190 reviews:v3100reviews:v3</p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: networking.istio.io/v1beta1</span><br><span class=\"line\">kind: VirtualService</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: bookinfo-traffic-injection</span><br><span class=\"line\">  namespace: demo</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  hosts:</span><br><span class=\"line\">  - reviews</span><br><span class=\"line\">  http:</span><br><span class=\"line\">  - route:</span><br><span class=\"line\">    - destination:</span><br><span class=\"line\">        host: reviews</span><br><span class=\"line\">        subset: v1 <span class=\"comment\"># DestinationRule </span></span><br><span class=\"line\">      weight: 10</span><br><span class=\"line\">    - destination:</span><br><span class=\"line\">        host: reviews</span><br><span class=\"line\">        subset: v3</span><br><span class=\"line\">      weight: 90</span><br><span class=\"line\">---</span><br><span class=\"line\"></span><br><span class=\"line\">apiVersion: networking.istio.io/v1alpha3</span><br><span class=\"line\">kind: DestinationRule</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  name: bookinfo-traffic-injection</span><br><span class=\"line\">  namespace: demo</span><br><span class=\"line\">spec:</span><br><span class=\"line\">  host: reviews</span><br><span class=\"line\">  subsets:</span><br><span class=\"line\">  - name: v1 <span class=\"comment\"># subset</span></span><br><span class=\"line\">    labels:</span><br><span class=\"line\">      version: v1 <span class=\"comment\"># pod labelsversion</span></span><br><span class=\"line\">  - name: v2</span><br><span class=\"line\">    labels:</span><br><span class=\"line\">      version: v2</span><br><span class=\"line\">  - name: v3</span><br><span class=\"line\">    labels:</span><br><span class=\"line\">      version: v3</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">$</span> <span class=\"string\">kubectl</span> <span class=\"string\">apply</span> <span class=\"string\">-f</span> <span class=\"string\">bookinfo-traffic-injection.yaml</span></span><br></pre></td></tr></table></figure>\n\n\n<p>istio-systemkialisvc<code>nodeport</code>   admin/admin</p>\n<p><img src=\"/uploads/istio/images/m_2d6a4a0feac0159ee65ac3aee53ecaaf_r.png\"></p>\n<p><code>reviews</code>pod 33%</p>\n<p></p>\n<p></p>\n<p>kiali</p>\n<p><img src=\"/uploads/istio/images/m_010ffca5e15ec7eb30397a2e97db1268_r.png\"></p>\n<p><code>reviews</code></p>\n<p><code>v1 ---&gt;14.3% v2 ---&gt; 0% ,  v3 ---&gt; 85.7%</code></p>\n<p>istioistio?</p>\n<p><font face=\"\" color=\"red\" size=\"3\">:</font> istio </p>\n<h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><p>istio </p>\n<h4 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h4><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><h5 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h5><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3>"},{"title":" lb","date":"2021-04-07T14:50:01.000Z","_content":"\n#  lb\n\nk8sLoadBalancerServiceLoad Balancer, slb\n\n\nk8sLoadBalancermetallb\n\nMetalLB2 `Layer2` `BGP`\n\n## MetalLB \n\n```bash\nkubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/namespace.yaml;\nkubectl create secret generic -n metallb-system memberlist --from-literal=secretkey=\"$(openssl rand -base64 128)\";\nkubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/metallb.yaml;\n```\n\n## \n\nMetalLB\n\n*  Kubernetes Kubernetes 1.13.0\n*   MetalLB\n* MetalLBIPv4\n* BGP BGP\n* 7946TCPUDP \n\n\nGBP \n\n```bash\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  namespace: metallb-system\n  name: config\ndata:\n  config: |\n    peers:\n    - peer-address: 10.0.0.1\n      peer-asn: 64501\n      my-asn: 64500\n    address-pools:\n    - name: default\n      protocol: bgp\n      addresses:\n      - 192.168.10.0/24\n```\n\n### configmap\n\n```bash\nkubectl apply -f configmap.yaml\n```","source":"_posts/k8s/lb.md","raw":"---\ntitle:  lb\ndate: 2021-04-07 22:50:01\ntags:\n- kubernetes\n---\n\n#  lb\n\nk8sLoadBalancerServiceLoad Balancer, slb\n\n\nk8sLoadBalancermetallb\n\nMetalLB2 `Layer2` `BGP`\n\n## MetalLB \n\n```bash\nkubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/namespace.yaml;\nkubectl create secret generic -n metallb-system memberlist --from-literal=secretkey=\"$(openssl rand -base64 128)\";\nkubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/metallb.yaml;\n```\n\n## \n\nMetalLB\n\n*  Kubernetes Kubernetes 1.13.0\n*   MetalLB\n* MetalLBIPv4\n* BGP BGP\n* 7946TCPUDP \n\n\nGBP \n\n```bash\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  namespace: metallb-system\n  name: config\ndata:\n  config: |\n    peers:\n    - peer-address: 10.0.0.1\n      peer-asn: 64501\n      my-asn: 64500\n    address-pools:\n    - name: default\n      protocol: bgp\n      addresses:\n      - 192.168.10.0/24\n```\n\n### configmap\n\n```bash\nkubectl apply -f configmap.yaml\n```","slug":"k8s/lb","published":1,"updated":"2021-08-24T16:25:21.608Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0cy000qsmjr2thjfk4m","content":"<h1 id=\"-lb\"><a href=\"#-lb\" class=\"headerlink\" title=\" lb\"></a> lb</h1><p>k8sLoadBalancerServiceLoad Balancer, slb</p>\n<p>k8sLoadBalancermetallb</p>\n<p>MetalLB2 <code>Layer2</code> <code>BGP</code></p>\n<h2 id=\"MetalLB-\"><a href=\"#MetalLB-\" class=\"headerlink\" title=\"MetalLB \"></a>MetalLB </h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/namespace.yaml;</span><br><span class=\"line\">kubectl create secret generic -n metallb-system memberlist --from-literal=secretkey=<span class=\"string\">&quot;<span class=\"subst\">$(openssl rand -base64 128)</span>&quot;</span>;</span><br><span class=\"line\">kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/metallb.yaml;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MetalLB</p>\n<ul>\n<li> Kubernetes Kubernetes 1.13.0</li>\n<li>  MetalLB</li>\n<li>MetalLBIPv4</li>\n<li>BGP BGP</li>\n<li>7946TCPUDP </li>\n</ul>\n<p>GBP </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: ConfigMap</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  namespace: metallb-system</span><br><span class=\"line\">  name: config</span><br><span class=\"line\">data:</span><br><span class=\"line\">  config: |</span><br><span class=\"line\">    peers:</span><br><span class=\"line\">    - peer-address: 10.0.0.1</span><br><span class=\"line\">      peer-asn: 64501</span><br><span class=\"line\">      my-asn: 64500</span><br><span class=\"line\">    address-pools:</span><br><span class=\"line\">    - name: default</span><br><span class=\"line\">      protocol: bgp</span><br><span class=\"line\">      addresses:</span><br><span class=\"line\">      - 192.168.10.0/24</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"configmap\"><a href=\"#configmap\" class=\"headerlink\" title=\"configmap\"></a>configmap</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f configmap.yaml</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h1 id=\"-lb\"><a href=\"#-lb\" class=\"headerlink\" title=\" lb\"></a> lb</h1><p>k8sLoadBalancerServiceLoad Balancer, slb</p>\n<p>k8sLoadBalancermetallb</p>\n<p>MetalLB2 <code>Layer2</code> <code>BGP</code></p>\n<h2 id=\"MetalLB-\"><a href=\"#MetalLB-\" class=\"headerlink\" title=\"MetalLB \"></a>MetalLB </h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/namespace.yaml;</span><br><span class=\"line\">kubectl create secret generic -n metallb-system memberlist --from-literal=secretkey=<span class=\"string\">&quot;<span class=\"subst\">$(openssl rand -base64 128)</span>&quot;</span>;</span><br><span class=\"line\">kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.9.3/manifests/metallb.yaml;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MetalLB</p>\n<ul>\n<li> Kubernetes Kubernetes 1.13.0</li>\n<li>  MetalLB</li>\n<li>MetalLBIPv4</li>\n<li>BGP BGP</li>\n<li>7946TCPUDP </li>\n</ul>\n<p>GBP </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apiVersion: v1</span><br><span class=\"line\">kind: ConfigMap</span><br><span class=\"line\">metadata:</span><br><span class=\"line\">  namespace: metallb-system</span><br><span class=\"line\">  name: config</span><br><span class=\"line\">data:</span><br><span class=\"line\">  config: |</span><br><span class=\"line\">    peers:</span><br><span class=\"line\">    - peer-address: 10.0.0.1</span><br><span class=\"line\">      peer-asn: 64501</span><br><span class=\"line\">      my-asn: 64500</span><br><span class=\"line\">    address-pools:</span><br><span class=\"line\">    - name: default</span><br><span class=\"line\">      protocol: bgp</span><br><span class=\"line\">      addresses:</span><br><span class=\"line\">      - 192.168.10.0/24</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"configmap\"><a href=\"#configmap\" class=\"headerlink\" title=\"configmap\"></a>configmap</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f configmap.yaml</span><br></pre></td></tr></table></figure>"},{"title":"kiali ","date":"2021-01-21T10:36:28.000Z","_content":"\n\nkiali \n\n: \n\nKialiIstioKialiGrafanaJaeger\n\n\nkiali \n\n![kiali](https://kiali.io/images/documentation/features/graph-health-v1.22.0.png)\n\nKialiIstio istiokiali\n\nistio kiali\n\n```bash\n$ istioctl manifest apply --set values.kiali.enabled=true\n```\n\nkiali   admin/admin\n\n## kiali \n\n### kiali route \n\nrouting/router\n\n```go\n//   \nif webRoot != \"/\" {\n\t\trootRouter.HandleFunc(webRoot, func(w http.ResponseWriter, r *http.Request) {\n\t\t\thttp.Redirect(w, r, webRootWithSlash, http.StatusFound)\n\t\t})\n\n\t\t// help the user out - if a request comes in for \"/\", redirect to our true webroot\n\t\trootRouter.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n\t\t\thttp.Redirect(w, r, webRootWithSlash, http.StatusFound)\n\t\t})\n\n\t\tappRouter = rootRouter.PathPrefix(conf.Server.WebRoot).Subrouter()\n\t}\n\tappRouter = appRouter.StrictSlash(true)\n\n// function \n\tr.Routes = []Route{\n\t\t// swagger:route GET /healthz kiali healthz\n\t\t// ---\n\t\t// Endpoint to get the health of Kiali\n\t\t//\n\t\t//     Produces:\n\t\t//     - application/json\n\t\t//\n\t\t//     Schemes: http, https\n\t\t// responses:\n\t\t//\t\t500: internalError\n\t\t//\t\t200\n\t\t{\n\t\t\t\"Healthz\",\n\t\t\t\"GET\",\n\t\t\t\"/healthz\",\n\t\t\thandlers.Healthz,\n\t\t\tfalse,\n\t\t},\n\t\t// swagger:route GET / kiali root\n\t\t// ---\n\t\t// Endpoint to get the status of Kiali\n\t\t//\n\t\t//     Produces:\n\t\t//     - application/json\n\t\t//\n\t\t//     Schemes: http, https\n\t\t// responses:\n\t\t//      500: internalError\n\t\t//      200: statusInfo\n\t\t{\n\t\t\t\"Root\",\n\t\t\t\"GET\",\n\t\t\t\"/api\",\n\t\t\thandlers.Root,\n\t\t\tfalse,\n\t\t}\n}\n```\n\n\nkiali kiali\n\n/graph/api/api\n\n```go\n\nfunc GraphNamespaces(business *business.Layer, o graph.Options) (code int, config interface{}) {\n\t// time how long it takes to generate this graph\n\tpromtimer := internalmetrics.GetGraphGenerationTimePrometheusTimer(o.GetGraphKind(), o.TelemetryOptions.GraphType, o.InjectServiceNodes)\n\tdefer promtimer.ObserveDuration()\n\n\tswitch o.TelemetryVendor {\n\tcase graph.VendorIstio:\n\t\tprom, err := prometheus.NewClientNoAuth(business.PromAddress)\n\t\tgraph.CheckError(err)\n//config \n\t\tcode, config = graphNamespacesIstio(business, prom, o)\n\tdefault:\n\t\tgraph.Error(fmt.Sprintf(\"TelemetryVendor [%s] not supported\", o.TelemetryVendor))\n\t}\n\n\t// update metrics\n\tinternalmetrics.SetGraphNodes(o.GetGraphKind(), o.TelemetryOptions.GraphType, o.InjectServiceNodes, 0)\n\n\treturn code, config\n}\n```\n\n\n TrafficMap\n\ngraph/telemetry/istio/istio.go\n\n```go\n\n// BuildNamespacesTrafficMap is required by the graph/TelemtryVendor interface\nfunc BuildNamespacesTrafficMap(o graph.TelemetryOptions, client *prometheus.Client, globalInfo *graph.AppenderGlobalInfo) graph.TrafficMap {\n\tlog.Tracef(\"Build [%s] graph for [%v] namespaces [%s]\", o.GraphType, len(o.Namespaces), o.Namespaces)\n\n\tsetLabels()\n\tappenders := appender.ParseAppenders(o)\n\ttrafficMap := graph.NewTrafficMap()\n\n\tfor _, namespace := range o.Namespaces {\n\t\tlog.Tracef(\"Build traffic map for namespace [%s]\", namespace)\n\t\t// namespaceTrafficMap\n\t\tnamespaceTrafficMap := buildNamespaceTrafficMap(namespace.Name, o, client)\n\t\tnamespaceInfo := graph.NewAppenderNamespaceInfo(namespace.Name)\n\t\tfor _, a := range appenders {\n\t\t\tappenderTimer := internalmetrics.GetGraphAppenderTimePrometheusTimer(a.Name())\n\t\t\ta.AppendGraph(namespaceTrafficMap, globalInfo, namespaceInfo)\n\t\t\tappenderTimer.ObserveDuration()\n\t\t}\n\t\t//  namespaceTrafficMap merge ---->  trafficMap \n\t\ttelemetry.MergeTrafficMaps(trafficMap, namespace.Name, namespaceTrafficMap)\n\t}\n\n\t// The appenders can add/remove/alter nodes. After the manipulations are complete\n\t// we can make some final adjustments:\n\t// - mark the outsiders (i.e. nodes not in the requested namespaces)\n\t// - mark the insider traffic generators (i.e. inside the namespace and only outgoing edges)\n\ttelemetry.MarkOutsideOrInaccessible(trafficMap, o)\n\ttelemetry.MarkTrafficGenerators(trafficMap)\n\n\tif graph.GraphTypeService == o.GraphType {\n\t\ttrafficMap = telemetry.ReduceToServiceGraph(trafficMap)\n\t}\n\n\treturn trafficMap\n}\n```\n\nAppender interface \n\ngraph/appender.go\n\n```go\n// Appender is implemented by any code offering to append a service graph with\n// supplemental information.  On error the appender should panic and it will be\n// handled as an error response.\ntype Appender interface {\n\t// AppendGraph performs the appender work on the provided traffic map. The map\n\t// may be initially empty. An appender is allowed to add or remove map entries.\n\tAppendGraph(trafficMap TrafficMap, globalInfo *AppenderGlobalInfo, namespaceInfo *AppenderNamespaceInfo)\n\t// Name returns a unique appender name and which is the name used to identify the appender (e.g in 'appenders' query param)\n\tName() string\n}\n\n```\n\n#### appender\n\n* istio: Istio\n* deadNode: \n* serviceEntry: ServiceEntryAppenderIstioserviceEntry\nserviceEntry\n\nserviceEntry se-service\n* responseTime: ResponseTimeAppenderresponseTime\n* securityPolicy: SecurityPolicyAppendersecurityPolicy\ninternational_tls\n* sidecarsCheck: SidecarsCheckAppenderEnvoy sidecar\n\n* unusedNode: \n\ngoType\n\n\nappender, service-entry --> deadNode --> responseTime ---> securityPolicy --->  unusedNode --> istio\n\nappendertrafficMap merge  traffic map\n\n```go\ntrafficMap := graph.NewTrafficMap()\n\n//  namespaceTrafficMap merge ---->  trafficMap \n\ntelemetry.MergeTrafficMaps(trafficMap, namespace.Name, namespaceTrafficMap)\n```\n\n","source":"_posts/k8s/kiali.md","raw":"---\ntitle: kiali \ndate: 2021-01-21 18:36:28\ncategories: \n- istio\ntags: \n- istio\n- kiali\n---\n\n\nkiali \n\n: \n\nKialiIstioKialiGrafanaJaeger\n\n\nkiali \n\n![kiali](https://kiali.io/images/documentation/features/graph-health-v1.22.0.png)\n\nKialiIstio istiokiali\n\nistio kiali\n\n```bash\n$ istioctl manifest apply --set values.kiali.enabled=true\n```\n\nkiali   admin/admin\n\n## kiali \n\n### kiali route \n\nrouting/router\n\n```go\n//   \nif webRoot != \"/\" {\n\t\trootRouter.HandleFunc(webRoot, func(w http.ResponseWriter, r *http.Request) {\n\t\t\thttp.Redirect(w, r, webRootWithSlash, http.StatusFound)\n\t\t})\n\n\t\t// help the user out - if a request comes in for \"/\", redirect to our true webroot\n\t\trootRouter.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n\t\t\thttp.Redirect(w, r, webRootWithSlash, http.StatusFound)\n\t\t})\n\n\t\tappRouter = rootRouter.PathPrefix(conf.Server.WebRoot).Subrouter()\n\t}\n\tappRouter = appRouter.StrictSlash(true)\n\n// function \n\tr.Routes = []Route{\n\t\t// swagger:route GET /healthz kiali healthz\n\t\t// ---\n\t\t// Endpoint to get the health of Kiali\n\t\t//\n\t\t//     Produces:\n\t\t//     - application/json\n\t\t//\n\t\t//     Schemes: http, https\n\t\t// responses:\n\t\t//\t\t500: internalError\n\t\t//\t\t200\n\t\t{\n\t\t\t\"Healthz\",\n\t\t\t\"GET\",\n\t\t\t\"/healthz\",\n\t\t\thandlers.Healthz,\n\t\t\tfalse,\n\t\t},\n\t\t// swagger:route GET / kiali root\n\t\t// ---\n\t\t// Endpoint to get the status of Kiali\n\t\t//\n\t\t//     Produces:\n\t\t//     - application/json\n\t\t//\n\t\t//     Schemes: http, https\n\t\t// responses:\n\t\t//      500: internalError\n\t\t//      200: statusInfo\n\t\t{\n\t\t\t\"Root\",\n\t\t\t\"GET\",\n\t\t\t\"/api\",\n\t\t\thandlers.Root,\n\t\t\tfalse,\n\t\t}\n}\n```\n\n\nkiali kiali\n\n/graph/api/api\n\n```go\n\nfunc GraphNamespaces(business *business.Layer, o graph.Options) (code int, config interface{}) {\n\t// time how long it takes to generate this graph\n\tpromtimer := internalmetrics.GetGraphGenerationTimePrometheusTimer(o.GetGraphKind(), o.TelemetryOptions.GraphType, o.InjectServiceNodes)\n\tdefer promtimer.ObserveDuration()\n\n\tswitch o.TelemetryVendor {\n\tcase graph.VendorIstio:\n\t\tprom, err := prometheus.NewClientNoAuth(business.PromAddress)\n\t\tgraph.CheckError(err)\n//config \n\t\tcode, config = graphNamespacesIstio(business, prom, o)\n\tdefault:\n\t\tgraph.Error(fmt.Sprintf(\"TelemetryVendor [%s] not supported\", o.TelemetryVendor))\n\t}\n\n\t// update metrics\n\tinternalmetrics.SetGraphNodes(o.GetGraphKind(), o.TelemetryOptions.GraphType, o.InjectServiceNodes, 0)\n\n\treturn code, config\n}\n```\n\n\n TrafficMap\n\ngraph/telemetry/istio/istio.go\n\n```go\n\n// BuildNamespacesTrafficMap is required by the graph/TelemtryVendor interface\nfunc BuildNamespacesTrafficMap(o graph.TelemetryOptions, client *prometheus.Client, globalInfo *graph.AppenderGlobalInfo) graph.TrafficMap {\n\tlog.Tracef(\"Build [%s] graph for [%v] namespaces [%s]\", o.GraphType, len(o.Namespaces), o.Namespaces)\n\n\tsetLabels()\n\tappenders := appender.ParseAppenders(o)\n\ttrafficMap := graph.NewTrafficMap()\n\n\tfor _, namespace := range o.Namespaces {\n\t\tlog.Tracef(\"Build traffic map for namespace [%s]\", namespace)\n\t\t// namespaceTrafficMap\n\t\tnamespaceTrafficMap := buildNamespaceTrafficMap(namespace.Name, o, client)\n\t\tnamespaceInfo := graph.NewAppenderNamespaceInfo(namespace.Name)\n\t\tfor _, a := range appenders {\n\t\t\tappenderTimer := internalmetrics.GetGraphAppenderTimePrometheusTimer(a.Name())\n\t\t\ta.AppendGraph(namespaceTrafficMap, globalInfo, namespaceInfo)\n\t\t\tappenderTimer.ObserveDuration()\n\t\t}\n\t\t//  namespaceTrafficMap merge ---->  trafficMap \n\t\ttelemetry.MergeTrafficMaps(trafficMap, namespace.Name, namespaceTrafficMap)\n\t}\n\n\t// The appenders can add/remove/alter nodes. After the manipulations are complete\n\t// we can make some final adjustments:\n\t// - mark the outsiders (i.e. nodes not in the requested namespaces)\n\t// - mark the insider traffic generators (i.e. inside the namespace and only outgoing edges)\n\ttelemetry.MarkOutsideOrInaccessible(trafficMap, o)\n\ttelemetry.MarkTrafficGenerators(trafficMap)\n\n\tif graph.GraphTypeService == o.GraphType {\n\t\ttrafficMap = telemetry.ReduceToServiceGraph(trafficMap)\n\t}\n\n\treturn trafficMap\n}\n```\n\nAppender interface \n\ngraph/appender.go\n\n```go\n// Appender is implemented by any code offering to append a service graph with\n// supplemental information.  On error the appender should panic and it will be\n// handled as an error response.\ntype Appender interface {\n\t// AppendGraph performs the appender work on the provided traffic map. The map\n\t// may be initially empty. An appender is allowed to add or remove map entries.\n\tAppendGraph(trafficMap TrafficMap, globalInfo *AppenderGlobalInfo, namespaceInfo *AppenderNamespaceInfo)\n\t// Name returns a unique appender name and which is the name used to identify the appender (e.g in 'appenders' query param)\n\tName() string\n}\n\n```\n\n#### appender\n\n* istio: Istio\n* deadNode: \n* serviceEntry: ServiceEntryAppenderIstioserviceEntry\nserviceEntry\n\nserviceEntry se-service\n* responseTime: ResponseTimeAppenderresponseTime\n* securityPolicy: SecurityPolicyAppendersecurityPolicy\ninternational_tls\n* sidecarsCheck: SidecarsCheckAppenderEnvoy sidecar\n\n* unusedNode: \n\ngoType\n\n\nappender, service-entry --> deadNode --> responseTime ---> securityPolicy --->  unusedNode --> istio\n\nappendertrafficMap merge  traffic map\n\n```go\ntrafficMap := graph.NewTrafficMap()\n\n//  namespaceTrafficMap merge ---->  trafficMap \n\ntelemetry.MergeTrafficMaps(trafficMap, namespace.Name, namespaceTrafficMap)\n```\n\n","slug":"k8s/kiali","published":1,"updated":"2021-08-24T16:25:21.608Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0cz000ssmjr2w6b6hqk","content":"<p>kiali </p>\n<p>: </p>\n<p>KialiIstioKialiGrafanaJaeger</p>\n<p>kiali </p>\n<p><img src=\"https://kiali.io/images/documentation/features/graph-health-v1.22.0.png\" alt=\"kiali\"></p>\n<p>KialiIstio istiokiali</p>\n<p>istio kiali</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ istioctl manifest apply --<span class=\"built_in\">set</span> values.kiali.enabled=<span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<p>kiali   admin/admin</p>\n<h2 id=\"kiali-\"><a href=\"#kiali-\" class=\"headerlink\" title=\"kiali \"></a>kiali </h2><h3 id=\"kiali-route-\"><a href=\"#kiali-route-\" class=\"headerlink\" title=\"kiali route \"></a>kiali route </h3><p>routing/router</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//   </span></span><br><span class=\"line\"><span class=\"keyword\">if</span> webRoot != <span class=\"string\">&quot;/&quot;</span> &#123;</span><br><span class=\"line\">\t\trootRouter.HandleFunc(webRoot, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">\t\t\thttp.Redirect(w, r, webRootWithSlash, http.StatusFound)</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// help the user out - if a request comes in for &quot;/&quot;, redirect to our true webroot</span></span><br><span class=\"line\">\t\trootRouter.HandleFunc(<span class=\"string\">&quot;/&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">\t\t\thttp.Redirect(w, r, webRootWithSlash, http.StatusFound)</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tappRouter = rootRouter.PathPrefix(conf.Server.WebRoot).Subrouter()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tappRouter = appRouter.StrictSlash(<span class=\"literal\">true</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// function </span></span><br><span class=\"line\">\tr.Routes = []Route&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// swagger:route GET /healthz kiali healthz</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// ---</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// Endpoint to get the health of Kiali</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//     Produces:</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//     - application/json</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//     Schemes: http, https</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// responses:</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//\t\t500: internalError</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//\t\t200</span></span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;Healthz&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;GET&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;/healthz&quot;</span>,</span><br><span class=\"line\">\t\t\thandlers.Healthz,</span><br><span class=\"line\">\t\t\t<span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"comment\">// swagger:route GET / kiali root</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// ---</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// Endpoint to get the status of Kiali</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//     Produces:</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//     - application/json</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//     Schemes: http, https</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// responses:</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//      500: internalError</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//      200: statusInfo</span></span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;Root&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;GET&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;/api&quot;</span>,</span><br><span class=\"line\">\t\t\thandlers.Root,</span><br><span class=\"line\">\t\t\t<span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<p>kiali kiali</p>\n<p>/graph/api/api</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GraphNamespaces</span><span class=\"params\">(business *business.Layer, o graph.Options)</span> <span class=\"params\">(code <span class=\"keyword\">int</span>, config <span class=\"keyword\">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// time how long it takes to generate this graph</span></span><br><span class=\"line\">\tpromtimer := internalmetrics.GetGraphGenerationTimePrometheusTimer(o.GetGraphKind(), o.TelemetryOptions.GraphType, o.InjectServiceNodes)</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> promtimer.ObserveDuration()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> o.TelemetryVendor &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> graph.VendorIstio:</span><br><span class=\"line\">\t\tprom, err := prometheus.NewClientNoAuth(business.PromAddress)</span><br><span class=\"line\">\t\tgraph.CheckError(err)</span><br><span class=\"line\"><span class=\"comment\">//config </span></span><br><span class=\"line\">\t\tcode, config = graphNamespacesIstio(business, prom, o)</span><br><span class=\"line\">\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\tgraph.Error(fmt.Sprintf(<span class=\"string\">&quot;TelemetryVendor [%s] not supported&quot;</span>, o.TelemetryVendor))</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// update metrics</span></span><br><span class=\"line\">\tinternalmetrics.SetGraphNodes(o.GetGraphKind(), o.TelemetryOptions.GraphType, o.InjectServiceNodes, <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> code, config</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<p> TrafficMap</p>\n<p>graph/telemetry/istio/istio.go</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// BuildNamespacesTrafficMap is required by the graph/TelemtryVendor interface</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">BuildNamespacesTrafficMap</span><span class=\"params\">(o graph.TelemetryOptions, client *prometheus.Client, globalInfo *graph.AppenderGlobalInfo)</span> <span class=\"title\">graph</span>.<span class=\"title\">TrafficMap</span></span> &#123;</span><br><span class=\"line\">\tlog.Tracef(<span class=\"string\">&quot;Build [%s] graph for [%v] namespaces [%s]&quot;</span>, o.GraphType, <span class=\"built_in\">len</span>(o.Namespaces), o.Namespaces)</span><br><span class=\"line\"></span><br><span class=\"line\">\tsetLabels()</span><br><span class=\"line\">\tappenders := appender.ParseAppenders(o)</span><br><span class=\"line\">\ttrafficMap := graph.NewTrafficMap()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, namespace := <span class=\"keyword\">range</span> o.Namespaces &#123;</span><br><span class=\"line\">\t\tlog.Tracef(<span class=\"string\">&quot;Build traffic map for namespace [%s]&quot;</span>, namespace)</span><br><span class=\"line\">\t\t<span class=\"comment\">// namespaceTrafficMap</span></span><br><span class=\"line\">\t\tnamespaceTrafficMap := buildNamespaceTrafficMap(namespace.Name, o, client)</span><br><span class=\"line\">\t\tnamespaceInfo := graph.NewAppenderNamespaceInfo(namespace.Name)</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> _, a := <span class=\"keyword\">range</span> appenders &#123;</span><br><span class=\"line\">\t\t\tappenderTimer := internalmetrics.GetGraphAppenderTimePrometheusTimer(a.Name())</span><br><span class=\"line\">\t\t\ta.AppendGraph(namespaceTrafficMap, globalInfo, namespaceInfo)</span><br><span class=\"line\">\t\t\tappenderTimer.ObserveDuration()</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">//  namespaceTrafficMap merge ----&gt;  trafficMap </span></span><br><span class=\"line\">\t\ttelemetry.MergeTrafficMaps(trafficMap, namespace.Name, namespaceTrafficMap)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// The appenders can add/remove/alter nodes. After the manipulations are complete</span></span><br><span class=\"line\">\t<span class=\"comment\">// we can make some final adjustments:</span></span><br><span class=\"line\">\t<span class=\"comment\">// - mark the outsiders (i.e. nodes not in the requested namespaces)</span></span><br><span class=\"line\">\t<span class=\"comment\">// - mark the insider traffic generators (i.e. inside the namespace and only outgoing edges)</span></span><br><span class=\"line\">\ttelemetry.MarkOutsideOrInaccessible(trafficMap, o)</span><br><span class=\"line\">\ttelemetry.MarkTrafficGenerators(trafficMap)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> graph.GraphTypeService == o.GraphType &#123;</span><br><span class=\"line\">\t\ttrafficMap = telemetry.ReduceToServiceGraph(trafficMap)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> trafficMap</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Appender interface </p>\n<p>graph/appender.go</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Appender is implemented by any code offering to append a service graph with</span></span><br><span class=\"line\"><span class=\"comment\">// supplemental information.  On error the appender should panic and it will be</span></span><br><span class=\"line\"><span class=\"comment\">// handled as an error response.</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Appender <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// AppendGraph performs the appender work on the provided traffic map. The map</span></span><br><span class=\"line\">\t<span class=\"comment\">// may be initially empty. An appender is allowed to add or remove map entries.</span></span><br><span class=\"line\">\tAppendGraph(trafficMap TrafficMap, globalInfo *AppenderGlobalInfo, namespaceInfo *AppenderNamespaceInfo)</span><br><span class=\"line\">\t<span class=\"comment\">// Name returns a unique appender name and which is the name used to identify the appender (e.g in &#x27;appenders&#x27; query param)</span></span><br><span class=\"line\">\tName() <span class=\"keyword\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"appender\"><a href=\"#appender\" class=\"headerlink\" title=\"appender\"></a>appender</h4><ul>\n<li>istio: Istio</li>\n<li>deadNode: </li>\n<li>serviceEntry: ServiceEntryAppenderIstioserviceEntry<br>serviceEntry<br><br>serviceEntry se-service</li>\n<li>responseTime: ResponseTimeAppenderresponseTime</li>\n<li>securityPolicy: SecurityPolicyAppendersecurityPolicy<br>international_tls</li>\n<li>sidecarsCheck: SidecarsCheckAppenderEnvoy sidecar<br></li>\n<li>unusedNode: <br><br>goType<br></li>\n</ul>\n<p>appender, service-entry &gt; deadNode &gt; responseTime &gt; securityPolicy &gt;  unusedNode &gt; istio</p>\n<p>appendertrafficMap merge  traffic map</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">trafficMap := graph.NewTrafficMap()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  namespaceTrafficMap merge ----&gt;  trafficMap </span></span><br><span class=\"line\"></span><br><span class=\"line\">telemetry.MergeTrafficMaps(trafficMap, namespace.Name, namespaceTrafficMap)</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<p>kiali </p>\n<p>: </p>\n<p>KialiIstioKialiGrafanaJaeger</p>\n<p>kiali </p>\n<p><img src=\"https://kiali.io/images/documentation/features/graph-health-v1.22.0.png\" alt=\"kiali\"></p>\n<p>KialiIstio istiokiali</p>\n<p>istio kiali</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ istioctl manifest apply --<span class=\"built_in\">set</span> values.kiali.enabled=<span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<p>kiali   admin/admin</p>\n<h2 id=\"kiali-\"><a href=\"#kiali-\" class=\"headerlink\" title=\"kiali \"></a>kiali </h2><h3 id=\"kiali-route-\"><a href=\"#kiali-route-\" class=\"headerlink\" title=\"kiali route \"></a>kiali route </h3><p>routing/router</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//   </span></span><br><span class=\"line\"><span class=\"keyword\">if</span> webRoot != <span class=\"string\">&quot;/&quot;</span> &#123;</span><br><span class=\"line\">\t\trootRouter.HandleFunc(webRoot, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">\t\t\thttp.Redirect(w, r, webRootWithSlash, http.StatusFound)</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// help the user out - if a request comes in for &quot;/&quot;, redirect to our true webroot</span></span><br><span class=\"line\">\t\trootRouter.HandleFunc(<span class=\"string\">&quot;/&quot;</span>, <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class=\"line\">\t\t\thttp.Redirect(w, r, webRootWithSlash, http.StatusFound)</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tappRouter = rootRouter.PathPrefix(conf.Server.WebRoot).Subrouter()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tappRouter = appRouter.StrictSlash(<span class=\"literal\">true</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// function </span></span><br><span class=\"line\">\tr.Routes = []Route&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// swagger:route GET /healthz kiali healthz</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// ---</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// Endpoint to get the health of Kiali</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//     Produces:</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//     - application/json</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//     Schemes: http, https</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// responses:</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//\t\t500: internalError</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//\t\t200</span></span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;Healthz&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;GET&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;/healthz&quot;</span>,</span><br><span class=\"line\">\t\t\thandlers.Healthz,</span><br><span class=\"line\">\t\t\t<span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"comment\">// swagger:route GET / kiali root</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// ---</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// Endpoint to get the status of Kiali</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//     Produces:</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//     - application/json</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//     Schemes: http, https</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// responses:</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//      500: internalError</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//      200: statusInfo</span></span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;Root&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;GET&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;/api&quot;</span>,</span><br><span class=\"line\">\t\t\thandlers.Root,</span><br><span class=\"line\">\t\t\t<span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<p>kiali kiali</p>\n<p>/graph/api/api</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GraphNamespaces</span><span class=\"params\">(business *business.Layer, o graph.Options)</span> <span class=\"params\">(code <span class=\"keyword\">int</span>, config <span class=\"keyword\">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// time how long it takes to generate this graph</span></span><br><span class=\"line\">\tpromtimer := internalmetrics.GetGraphGenerationTimePrometheusTimer(o.GetGraphKind(), o.TelemetryOptions.GraphType, o.InjectServiceNodes)</span><br><span class=\"line\">\t<span class=\"keyword\">defer</span> promtimer.ObserveDuration()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">switch</span> o.TelemetryVendor &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">case</span> graph.VendorIstio:</span><br><span class=\"line\">\t\tprom, err := prometheus.NewClientNoAuth(business.PromAddress)</span><br><span class=\"line\">\t\tgraph.CheckError(err)</span><br><span class=\"line\"><span class=\"comment\">//config </span></span><br><span class=\"line\">\t\tcode, config = graphNamespacesIstio(business, prom, o)</span><br><span class=\"line\">\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\tgraph.Error(fmt.Sprintf(<span class=\"string\">&quot;TelemetryVendor [%s] not supported&quot;</span>, o.TelemetryVendor))</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// update metrics</span></span><br><span class=\"line\">\tinternalmetrics.SetGraphNodes(o.GetGraphKind(), o.TelemetryOptions.GraphType, o.InjectServiceNodes, <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> code, config</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<p> TrafficMap</p>\n<p>graph/telemetry/istio/istio.go</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// BuildNamespacesTrafficMap is required by the graph/TelemtryVendor interface</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">BuildNamespacesTrafficMap</span><span class=\"params\">(o graph.TelemetryOptions, client *prometheus.Client, globalInfo *graph.AppenderGlobalInfo)</span> <span class=\"title\">graph</span>.<span class=\"title\">TrafficMap</span></span> &#123;</span><br><span class=\"line\">\tlog.Tracef(<span class=\"string\">&quot;Build [%s] graph for [%v] namespaces [%s]&quot;</span>, o.GraphType, <span class=\"built_in\">len</span>(o.Namespaces), o.Namespaces)</span><br><span class=\"line\"></span><br><span class=\"line\">\tsetLabels()</span><br><span class=\"line\">\tappenders := appender.ParseAppenders(o)</span><br><span class=\"line\">\ttrafficMap := graph.NewTrafficMap()</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> _, namespace := <span class=\"keyword\">range</span> o.Namespaces &#123;</span><br><span class=\"line\">\t\tlog.Tracef(<span class=\"string\">&quot;Build traffic map for namespace [%s]&quot;</span>, namespace)</span><br><span class=\"line\">\t\t<span class=\"comment\">// namespaceTrafficMap</span></span><br><span class=\"line\">\t\tnamespaceTrafficMap := buildNamespaceTrafficMap(namespace.Name, o, client)</span><br><span class=\"line\">\t\tnamespaceInfo := graph.NewAppenderNamespaceInfo(namespace.Name)</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> _, a := <span class=\"keyword\">range</span> appenders &#123;</span><br><span class=\"line\">\t\t\tappenderTimer := internalmetrics.GetGraphAppenderTimePrometheusTimer(a.Name())</span><br><span class=\"line\">\t\t\ta.AppendGraph(namespaceTrafficMap, globalInfo, namespaceInfo)</span><br><span class=\"line\">\t\t\tappenderTimer.ObserveDuration()</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">//  namespaceTrafficMap merge ----&gt;  trafficMap </span></span><br><span class=\"line\">\t\ttelemetry.MergeTrafficMaps(trafficMap, namespace.Name, namespaceTrafficMap)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">// The appenders can add/remove/alter nodes. After the manipulations are complete</span></span><br><span class=\"line\">\t<span class=\"comment\">// we can make some final adjustments:</span></span><br><span class=\"line\">\t<span class=\"comment\">// - mark the outsiders (i.e. nodes not in the requested namespaces)</span></span><br><span class=\"line\">\t<span class=\"comment\">// - mark the insider traffic generators (i.e. inside the namespace and only outgoing edges)</span></span><br><span class=\"line\">\ttelemetry.MarkOutsideOrInaccessible(trafficMap, o)</span><br><span class=\"line\">\ttelemetry.MarkTrafficGenerators(trafficMap)</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> graph.GraphTypeService == o.GraphType &#123;</span><br><span class=\"line\">\t\ttrafficMap = telemetry.ReduceToServiceGraph(trafficMap)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> trafficMap</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Appender interface </p>\n<p>graph/appender.go</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Appender is implemented by any code offering to append a service graph with</span></span><br><span class=\"line\"><span class=\"comment\">// supplemental information.  On error the appender should panic and it will be</span></span><br><span class=\"line\"><span class=\"comment\">// handled as an error response.</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> Appender <span class=\"keyword\">interface</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// AppendGraph performs the appender work on the provided traffic map. The map</span></span><br><span class=\"line\">\t<span class=\"comment\">// may be initially empty. An appender is allowed to add or remove map entries.</span></span><br><span class=\"line\">\tAppendGraph(trafficMap TrafficMap, globalInfo *AppenderGlobalInfo, namespaceInfo *AppenderNamespaceInfo)</span><br><span class=\"line\">\t<span class=\"comment\">// Name returns a unique appender name and which is the name used to identify the appender (e.g in &#x27;appenders&#x27; query param)</span></span><br><span class=\"line\">\tName() <span class=\"keyword\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"appender\"><a href=\"#appender\" class=\"headerlink\" title=\"appender\"></a>appender</h4><ul>\n<li>istio: Istio</li>\n<li>deadNode: </li>\n<li>serviceEntry: ServiceEntryAppenderIstioserviceEntry<br>serviceEntry<br><br>serviceEntry se-service</li>\n<li>responseTime: ResponseTimeAppenderresponseTime</li>\n<li>securityPolicy: SecurityPolicyAppendersecurityPolicy<br>international_tls</li>\n<li>sidecarsCheck: SidecarsCheckAppenderEnvoy sidecar<br></li>\n<li>unusedNode: <br><br>goType<br></li>\n</ul>\n<p>appender, service-entry &gt; deadNode &gt; responseTime &gt; securityPolicy &gt;  unusedNode &gt; istio</p>\n<p>appendertrafficMap merge  traffic map</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">trafficMap := graph.NewTrafficMap()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//  namespaceTrafficMap merge ----&gt;  trafficMap </span></span><br><span class=\"line\"></span><br><span class=\"line\">telemetry.MergeTrafficMaps(trafficMap, namespace.Name, namespaceTrafficMap)</span><br></pre></td></tr></table></figure>\n\n"},{"title":"cgroups Linux","date":"2021-03-10T10:06:35.000Z","_content":"\n,-\n,\n,\ncgroups,,CPU,,I / O\n\ncgroups\n\n ,\n CPU I/O \n \n \n\n`cgroup`,\n\nLinuxcgroup\n,memorycpuacctCPU\n\nLXC,libvirtDockercgroup,sysfslibcgroupscgroup \n,Red Hat Enterprise LinuxCentOS,\n\n```\n\nblkio:usb\ncpucgroupcpu\ncpuacctcgroupcpu\ncpusetcpucgroupcpu\ndevicescgroup\nfreezercgroup\nmemorycgroup\nnet_clscgroup\nns\nperf_eventgroupgroupCPU\n\n```\n\n## cgroups \n\n### \nsysfscgroupfoomemorycgroup / sys / fs / cgroup / memoryfoo\n\n```bash\n$ sudo mkdir /sys/fs/cgroup/memory/foo\n```\n\ncgroup memory.limit_in_bytes\n\ncgroupfoo50MB\n\n```bash\n$ echo 50000000 | sudo tee /sys/fs/cgroup/memory/foo/memory.limit_in_bytes\n```\n\n\n\n\n```bash\n$ sudo cat memory.limit_in_bytes\n50003968\n```\n\n40964KB\n\n\n\n```bash\n$ sh ~/test.sh &\n```\n\nIDPIDfoo cgroup memory\n\n```bash\n$ echo 2845 > /sys/fs/cgroup/memory/foo/cgroup.procs\n```\n\nPIDcgroup\n\n```bash\n$ ps -o cgroup 2845\nCGROUP\n8:memory:/foo,1:name=systemd:/user.slice/user-0.slice/session-4.scope\n```\n\ncgroup\n\n```bash\n$ cat /sys/fs/cgroup/memory/foo/memory.usage_in_bytes\n253952\n```\n\n### limit \n\ncgroup foo50MB500\n\n\n```bash\n$ echo 500 | sudo tee /sys/fs/cgroup/memory/foo/memory.limit_in_bytes\n```\n\n\n\n5004 KB\n\n```bash\n$ cat /sys/fs/cgroup/memory/foo/memory.limit_in_bytes\n4096\n```\n\ncgroup\n\n```bash\n\n$ sudo tail -f /var/log/messages\n\nOct 14 10:22:40 localhost kernel: sh invoked oom-killer:\ngfp_mask=0xd0, order=0, oom_score_adj=0\nOct 14 10:22:40 localhost kernel: sh cpuset=/ mems_allowed=0\nOct 14 10:22:40 localhost kernel: CPU: 0 PID: 2687 Comm:\nsh Tainted: G\nOE  ------------   3.10.0-327.36.3.el7.x86_64 #1\nOct 14 10:22:40 localhost kernel: Hardware name: innotek GmbH\nVirtualBox/VirtualBox, BIOS VirtualBox 12/01/2006\nOct 14 10:22:40 localhost kernel: ffff880036ea5c00\n0000000093314010 ffff88000002bcd0 ffffffff81636431\nOct 14 10:22:40 localhost kernel: ffff88000002bd60\nffffffff816313cc 01018800000000d0 ffff88000002bd68\nOct 14 10:22:40 localhost kernel: ffffffffbc35e040\nfffeefff00000000 0000000000000001 ffff880036ea6103\nOct 14 10:22:40 localhost kernel: Call Trace:\nOct 14 10:22:40 localhost kernel: [<ffffffff81636431>]\ndump_stack+0x19/0x1b\nOct 14 10:22:40 localhost kernel: [<ffffffff816313cc>]\ndump_header+0x8e/0x214\nOct 14 10:22:40 localhost kernel: [<ffffffff8116d21e>]\noom_kill_process+0x24e/0x3b0\nOct 14 10:22:40 localhost kernel: [<ffffffff81088e4e>] ?\nhas_capability_noaudit+0x1e/0x30\nOct 14 10:22:40 localhost kernel: [<ffffffff811d4285>]\nmem_cgroup_oom_synchronize+0x575/0x5a0\nOct 14 10:22:40 localhost kernel: [<ffffffff811d3650>] ?\nmem_cgroup_charge_common+0xc0/0xc0\nOct 14 10:22:40 localhost kernel: [<ffffffff8116da94>]\npagefault_out_of_memory+0x14/0x90\nOct 14 10:22:40 localhost kernel: [<ffffffff8162f815>]\nmm_fault_error+0x68/0x12b\nOct 14 10:22:40 localhost kernel: [<ffffffff816422d2>]\n__do_page_fault+0x3e2/0x450\nOct 14 10:22:40 localhost kernel: [<ffffffff81642363>]\ndo_page_fault+0x23/0x80\nOct 14 10:22:40 localhost kernel: [<ffffffff8163e648>]\npage_fault+0x28/0x30\nOct 14 10:22:40 localhost kernel: Task in /foo killed as\na result of limit of /foo\nOct 14 10:22:40 localhost kernel: memory: usage 4kB, limit\n4kB, failcnt 8\nOct 14 10:22:40 localhost kernel: memory+swap: usage 4kB,\nlimit 9007199254740991kB, failcnt 0\nOct 14 10:22:40 localhost kernel: kmem: usage 0kB, limit\n9007199254740991kB, failcnt 0\nOct 14 10:22:40 localhost kernel: Memory cgroup stats for /foo:\ncache:0KB rss:4KB rss_huge:0KB mapped_file:0KB swap:0KB\ninactive_anon:0KB active_anon:0KB inactive_file:0KB\nactive_file:0KB unevictable:0KB\nOct 14 10:22:40 localhost kernel: [ pid ]   uid  tgid total_vm\nrss nr_ptes swapents oom_score_adj name\nOct 14 10:22:40 localhost kernel: [ 2687]     0  2687    28281\n347     12        0             0 sh\nOct 14 10:22:40 localhost kernel: [ 2702]     0  2702    28281\n50    7        0             0 sh\nOct 14 10:22:40 localhost kernel: Memory cgroup out of memory:\nKill process 2687 (sh) score 0 or sacrifice child\nOct 14 10:22:40 localhost kernel: Killed process 2702 (sh)\ntotal-vm:113124kB, anon-rss:200kB, file-rss:0kB\nOct 14 10:22:41 localhost kernel: sh invoked oom-killer:\ngfp_mask=0xd0, order=0, oom_score_adj=0\n[ ... ]\n```\n\n4KBoom-killer\n\n```bash\n\n$ ps -o cgroup 2687\nCGROUP\n\n```\n\n## `libcgroup`\n\nlibcgroup cgcreatesysfs\n\n foomemory\n\n```bash\n$ sudo cgcreate -g memory:foo\n```\n\nlibcgroup\n\n\n\n```bash\n$ echo 50000000 | sudo tee\n/sys/fs/cgroup/memory/foo/memory.limit_in_bytes\n```\n\n\n\n```bash\n$ sudo cat memory.limit_in_bytes\n50003968\n```\n\nfoo cgexec cgroup\n\n```bash\n$ sudo cgexec -g memory:foo ~/test.sh\n```\n\nPIDcgroupmemory\n\n```bash\n$  ps -o cgroup 2945\nCGROUP\n6:memory:/foo,1:name=systemd:/user.slice/user-0.slice/\nsession-1.scope\n```\n\ncgroupcgdeletefoo memory\n\n```bash\n$ sudo cgdelete memory:foo\n```\n\n\n/etc/cgconfig.confcgroupfoo\n\n```bash\n\n$ cat /etc/cgconfig.conf\n#\n#  Copyright IBM Corporation. 2007\n#\n#  Authors:     Balbir Singh <balbir@linux.vnet.ibm.com>\n#  This program is free software; you can redistribute it\n#  and/or modify it under the terms of version 2.1 of the GNU\n#  Lesser General Public License as published by the Free\n#  Software Foundation.\n#\n#  This program is distributed in the hope that it would be\n#  useful, but WITHOUT ANY WARRANTY; without even the implied\n#  warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n#  PURPOSE.\n#\n#\n# By default, we expect systemd mounts everything on boot,\n# so there is not much to do.\n# See man cgconfig.conf for further details, how to create\n# groups on system boot using this file.\n\ngroup foo {\ncpu {\ncpu.shares = 100;\n}\nmemory {\nmemory.limit_in_bytes = 5000000;\n}\n}\n```\n\ncpu.sharesCPU1,024100CPU100CPU10\n\ncgroupCPUcgconfig.conf\n\n```bash\n\ncpuset {\ncpuset.cpus=\"0-5\";\n}\n\n```\n\ncgroup05-CPU\n\ncgconfigcgconfig\n\n```bash\n$ sudo systemctl enable cgconfig\nCreate symlink from /etc/systemd/system/sysinit.target.wants/\ncgconfig.service\nto /usr/lib/systemd/system/cgconfig.service.\n```\n\ncgconfig\n\n```bash\n$ sudo systemctl start cgconfig\n```\n\ncgroupfoo memorycpu \n\n```bash\n$ sudo cgexec -g memory,cpu,cpuset:foo ~/test.sh &\n```\n\ncgroupcgconfig  \n\n","source":"_posts/linux/cgroups.md","raw":"---\ntitle: cgroups Linux\ndate: 2021-03-10 18:06:35\ntags:\n- linux\n- kernal\n---\n\n,-\n,\n,\ncgroups,,CPU,,I / O\n\ncgroups\n\n ,\n CPU I/O \n \n \n\n`cgroup`,\n\nLinuxcgroup\n,memorycpuacctCPU\n\nLXC,libvirtDockercgroup,sysfslibcgroupscgroup \n,Red Hat Enterprise LinuxCentOS,\n\n```\n\nblkio:usb\ncpucgroupcpu\ncpuacctcgroupcpu\ncpusetcpucgroupcpu\ndevicescgroup\nfreezercgroup\nmemorycgroup\nnet_clscgroup\nns\nperf_eventgroupgroupCPU\n\n```\n\n## cgroups \n\n### \nsysfscgroupfoomemorycgroup / sys / fs / cgroup / memoryfoo\n\n```bash\n$ sudo mkdir /sys/fs/cgroup/memory/foo\n```\n\ncgroup memory.limit_in_bytes\n\ncgroupfoo50MB\n\n```bash\n$ echo 50000000 | sudo tee /sys/fs/cgroup/memory/foo/memory.limit_in_bytes\n```\n\n\n\n\n```bash\n$ sudo cat memory.limit_in_bytes\n50003968\n```\n\n40964KB\n\n\n\n```bash\n$ sh ~/test.sh &\n```\n\nIDPIDfoo cgroup memory\n\n```bash\n$ echo 2845 > /sys/fs/cgroup/memory/foo/cgroup.procs\n```\n\nPIDcgroup\n\n```bash\n$ ps -o cgroup 2845\nCGROUP\n8:memory:/foo,1:name=systemd:/user.slice/user-0.slice/session-4.scope\n```\n\ncgroup\n\n```bash\n$ cat /sys/fs/cgroup/memory/foo/memory.usage_in_bytes\n253952\n```\n\n### limit \n\ncgroup foo50MB500\n\n\n```bash\n$ echo 500 | sudo tee /sys/fs/cgroup/memory/foo/memory.limit_in_bytes\n```\n\n\n\n5004 KB\n\n```bash\n$ cat /sys/fs/cgroup/memory/foo/memory.limit_in_bytes\n4096\n```\n\ncgroup\n\n```bash\n\n$ sudo tail -f /var/log/messages\n\nOct 14 10:22:40 localhost kernel: sh invoked oom-killer:\ngfp_mask=0xd0, order=0, oom_score_adj=0\nOct 14 10:22:40 localhost kernel: sh cpuset=/ mems_allowed=0\nOct 14 10:22:40 localhost kernel: CPU: 0 PID: 2687 Comm:\nsh Tainted: G\nOE  ------------   3.10.0-327.36.3.el7.x86_64 #1\nOct 14 10:22:40 localhost kernel: Hardware name: innotek GmbH\nVirtualBox/VirtualBox, BIOS VirtualBox 12/01/2006\nOct 14 10:22:40 localhost kernel: ffff880036ea5c00\n0000000093314010 ffff88000002bcd0 ffffffff81636431\nOct 14 10:22:40 localhost kernel: ffff88000002bd60\nffffffff816313cc 01018800000000d0 ffff88000002bd68\nOct 14 10:22:40 localhost kernel: ffffffffbc35e040\nfffeefff00000000 0000000000000001 ffff880036ea6103\nOct 14 10:22:40 localhost kernel: Call Trace:\nOct 14 10:22:40 localhost kernel: [<ffffffff81636431>]\ndump_stack+0x19/0x1b\nOct 14 10:22:40 localhost kernel: [<ffffffff816313cc>]\ndump_header+0x8e/0x214\nOct 14 10:22:40 localhost kernel: [<ffffffff8116d21e>]\noom_kill_process+0x24e/0x3b0\nOct 14 10:22:40 localhost kernel: [<ffffffff81088e4e>] ?\nhas_capability_noaudit+0x1e/0x30\nOct 14 10:22:40 localhost kernel: [<ffffffff811d4285>]\nmem_cgroup_oom_synchronize+0x575/0x5a0\nOct 14 10:22:40 localhost kernel: [<ffffffff811d3650>] ?\nmem_cgroup_charge_common+0xc0/0xc0\nOct 14 10:22:40 localhost kernel: [<ffffffff8116da94>]\npagefault_out_of_memory+0x14/0x90\nOct 14 10:22:40 localhost kernel: [<ffffffff8162f815>]\nmm_fault_error+0x68/0x12b\nOct 14 10:22:40 localhost kernel: [<ffffffff816422d2>]\n__do_page_fault+0x3e2/0x450\nOct 14 10:22:40 localhost kernel: [<ffffffff81642363>]\ndo_page_fault+0x23/0x80\nOct 14 10:22:40 localhost kernel: [<ffffffff8163e648>]\npage_fault+0x28/0x30\nOct 14 10:22:40 localhost kernel: Task in /foo killed as\na result of limit of /foo\nOct 14 10:22:40 localhost kernel: memory: usage 4kB, limit\n4kB, failcnt 8\nOct 14 10:22:40 localhost kernel: memory+swap: usage 4kB,\nlimit 9007199254740991kB, failcnt 0\nOct 14 10:22:40 localhost kernel: kmem: usage 0kB, limit\n9007199254740991kB, failcnt 0\nOct 14 10:22:40 localhost kernel: Memory cgroup stats for /foo:\ncache:0KB rss:4KB rss_huge:0KB mapped_file:0KB swap:0KB\ninactive_anon:0KB active_anon:0KB inactive_file:0KB\nactive_file:0KB unevictable:0KB\nOct 14 10:22:40 localhost kernel: [ pid ]   uid  tgid total_vm\nrss nr_ptes swapents oom_score_adj name\nOct 14 10:22:40 localhost kernel: [ 2687]     0  2687    28281\n347     12        0             0 sh\nOct 14 10:22:40 localhost kernel: [ 2702]     0  2702    28281\n50    7        0             0 sh\nOct 14 10:22:40 localhost kernel: Memory cgroup out of memory:\nKill process 2687 (sh) score 0 or sacrifice child\nOct 14 10:22:40 localhost kernel: Killed process 2702 (sh)\ntotal-vm:113124kB, anon-rss:200kB, file-rss:0kB\nOct 14 10:22:41 localhost kernel: sh invoked oom-killer:\ngfp_mask=0xd0, order=0, oom_score_adj=0\n[ ... ]\n```\n\n4KBoom-killer\n\n```bash\n\n$ ps -o cgroup 2687\nCGROUP\n\n```\n\n## `libcgroup`\n\nlibcgroup cgcreatesysfs\n\n foomemory\n\n```bash\n$ sudo cgcreate -g memory:foo\n```\n\nlibcgroup\n\n\n\n```bash\n$ echo 50000000 | sudo tee\n/sys/fs/cgroup/memory/foo/memory.limit_in_bytes\n```\n\n\n\n```bash\n$ sudo cat memory.limit_in_bytes\n50003968\n```\n\nfoo cgexec cgroup\n\n```bash\n$ sudo cgexec -g memory:foo ~/test.sh\n```\n\nPIDcgroupmemory\n\n```bash\n$  ps -o cgroup 2945\nCGROUP\n6:memory:/foo,1:name=systemd:/user.slice/user-0.slice/\nsession-1.scope\n```\n\ncgroupcgdeletefoo memory\n\n```bash\n$ sudo cgdelete memory:foo\n```\n\n\n/etc/cgconfig.confcgroupfoo\n\n```bash\n\n$ cat /etc/cgconfig.conf\n#\n#  Copyright IBM Corporation. 2007\n#\n#  Authors:     Balbir Singh <balbir@linux.vnet.ibm.com>\n#  This program is free software; you can redistribute it\n#  and/or modify it under the terms of version 2.1 of the GNU\n#  Lesser General Public License as published by the Free\n#  Software Foundation.\n#\n#  This program is distributed in the hope that it would be\n#  useful, but WITHOUT ANY WARRANTY; without even the implied\n#  warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR\n#  PURPOSE.\n#\n#\n# By default, we expect systemd mounts everything on boot,\n# so there is not much to do.\n# See man cgconfig.conf for further details, how to create\n# groups on system boot using this file.\n\ngroup foo {\ncpu {\ncpu.shares = 100;\n}\nmemory {\nmemory.limit_in_bytes = 5000000;\n}\n}\n```\n\ncpu.sharesCPU1,024100CPU100CPU10\n\ncgroupCPUcgconfig.conf\n\n```bash\n\ncpuset {\ncpuset.cpus=\"0-5\";\n}\n\n```\n\ncgroup05-CPU\n\ncgconfigcgconfig\n\n```bash\n$ sudo systemctl enable cgconfig\nCreate symlink from /etc/systemd/system/sysinit.target.wants/\ncgconfig.service\nto /usr/lib/systemd/system/cgconfig.service.\n```\n\ncgconfig\n\n```bash\n$ sudo systemctl start cgconfig\n```\n\ncgroupfoo memorycpu \n\n```bash\n$ sudo cgexec -g memory,cpu,cpuset:foo ~/test.sh &\n```\n\ncgroupcgconfig  \n\n","slug":"linux/cgroups","published":1,"updated":"2021-08-24T16:25:21.609Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0d0000usmjr5in39oyo","content":"<p>,-<br>,<br>,<br>cgroups,,CPU,,I / O</p>\n<p>cgroups</p>\n<p> ,<br> CPU I/O <br> <br> </p>\n<p><code>cgroup</code>,</p>\n<p>Linuxcgroup<br>,memorycpuacctCPU</p>\n<p>LXC,libvirtDockercgroup,sysfslibcgroupscgroup <br>,Red Hat Enterprise LinuxCentOS,</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">blkio:usb</span><br><span class=\"line\">cpucgroupcpu</span><br><span class=\"line\">cpuacctcgroupcpu</span><br><span class=\"line\">cpusetcpucgroupcpu</span><br><span class=\"line\">devicescgroup</span><br><span class=\"line\">freezercgroup</span><br><span class=\"line\">memorycgroup</span><br><span class=\"line\">net_clscgroup</span><br><span class=\"line\">ns</span><br><span class=\"line\">perf_eventgroupgroupCPU</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"cgroups-\"><a href=\"#cgroups-\" class=\"headerlink\" title=\"cgroups \"></a>cgroups </h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>sysfscgroupfoomemorycgroup / sys / fs / cgroup / memoryfoo</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo mkdir /sys/fs/cgroup/memory/foo</span><br></pre></td></tr></table></figure>\n\n<p>cgroup memory.limit_in_bytes</p>\n<p>cgroupfoo50MB</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">echo</span> 50000000 | sudo tee /sys/fs/cgroup/memory/foo/memory.limit_in_bytes</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo cat memory.limit_in_bytes</span><br><span class=\"line\">50003968</span><br></pre></td></tr></table></figure>\n\n<p>40964KB</p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sh ~/test.sh &amp;</span><br></pre></td></tr></table></figure>\n\n<p>IDPIDfoo cgroup memory</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">echo</span> 2845 &gt; /sys/fs/cgroup/memory/foo/cgroup.procs</span><br></pre></td></tr></table></figure>\n\n<p>PIDcgroup</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ps -o cgroup 2845</span><br><span class=\"line\">CGROUP</span><br><span class=\"line\">8:memory:/foo,1:name=systemd:/user.slice/user-0.slice/session-4.scope</span><br></pre></td></tr></table></figure>\n\n<p>cgroup</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat /sys/fs/cgroup/memory/foo/memory.usage_in_bytes</span><br><span class=\"line\">253952</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"limit\"><a href=\"#limit\" class=\"headerlink\" title=\"limit\"></a>limit</h3><p>cgroup foo50MB500</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">echo</span> 500 | sudo tee /sys/fs/cgroup/memory/foo/memory.limit_in_bytes</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p>5004 KB</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat /sys/fs/cgroup/memory/foo/memory.limit_in_bytes</span><br><span class=\"line\">4096</span><br></pre></td></tr></table></figure>\n\n<p>cgroup</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ sudo tail -f /var/<span class=\"built_in\">log</span>/messages</span><br><span class=\"line\"></span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: sh invoked oom-killer:</span><br><span class=\"line\">gfp_mask=0xd0, order=0, oom_score_adj=0</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: sh cpuset=/ mems_allowed=0</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: CPU: 0 PID: 2687 Comm:</span><br><span class=\"line\">sh Tainted: G</span><br><span class=\"line\">OE  ------------   3.10.0-327.36.3.el7.x86_64 <span class=\"comment\">#1</span></span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: Hardware name: innotek GmbH</span><br><span class=\"line\">VirtualBox/VirtualBox, BIOS VirtualBox 12/01/2006</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: ffff880036ea5c00</span><br><span class=\"line\">0000000093314010 ffff88000002bcd0 ffffffff81636431</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: ffff88000002bd60</span><br><span class=\"line\">ffffffff816313cc 01018800000000d0 ffff88000002bd68</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: ffffffffbc35e040</span><br><span class=\"line\">fffeefff00000000 0000000000000001 ffff880036ea6103</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: Call Trace:</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff81636431&gt;]</span><br><span class=\"line\">dump_stack+0x19/0x1b</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff816313cc&gt;]</span><br><span class=\"line\">dump_header+0x8e/0x214</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff8116d21e&gt;]</span><br><span class=\"line\">oom_kill_process+0x24e/0x3b0</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff81088e4e&gt;] ?</span><br><span class=\"line\">has_capability_noaudit+0x1e/0x30</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff811d4285&gt;]</span><br><span class=\"line\">mem_cgroup_oom_synchronize+0x575/0x5a0</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff811d3650&gt;] ?</span><br><span class=\"line\">mem_cgroup_charge_common+0xc0/0xc0</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff8116da94&gt;]</span><br><span class=\"line\">pagefault_out_of_memory+0x14/0x90</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff8162f815&gt;]</span><br><span class=\"line\">mm_fault_error+0x68/0x12b</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff816422d2&gt;]</span><br><span class=\"line\">__do_page_fault+0x3e2/0x450</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff81642363&gt;]</span><br><span class=\"line\">do_page_fault+0x23/0x80</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff8163e648&gt;]</span><br><span class=\"line\">page_fault+0x28/0x30</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: Task <span class=\"keyword\">in</span> /foo killed as</span><br><span class=\"line\">a result of <span class=\"built_in\">limit</span> of /foo</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: memory: usage 4kB, <span class=\"built_in\">limit</span></span><br><span class=\"line\">4kB, failcnt 8</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: memory+swap: usage 4kB,</span><br><span class=\"line\"><span class=\"built_in\">limit</span> 9007199254740991kB, failcnt 0</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: kmem: usage 0kB, <span class=\"built_in\">limit</span></span><br><span class=\"line\">9007199254740991kB, failcnt 0</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: Memory cgroup stats <span class=\"keyword\">for</span> /foo:</span><br><span class=\"line\">cache:0KB rss:4KB rss_huge:0KB mapped_file:0KB swap:0KB</span><br><span class=\"line\">inactive_anon:0KB active_anon:0KB inactive_file:0KB</span><br><span class=\"line\">active_file:0KB unevictable:0KB</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [ pid ]   uid  tgid total_vm</span><br><span class=\"line\">rss nr_ptes swapents oom_score_adj name</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [ 2687]     0  2687    28281</span><br><span class=\"line\">347     12        0             0 sh</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [ 2702]     0  2702    28281</span><br><span class=\"line\">50    7        0             0 sh</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: Memory cgroup out of memory:</span><br><span class=\"line\">Kill process 2687 (sh) score 0 or sacrifice child</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: Killed process 2702 (sh)</span><br><span class=\"line\">total-vm:113124kB, anon-rss:200kB, file-rss:0kB</span><br><span class=\"line\">Oct 14 10:22:41 localhost kernel: sh invoked oom-killer:</span><br><span class=\"line\">gfp_mask=0xd0, order=0, oom_score_adj=0</span><br><span class=\"line\">[ ... ]</span><br></pre></td></tr></table></figure>\n\n<p>4KBoom-killer</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ ps -o cgroup 2687</span><br><span class=\"line\">CGROUP</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"libcgroup\"><a href=\"#libcgroup\" class=\"headerlink\" title=\"libcgroup\"></a><code>libcgroup</code></h2><p>libcgroup cgcreatesysfs</p>\n<p> foomemory</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo cgcreate -g memory:foo</span><br></pre></td></tr></table></figure>\n\n<p>libcgroup</p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">echo</span> 50000000 | sudo tee</span><br><span class=\"line\">/sys/fs/cgroup/memory/foo/memory.limit_in_bytes</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo cat memory.limit_in_bytes</span><br><span class=\"line\">50003968</span><br></pre></td></tr></table></figure>\n\n<p>foo cgexec cgroup</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo cgexec -g memory:foo ~/test.sh</span><br></pre></td></tr></table></figure>\n\n<p>PIDcgroupmemory</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$  ps -o cgroup 2945</span><br><span class=\"line\">CGROUP</span><br><span class=\"line\">6:memory:/foo,1:name=systemd:/user.slice/user-0.slice/</span><br><span class=\"line\">session-1.scope</span><br></pre></td></tr></table></figure>\n\n<p>cgroupcgdeletefoo memory</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo cgdelete memory:foo</span><br></pre></td></tr></table></figure>\n\n<p><br>/etc/cgconfig.confcgroupfoo</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ cat /etc/cgconfig.conf</span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#  Copyright IBM Corporation. 2007</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#  Authors:     Balbir Singh &lt;balbir@linux.vnet.ibm.com&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#  This program is free software; you can redistribute it</span></span><br><span class=\"line\"><span class=\"comment\">#  and/or modify it under the terms of version 2.1 of the GNU</span></span><br><span class=\"line\"><span class=\"comment\">#  Lesser General Public License as published by the Free</span></span><br><span class=\"line\"><span class=\"comment\">#  Software Foundation.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#  This program is distributed in the hope that it would be</span></span><br><span class=\"line\"><span class=\"comment\">#  useful, but WITHOUT ANY WARRANTY; without even the implied</span></span><br><span class=\"line\"><span class=\"comment\">#  warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR</span></span><br><span class=\"line\"><span class=\"comment\">#  PURPOSE.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># By default, we expect systemd mounts everything on boot,</span></span><br><span class=\"line\"><span class=\"comment\"># so there is not much to do.</span></span><br><span class=\"line\"><span class=\"comment\"># See man cgconfig.conf for further details, how to create</span></span><br><span class=\"line\"><span class=\"comment\"># groups on system boot using this file.</span></span><br><span class=\"line\"></span><br><span class=\"line\">group foo &#123;</span><br><span class=\"line\">cpu &#123;</span><br><span class=\"line\">cpu.shares = 100;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">memory &#123;</span><br><span class=\"line\">memory.limit_in_bytes = 5000000;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>cpu.sharesCPU1,024100CPU100CPU10</p>\n<p>cgroupCPUcgconfig.conf</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">cpuset &#123;</span><br><span class=\"line\">cpuset.cpus=<span class=\"string\">&quot;0-5&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>cgroup05-CPU</p>\n<p>cgconfigcgconfig</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo systemctl <span class=\"built_in\">enable</span> cgconfig</span><br><span class=\"line\">Create symlink from /etc/systemd/system/sysinit.target.wants/</span><br><span class=\"line\">cgconfig.service</span><br><span class=\"line\">to /usr/lib/systemd/system/cgconfig.service.</span><br></pre></td></tr></table></figure>\n\n<p>cgconfig</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo systemctl start cgconfig</span><br></pre></td></tr></table></figure>\n\n<p>cgroupfoo memorycpu </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo cgexec -g memory,cpu,cpuset:foo ~/test.sh &amp;</span><br></pre></td></tr></table></figure>\n\n<p>cgroupcgconfig  </p>\n","site":{"data":{}},"excerpt":"","more":"<p>,-<br>,<br>,<br>cgroups,,CPU,,I / O</p>\n<p>cgroups</p>\n<p> ,<br> CPU I/O <br> <br> </p>\n<p><code>cgroup</code>,</p>\n<p>Linuxcgroup<br>,memorycpuacctCPU</p>\n<p>LXC,libvirtDockercgroup,sysfslibcgroupscgroup <br>,Red Hat Enterprise LinuxCentOS,</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">blkio:usb</span><br><span class=\"line\">cpucgroupcpu</span><br><span class=\"line\">cpuacctcgroupcpu</span><br><span class=\"line\">cpusetcpucgroupcpu</span><br><span class=\"line\">devicescgroup</span><br><span class=\"line\">freezercgroup</span><br><span class=\"line\">memorycgroup</span><br><span class=\"line\">net_clscgroup</span><br><span class=\"line\">ns</span><br><span class=\"line\">perf_eventgroupgroupCPU</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"cgroups-\"><a href=\"#cgroups-\" class=\"headerlink\" title=\"cgroups \"></a>cgroups </h2><h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>sysfscgroupfoomemorycgroup / sys / fs / cgroup / memoryfoo</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo mkdir /sys/fs/cgroup/memory/foo</span><br></pre></td></tr></table></figure>\n\n<p>cgroup memory.limit_in_bytes</p>\n<p>cgroupfoo50MB</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">echo</span> 50000000 | sudo tee /sys/fs/cgroup/memory/foo/memory.limit_in_bytes</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo cat memory.limit_in_bytes</span><br><span class=\"line\">50003968</span><br></pre></td></tr></table></figure>\n\n<p>40964KB</p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sh ~/test.sh &amp;</span><br></pre></td></tr></table></figure>\n\n<p>IDPIDfoo cgroup memory</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">echo</span> 2845 &gt; /sys/fs/cgroup/memory/foo/cgroup.procs</span><br></pre></td></tr></table></figure>\n\n<p>PIDcgroup</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ps -o cgroup 2845</span><br><span class=\"line\">CGROUP</span><br><span class=\"line\">8:memory:/foo,1:name=systemd:/user.slice/user-0.slice/session-4.scope</span><br></pre></td></tr></table></figure>\n\n<p>cgroup</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat /sys/fs/cgroup/memory/foo/memory.usage_in_bytes</span><br><span class=\"line\">253952</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"limit\"><a href=\"#limit\" class=\"headerlink\" title=\"limit\"></a>limit</h3><p>cgroup foo50MB500</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">echo</span> 500 | sudo tee /sys/fs/cgroup/memory/foo/memory.limit_in_bytes</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p>5004 KB</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat /sys/fs/cgroup/memory/foo/memory.limit_in_bytes</span><br><span class=\"line\">4096</span><br></pre></td></tr></table></figure>\n\n<p>cgroup</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ sudo tail -f /var/<span class=\"built_in\">log</span>/messages</span><br><span class=\"line\"></span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: sh invoked oom-killer:</span><br><span class=\"line\">gfp_mask=0xd0, order=0, oom_score_adj=0</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: sh cpuset=/ mems_allowed=0</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: CPU: 0 PID: 2687 Comm:</span><br><span class=\"line\">sh Tainted: G</span><br><span class=\"line\">OE  ------------   3.10.0-327.36.3.el7.x86_64 <span class=\"comment\">#1</span></span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: Hardware name: innotek GmbH</span><br><span class=\"line\">VirtualBox/VirtualBox, BIOS VirtualBox 12/01/2006</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: ffff880036ea5c00</span><br><span class=\"line\">0000000093314010 ffff88000002bcd0 ffffffff81636431</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: ffff88000002bd60</span><br><span class=\"line\">ffffffff816313cc 01018800000000d0 ffff88000002bd68</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: ffffffffbc35e040</span><br><span class=\"line\">fffeefff00000000 0000000000000001 ffff880036ea6103</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: Call Trace:</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff81636431&gt;]</span><br><span class=\"line\">dump_stack+0x19/0x1b</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff816313cc&gt;]</span><br><span class=\"line\">dump_header+0x8e/0x214</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff8116d21e&gt;]</span><br><span class=\"line\">oom_kill_process+0x24e/0x3b0</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff81088e4e&gt;] ?</span><br><span class=\"line\">has_capability_noaudit+0x1e/0x30</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff811d4285&gt;]</span><br><span class=\"line\">mem_cgroup_oom_synchronize+0x575/0x5a0</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff811d3650&gt;] ?</span><br><span class=\"line\">mem_cgroup_charge_common+0xc0/0xc0</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff8116da94&gt;]</span><br><span class=\"line\">pagefault_out_of_memory+0x14/0x90</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff8162f815&gt;]</span><br><span class=\"line\">mm_fault_error+0x68/0x12b</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff816422d2&gt;]</span><br><span class=\"line\">__do_page_fault+0x3e2/0x450</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff81642363&gt;]</span><br><span class=\"line\">do_page_fault+0x23/0x80</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [&lt;ffffffff8163e648&gt;]</span><br><span class=\"line\">page_fault+0x28/0x30</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: Task <span class=\"keyword\">in</span> /foo killed as</span><br><span class=\"line\">a result of <span class=\"built_in\">limit</span> of /foo</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: memory: usage 4kB, <span class=\"built_in\">limit</span></span><br><span class=\"line\">4kB, failcnt 8</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: memory+swap: usage 4kB,</span><br><span class=\"line\"><span class=\"built_in\">limit</span> 9007199254740991kB, failcnt 0</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: kmem: usage 0kB, <span class=\"built_in\">limit</span></span><br><span class=\"line\">9007199254740991kB, failcnt 0</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: Memory cgroup stats <span class=\"keyword\">for</span> /foo:</span><br><span class=\"line\">cache:0KB rss:4KB rss_huge:0KB mapped_file:0KB swap:0KB</span><br><span class=\"line\">inactive_anon:0KB active_anon:0KB inactive_file:0KB</span><br><span class=\"line\">active_file:0KB unevictable:0KB</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [ pid ]   uid  tgid total_vm</span><br><span class=\"line\">rss nr_ptes swapents oom_score_adj name</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [ 2687]     0  2687    28281</span><br><span class=\"line\">347     12        0             0 sh</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: [ 2702]     0  2702    28281</span><br><span class=\"line\">50    7        0             0 sh</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: Memory cgroup out of memory:</span><br><span class=\"line\">Kill process 2687 (sh) score 0 or sacrifice child</span><br><span class=\"line\">Oct 14 10:22:40 localhost kernel: Killed process 2702 (sh)</span><br><span class=\"line\">total-vm:113124kB, anon-rss:200kB, file-rss:0kB</span><br><span class=\"line\">Oct 14 10:22:41 localhost kernel: sh invoked oom-killer:</span><br><span class=\"line\">gfp_mask=0xd0, order=0, oom_score_adj=0</span><br><span class=\"line\">[ ... ]</span><br></pre></td></tr></table></figure>\n\n<p>4KBoom-killer</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ ps -o cgroup 2687</span><br><span class=\"line\">CGROUP</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"libcgroup\"><a href=\"#libcgroup\" class=\"headerlink\" title=\"libcgroup\"></a><code>libcgroup</code></h2><p>libcgroup cgcreatesysfs</p>\n<p> foomemory</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo cgcreate -g memory:foo</span><br></pre></td></tr></table></figure>\n\n<p>libcgroup</p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">echo</span> 50000000 | sudo tee</span><br><span class=\"line\">/sys/fs/cgroup/memory/foo/memory.limit_in_bytes</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo cat memory.limit_in_bytes</span><br><span class=\"line\">50003968</span><br></pre></td></tr></table></figure>\n\n<p>foo cgexec cgroup</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo cgexec -g memory:foo ~/test.sh</span><br></pre></td></tr></table></figure>\n\n<p>PIDcgroupmemory</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$  ps -o cgroup 2945</span><br><span class=\"line\">CGROUP</span><br><span class=\"line\">6:memory:/foo,1:name=systemd:/user.slice/user-0.slice/</span><br><span class=\"line\">session-1.scope</span><br></pre></td></tr></table></figure>\n\n<p>cgroupcgdeletefoo memory</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo cgdelete memory:foo</span><br></pre></td></tr></table></figure>\n\n<p><br>/etc/cgconfig.confcgroupfoo</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ cat /etc/cgconfig.conf</span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#  Copyright IBM Corporation. 2007</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#  Authors:     Balbir Singh &lt;balbir@linux.vnet.ibm.com&gt;</span></span><br><span class=\"line\"><span class=\"comment\">#  This program is free software; you can redistribute it</span></span><br><span class=\"line\"><span class=\"comment\">#  and/or modify it under the terms of version 2.1 of the GNU</span></span><br><span class=\"line\"><span class=\"comment\">#  Lesser General Public License as published by the Free</span></span><br><span class=\"line\"><span class=\"comment\">#  Software Foundation.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#  This program is distributed in the hope that it would be</span></span><br><span class=\"line\"><span class=\"comment\">#  useful, but WITHOUT ANY WARRANTY; without even the implied</span></span><br><span class=\"line\"><span class=\"comment\">#  warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR</span></span><br><span class=\"line\"><span class=\"comment\">#  PURPOSE.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># By default, we expect systemd mounts everything on boot,</span></span><br><span class=\"line\"><span class=\"comment\"># so there is not much to do.</span></span><br><span class=\"line\"><span class=\"comment\"># See man cgconfig.conf for further details, how to create</span></span><br><span class=\"line\"><span class=\"comment\"># groups on system boot using this file.</span></span><br><span class=\"line\"></span><br><span class=\"line\">group foo &#123;</span><br><span class=\"line\">cpu &#123;</span><br><span class=\"line\">cpu.shares = 100;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">memory &#123;</span><br><span class=\"line\">memory.limit_in_bytes = 5000000;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>cpu.sharesCPU1,024100CPU100CPU10</p>\n<p>cgroupCPUcgconfig.conf</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">cpuset &#123;</span><br><span class=\"line\">cpuset.cpus=<span class=\"string\">&quot;0-5&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>cgroup05-CPU</p>\n<p>cgconfigcgconfig</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo systemctl <span class=\"built_in\">enable</span> cgconfig</span><br><span class=\"line\">Create symlink from /etc/systemd/system/sysinit.target.wants/</span><br><span class=\"line\">cgconfig.service</span><br><span class=\"line\">to /usr/lib/systemd/system/cgconfig.service.</span><br></pre></td></tr></table></figure>\n\n<p>cgconfig</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo systemctl start cgconfig</span><br></pre></td></tr></table></figure>\n\n<p>cgroupfoo memorycpu </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo cgexec -g memory,cpu,cpuset:foo ~/test.sh &amp;</span><br></pre></td></tr></table></figure>\n\n<p>cgroupcgconfig  </p>\n"},{"title":"lxc","date":"2021-03-16T14:29:22.000Z","_content":"\n\nLXC2008Solaris ContainersSolaris ZonesFreeBSD jail\nLXC\ncgroupCPUI / O\n chroot\n\n\nLXCcgroupCPUI / O\n\n### \n\nLinux\n\n\n\n### \n\n* \n* IP\n* \n\n\nDocker\n\n* Docker\n* Dockerrun  copyDockerDocker\n* Docker\n* Docker\n\n\n*** DockerLXCcgroup\n","source":"_posts/linux/lxc.md","raw":"---\ntitle: lxc\ndate: 2021-03-16 22:29:22\ntags:\n- linux\n- kernel\n---\n\n\nLXC2008Solaris ContainersSolaris ZonesFreeBSD jail\nLXC\ncgroupCPUI / O\n chroot\n\n\nLXCcgroupCPUI / O\n\n### \n\nLinux\n\n\n\n### \n\n* \n* IP\n* \n\n\nDocker\n\n* Docker\n* Dockerrun  copyDockerDocker\n* Docker\n* Docker\n\n\n*** DockerLXCcgroup\n","slug":"linux/lxc","published":1,"updated":"2021-08-24T16:25:21.610Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0d2000xsmjr23154t3q","content":"<p><br>LXC2008Solaris ContainersSolaris ZonesFreeBSD jail<br>LXC<br>cgroupCPUI / O<br> chroot</p>\n<p>LXCcgroupCPUI / O</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Linux</p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li></li>\n<li>IP</li>\n<li></li>\n</ul>\n<p>Docker</p>\n<ul>\n<li>Docker</li>\n<li>Dockerrun  copyDockerDocker</li>\n<li>Docker</li>\n<li>Docker</li>\n</ul>\n<p>*** DockerLXCcgroup</p>\n","site":{"data":{}},"excerpt":"","more":"<p><br>LXC2008Solaris ContainersSolaris ZonesFreeBSD jail<br>LXC<br>cgroupCPUI / O<br> chroot</p>\n<p>LXCcgroupCPUI / O</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>Linux</p>\n<p></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ul>\n<li></li>\n<li>IP</li>\n<li></li>\n</ul>\n<p>Docker</p>\n<ul>\n<li>Docker</li>\n<li>Dockerrun  copyDockerDocker</li>\n<li>Docker</li>\n<li>Docker</li>\n</ul>\n<p>*** DockerLXCcgroup</p>\n"},{"title":"Linux ","date":"2021-03-10T09:12:47.000Z","_content":"\n## namespace \n\nnamespace  Linux \n namespace \n namespace \n\n\n## namespace \n\nnamespace\n\n2\n\n\n\n\n\n\n\n\n\n## namespace \n\n* PID\n* \n\n\n* Unixuts\n* \n* mnt\n* IPC\n* CGroups\n\n\n## linux \n\n1. ip netns add xx  namespace\n\n```bash\n$ ip netns add net1\n$ ip netns ls\nnet1\n```\n\n2. ip netns exec <netns namespace> <BASH SHELL>  namespace net1  BASH SHELL \n\n```bash\n$ ip netns exec net1 bash\n\n# exit \n\n$ exit\n```\n\n\n![img.png](img.png)\n\n namespace  lo   \n\n```bash\n$ ip link set lo up\n```\n\nnetwork namespace \n namespace  namespace \n\n Linux  veth pair  namespace \n\n![img_2.png](img_2.png)\n\n3.1 ip link add type veth  veth pair\n\n```bash\n# veth\n\n$ ip link\n\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000\n    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff\n3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default\n    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff\n    \n    \n```\n\n link veth pair\n```bash\n#  veth pair\n\n$ ip link add type veth\n\n#  ip link add xxx type veth peer name yyy  veth pair \n\n$ ip link add veth1 type veth peer name veth2\n\n$ ip link\n\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000\n    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff\n3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default\n    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff\n8: veth2@veth1: <BROADCAST,MULTICAST,M-DOWN> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 6e:86:2f:10:5c:50 brd ff:ff:ff:ff:ff:ff\n9: veth1@veth2: <BROADCAST,MULTICAST,M-DOWN> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 0a:b8:54:5b:9f:7d brd ff:ff:ff:ff:ff:ff\n    \nveth pair   89 \n\n`veth1@veth2` -- `veth2@veth1` \n```\n\n3.2 ip link set xx netns yy  veth xx  namespace yy \n\n```bash\n$ ip link set veth1 netns net1\n\n$ ip link set veth2 netns net2\n\n```\n\n\nnamespace \n\n```bash\n$ ip link\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000\n    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff\n3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default\n    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff\n8: veth2@if9: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 6e:86:2f:10:5c:50 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    \n$ ip link set veth2 netns net2\n\n$ ip link\n\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000\n    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff\n3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default\n    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff\n```\n\n3.3  veth pair  ip \n\n```bash\n# net0 namespace  veth0 up\n$ ip netns exec net1 ip link set veth1 up\n\n$ ip addr add 10.1.1.1/24 dev veth1\n# veth0 up ip \n\n$ ip route\n10.1.1.0/24 dev veth1 proto kernel scope link src 10.1.1.1\n\n# net2 namespace  veth2 up\n\n$ ip addr add 10.1.1.2/24 dev veth2\n\n```\n\n![img_3.png](img_3.png)\n\n\n","source":"_posts/linux/namespace.md","raw":"---\ntitle: Linux \ndate: 2021-03-10 17:12:47\ntags:\n- linux\n- kernal\n---\n\n## namespace \n\nnamespace  Linux \n namespace \n namespace \n\n\n## namespace \n\nnamespace\n\n2\n\n\n\n\n\n\n\n\n\n## namespace \n\n* PID\n* \n\n\n* Unixuts\n* \n* mnt\n* IPC\n* CGroups\n\n\n## linux \n\n1. ip netns add xx  namespace\n\n```bash\n$ ip netns add net1\n$ ip netns ls\nnet1\n```\n\n2. ip netns exec <netns namespace> <BASH SHELL>  namespace net1  BASH SHELL \n\n```bash\n$ ip netns exec net1 bash\n\n# exit \n\n$ exit\n```\n\n\n![img.png](img.png)\n\n namespace  lo   \n\n```bash\n$ ip link set lo up\n```\n\nnetwork namespace \n namespace  namespace \n\n Linux  veth pair  namespace \n\n![img_2.png](img_2.png)\n\n3.1 ip link add type veth  veth pair\n\n```bash\n# veth\n\n$ ip link\n\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000\n    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff\n3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default\n    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff\n    \n    \n```\n\n link veth pair\n```bash\n#  veth pair\n\n$ ip link add type veth\n\n#  ip link add xxx type veth peer name yyy  veth pair \n\n$ ip link add veth1 type veth peer name veth2\n\n$ ip link\n\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000\n    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff\n3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default\n    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff\n8: veth2@veth1: <BROADCAST,MULTICAST,M-DOWN> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 6e:86:2f:10:5c:50 brd ff:ff:ff:ff:ff:ff\n9: veth1@veth2: <BROADCAST,MULTICAST,M-DOWN> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 0a:b8:54:5b:9f:7d brd ff:ff:ff:ff:ff:ff\n    \nveth pair   89 \n\n`veth1@veth2` -- `veth2@veth1` \n```\n\n3.2 ip link set xx netns yy  veth xx  namespace yy \n\n```bash\n$ ip link set veth1 netns net1\n\n$ ip link set veth2 netns net2\n\n```\n\n\nnamespace \n\n```bash\n$ ip link\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000\n    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff\n3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default\n    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff\n8: veth2@if9: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 6e:86:2f:10:5c:50 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    \n$ ip link set veth2 netns net2\n\n$ ip link\n\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000\n    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff\n3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default\n    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff\n```\n\n3.3  veth pair  ip \n\n```bash\n# net0 namespace  veth0 up\n$ ip netns exec net1 ip link set veth1 up\n\n$ ip addr add 10.1.1.1/24 dev veth1\n# veth0 up ip \n\n$ ip route\n10.1.1.0/24 dev veth1 proto kernel scope link src 10.1.1.1\n\n# net2 namespace  veth2 up\n\n$ ip addr add 10.1.1.2/24 dev veth2\n\n```\n\n![img_3.png](img_3.png)\n\n\n","slug":"linux/namespace","published":1,"updated":"2021-08-24T16:25:21.610Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0d2000ysmjrghfj4gar","content":"<h2 id=\"namespace-\"><a href=\"#namespace-\" class=\"headerlink\" title=\"namespace \"></a>namespace </h2><p>namespace  Linux <br> namespace <br> namespace </p>\n<h2 id=\"namespace-\"><a href=\"#namespace-\" class=\"headerlink\" title=\"namespace \"></a>namespace </h2><p>namespace<br><br>2<br></p>\n<p><br></p>\n<p><br><br></p>\n<h2 id=\"namespace-\"><a href=\"#namespace-\" class=\"headerlink\" title=\"namespace \"></a>namespace </h2><ul>\n<li>PID</li>\n<li></li>\n</ul>\n<ul>\n<li>Unixuts</li>\n<li></li>\n<li>mnt</li>\n<li>IPC</li>\n<li>CGroups</li>\n</ul>\n<h2 id=\"linux-\"><a href=\"#linux-\" class=\"headerlink\" title=\"linux \"></a>linux </h2><ol>\n<li>ip netns add xx  namespace</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ip netns add net1</span><br><span class=\"line\">$ ip netns ls</span><br><span class=\"line\">net1</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>ip netns exec <netns namespace> <BASH shell>  namespace net1  BASH SHELL </BASH></netns></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ip netns <span class=\"built_in\">exec</span> net1 bash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># exit </span></span><br><span class=\"line\"></span><br><span class=\"line\">$ <span class=\"built_in\">exit</span></span><br></pre></td></tr></table></figure>\n\n\n<p><img src=\"/2021/03/10/linux/namespace/img.png\" alt=\"img.png\"></p>\n<p> namespace  lo   </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ip link <span class=\"built_in\">set</span> lo up</span><br></pre></td></tr></table></figure>\n\n<p>network namespace <br> namespace  namespace </p>\n<p> Linux  veth pair  namespace </p>\n<p><img src=\"/2021/03/10/linux/namespace/img_2.png\" alt=\"img_2.png\"></p>\n<p>3.1 ip link add type veth  veth pair</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># veth</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ ip link</span><br><span class=\"line\"></span><br><span class=\"line\">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class=\"line\">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default</span><br><span class=\"line\">    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br></pre></td></tr></table></figure>\n\n<p> link veth pair</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  veth pair</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ ip link add <span class=\"built_in\">type</span> veth</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  ip link add xxx type veth peer name yyy  veth pair </span></span><br><span class=\"line\"></span><br><span class=\"line\">$ ip link add veth1 <span class=\"built_in\">type</span> veth peer name veth2</span><br><span class=\"line\"></span><br><span class=\"line\">$ ip link</span><br><span class=\"line\"></span><br><span class=\"line\">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class=\"line\">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default</span><br><span class=\"line\">    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">8: veth2@veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/ether 6e:86:2f:10:5c:50 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">9: veth1@veth2: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/ether 0a:b8:54:5b:9f:7d brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">    </span><br><span class=\"line\">veth pair   89 </span><br><span class=\"line\"></span><br><span class=\"line\">`veth1@veth2` -- `veth2@veth1` </span><br></pre></td></tr></table></figure>\n\n<p>3.2 ip link set xx netns yy  veth xx  namespace yy </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ip link <span class=\"built_in\">set</span> veth1 netns net1</span><br><span class=\"line\"></span><br><span class=\"line\">$ ip link <span class=\"built_in\">set</span> veth2 netns net2</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p>namespace </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ip link</span><br><span class=\"line\">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class=\"line\">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default</span><br><span class=\"line\">    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">8: veth2@if9: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/ether 6e:86:2f:10:5c:50 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class=\"line\">    </span><br><span class=\"line\">$ ip link <span class=\"built_in\">set</span> veth2 netns net2</span><br><span class=\"line\"></span><br><span class=\"line\">$ ip link</span><br><span class=\"line\"></span><br><span class=\"line\">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class=\"line\">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default</span><br><span class=\"line\">    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure>\n\n<p>3.3  veth pair  ip </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># net0 namespace  veth0 up</span></span><br><span class=\"line\">$ ip netns <span class=\"built_in\">exec</span> net1 ip link <span class=\"built_in\">set</span> veth1 up</span><br><span class=\"line\"></span><br><span class=\"line\">$ ip addr add 10.1.1.1/24 dev veth1</span><br><span class=\"line\"><span class=\"comment\"># veth0 up ip </span></span><br><span class=\"line\"></span><br><span class=\"line\">$ ip route</span><br><span class=\"line\">10.1.1.0/24 dev veth1 proto kernel scope link src 10.1.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># net2 namespace  veth2 up</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ ip addr add 10.1.1.2/24 dev veth2</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2021/03/10/linux/namespace/img_3.png\" alt=\"img_3.png\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"namespace-\"><a href=\"#namespace-\" class=\"headerlink\" title=\"namespace \"></a>namespace </h2><p>namespace  Linux <br> namespace <br> namespace </p>\n<h2 id=\"namespace-\"><a href=\"#namespace-\" class=\"headerlink\" title=\"namespace \"></a>namespace </h2><p>namespace<br><br>2<br></p>\n<p><br></p>\n<p><br><br></p>\n<h2 id=\"namespace-\"><a href=\"#namespace-\" class=\"headerlink\" title=\"namespace \"></a>namespace </h2><ul>\n<li>PID</li>\n<li></li>\n</ul>\n<ul>\n<li>Unixuts</li>\n<li></li>\n<li>mnt</li>\n<li>IPC</li>\n<li>CGroups</li>\n</ul>\n<h2 id=\"linux-\"><a href=\"#linux-\" class=\"headerlink\" title=\"linux \"></a>linux </h2><ol>\n<li>ip netns add xx  namespace</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ip netns add net1</span><br><span class=\"line\">$ ip netns ls</span><br><span class=\"line\">net1</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>ip netns exec <netns namespace> <BASH shell>  namespace net1  BASH SHELL </BASH></netns></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ip netns <span class=\"built_in\">exec</span> net1 bash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># exit </span></span><br><span class=\"line\"></span><br><span class=\"line\">$ <span class=\"built_in\">exit</span></span><br></pre></td></tr></table></figure>\n\n\n<p><img src=\"/2021/03/10/linux/namespace/img.png\" alt=\"img.png\"></p>\n<p> namespace  lo   </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ip link <span class=\"built_in\">set</span> lo up</span><br></pre></td></tr></table></figure>\n\n<p>network namespace <br> namespace  namespace </p>\n<p> Linux  veth pair  namespace </p>\n<p><img src=\"/2021/03/10/linux/namespace/img_2.png\" alt=\"img_2.png\"></p>\n<p>3.1 ip link add type veth  veth pair</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># veth</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ ip link</span><br><span class=\"line\"></span><br><span class=\"line\">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class=\"line\">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default</span><br><span class=\"line\">    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br></pre></td></tr></table></figure>\n\n<p> link veth pair</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  veth pair</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ ip link add <span class=\"built_in\">type</span> veth</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#  ip link add xxx type veth peer name yyy  veth pair </span></span><br><span class=\"line\"></span><br><span class=\"line\">$ ip link add veth1 <span class=\"built_in\">type</span> veth peer name veth2</span><br><span class=\"line\"></span><br><span class=\"line\">$ ip link</span><br><span class=\"line\"></span><br><span class=\"line\">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class=\"line\">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default</span><br><span class=\"line\">    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">8: veth2@veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/ether 6e:86:2f:10:5c:50 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">9: veth1@veth2: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/ether 0a:b8:54:5b:9f:7d brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">    </span><br><span class=\"line\">veth pair   89 </span><br><span class=\"line\"></span><br><span class=\"line\">`veth1@veth2` -- `veth2@veth1` </span><br></pre></td></tr></table></figure>\n\n<p>3.2 ip link set xx netns yy  veth xx  namespace yy </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ip link <span class=\"built_in\">set</span> veth1 netns net1</span><br><span class=\"line\"></span><br><span class=\"line\">$ ip link <span class=\"built_in\">set</span> veth2 netns net2</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p>namespace </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ip link</span><br><span class=\"line\">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class=\"line\">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default</span><br><span class=\"line\">    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">8: veth2@if9: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/ether 6e:86:2f:10:5c:50 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class=\"line\">    </span><br><span class=\"line\">$ ip link <span class=\"built_in\">set</span> veth2 netns net2</span><br><span class=\"line\"></span><br><span class=\"line\">$ ip link</span><br><span class=\"line\"></span><br><span class=\"line\">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class=\"line\">2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000</span><br><span class=\"line\">    link/ether 00:50:56:a9:e9:17 brd ff:ff:ff:ff:ff:ff</span><br><span class=\"line\">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN mode DEFAULT group default</span><br><span class=\"line\">    link/ether 02:42:8b:f3:61:ac brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure>\n\n<p>3.3  veth pair  ip </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># net0 namespace  veth0 up</span></span><br><span class=\"line\">$ ip netns <span class=\"built_in\">exec</span> net1 ip link <span class=\"built_in\">set</span> veth1 up</span><br><span class=\"line\"></span><br><span class=\"line\">$ ip addr add 10.1.1.1/24 dev veth1</span><br><span class=\"line\"><span class=\"comment\"># veth0 up ip </span></span><br><span class=\"line\"></span><br><span class=\"line\">$ ip route</span><br><span class=\"line\">10.1.1.0/24 dev veth1 proto kernel scope link src 10.1.1.1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># net2 namespace  veth2 up</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ ip addr add 10.1.1.2/24 dev veth2</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2021/03/10/linux/namespace/img_3.png\" alt=\"img_3.png\"></p>\n"},{"title":"route","date":"2021-03-13T16:25:54.000Z","_content":"\n","source":"_posts/linux/route.md","raw":"---\ntitle: route\ndate: 2021-03-14 00:25:54\ntags:\n- linux\n---\n\n","slug":"linux/route","published":1,"updated":"2021-08-24T16:25:21.617Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0d30011smjrctf8hhz8","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"Linux  Bridge ","date":"2021-03-13T14:44:26.000Z","_content":"\n tap/tunveth-pair Bridge  IPMAC \n\nBridge \n\n Bridge \n\nBridge .\n\n linux Bridge\n\n###  `brctl`\n\n```bash\n$ yum install bridge-utils -y\n```\n\ndocker0 \n\n1. (br0)\n```bash\n$ brctl addbr br0\n\n\n# :\n$ sudo ifconfig br0 192.168.100.1 netmask  255.255.255.0\n\n# :\n\n$ sudo ip addr add 192.168.100.0/16 dev bridge0\n\n$ sudo ip link set dev bridge0 up\n\n```\n\n2.\n\n1\n\n```bash\n$ sudo brctl show\n```\n\n2(br0)\n\n```bash\n$ sudo brctl show br0\n```\n\n3.(br0)\n\n```bash\n$ sudo brctl delbr br0\n```\n\n\n4. eth0br0\n\n```bash\n$ brctl addif br0 eth0\n```\n\n\n5. br0eth0\n\n```bash\n$ brctl delif br0 eth0\n```\n","source":"_posts/linux/bridge.md","raw":"---\ntitle: Linux  Bridge \ndate: 2021-03-13 22:44:26\ntags:\n- linux\n- network\n---\n\n tap/tunveth-pair Bridge  IPMAC \n\nBridge \n\n Bridge \n\nBridge .\n\n linux Bridge\n\n###  `brctl`\n\n```bash\n$ yum install bridge-utils -y\n```\n\ndocker0 \n\n1. (br0)\n```bash\n$ brctl addbr br0\n\n\n# :\n$ sudo ifconfig br0 192.168.100.1 netmask  255.255.255.0\n\n# :\n\n$ sudo ip addr add 192.168.100.0/16 dev bridge0\n\n$ sudo ip link set dev bridge0 up\n\n```\n\n2.\n\n1\n\n```bash\n$ sudo brctl show\n```\n\n2(br0)\n\n```bash\n$ sudo brctl show br0\n```\n\n3.(br0)\n\n```bash\n$ sudo brctl delbr br0\n```\n\n\n4. eth0br0\n\n```bash\n$ brctl addif br0 eth0\n```\n\n\n5. br0eth0\n\n```bash\n$ brctl delif br0 eth0\n```\n","slug":"linux/bridge","published":1,"updated":"2021-08-24T16:25:21.609Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0d40012smjr5qnz7fvq","content":"<p> tap/tunveth-pair Bridge  IPMAC </p>\n<p>Bridge </p>\n<p> Bridge </p>\n<p>Bridge .</p>\n<p> linux Bridge</p>\n<h3 id=\"-brctl\"><a href=\"#-brctl\" class=\"headerlink\" title=\" brctl\"></a> <code>brctl</code></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yum install bridge-utils -y</span><br></pre></td></tr></table></figure>\n\n<p>docker0 </p>\n<ol>\n<li>(br0)<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ brctl addbr br0</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># :</span></span><br><span class=\"line\">$ sudo ifconfig br0 192.168.100.1 netmask  255.255.255.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># :</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ sudo ip addr add 192.168.100.0/16 dev bridge0</span><br><span class=\"line\"></span><br><span class=\"line\">$ sudo ip link <span class=\"built_in\">set</span> dev bridge0 up</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>2.</p>\n<p>1</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo brctl show</span><br></pre></td></tr></table></figure>\n\n<p>2(br0)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo brctl show br0</span><br></pre></td></tr></table></figure>\n\n<p>3.(br0)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo brctl delbr br0</span><br></pre></td></tr></table></figure>\n\n\n<ol start=\"4\">\n<li>eth0br0</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ brctl addif br0 eth0</span><br></pre></td></tr></table></figure>\n\n\n<ol start=\"5\">\n<li>br0eth0</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ brctl delif br0 eth0</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p> tap/tunveth-pair Bridge  IPMAC </p>\n<p>Bridge </p>\n<p> Bridge </p>\n<p>Bridge .</p>\n<p> linux Bridge</p>\n<h3 id=\"-brctl\"><a href=\"#-brctl\" class=\"headerlink\" title=\" brctl\"></a> <code>brctl</code></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ yum install bridge-utils -y</span><br></pre></td></tr></table></figure>\n\n<p>docker0 </p>\n<ol>\n<li>(br0)<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ brctl addbr br0</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># :</span></span><br><span class=\"line\">$ sudo ifconfig br0 192.168.100.1 netmask  255.255.255.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># :</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ sudo ip addr add 192.168.100.0/16 dev bridge0</span><br><span class=\"line\"></span><br><span class=\"line\">$ sudo ip link <span class=\"built_in\">set</span> dev bridge0 up</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></li>\n</ol>\n<p>2.</p>\n<p>1</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo brctl show</span><br></pre></td></tr></table></figure>\n\n<p>2(br0)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo brctl show br0</span><br></pre></td></tr></table></figure>\n\n<p>3.(br0)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo brctl delbr br0</span><br></pre></td></tr></table></figure>\n\n\n<ol start=\"4\">\n<li>eth0br0</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ brctl addif br0 eth0</span><br></pre></td></tr></table></figure>\n\n\n<ol start=\"5\">\n<li>br0eth0</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ brctl delif br0 eth0</span><br></pre></td></tr></table></figure>\n"},{"title":"istio","date":"2021-03-21T16:00:00.000Z","_content":"\nistio\n\nistio1.8.4,istio release-1.8.4\n\nistio \n\n* pilot-discovery: istiod istio/pilot/pilot-discovery \n* pilot-agent:  proxy istio/pilot/pilot-discovery \n\n![img.png](debug-istio/img_2.png)\n\nkind  --config trustworthy-jwt.yaml\n\n```yaml\napiVersion: kind.x-k8s.io/v1alpha4\nkind: Cluster\nkubeadmConfigPatches:\n  - |\n    apiVersion: kubeadm.k8s.io/v1beta2\n    kind: ClusterConfiguration\n    metadata:\n      name: config\n    etcd:\n      local:\n        # Run etcd in a tmpfs (in RAM) for performance improvements\n        dataDir: /tmp/kind-cluster-etcd\n    apiServer:\n      extraArgs:\n        \"service-account-issuer\": \"kubernetes.default.svc\"\n        \"service-account-signing-key-file\": \"/etc/kubernetes/pki/sa.key\"\ncontainerdConfigPatches:\n  - |-\n    [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"localhost:5000\"]\n      endpoint = [\"http://kind-registry:5000\"]\n```\n\n### kind\n\n```bash\n$ kind create cluster --image  docker.io/kindest/node:v1.17.5 --config trustworthy-jwt.yaml  --name kind-2\n```\n\n### `pilot-discovery`\n\n```bash\n# istio\n$ istioctl install\n```\n\nistio  istiodendpoint \n\n istiod\n\n```bash\n#  IP\n$ export ip=192.168.110.206\n$ kubectl -n istio-system delete svc istiod\n$ kubectl -n istio-system delete endpoints istiod\n\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Service\nmetadata:\n  name: istiod\n  namespace: istio-system\nspec:\n  ports:\n  - name: grpc-xds\n    port: 15010\n  - name: https-dns\n    port: 15012\n  - name: https-webhook\n    port: 443\n    targetPort: 15017\n  - name: http-monitoring\n    port: 15014\n---\napiVersion: v1\nkind: Endpoints\nmetadata:\n  name: istiod\n  namespace: istio-system\nsubsets:\n- addresses:\n  - ip: ${ip}\n  ports:\n  - name: https-dns\n    port: 15012\n    protocol: TCP\n  - name: grpc-xds\n    port: 15010\n    protocol: TCP\n  - name: https-webhook\n    port: 15017\n    protocol: TCP\n  - name: http-monitoring\n    port: 15014\n    protocol: TCP\n\nEOF\n```\n\nistio svc svc  istiod.istio-system pod\n\n```bash\n$ kubectl -n istio-system delete svc istiod\n$ kubectl -n istio-system delete endpoints istiod\n\ncat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Service\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{},\"labels\":{\"app\":\"istiod\",\"install.operator.istio.io/owning-resource\":\"unknown\",\"install.operator.istio.io/owning-resource-namespace\":\"istio-system\",\"istio\":\"pilot\",\"istio.io/rev\":\"default\",\"operator.istio.io/component\":\"Pilot\",\"operator.istio.io/managed\":\"Reconcile\",\"operator.istio.io/version\":\"1.8.4\",\"release\":\"istio\"},\"name\":\"istiod\",\"namespace\":\"istio-system\"},\"spec\":{\"ports\":[{\"name\":\"grpc-xds\",\"port\":15010,\"protocol\":\"TCP\"},{\"name\":\"https-dns\",\"port\":15012,\"protocol\":\"TCP\"},{\"name\":\"https-webhook\",\"port\":443,\"protocol\":\"TCP\",\"targetPort\":15017},{\"name\":\"http-monitoring\",\"port\":15014,\"protocol\":\"TCP\"}],\"selector\":{\"app\":\"istiod\",\"istio\":\"pilot\"}}}\n  creationTimestamp: \"2021-03-22T07:08:32Z\"\n  labels:\n    app: istiod\n    install.operator.istio.io/owning-resource: unknown\n    install.operator.istio.io/owning-resource-namespace: istio-system\n    istio: pilot\n    istio.io/rev: default\n    operator.istio.io/component: Pilot\n    operator.istio.io/managed: Reconcile\n    operator.istio.io/version: 1.8.4\n    release: istio\n  name: istiod\n  namespace: istio-system\n  resourceVersion: \"826\"\n  selfLink: /api/v1/namespaces/istio-system/services/istiod\n  uid: 44ee44a6-9003-4f8d-9196-49e47b6667c1\nspec:\n  clusterIP: 10.96.3.250\n  ports:\n  - name: grpc-xds\n    port: 15010\n    protocol: TCP\n    targetPort: 15010\n  - name: https-dns\n    port: 15012\n    protocol: TCP\n    targetPort: 15012\n  - name: https-webhook\n    port: 443\n    protocol: TCP\n    targetPort: 15017\n  - name: http-monitoring\n    port: 15014\n    protocol: TCP\n    targetPort: 15014\n  selector:\n    app: istiod\n    istio: pilot\n  sessionAffinity: None\n  type: ClusterIP\nstatus:\n  loadBalancer: {}\nEOF  \n```\n\n","source":"_posts/k8s/istio/debug-istio.md","raw":"---\ntitle: istio\ndate: 2021-03-22\ntags:\n- istio\n- k8s\n---\n\nistio\n\nistio1.8.4,istio release-1.8.4\n\nistio \n\n* pilot-discovery: istiod istio/pilot/pilot-discovery \n* pilot-agent:  proxy istio/pilot/pilot-discovery \n\n![img.png](debug-istio/img_2.png)\n\nkind  --config trustworthy-jwt.yaml\n\n```yaml\napiVersion: kind.x-k8s.io/v1alpha4\nkind: Cluster\nkubeadmConfigPatches:\n  - |\n    apiVersion: kubeadm.k8s.io/v1beta2\n    kind: ClusterConfiguration\n    metadata:\n      name: config\n    etcd:\n      local:\n        # Run etcd in a tmpfs (in RAM) for performance improvements\n        dataDir: /tmp/kind-cluster-etcd\n    apiServer:\n      extraArgs:\n        \"service-account-issuer\": \"kubernetes.default.svc\"\n        \"service-account-signing-key-file\": \"/etc/kubernetes/pki/sa.key\"\ncontainerdConfigPatches:\n  - |-\n    [plugins.\"io.containerd.grpc.v1.cri\".registry.mirrors.\"localhost:5000\"]\n      endpoint = [\"http://kind-registry:5000\"]\n```\n\n### kind\n\n```bash\n$ kind create cluster --image  docker.io/kindest/node:v1.17.5 --config trustworthy-jwt.yaml  --name kind-2\n```\n\n### `pilot-discovery`\n\n```bash\n# istio\n$ istioctl install\n```\n\nistio  istiodendpoint \n\n istiod\n\n```bash\n#  IP\n$ export ip=192.168.110.206\n$ kubectl -n istio-system delete svc istiod\n$ kubectl -n istio-system delete endpoints istiod\n\n$ cat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Service\nmetadata:\n  name: istiod\n  namespace: istio-system\nspec:\n  ports:\n  - name: grpc-xds\n    port: 15010\n  - name: https-dns\n    port: 15012\n  - name: https-webhook\n    port: 443\n    targetPort: 15017\n  - name: http-monitoring\n    port: 15014\n---\napiVersion: v1\nkind: Endpoints\nmetadata:\n  name: istiod\n  namespace: istio-system\nsubsets:\n- addresses:\n  - ip: ${ip}\n  ports:\n  - name: https-dns\n    port: 15012\n    protocol: TCP\n  - name: grpc-xds\n    port: 15010\n    protocol: TCP\n  - name: https-webhook\n    port: 15017\n    protocol: TCP\n  - name: http-monitoring\n    port: 15014\n    protocol: TCP\n\nEOF\n```\n\nistio svc svc  istiod.istio-system pod\n\n```bash\n$ kubectl -n istio-system delete svc istiod\n$ kubectl -n istio-system delete endpoints istiod\n\ncat <<EOF | kubectl apply -f -\napiVersion: v1\nkind: Service\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {\"apiVersion\":\"v1\",\"kind\":\"Service\",\"metadata\":{\"annotations\":{},\"labels\":{\"app\":\"istiod\",\"install.operator.istio.io/owning-resource\":\"unknown\",\"install.operator.istio.io/owning-resource-namespace\":\"istio-system\",\"istio\":\"pilot\",\"istio.io/rev\":\"default\",\"operator.istio.io/component\":\"Pilot\",\"operator.istio.io/managed\":\"Reconcile\",\"operator.istio.io/version\":\"1.8.4\",\"release\":\"istio\"},\"name\":\"istiod\",\"namespace\":\"istio-system\"},\"spec\":{\"ports\":[{\"name\":\"grpc-xds\",\"port\":15010,\"protocol\":\"TCP\"},{\"name\":\"https-dns\",\"port\":15012,\"protocol\":\"TCP\"},{\"name\":\"https-webhook\",\"port\":443,\"protocol\":\"TCP\",\"targetPort\":15017},{\"name\":\"http-monitoring\",\"port\":15014,\"protocol\":\"TCP\"}],\"selector\":{\"app\":\"istiod\",\"istio\":\"pilot\"}}}\n  creationTimestamp: \"2021-03-22T07:08:32Z\"\n  labels:\n    app: istiod\n    install.operator.istio.io/owning-resource: unknown\n    install.operator.istio.io/owning-resource-namespace: istio-system\n    istio: pilot\n    istio.io/rev: default\n    operator.istio.io/component: Pilot\n    operator.istio.io/managed: Reconcile\n    operator.istio.io/version: 1.8.4\n    release: istio\n  name: istiod\n  namespace: istio-system\n  resourceVersion: \"826\"\n  selfLink: /api/v1/namespaces/istio-system/services/istiod\n  uid: 44ee44a6-9003-4f8d-9196-49e47b6667c1\nspec:\n  clusterIP: 10.96.3.250\n  ports:\n  - name: grpc-xds\n    port: 15010\n    protocol: TCP\n    targetPort: 15010\n  - name: https-dns\n    port: 15012\n    protocol: TCP\n    targetPort: 15012\n  - name: https-webhook\n    port: 443\n    protocol: TCP\n    targetPort: 15017\n  - name: http-monitoring\n    port: 15014\n    protocol: TCP\n    targetPort: 15014\n  selector:\n    app: istiod\n    istio: pilot\n  sessionAffinity: None\n  type: ClusterIP\nstatus:\n  loadBalancer: {}\nEOF  \n```\n\n","slug":"k8s/istio/debug-istio","published":1,"updated":"2021-09-09T08:04:42.167Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0d50015smjr9g9c1buv","content":"<p>istio</p>\n<p>istio1.8.4,istio release-1.8.4</p>\n<p>istio </p>\n<ul>\n<li>pilot-discovery: istiod istio/pilot/pilot-discovery </li>\n<li>pilot-agent:  proxy istio/pilot/pilot-discovery </li>\n</ul>\n<p><img src=\"/2021/03/22/k8s/istio/debug-istio/img_2.png\" alt=\"img.png\"></p>\n<p>kind  config trustworthy-jwt.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">kind.x-k8s.io/v1alpha4</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Cluster</span></span><br><span class=\"line\"><span class=\"attr\">kubeadmConfigPatches:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">|</span></span><br><span class=\"line\">    <span class=\"attr\">apiVersion:</span> <span class=\"string\">kubeadm.k8s.io/v1beta2</span></span><br><span class=\"line\">    <span class=\"attr\">kind:</span> <span class=\"string\">ClusterConfiguration</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">config</span></span><br><span class=\"line\">    <span class=\"attr\">etcd:</span></span><br><span class=\"line\">      <span class=\"attr\">local:</span></span><br><span class=\"line\">        <span class=\"comment\"># Run etcd in a tmpfs (in RAM) for performance improvements</span></span><br><span class=\"line\">        <span class=\"attr\">dataDir:</span> <span class=\"string\">/tmp/kind-cluster-etcd</span></span><br><span class=\"line\">    <span class=\"attr\">apiServer:</span></span><br><span class=\"line\">      <span class=\"attr\">extraArgs:</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;service-account-issuer&quot;:</span> <span class=\"string\">&quot;kubernetes.default.svc&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;service-account-signing-key-file&quot;:</span> <span class=\"string\">&quot;/etc/kubernetes/pki/sa.key&quot;</span></span><br><span class=\"line\"><span class=\"attr\">containerdConfigPatches:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">|-</span></span><br><span class=\"line\">    [<span class=\"string\">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;localhost:5000&quot;</span>]</span><br><span class=\"line\">      <span class=\"string\">endpoint</span> <span class=\"string\">=</span> [<span class=\"string\">&quot;http://kind-registry:5000&quot;</span>]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"kind\"><a href=\"#kind\" class=\"headerlink\" title=\"kind\"></a>kind</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kind create cluster --image  docker.io/kindest/node:v1.17.5 --config trustworthy-jwt.yaml  --name kind-2</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"pilot-discovery\"><a href=\"#pilot-discovery\" class=\"headerlink\" title=\"pilot-discovery\"></a><code>pilot-discovery</code></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># istio</span></span><br><span class=\"line\">$ istioctl install</span><br></pre></td></tr></table></figure>\n\n<p>istio  istiodendpoint </p>\n<p> istiod</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  IP</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> ip=192.168.110.206</span><br><span class=\"line\">$ kubectl -n istio-system delete svc istiod</span><br><span class=\"line\">$ kubectl -n istio-system delete endpoints istiod</span><br><span class=\"line\"></span><br><span class=\"line\">$ cat &lt;&lt;<span class=\"string\">EOF | kubectl apply -f -</span></span><br><span class=\"line\"><span class=\"string\">apiVersion: v1</span></span><br><span class=\"line\"><span class=\"string\">kind: Service</span></span><br><span class=\"line\"><span class=\"string\">metadata:</span></span><br><span class=\"line\"><span class=\"string\">  name: istiod</span></span><br><span class=\"line\"><span class=\"string\">  namespace: istio-system</span></span><br><span class=\"line\"><span class=\"string\">spec:</span></span><br><span class=\"line\"><span class=\"string\">  ports:</span></span><br><span class=\"line\"><span class=\"string\">  - name: grpc-xds</span></span><br><span class=\"line\"><span class=\"string\">    port: 15010</span></span><br><span class=\"line\"><span class=\"string\">  - name: https-dns</span></span><br><span class=\"line\"><span class=\"string\">    port: 15012</span></span><br><span class=\"line\"><span class=\"string\">  - name: https-webhook</span></span><br><span class=\"line\"><span class=\"string\">    port: 443</span></span><br><span class=\"line\"><span class=\"string\">    targetPort: 15017</span></span><br><span class=\"line\"><span class=\"string\">  - name: http-monitoring</span></span><br><span class=\"line\"><span class=\"string\">    port: 15014</span></span><br><span class=\"line\"><span class=\"string\">---</span></span><br><span class=\"line\"><span class=\"string\">apiVersion: v1</span></span><br><span class=\"line\"><span class=\"string\">kind: Endpoints</span></span><br><span class=\"line\"><span class=\"string\">metadata:</span></span><br><span class=\"line\"><span class=\"string\">  name: istiod</span></span><br><span class=\"line\"><span class=\"string\">  namespace: istio-system</span></span><br><span class=\"line\"><span class=\"string\">subsets:</span></span><br><span class=\"line\"><span class=\"string\">- addresses:</span></span><br><span class=\"line\"><span class=\"string\">  - ip: $&#123;ip&#125;</span></span><br><span class=\"line\"><span class=\"string\">  ports:</span></span><br><span class=\"line\"><span class=\"string\">  - name: https-dns</span></span><br><span class=\"line\"><span class=\"string\">    port: 15012</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">  - name: grpc-xds</span></span><br><span class=\"line\"><span class=\"string\">    port: 15010</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">  - name: https-webhook</span></span><br><span class=\"line\"><span class=\"string\">    port: 15017</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">  - name: http-monitoring</span></span><br><span class=\"line\"><span class=\"string\">    port: 15014</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br></pre></td></tr></table></figure>\n\n<p>istio svc svc  istiod.istio-system pod</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl -n istio-system delete svc istiod</span><br><span class=\"line\">$ kubectl -n istio-system delete endpoints istiod</span><br><span class=\"line\"></span><br><span class=\"line\">cat &lt;&lt;<span class=\"string\">EOF | kubectl apply -f -</span></span><br><span class=\"line\"><span class=\"string\">apiVersion: v1</span></span><br><span class=\"line\"><span class=\"string\">kind: Service</span></span><br><span class=\"line\"><span class=\"string\">metadata:</span></span><br><span class=\"line\"><span class=\"string\">  annotations:</span></span><br><span class=\"line\"><span class=\"string\">    kubectl.kubernetes.io/last-applied-configuration: |</span></span><br><span class=\"line\"><span class=\"string\">      &#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Service&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;labels&quot;:&#123;&quot;app&quot;:&quot;istiod&quot;,&quot;install.operator.istio.io/owning-resource&quot;:&quot;unknown&quot;,&quot;install.operator.istio.io/owning-resource-namespace&quot;:&quot;istio-system&quot;,&quot;istio&quot;:&quot;pilot&quot;,&quot;istio.io/rev&quot;:&quot;default&quot;,&quot;operator.istio.io/component&quot;:&quot;Pilot&quot;,&quot;operator.istio.io/managed&quot;:&quot;Reconcile&quot;,&quot;operator.istio.io/version&quot;:&quot;1.8.4&quot;,&quot;release&quot;:&quot;istio&quot;&#125;,&quot;name&quot;:&quot;istiod&quot;,&quot;namespace&quot;:&quot;istio-system&quot;&#125;,&quot;spec&quot;:&#123;&quot;ports&quot;:[&#123;&quot;name&quot;:&quot;grpc-xds&quot;,&quot;port&quot;:15010,&quot;protocol&quot;:&quot;TCP&quot;&#125;,&#123;&quot;name&quot;:&quot;https-dns&quot;,&quot;port&quot;:15012,&quot;protocol&quot;:&quot;TCP&quot;&#125;,&#123;&quot;name&quot;:&quot;https-webhook&quot;,&quot;port&quot;:443,&quot;protocol&quot;:&quot;TCP&quot;,&quot;targetPort&quot;:15017&#125;,&#123;&quot;name&quot;:&quot;http-monitoring&quot;,&quot;port&quot;:15014,&quot;protocol&quot;:&quot;TCP&quot;&#125;],&quot;selector&quot;:&#123;&quot;app&quot;:&quot;istiod&quot;,&quot;istio&quot;:&quot;pilot&quot;&#125;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">  creationTimestamp: &quot;2021-03-22T07:08:32Z&quot;</span></span><br><span class=\"line\"><span class=\"string\">  labels:</span></span><br><span class=\"line\"><span class=\"string\">    app: istiod</span></span><br><span class=\"line\"><span class=\"string\">    install.operator.istio.io/owning-resource: unknown</span></span><br><span class=\"line\"><span class=\"string\">    install.operator.istio.io/owning-resource-namespace: istio-system</span></span><br><span class=\"line\"><span class=\"string\">    istio: pilot</span></span><br><span class=\"line\"><span class=\"string\">    istio.io/rev: default</span></span><br><span class=\"line\"><span class=\"string\">    operator.istio.io/component: Pilot</span></span><br><span class=\"line\"><span class=\"string\">    operator.istio.io/managed: Reconcile</span></span><br><span class=\"line\"><span class=\"string\">    operator.istio.io/version: 1.8.4</span></span><br><span class=\"line\"><span class=\"string\">    release: istio</span></span><br><span class=\"line\"><span class=\"string\">  name: istiod</span></span><br><span class=\"line\"><span class=\"string\">  namespace: istio-system</span></span><br><span class=\"line\"><span class=\"string\">  resourceVersion: &quot;826&quot;</span></span><br><span class=\"line\"><span class=\"string\">  selfLink: /api/v1/namespaces/istio-system/services/istiod</span></span><br><span class=\"line\"><span class=\"string\">  uid: 44ee44a6-9003-4f8d-9196-49e47b6667c1</span></span><br><span class=\"line\"><span class=\"string\">spec:</span></span><br><span class=\"line\"><span class=\"string\">  clusterIP: 10.96.3.250</span></span><br><span class=\"line\"><span class=\"string\">  ports:</span></span><br><span class=\"line\"><span class=\"string\">  - name: grpc-xds</span></span><br><span class=\"line\"><span class=\"string\">    port: 15010</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">    targetPort: 15010</span></span><br><span class=\"line\"><span class=\"string\">  - name: https-dns</span></span><br><span class=\"line\"><span class=\"string\">    port: 15012</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">    targetPort: 15012</span></span><br><span class=\"line\"><span class=\"string\">  - name: https-webhook</span></span><br><span class=\"line\"><span class=\"string\">    port: 443</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">    targetPort: 15017</span></span><br><span class=\"line\"><span class=\"string\">  - name: http-monitoring</span></span><br><span class=\"line\"><span class=\"string\">    port: 15014</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">    targetPort: 15014</span></span><br><span class=\"line\"><span class=\"string\">  selector:</span></span><br><span class=\"line\"><span class=\"string\">    app: istiod</span></span><br><span class=\"line\"><span class=\"string\">    istio: pilot</span></span><br><span class=\"line\"><span class=\"string\">  sessionAffinity: None</span></span><br><span class=\"line\"><span class=\"string\">  type: ClusterIP</span></span><br><span class=\"line\"><span class=\"string\">status:</span></span><br><span class=\"line\"><span class=\"string\">  loadBalancer: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">EOF</span>  </span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<p>istio</p>\n<p>istio1.8.4,istio release-1.8.4</p>\n<p>istio </p>\n<ul>\n<li>pilot-discovery: istiod istio/pilot/pilot-discovery </li>\n<li>pilot-agent:  proxy istio/pilot/pilot-discovery </li>\n</ul>\n<p><img src=\"/2021/03/22/k8s/istio/debug-istio/img_2.png\" alt=\"img.png\"></p>\n<p>kind  config trustworthy-jwt.yaml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">kind.x-k8s.io/v1alpha4</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Cluster</span></span><br><span class=\"line\"><span class=\"attr\">kubeadmConfigPatches:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">|</span></span><br><span class=\"line\">    <span class=\"attr\">apiVersion:</span> <span class=\"string\">kubeadm.k8s.io/v1beta2</span></span><br><span class=\"line\">    <span class=\"attr\">kind:</span> <span class=\"string\">ClusterConfiguration</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">config</span></span><br><span class=\"line\">    <span class=\"attr\">etcd:</span></span><br><span class=\"line\">      <span class=\"attr\">local:</span></span><br><span class=\"line\">        <span class=\"comment\"># Run etcd in a tmpfs (in RAM) for performance improvements</span></span><br><span class=\"line\">        <span class=\"attr\">dataDir:</span> <span class=\"string\">/tmp/kind-cluster-etcd</span></span><br><span class=\"line\">    <span class=\"attr\">apiServer:</span></span><br><span class=\"line\">      <span class=\"attr\">extraArgs:</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;service-account-issuer&quot;:</span> <span class=\"string\">&quot;kubernetes.default.svc&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;service-account-signing-key-file&quot;:</span> <span class=\"string\">&quot;/etc/kubernetes/pki/sa.key&quot;</span></span><br><span class=\"line\"><span class=\"attr\">containerdConfigPatches:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">|-</span></span><br><span class=\"line\">    [<span class=\"string\">plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;localhost:5000&quot;</span>]</span><br><span class=\"line\">      <span class=\"string\">endpoint</span> <span class=\"string\">=</span> [<span class=\"string\">&quot;http://kind-registry:5000&quot;</span>]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"kind\"><a href=\"#kind\" class=\"headerlink\" title=\"kind\"></a>kind</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kind create cluster --image  docker.io/kindest/node:v1.17.5 --config trustworthy-jwt.yaml  --name kind-2</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"pilot-discovery\"><a href=\"#pilot-discovery\" class=\"headerlink\" title=\"pilot-discovery\"></a><code>pilot-discovery</code></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># istio</span></span><br><span class=\"line\">$ istioctl install</span><br></pre></td></tr></table></figure>\n\n<p>istio  istiodendpoint </p>\n<p> istiod</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#  IP</span></span><br><span class=\"line\">$ <span class=\"built_in\">export</span> ip=192.168.110.206</span><br><span class=\"line\">$ kubectl -n istio-system delete svc istiod</span><br><span class=\"line\">$ kubectl -n istio-system delete endpoints istiod</span><br><span class=\"line\"></span><br><span class=\"line\">$ cat &lt;&lt;<span class=\"string\">EOF | kubectl apply -f -</span></span><br><span class=\"line\"><span class=\"string\">apiVersion: v1</span></span><br><span class=\"line\"><span class=\"string\">kind: Service</span></span><br><span class=\"line\"><span class=\"string\">metadata:</span></span><br><span class=\"line\"><span class=\"string\">  name: istiod</span></span><br><span class=\"line\"><span class=\"string\">  namespace: istio-system</span></span><br><span class=\"line\"><span class=\"string\">spec:</span></span><br><span class=\"line\"><span class=\"string\">  ports:</span></span><br><span class=\"line\"><span class=\"string\">  - name: grpc-xds</span></span><br><span class=\"line\"><span class=\"string\">    port: 15010</span></span><br><span class=\"line\"><span class=\"string\">  - name: https-dns</span></span><br><span class=\"line\"><span class=\"string\">    port: 15012</span></span><br><span class=\"line\"><span class=\"string\">  - name: https-webhook</span></span><br><span class=\"line\"><span class=\"string\">    port: 443</span></span><br><span class=\"line\"><span class=\"string\">    targetPort: 15017</span></span><br><span class=\"line\"><span class=\"string\">  - name: http-monitoring</span></span><br><span class=\"line\"><span class=\"string\">    port: 15014</span></span><br><span class=\"line\"><span class=\"string\">---</span></span><br><span class=\"line\"><span class=\"string\">apiVersion: v1</span></span><br><span class=\"line\"><span class=\"string\">kind: Endpoints</span></span><br><span class=\"line\"><span class=\"string\">metadata:</span></span><br><span class=\"line\"><span class=\"string\">  name: istiod</span></span><br><span class=\"line\"><span class=\"string\">  namespace: istio-system</span></span><br><span class=\"line\"><span class=\"string\">subsets:</span></span><br><span class=\"line\"><span class=\"string\">- addresses:</span></span><br><span class=\"line\"><span class=\"string\">  - ip: $&#123;ip&#125;</span></span><br><span class=\"line\"><span class=\"string\">  ports:</span></span><br><span class=\"line\"><span class=\"string\">  - name: https-dns</span></span><br><span class=\"line\"><span class=\"string\">    port: 15012</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">  - name: grpc-xds</span></span><br><span class=\"line\"><span class=\"string\">    port: 15010</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">  - name: https-webhook</span></span><br><span class=\"line\"><span class=\"string\">    port: 15017</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">  - name: http-monitoring</span></span><br><span class=\"line\"><span class=\"string\">    port: 15014</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br></pre></td></tr></table></figure>\n\n<p>istio svc svc  istiod.istio-system pod</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl -n istio-system delete svc istiod</span><br><span class=\"line\">$ kubectl -n istio-system delete endpoints istiod</span><br><span class=\"line\"></span><br><span class=\"line\">cat &lt;&lt;<span class=\"string\">EOF | kubectl apply -f -</span></span><br><span class=\"line\"><span class=\"string\">apiVersion: v1</span></span><br><span class=\"line\"><span class=\"string\">kind: Service</span></span><br><span class=\"line\"><span class=\"string\">metadata:</span></span><br><span class=\"line\"><span class=\"string\">  annotations:</span></span><br><span class=\"line\"><span class=\"string\">    kubectl.kubernetes.io/last-applied-configuration: |</span></span><br><span class=\"line\"><span class=\"string\">      &#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;kind&quot;:&quot;Service&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;labels&quot;:&#123;&quot;app&quot;:&quot;istiod&quot;,&quot;install.operator.istio.io/owning-resource&quot;:&quot;unknown&quot;,&quot;install.operator.istio.io/owning-resource-namespace&quot;:&quot;istio-system&quot;,&quot;istio&quot;:&quot;pilot&quot;,&quot;istio.io/rev&quot;:&quot;default&quot;,&quot;operator.istio.io/component&quot;:&quot;Pilot&quot;,&quot;operator.istio.io/managed&quot;:&quot;Reconcile&quot;,&quot;operator.istio.io/version&quot;:&quot;1.8.4&quot;,&quot;release&quot;:&quot;istio&quot;&#125;,&quot;name&quot;:&quot;istiod&quot;,&quot;namespace&quot;:&quot;istio-system&quot;&#125;,&quot;spec&quot;:&#123;&quot;ports&quot;:[&#123;&quot;name&quot;:&quot;grpc-xds&quot;,&quot;port&quot;:15010,&quot;protocol&quot;:&quot;TCP&quot;&#125;,&#123;&quot;name&quot;:&quot;https-dns&quot;,&quot;port&quot;:15012,&quot;protocol&quot;:&quot;TCP&quot;&#125;,&#123;&quot;name&quot;:&quot;https-webhook&quot;,&quot;port&quot;:443,&quot;protocol&quot;:&quot;TCP&quot;,&quot;targetPort&quot;:15017&#125;,&#123;&quot;name&quot;:&quot;http-monitoring&quot;,&quot;port&quot;:15014,&quot;protocol&quot;:&quot;TCP&quot;&#125;],&quot;selector&quot;:&#123;&quot;app&quot;:&quot;istiod&quot;,&quot;istio&quot;:&quot;pilot&quot;&#125;&#125;&#125;</span></span><br><span class=\"line\"><span class=\"string\">  creationTimestamp: &quot;2021-03-22T07:08:32Z&quot;</span></span><br><span class=\"line\"><span class=\"string\">  labels:</span></span><br><span class=\"line\"><span class=\"string\">    app: istiod</span></span><br><span class=\"line\"><span class=\"string\">    install.operator.istio.io/owning-resource: unknown</span></span><br><span class=\"line\"><span class=\"string\">    install.operator.istio.io/owning-resource-namespace: istio-system</span></span><br><span class=\"line\"><span class=\"string\">    istio: pilot</span></span><br><span class=\"line\"><span class=\"string\">    istio.io/rev: default</span></span><br><span class=\"line\"><span class=\"string\">    operator.istio.io/component: Pilot</span></span><br><span class=\"line\"><span class=\"string\">    operator.istio.io/managed: Reconcile</span></span><br><span class=\"line\"><span class=\"string\">    operator.istio.io/version: 1.8.4</span></span><br><span class=\"line\"><span class=\"string\">    release: istio</span></span><br><span class=\"line\"><span class=\"string\">  name: istiod</span></span><br><span class=\"line\"><span class=\"string\">  namespace: istio-system</span></span><br><span class=\"line\"><span class=\"string\">  resourceVersion: &quot;826&quot;</span></span><br><span class=\"line\"><span class=\"string\">  selfLink: /api/v1/namespaces/istio-system/services/istiod</span></span><br><span class=\"line\"><span class=\"string\">  uid: 44ee44a6-9003-4f8d-9196-49e47b6667c1</span></span><br><span class=\"line\"><span class=\"string\">spec:</span></span><br><span class=\"line\"><span class=\"string\">  clusterIP: 10.96.3.250</span></span><br><span class=\"line\"><span class=\"string\">  ports:</span></span><br><span class=\"line\"><span class=\"string\">  - name: grpc-xds</span></span><br><span class=\"line\"><span class=\"string\">    port: 15010</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">    targetPort: 15010</span></span><br><span class=\"line\"><span class=\"string\">  - name: https-dns</span></span><br><span class=\"line\"><span class=\"string\">    port: 15012</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">    targetPort: 15012</span></span><br><span class=\"line\"><span class=\"string\">  - name: https-webhook</span></span><br><span class=\"line\"><span class=\"string\">    port: 443</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">    targetPort: 15017</span></span><br><span class=\"line\"><span class=\"string\">  - name: http-monitoring</span></span><br><span class=\"line\"><span class=\"string\">    port: 15014</span></span><br><span class=\"line\"><span class=\"string\">    protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">    targetPort: 15014</span></span><br><span class=\"line\"><span class=\"string\">  selector:</span></span><br><span class=\"line\"><span class=\"string\">    app: istiod</span></span><br><span class=\"line\"><span class=\"string\">    istio: pilot</span></span><br><span class=\"line\"><span class=\"string\">  sessionAffinity: None</span></span><br><span class=\"line\"><span class=\"string\">  type: ClusterIP</span></span><br><span class=\"line\"><span class=\"string\">status:</span></span><br><span class=\"line\"><span class=\"string\">  loadBalancer: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">EOF</span>  </span><br></pre></td></tr></table></figure>\n\n"},{"title":"2 GIT ","date":"2018-02-19T16:00:00.000Z","_content":"\n## 2.1 \n\n\"\"Version Control System\n\"\"Git\n\n![](https://git-scm.com/images/logos/logomark-orange@2x.png)\n\nGitbranchmergeGit\"\"\n\n\n![](https://git-scm.com/images/branching-illustration@2x.png)\n\nVincent DriessenGitGit\n\n## 2.2 Git \n\n[Git ](https://github.com/git-for-windows/git/releases/download/v2.20.1.windows.1/Git-2.20.1-64-bit.exe)\n\n\n\n## 2.3 Git \n\n`https://gitlab.sissyun.com.cn` Gitlab\n\n## 2.4 \n\n,  \n\n\n* name\n* usernamezhangsan\n* zhang.san@ssi.com.\n\n8pA5wOldyGitlab\n\n![](/assets/gitlab-register.png)\n\n## 2.5 \n\n\n\n Gitlab ,\n\n## 2.6 \n\nwindowsgit bashsshgit, ssh-keygengitssh-keygen\n\n```bash\nssh-keygen -trsa -C \"zhang.san@ssi.com\"\ngit config --global user.name\"Zhang San\"\ngit config --global user.email\"zhang.san@ssi.com\"\n```\n\n### 2.7 \n\ngitlab Profile Settings > \n\n![](img/gitlab_settings.png)\n\n`rsa` \n\n```bash\nssh-keygen -t rsa -C \"youname@ssi.com\"\n```\n\n\b\n\n git bashssh\n\n* Windowsc:\\Users\\yourname\\.ssh\\id_rsa.pub; \n* Linux/Mac: ~/.ssh/id_rsa.pub\n\n```bash\n\ncat ~/.ssh/id_rsa.pub\n```\n\n![ssh_key](img/gitlab_profile_keys_new.png)\n\n### 2.8 Git\n\n\n\n```bash\ngit clonessh://git@gitlab.sissyun.com.cn:8022/frameworks/spring-boot-utils.git\n```\n\n### 2.9 Git \b\n\n\n\ngit\n\n****\n\n demo\n\n```bash\ngit checkout -b demo\n```\n\n****\n\n```bash\ngit branch a\n```\n\n****\n\n\n\n```bash\ngit status\n```\n\n****\n feature \n\n```bash\ngit add .\n\ngit status\n\ngit commit\n\n(press i to input below text)\n\n[Description]: Your comments.\n\n[Reviewer]: The name of reviewer\n\n(press esc and :wq to commit )\n```\n\n\n\n```bash\ngit push origin demo\n```\n\n**master**\n\n\n\nGitmaster\n\n**development**\n\ndevelopment, featuredevelopmentfeature\n\nnightlyMasterDevelopment\"\"merge\nGitDevelopment\n\n```bash\ngit checkout -b development\n```\n\nDevelopmentMaster\n\n```bash\n# Master\ngit checkout master\n\n# Development\ngit merge --no-ff development\n```\n\n--no-ffGit\"\"fast-farward mergeMasterDevelop\n\n--no-ffMasterBenjamin SandofskyUnderstanding the Git Workflow\n\n****\n\nMasterDevelopment\n\n\n* feature\n* release\n* bugfixbug\n\nMasterDevelopment\n\n****\n\n\"\"\nDevelopmentDevelopment\n\nfeature-*\n\n\n```bash\ngit checkout -b feature-x development\n```\n\ndevelopment\n\n```bash\ngit checkout development\ngit merge --no-ff feature-x\n```\n\nfeature\n\n```bash\ngit branch -d feature-x\n```\n\n**2.2.3.5 **\n\nMaster\nDevelopmentDevelopmentMasterrelease-*\n\n\n```bash\ngit checkout -b release-1.0.0 development\n```\n\nmaster\n\n```bash\ngit checkout master\ngit merge --no-ff release-1.0.0\n# \ngit tag -a 1.0.0\n```\n\ndevelopment\n\n```bash\ngit checkout development\ngit merge --no-ff release-1.0.0\n```\n\n\n\n```bash\ngit branch -d release-1.0.0\n```\n\n**bug**\n\nbugbugbug\nbugMasterMasterDevelopmentfixbug-*\n\nbug\n\n```bash\ngit checkout -b fixbug-0.1 master\n```\n\nmaster\n\n```bash\ngit checkout master\ngit merge --no-ff fixbug-0.1\ngit tag -a 0.1.1\n```\n\ndevelopment\n\n```bash\ngit checkout development\ngit merge --no-ff fixbug-0.1\n```\n\n\"bug\"\n\n```bash\ngit branch -d fixbug-0.1\n```\n\n****\n\nmaster\b\b abc-xxx\n master abc-xxxabc\b, xxx\n\n\n\n```bash\ngit checkout -b abc-1.0.0 master\n```\n\n\b\b\n","source":"_posts/doc-dev/basics/git.md","raw":"---\ntitle: 2 GIT \ndate: 2018-02-20\n---\n\n## 2.1 \n\n\"\"Version Control System\n\"\"Git\n\n![](https://git-scm.com/images/logos/logomark-orange@2x.png)\n\nGitbranchmergeGit\"\"\n\n\n![](https://git-scm.com/images/branching-illustration@2x.png)\n\nVincent DriessenGitGit\n\n## 2.2 Git \n\n[Git ](https://github.com/git-for-windows/git/releases/download/v2.20.1.windows.1/Git-2.20.1-64-bit.exe)\n\n\n\n## 2.3 Git \n\n`https://gitlab.sissyun.com.cn` Gitlab\n\n## 2.4 \n\n,  \n\n\n* name\n* usernamezhangsan\n* zhang.san@ssi.com.\n\n8pA5wOldyGitlab\n\n![](/assets/gitlab-register.png)\n\n## 2.5 \n\n\n\n Gitlab ,\n\n## 2.6 \n\nwindowsgit bashsshgit, ssh-keygengitssh-keygen\n\n```bash\nssh-keygen -trsa -C \"zhang.san@ssi.com\"\ngit config --global user.name\"Zhang San\"\ngit config --global user.email\"zhang.san@ssi.com\"\n```\n\n### 2.7 \n\ngitlab Profile Settings > \n\n![](img/gitlab_settings.png)\n\n`rsa` \n\n```bash\nssh-keygen -t rsa -C \"youname@ssi.com\"\n```\n\n\b\n\n git bashssh\n\n* Windowsc:\\Users\\yourname\\.ssh\\id_rsa.pub; \n* Linux/Mac: ~/.ssh/id_rsa.pub\n\n```bash\n\ncat ~/.ssh/id_rsa.pub\n```\n\n![ssh_key](img/gitlab_profile_keys_new.png)\n\n### 2.8 Git\n\n\n\n```bash\ngit clonessh://git@gitlab.sissyun.com.cn:8022/frameworks/spring-boot-utils.git\n```\n\n### 2.9 Git \b\n\n\n\ngit\n\n****\n\n demo\n\n```bash\ngit checkout -b demo\n```\n\n****\n\n```bash\ngit branch a\n```\n\n****\n\n\n\n```bash\ngit status\n```\n\n****\n feature \n\n```bash\ngit add .\n\ngit status\n\ngit commit\n\n(press i to input below text)\n\n[Description]: Your comments.\n\n[Reviewer]: The name of reviewer\n\n(press esc and :wq to commit )\n```\n\n\n\n```bash\ngit push origin demo\n```\n\n**master**\n\n\n\nGitmaster\n\n**development**\n\ndevelopment, featuredevelopmentfeature\n\nnightlyMasterDevelopment\"\"merge\nGitDevelopment\n\n```bash\ngit checkout -b development\n```\n\nDevelopmentMaster\n\n```bash\n# Master\ngit checkout master\n\n# Development\ngit merge --no-ff development\n```\n\n--no-ffGit\"\"fast-farward mergeMasterDevelop\n\n--no-ffMasterBenjamin SandofskyUnderstanding the Git Workflow\n\n****\n\nMasterDevelopment\n\n\n* feature\n* release\n* bugfixbug\n\nMasterDevelopment\n\n****\n\n\"\"\nDevelopmentDevelopment\n\nfeature-*\n\n\n```bash\ngit checkout -b feature-x development\n```\n\ndevelopment\n\n```bash\ngit checkout development\ngit merge --no-ff feature-x\n```\n\nfeature\n\n```bash\ngit branch -d feature-x\n```\n\n**2.2.3.5 **\n\nMaster\nDevelopmentDevelopmentMasterrelease-*\n\n\n```bash\ngit checkout -b release-1.0.0 development\n```\n\nmaster\n\n```bash\ngit checkout master\ngit merge --no-ff release-1.0.0\n# \ngit tag -a 1.0.0\n```\n\ndevelopment\n\n```bash\ngit checkout development\ngit merge --no-ff release-1.0.0\n```\n\n\n\n```bash\ngit branch -d release-1.0.0\n```\n\n**bug**\n\nbugbugbug\nbugMasterMasterDevelopmentfixbug-*\n\nbug\n\n```bash\ngit checkout -b fixbug-0.1 master\n```\n\nmaster\n\n```bash\ngit checkout master\ngit merge --no-ff fixbug-0.1\ngit tag -a 0.1.1\n```\n\ndevelopment\n\n```bash\ngit checkout development\ngit merge --no-ff fixbug-0.1\n```\n\n\"bug\"\n\n```bash\ngit branch -d fixbug-0.1\n```\n\n****\n\nmaster\b\b abc-xxx\n master abc-xxxabc\b, xxx\n\n\n\n```bash\ngit checkout -b abc-1.0.0 master\n```\n\n\b\b\n","slug":"doc-dev/basics/git","published":1,"updated":"2021-03-09T14:24:00.617Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0d60018smjraujafzoa","content":"<h2 id=\"2-1-\"><a href=\"#2-1-\" class=\"headerlink\" title=\"2.1 \"></a>2.1 </h2><p>Version Control System<br>Git</p>\n<p><img src=\"https://git-scm.com/images/logos/logomark-orange@2x.png\"></p>\n<p>GitbranchmergeGit<br></p>\n<p><img src=\"https://git-scm.com/images/branching-illustration@2x.png\"></p>\n<p>Vincent DriessenGitGit</p>\n<h2 id=\"2-2-Git-\"><a href=\"#2-2-Git-\" class=\"headerlink\" title=\"2.2 Git \"></a>2.2 Git </h2><p><a class=\"link\" href=\"https://github.com/git-for-windows/git/releases/download/v2.20.1.windows.1/Git-2.20.1-64-bit.exe\">Git <i class=\"fas fa-external-link-alt\"></i></a></p>\n<p></p>\n<h2 id=\"2-3-Git-\"><a href=\"#2-3-Git-\" class=\"headerlink\" title=\"2.3 Git \"></a>2.3 Git </h2><p><code>https://gitlab.sissyun.com.cn</code> Gitlab</p>\n<h2 id=\"2-4-\"><a href=\"#2-4-\" class=\"headerlink\" title=\"2.4 \"></a>2.4 </h2><p>,  <br></p>\n<ul>\n<li>name</li>\n<li>usernamezhangsan</li>\n<li><a class=\"link\" href=\"mailto:&#122;&#x68;&#97;&#110;&#x67;&#x2e;&#115;&#x61;&#110;&#64;&#115;&#x73;&#x69;&#46;&#99;&#x6f;&#109;\">&#122;&#x68;&#97;&#110;&#x67;&#x2e;&#115;&#x61;&#110;&#64;&#115;&#x73;&#x69;&#46;&#99;&#x6f;&#109;<i class=\"fas fa-external-link-alt\"></i></a>.</li>\n</ul>\n<p>8pA5wOldyGitlab</p>\n<p><img src=\"/2018/02/20/doc-dev/basics/git/gitlab-register.png\"></p>\n<h2 id=\"2-5-\"><a href=\"#2-5-\" class=\"headerlink\" title=\"2.5 \"></a>2.5 </h2><p></p>\n<p> Gitlab ,</p>\n<h2 id=\"2-6-\"><a href=\"#2-6-\" class=\"headerlink\" title=\"2.6 \"></a>2.6 </h2><p>windowsgit bashsshgit, ssh-keygengitssh-keygen</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -trsa -C <span class=\"string\">&quot;zhang.san@ssi.com&quot;</span></span><br><span class=\"line\">git config --global user.name<span class=\"string\">&quot;Zhang San&quot;</span></span><br><span class=\"line\">git config --global user.email<span class=\"string\">&quot;zhang.san@ssi.com&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-7-\"><a href=\"#2-7-\" class=\"headerlink\" title=\"2.7 \"></a>2.7 </h3><p>gitlab Profile Settings &gt; </p>\n<p><img src=\"/2018/02/20/doc-dev/basics/git/gitlab_settings.png\"></p>\n<p><code>rsa</code> </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C <span class=\"string\">&quot;youname@ssi.com&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>\b</p>\n<p> git bashssh</p>\n<ul>\n<li>Windowsc:\\Users\\yourname.ssh\\id_rsa.pub; </li>\n<li>Linux/Mac: ~/.ssh/id_rsa.pub</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">cat ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2018/02/20/doc-dev/basics/git/gitlab_profile_keys_new.png\" alt=\"ssh_key\"></p>\n<h3 id=\"2-8-Git\"><a href=\"#2-8-Git\" class=\"headerlink\" title=\"2.8 Git\"></a>2.8 Git</h3><p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span>ssh://git@gitlab.sissyun.com.cn:8022/frameworks/spring-boot-utils.git</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-9-Git-\"><a href=\"#2-9-Git-\" class=\"headerlink\" title=\"2.9 Git \b\"></a>2.9 Git \b</h3><p></p>\n<p>git</p>\n<p><strong></strong></p>\n<p> demo</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b demo</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch a</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong></p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git status</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong><br> feature </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br><span class=\"line\"></span><br><span class=\"line\">git status</span><br><span class=\"line\"></span><br><span class=\"line\">git commit</span><br><span class=\"line\"></span><br><span class=\"line\">(press i to input below text)</span><br><span class=\"line\"></span><br><span class=\"line\">[Description]: Your comments.</span><br><span class=\"line\"></span><br><span class=\"line\">[Reviewer]: The name of reviewer</span><br><span class=\"line\"></span><br><span class=\"line\">(press esc and :wq to commit )</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin demo</span><br></pre></td></tr></table></figure>\n\n<p><strong>master</strong></p>\n<p></p>\n<p>Gitmaster</p>\n<p><strong>development</strong></p>\n<p>development, featuredevelopmentfeature</p>\n<p>nightlyMasterDevelopmentmerge<br>GitDevelopment</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b development</span><br></pre></td></tr></table></figure>\n\n<p>DevelopmentMaster</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Master</span></span><br><span class=\"line\">git checkout master</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Development</span></span><br><span class=\"line\">git merge --no-ff development</span><br></pre></td></tr></table></figure>\n\n<p>no-ffGitfast-farward mergeMasterDevelop</p>\n<p>no-ffMasterBenjamin SandofskyUnderstanding the Git Workflow</p>\n<p><strong></strong></p>\n<p>MasterDevelopment<br></p>\n<ul>\n<li>feature</li>\n<li>release</li>\n<li>bugfixbug</li>\n</ul>\n<p>MasterDevelopment</p>\n<p><strong></strong></p>\n<p><br>DevelopmentDevelopment</p>\n<p>feature-*<br></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b feature-x development</span><br></pre></td></tr></table></figure>\n\n<p>development</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout development</span><br><span class=\"line\">git merge --no-ff feature-x</span><br></pre></td></tr></table></figure>\n\n<p>feature</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -d feature-x</span><br></pre></td></tr></table></figure>\n\n<p><strong>2.2.3.5 </strong></p>\n<p>Master<br>DevelopmentDevelopmentMasterrelease-*<br></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b release-1.0.0 development</span><br></pre></td></tr></table></figure>\n\n<p>master</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout master</span><br><span class=\"line\">git merge --no-ff release-1.0.0</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git tag -a 1.0.0</span><br></pre></td></tr></table></figure>\n\n<p>development</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout development</span><br><span class=\"line\">git merge --no-ff release-1.0.0</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -d release-1.0.0</span><br></pre></td></tr></table></figure>\n\n<p><strong>bug</strong></p>\n<p>bugbugbug<br>bugMasterMasterDevelopmentfixbug-*</p>\n<p>bug</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b fixbug-0.1 master</span><br></pre></td></tr></table></figure>\n\n<p>master</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout master</span><br><span class=\"line\">git merge --no-ff fixbug-0.1</span><br><span class=\"line\">git tag -a 0.1.1</span><br></pre></td></tr></table></figure>\n\n<p>development</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout development</span><br><span class=\"line\">git merge --no-ff fixbug-0.1</span><br></pre></td></tr></table></figure>\n\n<p>bug</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -d fixbug-0.1</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong></p>\n<p>master\b\b abc-xxx<br> master abc-xxxabc\b, xxx</p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b abc-1.0.0 master</span><br></pre></td></tr></table></figure>\n\n<p>\b\b</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"2-1-\"><a href=\"#2-1-\" class=\"headerlink\" title=\"2.1 \"></a>2.1 </h2><p>Version Control System<br>Git</p>\n<p><img src=\"https://git-scm.com/images/logos/logomark-orange@2x.png\"></p>\n<p>GitbranchmergeGit<br></p>\n<p><img src=\"https://git-scm.com/images/branching-illustration@2x.png\"></p>\n<p>Vincent DriessenGitGit</p>\n<h2 id=\"2-2-Git-\"><a href=\"#2-2-Git-\" class=\"headerlink\" title=\"2.2 Git \"></a>2.2 Git </h2><p><a class=\"link\" href=\"https://github.com/git-for-windows/git/releases/download/v2.20.1.windows.1/Git-2.20.1-64-bit.exe\">Git <i class=\"fas fa-external-link-alt\"></i></a></p>\n<p></p>\n<h2 id=\"2-3-Git-\"><a href=\"#2-3-Git-\" class=\"headerlink\" title=\"2.3 Git \"></a>2.3 Git </h2><p><code>https://gitlab.sissyun.com.cn</code> Gitlab</p>\n<h2 id=\"2-4-\"><a href=\"#2-4-\" class=\"headerlink\" title=\"2.4 \"></a>2.4 </h2><p>,  <br></p>\n<ul>\n<li>name</li>\n<li>usernamezhangsan</li>\n<li><a class=\"link\" href=\"mailto:&#122;&#x68;&#97;&#110;&#x67;&#x2e;&#115;&#x61;&#110;&#64;&#115;&#x73;&#x69;&#46;&#99;&#x6f;&#109;\">&#122;&#x68;&#97;&#110;&#x67;&#x2e;&#115;&#x61;&#110;&#64;&#115;&#x73;&#x69;&#46;&#99;&#x6f;&#109;<i class=\"fas fa-external-link-alt\"></i></a>.</li>\n</ul>\n<p>8pA5wOldyGitlab</p>\n<p><img src=\"/2018/02/20/doc-dev/basics/git/gitlab-register.png\"></p>\n<h2 id=\"2-5-\"><a href=\"#2-5-\" class=\"headerlink\" title=\"2.5 \"></a>2.5 </h2><p></p>\n<p> Gitlab ,</p>\n<h2 id=\"2-6-\"><a href=\"#2-6-\" class=\"headerlink\" title=\"2.6 \"></a>2.6 </h2><p>windowsgit bashsshgit, ssh-keygengitssh-keygen</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -trsa -C <span class=\"string\">&quot;zhang.san@ssi.com&quot;</span></span><br><span class=\"line\">git config --global user.name<span class=\"string\">&quot;Zhang San&quot;</span></span><br><span class=\"line\">git config --global user.email<span class=\"string\">&quot;zhang.san@ssi.com&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-7-\"><a href=\"#2-7-\" class=\"headerlink\" title=\"2.7 \"></a>2.7 </h3><p>gitlab Profile Settings &gt; </p>\n<p><img src=\"/2018/02/20/doc-dev/basics/git/gitlab_settings.png\"></p>\n<p><code>rsa</code> </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C <span class=\"string\">&quot;youname@ssi.com&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>\b</p>\n<p> git bashssh</p>\n<ul>\n<li>Windowsc:\\Users\\yourname.ssh\\id_rsa.pub; </li>\n<li>Linux/Mac: ~/.ssh/id_rsa.pub</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">cat ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2018/02/20/doc-dev/basics/git/gitlab_profile_keys_new.png\" alt=\"ssh_key\"></p>\n<h3 id=\"2-8-Git\"><a href=\"#2-8-Git\" class=\"headerlink\" title=\"2.8 Git\"></a>2.8 Git</h3><p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span>ssh://git@gitlab.sissyun.com.cn:8022/frameworks/spring-boot-utils.git</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-9-Git-\"><a href=\"#2-9-Git-\" class=\"headerlink\" title=\"2.9 Git \b\"></a>2.9 Git \b</h3><p></p>\n<p>git</p>\n<p><strong></strong></p>\n<p> demo</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b demo</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch a</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong></p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git status</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong><br> feature </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git add .</span><br><span class=\"line\"></span><br><span class=\"line\">git status</span><br><span class=\"line\"></span><br><span class=\"line\">git commit</span><br><span class=\"line\"></span><br><span class=\"line\">(press i to input below text)</span><br><span class=\"line\"></span><br><span class=\"line\">[Description]: Your comments.</span><br><span class=\"line\"></span><br><span class=\"line\">[Reviewer]: The name of reviewer</span><br><span class=\"line\"></span><br><span class=\"line\">(press esc and :wq to commit )</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push origin demo</span><br></pre></td></tr></table></figure>\n\n<p><strong>master</strong></p>\n<p></p>\n<p>Gitmaster</p>\n<p><strong>development</strong></p>\n<p>development, featuredevelopmentfeature</p>\n<p>nightlyMasterDevelopmentmerge<br>GitDevelopment</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b development</span><br></pre></td></tr></table></figure>\n\n<p>DevelopmentMaster</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Master</span></span><br><span class=\"line\">git checkout master</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Development</span></span><br><span class=\"line\">git merge --no-ff development</span><br></pre></td></tr></table></figure>\n\n<p>no-ffGitfast-farward mergeMasterDevelop</p>\n<p>no-ffMasterBenjamin SandofskyUnderstanding the Git Workflow</p>\n<p><strong></strong></p>\n<p>MasterDevelopment<br></p>\n<ul>\n<li>feature</li>\n<li>release</li>\n<li>bugfixbug</li>\n</ul>\n<p>MasterDevelopment</p>\n<p><strong></strong></p>\n<p><br>DevelopmentDevelopment</p>\n<p>feature-*<br></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b feature-x development</span><br></pre></td></tr></table></figure>\n\n<p>development</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout development</span><br><span class=\"line\">git merge --no-ff feature-x</span><br></pre></td></tr></table></figure>\n\n<p>feature</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -d feature-x</span><br></pre></td></tr></table></figure>\n\n<p><strong>2.2.3.5 </strong></p>\n<p>Master<br>DevelopmentDevelopmentMasterrelease-*<br></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b release-1.0.0 development</span><br></pre></td></tr></table></figure>\n\n<p>master</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout master</span><br><span class=\"line\">git merge --no-ff release-1.0.0</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">git tag -a 1.0.0</span><br></pre></td></tr></table></figure>\n\n<p>development</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout development</span><br><span class=\"line\">git merge --no-ff release-1.0.0</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -d release-1.0.0</span><br></pre></td></tr></table></figure>\n\n<p><strong>bug</strong></p>\n<p>bugbugbug<br>bugMasterMasterDevelopmentfixbug-*</p>\n<p>bug</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b fixbug-0.1 master</span><br></pre></td></tr></table></figure>\n\n<p>master</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout master</span><br><span class=\"line\">git merge --no-ff fixbug-0.1</span><br><span class=\"line\">git tag -a 0.1.1</span><br></pre></td></tr></table></figure>\n\n<p>development</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout development</span><br><span class=\"line\">git merge --no-ff fixbug-0.1</span><br></pre></td></tr></table></figure>\n\n<p>bug</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git branch -d fixbug-0.1</span><br></pre></td></tr></table></figure>\n\n<p><strong></strong></p>\n<p>master\b\b abc-xxx<br> master abc-xxxabc\b, xxx</p>\n<p></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git checkout -b abc-1.0.0 master</span><br></pre></td></tr></table></figure>\n\n<p>\b\b</p>\n"},{"title":"GRPC","date":"2018-02-19T16:00:00.000Z","_content":"\n## \n\ngrpc  google ,(RPC)RPCHTTP/2\nCJavaGogrpcgrpc-javagrpc-go\ngRPCHTTP/2TCP\n\n![grpc-img](https://img-blog.csdn.net/20171019113619182?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveHVkdW9ydWk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\n## grpc\n\n`java` SpringBoot  grpc\n\n### \n\n|.proto|Java |C++||\n|---|---|---|---|---|\n|double|double|double||\n|float|float|float||\n|int32|int|int32|sint32|\n|int64|long|int64|sint64|\n|uint32|int[1]|uint32|Uses variable-length encoding.|\n|uint64|long[1]|uint64|Uses variable-length encoding.|\n|sint32|int|int32|int32|\n|sint64|long|int64|int64|\n|fixed32|int[1]|uint32|4228uint32|\n|fixed64|long[1]|uint64|8256uint64|\n|sfixed32|int|int32|4|\n|sfixed64|long|int64|8|\n|bool|boolean|bool||\n|string|String|string|UTF-87-bit ASCII|\n|bytes|ByteString|string||\n\n### \n\n`ideal``springboot`\n\n![New-Project](img/NewProject.png)\n\n `` ``\n\n![project-metadata](img/ProjectMetadata.png)\n\n### \n\n  pom.xml\n\n```xml\n<!--  -->\n    <parent>\n        <groupId>cn.com.siss</groupId>\n        <artifactId>spring-boot-starters</artifactId>\n        <version>0.0.1-SNAPSHOT</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n\n    <groupId>cn.com.siss</groupId>\n    <artifactId>demo-grpc</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>demo-grpc</name>\n\n     <!-- packaging  pom -->\n    <packaging>pom</packaging>\n\n    <!--  -->\n    <modules>\n        <module>demo-api</module>\n        <module>demo-provider</module>\n        <module>demo-web</module>\n    </modules>\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>cn.com.siss</groupId>\n            <artifactId>spring-boot-starter-grpc</artifactId>\n            <version>0.0.1-SNAPSHOT</version>\n        </dependency>\n        <dependency>\n            <groupId>cn.com.siss.utils</groupId>\n            <artifactId>siss-utils</artifactId>\n            <version>0.0.1-SNAPSHOT</version>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n```\n\n\n\n`demo-api` `` `proto`\n\n![demo-api](img/demo-api.png)\n\n `demo-api`  pom.xml\n\n```xml\n<!-- parent -->\n    <parent>\n        <groupId>cn.com.siss</groupId>\n        <artifactId>demo-grpc</artifactId>\n        <version>0.0.1-SNAPSHOT</version>\n    </parent>\n<!--  -->\n        <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n<!--  -->\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <classifier>exec</classifier>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.xolstice.maven.plugins</groupId>\n                <artifactId>protobuf-maven-plugin</artifactId>\n            </plugin>\n            <plugin>\n                <groupId>org.sonarsource.scanner.maven</groupId>\n                <artifactId>sonar-maven-plugin</artifactId>\n            </plugin>\n            <plugin>\n                <groupId>org.jacoco</groupId>\n                <artifactId>jacoco-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n```\n\n`demo-web` \n\napi\n\n```java\n@RestController\npublic class HelloWorld {\n\n    @Autowired\n    private HelloRpcService helloRpcService;\n\n    @RequestMapping(value = \"/\", method = RequestMethod.GET)\n    public String get(){\n        System.out.println(\"controller get method\");\n        String b = helloRpcService.get(\"qq\");\n        return b;\n    }\n}\n```\n\nrpcjavaproto\n\n```java\n@Service\n@Slf4j\n@AllArgsConstructor\npublic class HelloRpcService {\n    private HelloServiceGrpc.HelloServiceBlockingStub blockingStub;\n\n    public String get(String name) {\n        Hello hello = new Hello();\n        hello.setName(name);\n        HelloProto.HelloDTO dto = (HelloProto.HelloDTO) toGRpcMessage(hello, HelloProto.HelloDTO.newBuilder());\n        HelloProto.HelloDTO rep = blockingStub.get(dto);\n        String say = (String) fromGRpcMessage(rep, String.class);\n        return say;\n    }\n}\n```\n\n`protobuf`\n\n```protobuf\nsyntax = \"proto3\";\n\noption java_package = \"cn.com.siss.api\";\noption java_outer_classname = \"HelloProto\";\n\nmessage HelloDTO {\n    string name = 1;\n}\n\nservice HelloService {\n    rpc get (HelloDTO) returns (HelloDTO) {}\n}\n```\n\n`config`\n\n```java\n@Configuration\n@EnableAutoConfiguration\npublic class HelloConfig {\n\n    @GRpcClient(\"demo-provider\")\n    private ManagedChannel channel;\n\n    @Bean\n    public HelloServiceGrpc.HelloServiceBlockingStub helloServiceBlockingStub(){\n        return HelloServiceGrpc.newBlockingStub(channel);\n    }\n}\n```\n\napplication.yml\n\n```yaml\ngrpc:\n  client:\n    demo-provider:\n      server-host: localhost\n      server-port: 7575\n      enable-keep-alive: true\n      keep-alive-delay: 60 # seconds\n      keep-alive-timeOut: 60\n```\n\n`demo-provider` \n\npom\n\n```xml\n\n    <parent>\n        <groupId>cn.com.siss</groupId>\n        <artifactId>demo-grpc</artifactId>\n        <version>0.0.1-SNAPSHOT</version>\n    </parent>\n    <!--  -->\n        <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>cn.com.siss</groupId>\n            <artifactId>demo-api</artifactId>\n            <version>0.0.1-SNAPSHOT</version>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n\n```\n\nrpc\n\n```java\n@Slf4j\n@GRpcService\npublic class HelloRpc extends HelloServiceGrpc.HelloServiceImplBase {\n\n    @Override\n    public void get(HelloProto.HelloDTO request,\n                    StreamObserver<HelloProto.HelloDTO> responseObserver) {\n        HelloProto.HelloDTO response = (HelloProto.HelloDTO) toGRpcMessage(request, HelloProto.HelloDTO.newBuilder());\n        responseObserver.onNext(response);\n        responseObserver.onCompleted();\n    }\n\n}\n```\n\ndemo debug\n\n```bash\ngit clone ssh://git@gitlab.sissyun.com.cn:8022/demo/demo-grpc.git\n```","source":"_posts/doc-dev/basics/grpc.md","raw":"---\ntitle:  GRPC\ndate: 2018-02-20\n\n---\n\n## \n\ngrpc  google ,(RPC)RPCHTTP/2\nCJavaGogrpcgrpc-javagrpc-go\ngRPCHTTP/2TCP\n\n![grpc-img](https://img-blog.csdn.net/20171019113619182?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveHVkdW9ydWk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)\n\n## grpc\n\n`java` SpringBoot  grpc\n\n### \n\n|.proto|Java |C++||\n|---|---|---|---|---|\n|double|double|double||\n|float|float|float||\n|int32|int|int32|sint32|\n|int64|long|int64|sint64|\n|uint32|int[1]|uint32|Uses variable-length encoding.|\n|uint64|long[1]|uint64|Uses variable-length encoding.|\n|sint32|int|int32|int32|\n|sint64|long|int64|int64|\n|fixed32|int[1]|uint32|4228uint32|\n|fixed64|long[1]|uint64|8256uint64|\n|sfixed32|int|int32|4|\n|sfixed64|long|int64|8|\n|bool|boolean|bool||\n|string|String|string|UTF-87-bit ASCII|\n|bytes|ByteString|string||\n\n### \n\n`ideal``springboot`\n\n![New-Project](img/NewProject.png)\n\n `` ``\n\n![project-metadata](img/ProjectMetadata.png)\n\n### \n\n  pom.xml\n\n```xml\n<!--  -->\n    <parent>\n        <groupId>cn.com.siss</groupId>\n        <artifactId>spring-boot-starters</artifactId>\n        <version>0.0.1-SNAPSHOT</version>\n        <relativePath/> <!-- lookup parent from repository -->\n    </parent>\n\n    <groupId>cn.com.siss</groupId>\n    <artifactId>demo-grpc</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>demo-grpc</name>\n\n     <!-- packaging  pom -->\n    <packaging>pom</packaging>\n\n    <!--  -->\n    <modules>\n        <module>demo-api</module>\n        <module>demo-provider</module>\n        <module>demo-web</module>\n    </modules>\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>cn.com.siss</groupId>\n            <artifactId>spring-boot-starter-grpc</artifactId>\n            <version>0.0.1-SNAPSHOT</version>\n        </dependency>\n        <dependency>\n            <groupId>cn.com.siss.utils</groupId>\n            <artifactId>siss-utils</artifactId>\n            <version>0.0.1-SNAPSHOT</version>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n```\n\n\n\n`demo-api` `` `proto`\n\n![demo-api](img/demo-api.png)\n\n `demo-api`  pom.xml\n\n```xml\n<!-- parent -->\n    <parent>\n        <groupId>cn.com.siss</groupId>\n        <artifactId>demo-grpc</artifactId>\n        <version>0.0.1-SNAPSHOT</version>\n    </parent>\n<!--  -->\n        <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n    </dependencies>\n\n<!--  -->\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <configuration>\n                    <classifier>exec</classifier>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.xolstice.maven.plugins</groupId>\n                <artifactId>protobuf-maven-plugin</artifactId>\n            </plugin>\n            <plugin>\n                <groupId>org.sonarsource.scanner.maven</groupId>\n                <artifactId>sonar-maven-plugin</artifactId>\n            </plugin>\n            <plugin>\n                <groupId>org.jacoco</groupId>\n                <artifactId>jacoco-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n```\n\n`demo-web` \n\napi\n\n```java\n@RestController\npublic class HelloWorld {\n\n    @Autowired\n    private HelloRpcService helloRpcService;\n\n    @RequestMapping(value = \"/\", method = RequestMethod.GET)\n    public String get(){\n        System.out.println(\"controller get method\");\n        String b = helloRpcService.get(\"qq\");\n        return b;\n    }\n}\n```\n\nrpcjavaproto\n\n```java\n@Service\n@Slf4j\n@AllArgsConstructor\npublic class HelloRpcService {\n    private HelloServiceGrpc.HelloServiceBlockingStub blockingStub;\n\n    public String get(String name) {\n        Hello hello = new Hello();\n        hello.setName(name);\n        HelloProto.HelloDTO dto = (HelloProto.HelloDTO) toGRpcMessage(hello, HelloProto.HelloDTO.newBuilder());\n        HelloProto.HelloDTO rep = blockingStub.get(dto);\n        String say = (String) fromGRpcMessage(rep, String.class);\n        return say;\n    }\n}\n```\n\n`protobuf`\n\n```protobuf\nsyntax = \"proto3\";\n\noption java_package = \"cn.com.siss.api\";\noption java_outer_classname = \"HelloProto\";\n\nmessage HelloDTO {\n    string name = 1;\n}\n\nservice HelloService {\n    rpc get (HelloDTO) returns (HelloDTO) {}\n}\n```\n\n`config`\n\n```java\n@Configuration\n@EnableAutoConfiguration\npublic class HelloConfig {\n\n    @GRpcClient(\"demo-provider\")\n    private ManagedChannel channel;\n\n    @Bean\n    public HelloServiceGrpc.HelloServiceBlockingStub helloServiceBlockingStub(){\n        return HelloServiceGrpc.newBlockingStub(channel);\n    }\n}\n```\n\napplication.yml\n\n```yaml\ngrpc:\n  client:\n    demo-provider:\n      server-host: localhost\n      server-port: 7575\n      enable-keep-alive: true\n      keep-alive-delay: 60 # seconds\n      keep-alive-timeOut: 60\n```\n\n`demo-provider` \n\npom\n\n```xml\n\n    <parent>\n        <groupId>cn.com.siss</groupId>\n        <artifactId>demo-grpc</artifactId>\n        <version>0.0.1-SNAPSHOT</version>\n    </parent>\n    <!--  -->\n        <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-test</artifactId>\n            <scope>test</scope>\n        </dependency>\n        <dependency>\n            <groupId>cn.com.siss</groupId>\n            <artifactId>demo-api</artifactId>\n            <version>0.0.1-SNAPSHOT</version>\n        </dependency>\n    </dependencies>\n\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n\n```\n\nrpc\n\n```java\n@Slf4j\n@GRpcService\npublic class HelloRpc extends HelloServiceGrpc.HelloServiceImplBase {\n\n    @Override\n    public void get(HelloProto.HelloDTO request,\n                    StreamObserver<HelloProto.HelloDTO> responseObserver) {\n        HelloProto.HelloDTO response = (HelloProto.HelloDTO) toGRpcMessage(request, HelloProto.HelloDTO.newBuilder());\n        responseObserver.onNext(response);\n        responseObserver.onCompleted();\n    }\n\n}\n```\n\ndemo debug\n\n```bash\ngit clone ssh://git@gitlab.sissyun.com.cn:8022/demo/demo-grpc.git\n```","slug":"doc-dev/basics/grpc","published":1,"updated":"2021-03-09T14:24:06.656Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0d7001asmjr6o8p02gn","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>grpc  google ,(RPC)RPCHTTP/2<br>CJavaGogrpcgrpc-javagrpc-go<br>gRPCHTTP/2TCP</p>\n<p><img src=\"https://img-blog.csdn.net/20171019113619182?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveHVkdW9ydWk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"grpc-img\"></p>\n<h2 id=\"grpc\"><a href=\"#grpc\" class=\"headerlink\" title=\"grpc\"></a>grpc</h2><p><code>java</code> SpringBoot  grpc</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>|.proto|Java |C++||<br>||||||<br>|double|double|double||<br>|float|float|float||<br>|int32|int|int32|sint32|<br>|int64|long|int64|sint64|<br>|uint32|int[1]|uint32|Uses variable-length encoding.|<br>|uint64|long[1]|uint64|Uses variable-length encoding.|<br>|sint32|int|int32|int32|<br>|sint64|long|int64|int64|<br>|fixed32|int[1]|uint32|4228uint32|<br>|fixed64|long[1]|uint64|8256uint64|<br>|sfixed32|int|int32|4|<br>|sfixed64|long|int64|8|<br>|bool|boolean|bool||<br>|string|String|string|UTF-87-bit ASCII|<br>|bytes|ByteString|string||</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>ideal</code><code>springboot</code></p>\n<p><img src=\"/2018/02/20/doc-dev/basics/grpc/NewProject.png\" alt=\"New-Project\"></p>\n<p> <code></code> <code></code></p>\n<p><img src=\"/2018/02/20/doc-dev/basics/grpc/ProjectMetadata.png\" alt=\"project-metadata\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>  pom.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starters<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-grpc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>demo-grpc<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">&lt;!-- packaging  pom --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>demo-api<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>demo-provider<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>demo-web<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-grpc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss.utils<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>siss-utils<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><code>demo-api</code> <code></code> <code>proto</code></p>\n<p><img src=\"/2018/02/20/doc-dev/basics/grpc/demo-api.png\" alt=\"demo-api\"></p>\n<p> <code>demo-api</code>  pom.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- parent --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-grpc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">classifier</span>&gt;</span>exec<span class=\"tag\">&lt;/<span class=\"name\">classifier</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.xolstice.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>protobuf-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.sonarsource.scanner.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sonar-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.jacoco<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jacoco-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>demo-web</code> </p>\n<p>api</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloWorld</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> HelloRpcService helloRpcService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(value = &quot;/&quot;, method = RequestMethod.GET)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">get</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;controller get method&quot;</span>);</span><br><span class=\"line\">        String b = helloRpcService.get(<span class=\"string\">&quot;qq&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>rpcjavaproto</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloRpcService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> HelloServiceGrpc.HelloServiceBlockingStub blockingStub;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">get</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\">        Hello hello = <span class=\"keyword\">new</span> Hello();</span><br><span class=\"line\">        hello.setName(name);</span><br><span class=\"line\">        HelloProto.HelloDTO dto = (HelloProto.HelloDTO) toGRpcMessage(hello, HelloProto.HelloDTO.newBuilder());</span><br><span class=\"line\">        HelloProto.HelloDTO rep = blockingStub.get(dto);</span><br><span class=\"line\">        String say = (String) fromGRpcMessage(rep, String.class);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> say;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>protobuf</code></p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">syntax = <span class=\"string\">&quot;proto3&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">option</span> java_package = <span class=\"string\">&quot;cn.com.siss.api&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">option</span> java_outer_classname = <span class=\"string\">&quot;HelloProto&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">message</span> <span class=\"title\">HelloDTO</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">string</span> name = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">service</span> <span class=\"title\">HelloService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">rpc</span> get (HelloDTO) <span class=\"keyword\">returns</span> (HelloDTO) </span>&#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>config</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableAutoConfiguration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloConfig</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GRpcClient(&quot;demo-provider&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ManagedChannel channel;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> HelloServiceGrpc.<span class=\"function\">HelloServiceBlockingStub <span class=\"title\">helloServiceBlockingStub</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> HelloServiceGrpc.newBlockingStub(channel);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>application.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">grpc:</span></span><br><span class=\"line\">  <span class=\"attr\">client:</span></span><br><span class=\"line\">    <span class=\"attr\">demo-provider:</span></span><br><span class=\"line\">      <span class=\"attr\">server-host:</span> <span class=\"string\">localhost</span></span><br><span class=\"line\">      <span class=\"attr\">server-port:</span> <span class=\"number\">7575</span></span><br><span class=\"line\">      <span class=\"attr\">enable-keep-alive:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">keep-alive-delay:</span> <span class=\"number\">60</span> <span class=\"comment\"># seconds</span></span><br><span class=\"line\">      <span class=\"attr\">keep-alive-timeOut:</span> <span class=\"number\">60</span></span><br></pre></td></tr></table></figure>\n\n<p><code>demo-provider</code> </p>\n<p>pom</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-grpc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>rpc</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@GRpcService</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloRpc</span> <span class=\"keyword\">extends</span> <span class=\"title\">HelloServiceGrpc</span>.<span class=\"title\">HelloServiceImplBase</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">get</span><span class=\"params\">(HelloProto.HelloDTO request,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                    StreamObserver&lt;HelloProto.HelloDTO&gt; responseObserver)</span> </span>&#123;</span><br><span class=\"line\">        HelloProto.HelloDTO response = (HelloProto.HelloDTO) toGRpcMessage(request, HelloProto.HelloDTO.newBuilder());</span><br><span class=\"line\">        responseObserver.onNext(response);</span><br><span class=\"line\">        responseObserver.onCompleted();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>demo debug</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> ssh://git@gitlab.sissyun.com.cn:8022/demo/demo-grpc.git</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>grpc  google ,(RPC)RPCHTTP/2<br>CJavaGogrpcgrpc-javagrpc-go<br>gRPCHTTP/2TCP</p>\n<p><img src=\"https://img-blog.csdn.net/20171019113619182?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveHVkdW9ydWk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"grpc-img\"></p>\n<h2 id=\"grpc\"><a href=\"#grpc\" class=\"headerlink\" title=\"grpc\"></a>grpc</h2><p><code>java</code> SpringBoot  grpc</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>|.proto|Java |C++||<br>||||||<br>|double|double|double||<br>|float|float|float||<br>|int32|int|int32|sint32|<br>|int64|long|int64|sint64|<br>|uint32|int[1]|uint32|Uses variable-length encoding.|<br>|uint64|long[1]|uint64|Uses variable-length encoding.|<br>|sint32|int|int32|int32|<br>|sint64|long|int64|int64|<br>|fixed32|int[1]|uint32|4228uint32|<br>|fixed64|long[1]|uint64|8256uint64|<br>|sfixed32|int|int32|4|<br>|sfixed64|long|int64|8|<br>|bool|boolean|bool||<br>|string|String|string|UTF-87-bit ASCII|<br>|bytes|ByteString|string||</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><code>ideal</code><code>springboot</code></p>\n<p><img src=\"/2018/02/20/doc-dev/basics/grpc/NewProject.png\" alt=\"New-Project\"></p>\n<p> <code></code> <code></code></p>\n<p><img src=\"/2018/02/20/doc-dev/basics/grpc/ProjectMetadata.png\" alt=\"project-metadata\"></p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>  pom.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starters<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-grpc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>demo-grpc<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"comment\">&lt;!-- packaging  pom --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>pom<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>demo-api<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>demo-provider<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>demo-web<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">modules</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-grpc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss.utils<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>siss-utils<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><code>demo-api</code> <code></code> <code>proto</code></p>\n<p><img src=\"/2018/02/20/doc-dev/basics/grpc/demo-api.png\" alt=\"demo-api\"></p>\n<p> <code>demo-api</code>  pom.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- parent --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-grpc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">classifier</span>&gt;</span>exec<span class=\"tag\">&lt;/<span class=\"name\">classifier</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.xolstice.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>protobuf-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.sonarsource.scanner.maven<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>sonar-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.jacoco<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jacoco-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>demo-web</code> </p>\n<p>api</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloWorld</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> HelloRpcService helloRpcService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(value = &quot;/&quot;, method = RequestMethod.GET)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">get</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;controller get method&quot;</span>);</span><br><span class=\"line\">        String b = helloRpcService.get(<span class=\"string\">&quot;qq&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>rpcjavaproto</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@AllArgsConstructor</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloRpcService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> HelloServiceGrpc.HelloServiceBlockingStub blockingStub;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">get</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\">        Hello hello = <span class=\"keyword\">new</span> Hello();</span><br><span class=\"line\">        hello.setName(name);</span><br><span class=\"line\">        HelloProto.HelloDTO dto = (HelloProto.HelloDTO) toGRpcMessage(hello, HelloProto.HelloDTO.newBuilder());</span><br><span class=\"line\">        HelloProto.HelloDTO rep = blockingStub.get(dto);</span><br><span class=\"line\">        String say = (String) fromGRpcMessage(rep, String.class);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> say;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>protobuf</code></p>\n<figure class=\"highlight protobuf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">syntax = <span class=\"string\">&quot;proto3&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">option</span> java_package = <span class=\"string\">&quot;cn.com.siss.api&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">option</span> java_outer_classname = <span class=\"string\">&quot;HelloProto&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">message</span> <span class=\"title\">HelloDTO</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">string</span> name = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">service</span> <span class=\"title\">HelloService</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">rpc</span> get (HelloDTO) <span class=\"keyword\">returns</span> (HelloDTO) </span>&#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>config</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableAutoConfiguration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloConfig</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GRpcClient(&quot;demo-provider&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ManagedChannel channel;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> HelloServiceGrpc.<span class=\"function\">HelloServiceBlockingStub <span class=\"title\">helloServiceBlockingStub</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> HelloServiceGrpc.newBlockingStub(channel);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>application.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">grpc:</span></span><br><span class=\"line\">  <span class=\"attr\">client:</span></span><br><span class=\"line\">    <span class=\"attr\">demo-provider:</span></span><br><span class=\"line\">      <span class=\"attr\">server-host:</span> <span class=\"string\">localhost</span></span><br><span class=\"line\">      <span class=\"attr\">server-port:</span> <span class=\"number\">7575</span></span><br><span class=\"line\">      <span class=\"attr\">enable-keep-alive:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">keep-alive-delay:</span> <span class=\"number\">60</span> <span class=\"comment\"># seconds</span></span><br><span class=\"line\">      <span class=\"attr\">keep-alive-timeOut:</span> <span class=\"number\">60</span></span><br></pre></td></tr></table></figure>\n\n<p><code>demo-provider</code> </p>\n<p>pom</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-grpc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--  --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>demo-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>rpc</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"meta\">@GRpcService</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloRpc</span> <span class=\"keyword\">extends</span> <span class=\"title\">HelloServiceGrpc</span>.<span class=\"title\">HelloServiceImplBase</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">get</span><span class=\"params\">(HelloProto.HelloDTO request,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">                    StreamObserver&lt;HelloProto.HelloDTO&gt; responseObserver)</span> </span>&#123;</span><br><span class=\"line\">        HelloProto.HelloDTO response = (HelloProto.HelloDTO) toGRpcMessage(request, HelloProto.HelloDTO.newBuilder());</span><br><span class=\"line\">        responseObserver.onNext(response);</span><br><span class=\"line\">        responseObserver.onCompleted();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>demo debug</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> ssh://git@gitlab.sissyun.com.cn:8022/demo/demo-grpc.git</span><br></pre></td></tr></table></figure>"},{"title":"SpringBoot  Kafka","date":"2018-02-19T16:00:00.000Z","_content":"\n## \n\nKafka is a distributed,partitioned,replicated commit logserviceJMSJMSkafkaTopicProducer,Consumer,kafkakafka(server)brokerkafkaproducerconsumerzookeepermeta\n\n![kafka-img](http://kafka.apache.org/images/kafka_diagram.png)\n\n## \n\n## Kafka\n\n1. Kafka2550 MB55110 MB\n2. ETLreplication\n3. producerbrokerconsumer\n4. consumerserver\n5. onlineoffline\n\n## SpringBoot Kafka\n\nkafka starter\n\n```xml\n        <dependency>\n            <groupId>cn.com.siss</groupId>\n            <artifactId>spring-boot-starter-kafka</artifactId>\n            <version>${starters.version}</version>\n        </dependency>\n```\n\nkafka\n\n```yaml\nspring:\n  profiles:\n    include:\n      - kafka\n```\n\n `kafkaTemplate` `kafkaTemplate.send(\"message\", \"hello-world\")`\n\n```java\n    @Autowired\n    private KafkaTemplate kafkaTemplate;\n\n    @RequestMapping(value = \"/sendKafka\", method = RequestMethod.GET)\n    public Object sendKafka(){\n        System.out.println(\"sendKafka\");\n        ListenableFuture result = kafkaTemplate.send(\"message\", \"hello-world\");\n        return result;\n    }\n```\n\n\n\n```java\n@Component\n@Slf4j\npublic class Hellokafka {\n\n    @KafkaListener(topics = {\"message\"})\n    public void getMessage(ConsumerRecord<?, ?> record) {\n        Optional<?> kafkaMessage = Optional.ofNullable(record.value());\n        if (kafkaMessage.isPresent()) {\n\n            Object message = kafkaMessage.get();\n\n            log.info(\"----------------- record =\" + record);\n            log.info(\"------------------ message =\" + message);\n        }\n    }\n}\n```\n\n\n\n```\nsendKafka\n2019-02-28 17:20:07.013  INFO 10477 --- [nio-8081-exec-1] o.a.k.clients.producer.ProducerConfig    : ProducerConfig values:\n2019-02-28 17:20:07.020  INFO 10477 --- [nio-8081-exec-1] o.a.k.clients.producer.ProducerConfig    : ProducerConfig values:\n2019-02-28 17:20:07.020  INFO 10477 --- [nio-8081-exec-1] o.a.kafka.common.utils.AppInfoParser     : Kafka version : 0.10.0.1\n2019-02-28 17:20:07.020  INFO 10477 --- [nio-8081-exec-1] o.a.kafka.common.utils.AppInfoParser     : Kafka commitId : a7a17cdec9eaa6c5\n2019-02-28 17:20:07.398  INFO 10477 --- [afka-listener-1] cn.com.siss.web.kafka.Hellokafka         : ----------------- record =ConsumerRecord(topic = message, partition = 0, offset = 85, CreateTime = 1551345607273, checksum = 3403921507, serialized key size = -1, serialized value size = 11, key = null, value = hello-world)\n2019-02-28 17:20:07.398  INFO 10477 --- [afka-listener-1] cn.com.siss.web.kafka.Hellokafka         : ------------------ message =hello-world\n2019-02-28 17:20:07.434  WARN 10477 --- [nio-8081-exec-2] .w.s.m.s.DefaultHandlerExceptionResolver : Failed to write HTTP message: org.springframework.http.converter.HttpMessageNotWritableException: Could not write JSON: No serializer found for class org.apache.kafka.clients.producer.ProducerRecord and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS); nested exception is com.fasterxml.jackson.databind.JsonMappingException: No serializer found for class org.apache.kafka.clients.producer.ProducerRecord and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS) (through reference chain: org.springframework.kafka.support.SendResult[\"producerRecord\"])\n```","source":"_posts/doc-dev/basics/kafka.md","raw":"---\ntitle: SpringBoot  Kafka\ndate: 2018-02-20\n\n---\n\n## \n\nKafka is a distributed,partitioned,replicated commit logserviceJMSJMSkafkaTopicProducer,Consumer,kafkakafka(server)brokerkafkaproducerconsumerzookeepermeta\n\n![kafka-img](http://kafka.apache.org/images/kafka_diagram.png)\n\n## \n\n## Kafka\n\n1. Kafka2550 MB55110 MB\n2. ETLreplication\n3. producerbrokerconsumer\n4. consumerserver\n5. onlineoffline\n\n## SpringBoot Kafka\n\nkafka starter\n\n```xml\n        <dependency>\n            <groupId>cn.com.siss</groupId>\n            <artifactId>spring-boot-starter-kafka</artifactId>\n            <version>${starters.version}</version>\n        </dependency>\n```\n\nkafka\n\n```yaml\nspring:\n  profiles:\n    include:\n      - kafka\n```\n\n `kafkaTemplate` `kafkaTemplate.send(\"message\", \"hello-world\")`\n\n```java\n    @Autowired\n    private KafkaTemplate kafkaTemplate;\n\n    @RequestMapping(value = \"/sendKafka\", method = RequestMethod.GET)\n    public Object sendKafka(){\n        System.out.println(\"sendKafka\");\n        ListenableFuture result = kafkaTemplate.send(\"message\", \"hello-world\");\n        return result;\n    }\n```\n\n\n\n```java\n@Component\n@Slf4j\npublic class Hellokafka {\n\n    @KafkaListener(topics = {\"message\"})\n    public void getMessage(ConsumerRecord<?, ?> record) {\n        Optional<?> kafkaMessage = Optional.ofNullable(record.value());\n        if (kafkaMessage.isPresent()) {\n\n            Object message = kafkaMessage.get();\n\n            log.info(\"----------------- record =\" + record);\n            log.info(\"------------------ message =\" + message);\n        }\n    }\n}\n```\n\n\n\n```\nsendKafka\n2019-02-28 17:20:07.013  INFO 10477 --- [nio-8081-exec-1] o.a.k.clients.producer.ProducerConfig    : ProducerConfig values:\n2019-02-28 17:20:07.020  INFO 10477 --- [nio-8081-exec-1] o.a.k.clients.producer.ProducerConfig    : ProducerConfig values:\n2019-02-28 17:20:07.020  INFO 10477 --- [nio-8081-exec-1] o.a.kafka.common.utils.AppInfoParser     : Kafka version : 0.10.0.1\n2019-02-28 17:20:07.020  INFO 10477 --- [nio-8081-exec-1] o.a.kafka.common.utils.AppInfoParser     : Kafka commitId : a7a17cdec9eaa6c5\n2019-02-28 17:20:07.398  INFO 10477 --- [afka-listener-1] cn.com.siss.web.kafka.Hellokafka         : ----------------- record =ConsumerRecord(topic = message, partition = 0, offset = 85, CreateTime = 1551345607273, checksum = 3403921507, serialized key size = -1, serialized value size = 11, key = null, value = hello-world)\n2019-02-28 17:20:07.398  INFO 10477 --- [afka-listener-1] cn.com.siss.web.kafka.Hellokafka         : ------------------ message =hello-world\n2019-02-28 17:20:07.434  WARN 10477 --- [nio-8081-exec-2] .w.s.m.s.DefaultHandlerExceptionResolver : Failed to write HTTP message: org.springframework.http.converter.HttpMessageNotWritableException: Could not write JSON: No serializer found for class org.apache.kafka.clients.producer.ProducerRecord and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS); nested exception is com.fasterxml.jackson.databind.JsonMappingException: No serializer found for class org.apache.kafka.clients.producer.ProducerRecord and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS) (through reference chain: org.springframework.kafka.support.SendResult[\"producerRecord\"])\n```","slug":"doc-dev/basics/kafka","published":1,"updated":"2021-03-09T14:24:10.265Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0d7001csmjrbgbm81yi","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Kafka is a distributed,partitioned,replicated commit logserviceJMSJMSkafkaTopicProducer,Consumer,kafkakafka(server)brokerkafkaproducerconsumerzookeepermeta</p>\n<p><img src=\"http://kafka.apache.org/images/kafka_diagram.png\" alt=\"kafka-img\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ol>\n<li>Kafka2550 MB55110 MB</li>\n<li>ETLreplication</li>\n<li>producerbrokerconsumer</li>\n<li>consumerserver</li>\n<li>onlineoffline</li>\n</ol>\n<h2 id=\"SpringBoot-Kafka\"><a href=\"#SpringBoot-Kafka\" class=\"headerlink\" title=\"SpringBoot Kafka\"></a>SpringBoot Kafka</h2><p>kafka starter</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-kafka<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;starters.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>kafka</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">    <span class=\"attr\">include:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">kafka</span></span><br></pre></td></tr></table></figure>\n\n<p> <code>kafkaTemplate</code> <code>kafkaTemplate.send(&quot;message&quot;, &quot;hello-world&quot;)</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> KafkaTemplate kafkaTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(value = &quot;/sendKafka&quot;, method = RequestMethod.GET)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">sendKafka</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;sendKafka&quot;</span>);</span><br><span class=\"line\">    ListenableFuture result = kafkaTemplate.send(<span class=\"string\">&quot;message&quot;</span>, <span class=\"string\">&quot;hello-world&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Hellokafka</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@KafkaListener(topics = &#123;&quot;message&quot;&#125;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getMessage</span><span class=\"params\">(ConsumerRecord&lt;?, ?&gt; record)</span> </span>&#123;</span><br><span class=\"line\">        Optional&lt;?&gt; kafkaMessage = Optional.ofNullable(record.value());</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (kafkaMessage.isPresent()) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            Object message = kafkaMessage.get();</span><br><span class=\"line\"></span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;----------------- record =&quot;</span> + record);</span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;------------------ message =&quot;</span> + message);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sendKafka</span><br><span class=\"line\">2019-02-28 17:20:07.013  INFO 10477 --- [nio-8081-exec-1] o.a.k.clients.producer.ProducerConfig    : ProducerConfig values:</span><br><span class=\"line\">2019-02-28 17:20:07.020  INFO 10477 --- [nio-8081-exec-1] o.a.k.clients.producer.ProducerConfig    : ProducerConfig values:</span><br><span class=\"line\">2019-02-28 17:20:07.020  INFO 10477 --- [nio-8081-exec-1] o.a.kafka.common.utils.AppInfoParser     : Kafka version : 0.10.0.1</span><br><span class=\"line\">2019-02-28 17:20:07.020  INFO 10477 --- [nio-8081-exec-1] o.a.kafka.common.utils.AppInfoParser     : Kafka commitId : a7a17cdec9eaa6c5</span><br><span class=\"line\">2019-02-28 17:20:07.398  INFO 10477 --- [afka-listener-1] cn.com.siss.web.kafka.Hellokafka         : ----------------- record &#x3D;ConsumerRecord(topic &#x3D; message, partition &#x3D; 0, offset &#x3D; 85, CreateTime &#x3D; 1551345607273, checksum &#x3D; 3403921507, serialized key size &#x3D; -1, serialized value size &#x3D; 11, key &#x3D; null, value &#x3D; hello-world)</span><br><span class=\"line\">2019-02-28 17:20:07.398  INFO 10477 --- [afka-listener-1] cn.com.siss.web.kafka.Hellokafka         : ------------------ message &#x3D;hello-world</span><br><span class=\"line\">2019-02-28 17:20:07.434  WARN 10477 --- [nio-8081-exec-2] .w.s.m.s.DefaultHandlerExceptionResolver : Failed to write HTTP message: org.springframework.http.converter.HttpMessageNotWritableException: Could not write JSON: No serializer found for class org.apache.kafka.clients.producer.ProducerRecord and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS); nested exception is com.fasterxml.jackson.databind.JsonMappingException: No serializer found for class org.apache.kafka.clients.producer.ProducerRecord and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS) (through reference chain: org.springframework.kafka.support.SendResult[&quot;producerRecord&quot;])</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Kafka is a distributed,partitioned,replicated commit logserviceJMSJMSkafkaTopicProducer,Consumer,kafkakafka(server)brokerkafkaproducerconsumerzookeepermeta</p>\n<p><img src=\"http://kafka.apache.org/images/kafka_diagram.png\" alt=\"kafka-img\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h2 id=\"Kafka\"><a href=\"#Kafka\" class=\"headerlink\" title=\"Kafka\"></a>Kafka</h2><ol>\n<li>Kafka2550 MB55110 MB</li>\n<li>ETLreplication</li>\n<li>producerbrokerconsumer</li>\n<li>consumerserver</li>\n<li>onlineoffline</li>\n</ol>\n<h2 id=\"SpringBoot-Kafka\"><a href=\"#SpringBoot-Kafka\" class=\"headerlink\" title=\"SpringBoot Kafka\"></a>SpringBoot Kafka</h2><p>kafka starter</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-kafka<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;starters.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>kafka</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">    <span class=\"attr\">include:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">kafka</span></span><br></pre></td></tr></table></figure>\n\n<p> <code>kafkaTemplate</code> <code>kafkaTemplate.send(&quot;message&quot;, &quot;hello-world&quot;)</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> KafkaTemplate kafkaTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RequestMapping(value = &quot;/sendKafka&quot;, method = RequestMethod.GET)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">sendKafka</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;sendKafka&quot;</span>);</span><br><span class=\"line\">    ListenableFuture result = kafkaTemplate.send(<span class=\"string\">&quot;message&quot;</span>, <span class=\"string\">&quot;hello-world&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Hellokafka</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@KafkaListener(topics = &#123;&quot;message&quot;&#125;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">getMessage</span><span class=\"params\">(ConsumerRecord&lt;?, ?&gt; record)</span> </span>&#123;</span><br><span class=\"line\">        Optional&lt;?&gt; kafkaMessage = Optional.ofNullable(record.value());</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (kafkaMessage.isPresent()) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            Object message = kafkaMessage.get();</span><br><span class=\"line\"></span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;----------------- record =&quot;</span> + record);</span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;------------------ message =&quot;</span> + message);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sendKafka</span><br><span class=\"line\">2019-02-28 17:20:07.013  INFO 10477 --- [nio-8081-exec-1] o.a.k.clients.producer.ProducerConfig    : ProducerConfig values:</span><br><span class=\"line\">2019-02-28 17:20:07.020  INFO 10477 --- [nio-8081-exec-1] o.a.k.clients.producer.ProducerConfig    : ProducerConfig values:</span><br><span class=\"line\">2019-02-28 17:20:07.020  INFO 10477 --- [nio-8081-exec-1] o.a.kafka.common.utils.AppInfoParser     : Kafka version : 0.10.0.1</span><br><span class=\"line\">2019-02-28 17:20:07.020  INFO 10477 --- [nio-8081-exec-1] o.a.kafka.common.utils.AppInfoParser     : Kafka commitId : a7a17cdec9eaa6c5</span><br><span class=\"line\">2019-02-28 17:20:07.398  INFO 10477 --- [afka-listener-1] cn.com.siss.web.kafka.Hellokafka         : ----------------- record &#x3D;ConsumerRecord(topic &#x3D; message, partition &#x3D; 0, offset &#x3D; 85, CreateTime &#x3D; 1551345607273, checksum &#x3D; 3403921507, serialized key size &#x3D; -1, serialized value size &#x3D; 11, key &#x3D; null, value &#x3D; hello-world)</span><br><span class=\"line\">2019-02-28 17:20:07.398  INFO 10477 --- [afka-listener-1] cn.com.siss.web.kafka.Hellokafka         : ------------------ message &#x3D;hello-world</span><br><span class=\"line\">2019-02-28 17:20:07.434  WARN 10477 --- [nio-8081-exec-2] .w.s.m.s.DefaultHandlerExceptionResolver : Failed to write HTTP message: org.springframework.http.converter.HttpMessageNotWritableException: Could not write JSON: No serializer found for class org.apache.kafka.clients.producer.ProducerRecord and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS); nested exception is com.fasterxml.jackson.databind.JsonMappingException: No serializer found for class org.apache.kafka.clients.producer.ProducerRecord and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS) (through reference chain: org.springframework.kafka.support.SendResult[&quot;producerRecord&quot;])</span><br></pre></td></tr></table></figure>"},{"title":"MongoDB","date":"2018-02-25T16:00:00.000Z","_content":"\n![mongo](https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQa7f6h94s8xpLwtgV4EoP0CPF2bYz1SW2M5ABcrArTZl1pEbpQMw)\n\n## \n\nMongoDBHumongousMongoDB  MongoDBMongoDB\n\nMongoDBMongoDB MongoDB\n\n1High performance - web2.0 \n\n SQL  SQL IO  BBS \n\n2Huge Storage - \n\n SNS  Friend feed  2.5  2.5 \nSQL  web \n\n3High Scalability && High Availability - \n\n web  web server  app server  24  web2.0 \n\n1 \n\n web \n\n2 \n\n web \n\n3SQL \n\n web  SQL  SNS \nSQL \n\n## MongoDB\n\n\n\n```xml\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-data-mongodb</artifactId>\n\t\t</dependency>\n```\n\n\n\n```yaml\nspring:\n  data:\n    mongodb:\n      uri: mongodb://siss:dev.5566@39.108.210.229:27017/demo\n\n      #mongodb://username:password@host:port/dbName\n```\n\n```java\n@Data\npublic class User {\n    private String id;\n    private String username;\n    private String password;\n    private String registerTime;\n    private String phone;\n    private String name;\n    private String sex;\n    private String age;\n}\n```\n\ndao\n\n```java\n@Component\npublic class UserDaoImpl {\n\n    @Autowired\n    private MongoTemplate mongoTemplate;\n\n    /**\n     * \n     * @param user\n     */\n    public void saveUser(User user) {\n        mongoTemplate.save(user);\n    }\n\n    /**\n     * \n     * @param userName\n     * @return\n     */\n    public User findUserByUserName(String userName) {\n        Query query=new Query(Criteria.where(\"id\").is(userName));\n        User user =  mongoTemplate.findOne(query , User.class);\n        return user;\n    }\n\n    /**\n     * \n     * @param user\n     */\n    public void updateUser(User user) {\n        Query query=new Query(Criteria.where(\"id\").is(user.getId()));\n        Update update= new Update().set(\"userName\", user.getName()).set(\"passWord\", user.getPassword());\n        //\n        mongoTemplate.updateFirst(query,update,User.class);\n        //\n        // mongoTemplate.updateMulti(query,update,User.class);\n    }\n\n    /**\n     * \n     * @param id\n     */\n    public void deleteUserById(Long id) {\n        Query query=new Query(Criteria.where(\"id\").is(id));\n        mongoTemplate.remove(query,User.class);\n    }\n}\n```\n\ncontroller\n\n```java\n@RestController\npublic class UserMongo {\n\n    @Autowired\n    private UserDaoImpl userDao;\n\n    @RequestMapping(value = \"mongo\", method = RequestMethod.GET)\n    public Object mongo() {\n\n        User user = new User();\n        user.setId(\"9\");\n        user.setAge(\"3\");\n        user.setName(\"demo\");\n        userDao.saveUser(user);\n        return null;\n    }\n\n    @RequestMapping(value = \"\", method = RequestMethod.GET)\n    public Object get() {\n        User user = userDao.findUserByUserName(\"1\");\n        return user;\n    }\n}\n\n```\n\n## \n\n\n\n![mongo-insert](img/mongo-insert.png)\n\n\n\n![mongo-select](img/mongo-select.png)","source":"_posts/doc-dev/basics/mongo.md","raw":"---\ntitle: MongoDB\ndate: 2018-02-26\n\n---\n\n![mongo](https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQa7f6h94s8xpLwtgV4EoP0CPF2bYz1SW2M5ABcrArTZl1pEbpQMw)\n\n## \n\nMongoDBHumongousMongoDB  MongoDBMongoDB\n\nMongoDBMongoDB MongoDB\n\n1High performance - web2.0 \n\n SQL  SQL IO  BBS \n\n2Huge Storage - \n\n SNS  Friend feed  2.5  2.5 \nSQL  web \n\n3High Scalability && High Availability - \n\n web  web server  app server  24  web2.0 \n\n1 \n\n web \n\n2 \n\n web \n\n3SQL \n\n web  SQL  SNS \nSQL \n\n## MongoDB\n\n\n\n```xml\n\t\t<dependency>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-starter-data-mongodb</artifactId>\n\t\t</dependency>\n```\n\n\n\n```yaml\nspring:\n  data:\n    mongodb:\n      uri: mongodb://siss:dev.5566@39.108.210.229:27017/demo\n\n      #mongodb://username:password@host:port/dbName\n```\n\n```java\n@Data\npublic class User {\n    private String id;\n    private String username;\n    private String password;\n    private String registerTime;\n    private String phone;\n    private String name;\n    private String sex;\n    private String age;\n}\n```\n\ndao\n\n```java\n@Component\npublic class UserDaoImpl {\n\n    @Autowired\n    private MongoTemplate mongoTemplate;\n\n    /**\n     * \n     * @param user\n     */\n    public void saveUser(User user) {\n        mongoTemplate.save(user);\n    }\n\n    /**\n     * \n     * @param userName\n     * @return\n     */\n    public User findUserByUserName(String userName) {\n        Query query=new Query(Criteria.where(\"id\").is(userName));\n        User user =  mongoTemplate.findOne(query , User.class);\n        return user;\n    }\n\n    /**\n     * \n     * @param user\n     */\n    public void updateUser(User user) {\n        Query query=new Query(Criteria.where(\"id\").is(user.getId()));\n        Update update= new Update().set(\"userName\", user.getName()).set(\"passWord\", user.getPassword());\n        //\n        mongoTemplate.updateFirst(query,update,User.class);\n        //\n        // mongoTemplate.updateMulti(query,update,User.class);\n    }\n\n    /**\n     * \n     * @param id\n     */\n    public void deleteUserById(Long id) {\n        Query query=new Query(Criteria.where(\"id\").is(id));\n        mongoTemplate.remove(query,User.class);\n    }\n}\n```\n\ncontroller\n\n```java\n@RestController\npublic class UserMongo {\n\n    @Autowired\n    private UserDaoImpl userDao;\n\n    @RequestMapping(value = \"mongo\", method = RequestMethod.GET)\n    public Object mongo() {\n\n        User user = new User();\n        user.setId(\"9\");\n        user.setAge(\"3\");\n        user.setName(\"demo\");\n        userDao.saveUser(user);\n        return null;\n    }\n\n    @RequestMapping(value = \"\", method = RequestMethod.GET)\n    public Object get() {\n        User user = userDao.findUserByUserName(\"1\");\n        return user;\n    }\n}\n\n```\n\n## \n\n\n\n![mongo-insert](img/mongo-insert.png)\n\n\n\n![mongo-select](img/mongo-select.png)","slug":"doc-dev/basics/mongo","published":1,"updated":"2021-03-09T14:24:32.103Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0d8001esmjrgvn7f2vs","content":"<p><img src=\"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQa7f6h94s8xpLwtgV4EoP0CPF2bYz1SW2M5ABcrArTZl1pEbpQMw\" alt=\"mongo\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MongoDBHumongousMongoDB  MongoDBMongoDB</p>\n<p>MongoDBMongoDB MongoDB</p>\n<p>1High performance - web2.0 </p>\n<p> SQL  SQL IO  BBS </p>\n<p>2Huge Storage - </p>\n<p> SNS  Friend feed  2.5  2.5 <br>SQL  web </p>\n<p>3High Scalability &amp;&amp; High Availability - </p>\n<p> web  web server  app server  24  web2.0 </p>\n<p>1 </p>\n<p> web </p>\n<p>2 </p>\n<p> web </p>\n<p>3SQL </p>\n<p> web  SQL  SNS <br>SQL </p>\n<h2 id=\"MongoDB\"><a href=\"#MongoDB\" class=\"headerlink\" title=\"MongoDB\"></a>MongoDB</h2><p></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">mongodb:</span></span><br><span class=\"line\">      <span class=\"attr\">uri:</span> <span class=\"string\">mongodb://siss:dev.5566@39.108.210.229:27017/demo</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">#mongodb://username:password@host:port/dbName</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String id;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String username;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String registerTime;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String phone;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String sex;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String age;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>dao</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserDaoImpl</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> MongoTemplate mongoTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> user</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">saveUser</span><span class=\"params\">(User user)</span> </span>&#123;</span><br><span class=\"line\">        mongoTemplate.save(user);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userName</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">findUserByUserName</span><span class=\"params\">(String userName)</span> </span>&#123;</span><br><span class=\"line\">        Query query=<span class=\"keyword\">new</span> Query(Criteria.where(<span class=\"string\">&quot;id&quot;</span>).is(userName));</span><br><span class=\"line\">        User user =  mongoTemplate.findOne(query , User.class);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> user</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updateUser</span><span class=\"params\">(User user)</span> </span>&#123;</span><br><span class=\"line\">        Query query=<span class=\"keyword\">new</span> Query(Criteria.where(<span class=\"string\">&quot;id&quot;</span>).is(user.getId()));</span><br><span class=\"line\">        Update update= <span class=\"keyword\">new</span> Update().set(<span class=\"string\">&quot;userName&quot;</span>, user.getName()).set(<span class=\"string\">&quot;passWord&quot;</span>, user.getPassword());</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        mongoTemplate.updateFirst(query,update,User.class);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"comment\">// mongoTemplate.updateMulti(query,update,User.class);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> id</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">deleteUserById</span><span class=\"params\">(Long id)</span> </span>&#123;</span><br><span class=\"line\">        Query query=<span class=\"keyword\">new</span> Query(Criteria.where(<span class=\"string\">&quot;id&quot;</span>).is(id));</span><br><span class=\"line\">        mongoTemplate.remove(query,User.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>controller</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserMongo</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserDaoImpl userDao;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(value = &quot;mongo&quot;, method = RequestMethod.GET)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">mongo</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        User user = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">        user.setId(<span class=\"string\">&quot;9&quot;</span>);</span><br><span class=\"line\">        user.setAge(<span class=\"string\">&quot;3&quot;</span>);</span><br><span class=\"line\">        user.setName(<span class=\"string\">&quot;demo&quot;</span>);</span><br><span class=\"line\">        userDao.saveUser(user);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(value = &quot;&quot;, method = RequestMethod.GET)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">get</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        User user = userDao.findUserByUserName(<span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p><img src=\"/2018/02/26/doc-dev/basics/mongo/mongo-insert.png\" alt=\"mongo-insert\"></p>\n<p></p>\n<p><img src=\"/2018/02/26/doc-dev/basics/mongo/mongo-select.png\" alt=\"mongo-select\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQa7f6h94s8xpLwtgV4EoP0CPF2bYz1SW2M5ABcrArTZl1pEbpQMw\" alt=\"mongo\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>MongoDBHumongousMongoDB  MongoDBMongoDB</p>\n<p>MongoDBMongoDB MongoDB</p>\n<p>1High performance - web2.0 </p>\n<p> SQL  SQL IO  BBS </p>\n<p>2Huge Storage - </p>\n<p> SNS  Friend feed  2.5  2.5 <br>SQL  web </p>\n<p>3High Scalability &amp;&amp; High Availability - </p>\n<p> web  web server  app server  24  web2.0 </p>\n<p>1 </p>\n<p> web </p>\n<p>2 </p>\n<p> web </p>\n<p>3SQL </p>\n<p> web  SQL  SNS <br>SQL </p>\n<h2 id=\"MongoDB\"><a href=\"#MongoDB\" class=\"headerlink\" title=\"MongoDB\"></a>MongoDB</h2><p></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">data:</span></span><br><span class=\"line\">    <span class=\"attr\">mongodb:</span></span><br><span class=\"line\">      <span class=\"attr\">uri:</span> <span class=\"string\">mongodb://siss:dev.5566@39.108.210.229:27017/demo</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">#mongodb://username:password@host:port/dbName</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">User</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String id;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String username;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String registerTime;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String phone;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String sex;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String age;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>dao</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserDaoImpl</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> MongoTemplate mongoTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> user</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">saveUser</span><span class=\"params\">(User user)</span> </span>&#123;</span><br><span class=\"line\">        mongoTemplate.save(user);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userName</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">findUserByUserName</span><span class=\"params\">(String userName)</span> </span>&#123;</span><br><span class=\"line\">        Query query=<span class=\"keyword\">new</span> Query(Criteria.where(<span class=\"string\">&quot;id&quot;</span>).is(userName));</span><br><span class=\"line\">        User user =  mongoTemplate.findOne(query , User.class);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> user</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">updateUser</span><span class=\"params\">(User user)</span> </span>&#123;</span><br><span class=\"line\">        Query query=<span class=\"keyword\">new</span> Query(Criteria.where(<span class=\"string\">&quot;id&quot;</span>).is(user.getId()));</span><br><span class=\"line\">        Update update= <span class=\"keyword\">new</span> Update().set(<span class=\"string\">&quot;userName&quot;</span>, user.getName()).set(<span class=\"string\">&quot;passWord&quot;</span>, user.getPassword());</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        mongoTemplate.updateFirst(query,update,User.class);</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"comment\">// mongoTemplate.updateMulti(query,update,User.class);</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * </span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> id</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">deleteUserById</span><span class=\"params\">(Long id)</span> </span>&#123;</span><br><span class=\"line\">        Query query=<span class=\"keyword\">new</span> Query(Criteria.where(<span class=\"string\">&quot;id&quot;</span>).is(id));</span><br><span class=\"line\">        mongoTemplate.remove(query,User.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>controller</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserMongo</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserDaoImpl userDao;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(value = &quot;mongo&quot;, method = RequestMethod.GET)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">mongo</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        User user = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">        user.setId(<span class=\"string\">&quot;9&quot;</span>);</span><br><span class=\"line\">        user.setAge(<span class=\"string\">&quot;3&quot;</span>);</span><br><span class=\"line\">        user.setName(<span class=\"string\">&quot;demo&quot;</span>);</span><br><span class=\"line\">        userDao.saveUser(user);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(value = &quot;&quot;, method = RequestMethod.GET)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">get</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        User user = userDao.findUserByUserName(<span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<p><img src=\"/2018/02/26/doc-dev/basics/mongo/mongo-insert.png\" alt=\"mongo-insert\"></p>\n<p></p>\n<p><img src=\"/2018/02/26/doc-dev/basics/mongo/mongo-select.png\" alt=\"mongo-select\"></p>\n"},{"title":"TDD","date":"2018-02-25T16:00:00.000Z","_content":"\n## \n\n\n\n* TDDTest-Driven Development\nTDDTDDTDD\n\n* BDDBehavior Driven Development\nQABDDDan North2003\n\n* ATDDAcceptance Test Driven Development\n ATDD TDD\n\nBDDATDD\nBDDCucumber\n\n## Spring Boot Mokito \n\n`mvc``mapper`mock , `Mokito` mock\n\nservice\n\n```java\n@Service\npublic class PersonService {\n\n    @Autowired\n    private PersonDao personDao;\n\n    public boolean update(int id, String name) {\n        Person person = personDao.getPerson(id);\n        if (person == null) {\n            return false;\n        }\n        Person personUpdate = new Person();\n        personUpdate.setId(person.getId());\n        personUpdate.setName(name);\n        return personDao.update(personUpdate);\n    }\n\n    public boolean getData(int id) throws Exception {\n        Person person = personDao.getPerson(id);\n        if (person == null) {\n            new Exception(\"\");\n        }\n        return true;\n    }\n}\n\n```\n\ndao\n\n```java\npublic interface PersonDao {\n    Person getPerson(int id);\n\n    boolean update(Person person);\n\n}\n```\n\nPerson\n\n```java\n@Data\npublic class Person {\n    private int id;\n    private String name;\n}\n```\n\nservice\n\n```java\n//spring\n@RunWith(SpringRunner.class) \npublic class DemoTestApplicationTests {\n\n    /*@InjectMocks\n    mockAPMInfoServicenew\n    @AutowiredspringAPMInfoServiceMock\n    Mockitonull\n    */\n\n  @InjectMocks\n  private PersonService personService = new PersonService();\n\n\n  @Mock\n  private PersonDao personDao;\n\n  @Before\n  public void beforeUpdate(){\n      Person person = new Person();\n      person.setId(1);\n      person.setName(\"chulei\");\n      when(personDao.getPerson(1)).thenReturn(person);\n      //when().thenThrow(Exception.class);\n      when(personDao.update(person)).thenReturn(true);\n  }\n\n  @Test\n  public void update() {\n     Boolean flag = personService.update(1, \"chulei\");\n      Assert.assertEquals(flag, true);\n      verify(personDao).getPerson(1);\n  }\n\n}\n```\n\ncontroller\n\n```java\n\n@WebAppConfiguration\n@Transactional //\n@RunWith(SpringRunner.class)\n@SpringBootTest\npublic class DemoTestApplicationTests {\n  @Autowired\n  private WebApplicationContext wac;\n\n  private MockMvc mockMvc;\n\n    @Before\n    public void setup() {\n        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();\n    }\n\n  @Test\n    public void sub() throws Exception {\n\n          String result = mockMvc.perform(\n                  get(\"/api/order\")\n                          .param(\"pageNum\", \"1\")\n                          .param(\"pageSize\", \"10\")\n                          .param(\"status\", \"1\")\n                          .contentType(MediaType.APPLICATION_JSON_UTF8))\n                  .andExpect(status().isOk())\n                  .andExpect(jsonPath(\"$.code\").value(10000))\n                  .andReturn().getResponse().getContentAsString();\n  }\n\n\n}  \n```","source":"_posts/doc-dev/basics/mock.md","raw":"---\ntitle: TDD\ndate: 2018-02-26\n\n---\n\n## \n\n\n\n* TDDTest-Driven Development\nTDDTDDTDD\n\n* BDDBehavior Driven Development\nQABDDDan North2003\n\n* ATDDAcceptance Test Driven Development\n ATDD TDD\n\nBDDATDD\nBDDCucumber\n\n## Spring Boot Mokito \n\n`mvc``mapper`mock , `Mokito` mock\n\nservice\n\n```java\n@Service\npublic class PersonService {\n\n    @Autowired\n    private PersonDao personDao;\n\n    public boolean update(int id, String name) {\n        Person person = personDao.getPerson(id);\n        if (person == null) {\n            return false;\n        }\n        Person personUpdate = new Person();\n        personUpdate.setId(person.getId());\n        personUpdate.setName(name);\n        return personDao.update(personUpdate);\n    }\n\n    public boolean getData(int id) throws Exception {\n        Person person = personDao.getPerson(id);\n        if (person == null) {\n            new Exception(\"\");\n        }\n        return true;\n    }\n}\n\n```\n\ndao\n\n```java\npublic interface PersonDao {\n    Person getPerson(int id);\n\n    boolean update(Person person);\n\n}\n```\n\nPerson\n\n```java\n@Data\npublic class Person {\n    private int id;\n    private String name;\n}\n```\n\nservice\n\n```java\n//spring\n@RunWith(SpringRunner.class) \npublic class DemoTestApplicationTests {\n\n    /*@InjectMocks\n    mockAPMInfoServicenew\n    @AutowiredspringAPMInfoServiceMock\n    Mockitonull\n    */\n\n  @InjectMocks\n  private PersonService personService = new PersonService();\n\n\n  @Mock\n  private PersonDao personDao;\n\n  @Before\n  public void beforeUpdate(){\n      Person person = new Person();\n      person.setId(1);\n      person.setName(\"chulei\");\n      when(personDao.getPerson(1)).thenReturn(person);\n      //when().thenThrow(Exception.class);\n      when(personDao.update(person)).thenReturn(true);\n  }\n\n  @Test\n  public void update() {\n     Boolean flag = personService.update(1, \"chulei\");\n      Assert.assertEquals(flag, true);\n      verify(personDao).getPerson(1);\n  }\n\n}\n```\n\ncontroller\n\n```java\n\n@WebAppConfiguration\n@Transactional //\n@RunWith(SpringRunner.class)\n@SpringBootTest\npublic class DemoTestApplicationTests {\n  @Autowired\n  private WebApplicationContext wac;\n\n  private MockMvc mockMvc;\n\n    @Before\n    public void setup() {\n        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();\n    }\n\n  @Test\n    public void sub() throws Exception {\n\n          String result = mockMvc.perform(\n                  get(\"/api/order\")\n                          .param(\"pageNum\", \"1\")\n                          .param(\"pageSize\", \"10\")\n                          .param(\"status\", \"1\")\n                          .contentType(MediaType.APPLICATION_JSON_UTF8))\n                  .andExpect(status().isOk())\n                  .andExpect(jsonPath(\"$.code\").value(10000))\n                  .andReturn().getResponse().getContentAsString();\n  }\n\n\n}  \n```","slug":"doc-dev/basics/mock","published":1,"updated":"2021-03-09T14:24:26.575Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0d9001gsmjrg5nh6yvi","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ul>\n<li><p>TDDTest-Driven Development<br>TDDTDDTDD</p>\n</li>\n<li><p>BDDBehavior Driven Development<br>QABDDDan North2003</p>\n</li>\n<li><p>ATDDAcceptance Test Driven Development<br>ATDD TDD</p>\n</li>\n</ul>\n<p>BDDATDD<br>BDDCucumber</p>\n<h2 id=\"Spring-Boot-Mokito-\"><a href=\"#Spring-Boot-Mokito-\" class=\"headerlink\" title=\"Spring Boot Mokito \"></a>Spring Boot Mokito </h2><p><code>mvc</code><code>mapper</code>mock , <code>Mokito</code> mock</p>\n<p>service</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PersonService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> PersonDao personDao;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">update</span><span class=\"params\">(<span class=\"keyword\">int</span> id, String name)</span> </span>&#123;</span><br><span class=\"line\">        Person person = personDao.getPerson(id);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (person == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Person personUpdate = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\">        personUpdate.setId(person.getId());</span><br><span class=\"line\">        personUpdate.setName(name);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> personDao.update(personUpdate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">getData</span><span class=\"params\">(<span class=\"keyword\">int</span> id)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        Person person = personDao.getPerson(id);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (person == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> Exception(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>dao</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">PersonDao</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\">Person <span class=\"title\">getPerson</span><span class=\"params\">(<span class=\"keyword\">int</span> id)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">update</span><span class=\"params\">(Person person)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Person</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> id;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>service</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//spring</span></span><br><span class=\"line\"><span class=\"meta\">@RunWith(SpringRunner.class)</span> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DemoTestApplicationTests</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*@InjectMocks</span></span><br><span class=\"line\"><span class=\"comment\">    mockAPMInfoServicenew</span></span><br><span class=\"line\"><span class=\"comment\">    @AutowiredspringAPMInfoServiceMock</span></span><br><span class=\"line\"><span class=\"comment\">    Mockitonull</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@InjectMocks</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> PersonService personService = <span class=\"keyword\">new</span> PersonService();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Mock</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> PersonDao personDao;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Before</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">beforeUpdate</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      Person person = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\">      person.setId(<span class=\"number\">1</span>);</span><br><span class=\"line\">      person.setName(<span class=\"string\">&quot;chulei&quot;</span>);</span><br><span class=\"line\">      when(personDao.getPerson(<span class=\"number\">1</span>)).thenReturn(person);</span><br><span class=\"line\">      <span class=\"comment\">//when().thenThrow(Exception.class);</span></span><br><span class=\"line\">      when(personDao.update(person)).thenReturn(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Test</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">update</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">     Boolean flag = personService.update(<span class=\"number\">1</span>, <span class=\"string\">&quot;chulei&quot;</span>);</span><br><span class=\"line\">      Assert.assertEquals(flag, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">      verify(personDao).getPerson(<span class=\"number\">1</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>controller</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@WebAppConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@Transactional</span> <span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"meta\">@RunWith(SpringRunner.class)</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootTest</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DemoTestApplicationTests</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> WebApplicationContext wac;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">private</span> MockMvc mockMvc;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Before</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sub</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">          String result = mockMvc.perform(</span><br><span class=\"line\">                  get(<span class=\"string\">&quot;/api/order&quot;</span>)</span><br><span class=\"line\">                          .param(<span class=\"string\">&quot;pageNum&quot;</span>, <span class=\"string\">&quot;1&quot;</span>)</span><br><span class=\"line\">                          .param(<span class=\"string\">&quot;pageSize&quot;</span>, <span class=\"string\">&quot;10&quot;</span>)</span><br><span class=\"line\">                          .param(<span class=\"string\">&quot;status&quot;</span>, <span class=\"string\">&quot;1&quot;</span>)</span><br><span class=\"line\">                          .contentType(MediaType.APPLICATION_JSON_UTF8))</span><br><span class=\"line\">                  .andExpect(status().isOk())</span><br><span class=\"line\">                  .andExpect(jsonPath(<span class=\"string\">&quot;$.code&quot;</span>).value(<span class=\"number\">10000</span>))</span><br><span class=\"line\">                  .andReturn().getResponse().getContentAsString();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;  </span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p></p>\n<ul>\n<li><p>TDDTest-Driven Development<br>TDDTDDTDD</p>\n</li>\n<li><p>BDDBehavior Driven Development<br>QABDDDan North2003</p>\n</li>\n<li><p>ATDDAcceptance Test Driven Development<br>ATDD TDD</p>\n</li>\n</ul>\n<p>BDDATDD<br>BDDCucumber</p>\n<h2 id=\"Spring-Boot-Mokito-\"><a href=\"#Spring-Boot-Mokito-\" class=\"headerlink\" title=\"Spring Boot Mokito \"></a>Spring Boot Mokito </h2><p><code>mvc</code><code>mapper</code>mock , <code>Mokito</code> mock</p>\n<p>service</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PersonService</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> PersonDao personDao;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">update</span><span class=\"params\">(<span class=\"keyword\">int</span> id, String name)</span> </span>&#123;</span><br><span class=\"line\">        Person person = personDao.getPerson(id);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (person == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Person personUpdate = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\">        personUpdate.setId(person.getId());</span><br><span class=\"line\">        personUpdate.setName(name);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> personDao.update(personUpdate);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">boolean</span> <span class=\"title\">getData</span><span class=\"params\">(<span class=\"keyword\">int</span> id)</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">        Person person = personDao.getPerson(id);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (person == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> Exception(<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>dao</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">PersonDao</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\">Person <span class=\"title\">getPerson</span><span class=\"params\">(<span class=\"keyword\">int</span> id)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">boolean</span> <span class=\"title\">update</span><span class=\"params\">(Person person)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Person</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">int</span> id;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>service</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//spring</span></span><br><span class=\"line\"><span class=\"meta\">@RunWith(SpringRunner.class)</span> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DemoTestApplicationTests</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/*@InjectMocks</span></span><br><span class=\"line\"><span class=\"comment\">    mockAPMInfoServicenew</span></span><br><span class=\"line\"><span class=\"comment\">    @AutowiredspringAPMInfoServiceMock</span></span><br><span class=\"line\"><span class=\"comment\">    Mockitonull</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@InjectMocks</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> PersonService personService = <span class=\"keyword\">new</span> PersonService();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Mock</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> PersonDao personDao;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Before</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">beforeUpdate</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">      Person person = <span class=\"keyword\">new</span> Person();</span><br><span class=\"line\">      person.setId(<span class=\"number\">1</span>);</span><br><span class=\"line\">      person.setName(<span class=\"string\">&quot;chulei&quot;</span>);</span><br><span class=\"line\">      when(personDao.getPerson(<span class=\"number\">1</span>)).thenReturn(person);</span><br><span class=\"line\">      <span class=\"comment\">//when().thenThrow(Exception.class);</span></span><br><span class=\"line\">      when(personDao.update(person)).thenReturn(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Test</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">update</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">     Boolean flag = personService.update(<span class=\"number\">1</span>, <span class=\"string\">&quot;chulei&quot;</span>);</span><br><span class=\"line\">      Assert.assertEquals(flag, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">      verify(personDao).getPerson(<span class=\"number\">1</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>controller</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@WebAppConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@Transactional</span> <span class=\"comment\">//</span></span><br><span class=\"line\"><span class=\"meta\">@RunWith(SpringRunner.class)</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootTest</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DemoTestApplicationTests</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> WebApplicationContext wac;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">private</span> MockMvc mockMvc;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Before</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">setup</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">sub</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">          String result = mockMvc.perform(</span><br><span class=\"line\">                  get(<span class=\"string\">&quot;/api/order&quot;</span>)</span><br><span class=\"line\">                          .param(<span class=\"string\">&quot;pageNum&quot;</span>, <span class=\"string\">&quot;1&quot;</span>)</span><br><span class=\"line\">                          .param(<span class=\"string\">&quot;pageSize&quot;</span>, <span class=\"string\">&quot;10&quot;</span>)</span><br><span class=\"line\">                          .param(<span class=\"string\">&quot;status&quot;</span>, <span class=\"string\">&quot;1&quot;</span>)</span><br><span class=\"line\">                          .contentType(MediaType.APPLICATION_JSON_UTF8))</span><br><span class=\"line\">                  .andExpect(status().isOk())</span><br><span class=\"line\">                  .andExpect(jsonPath(<span class=\"string\">&quot;$.code&quot;</span>).value(<span class=\"number\">10000</span>))</span><br><span class=\"line\">                  .andReturn().getResponse().getContentAsString();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;  </span><br></pre></td></tr></table></figure>"},{"title":" Spring Boot RabbitMq","date":"2018-02-25T16:00:00.000Z","_content":"\n## \n\n AMQPAdvanced Message Queuing Protocol AMQP/ RabbitMQAMQPErlangPythonRuby.NETJavaJMSCPHPActionScriptXMPPSTOMPAJAX RabbitMQRabbitMQ\n\n![rabbitmq](http://www.rabbitmq.com/img/RabbitMQ-logo.svg)\n\n## \n\n### ,\n\n* \n\n:,,, ,,,,.\n\n* \n\n:,,,,,\n\n50ms,150ms,100ms,,,,.\n\n### \n\n11,,,.\n\n:\n\n,(^ ^)\n.\n\n\n:,,,\n\n:,, \n,,().\n\n### \n\n \n:,\n:\n\n1. (^^)\n2. ()\n\n3. ,,,,.\n4. .\n\n## SpringBoot RabbitMq\n\n`pom.xml`\n\n```xml\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-amqp</artifactId>\n        </dependency>\n```\n\n`application.yml`\n\n```yaml\nspring:\n  rabbitmq:\n    host: youhostname\n    port: 5672\n    username: test\n    password: dev.5566\n    virtual-host: /\n    publisher-returns: true\n    template:\n      mandatory: true\n```\n\n`topic` `config`\n\n```java\n@Configuration\npublic class RabbitConfig {\n    //\n    @Bean\n    public Queue queue1() {\n        return new Queue(\"hello.queue1\", true); // true\n    }\n\n    @Bean\n    public Queue queue2() {\n        return new Queue(\"hello.queue2\", true);\n    }\n\n    //\n    @Bean\n    TopicExchange topicExchange() {\n        return new TopicExchange(\"topicExchange\");\n    }\n\n    //\n    @Bean\n    public Binding binding1() {\n        return BindingBuilder.bind(queue1()).to(topicExchange()).with(\"key.1\");\n    }\n\n    @Bean\n    public Binding binding2() {\n        return BindingBuilder.bind(queue2()).to(topicExchange()).with(\"key.#\");\n    }\n}\n\n```\n\nmessage\n\n```java\n@Component\npublic class Sender implements ConfirmCallback, ReturnCallback {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    public void init() {\n        rabbitTemplate.setConfirmCallback(this);\n        rabbitTemplate.setReturnCallback(this);\n    }\n\n    @Override\n    public void confirm(CorrelationData correlationData, boolean b, String s) {\n        if (b) {\n            System.out.println(\":\" + correlationData);\n        } else {\n            System.out.println(\":\" + s);\n        }\n    }\n\n    @Override\n    public void returnedMessage(Message message, int i, String s, String s1, String s2) {\n\n    }\n\n    public void send(String msg){\n\n        CorrelationData correlationId = new CorrelationData(UUID.randomUUID().toString());\n\n        System.out.println(\" : \" + msg.toLowerCase());\n        String response = rabbitTemplate.convertSendAndReceive(\"topicExchange\", \"key.1\", msg, correlationId).toString();\n        System.out.println(\" : \" + msg.toLowerCase());\n        System.out.println(\" : \" + response + \" \");\n    }\n}\n\n```\n\n\n\n```java\n@Component\npublic class Receiver {\n\n    @RabbitListener(queues = \"hello.queue1\")\n    public String processMessage1(String msg) {\n        System.out.println(Thread.currentThread().getName() + \" hello.queue1\" + msg);\n        return msg.toUpperCase();\n    }\n\n}\n\n```\n\ncontroller\n\n```java\n@RestController\npublic class RabbitMqController {\n\n    @Autowired\n    private Sender sender;\n\n    @RequestMapping(value = \"/rabbit\", method = RequestMethod.GET)\n    public void rabbit() {\n        sender.send(\"ss\");\n    }\n\n}\n\n```\n\n## \n\n```\n : ss\nSimpleAsyncTaskExecutor-1 hello.queue1ss\n : ss\n : SS \n```","source":"_posts/doc-dev/basics/rabiit.md","raw":"---\ntitle:  Spring Boot RabbitMq\ndate: 2018-02-26\n\n---\n\n## \n\n AMQPAdvanced Message Queuing Protocol AMQP/ RabbitMQAMQPErlangPythonRuby.NETJavaJMSCPHPActionScriptXMPPSTOMPAJAX RabbitMQRabbitMQ\n\n![rabbitmq](http://www.rabbitmq.com/img/RabbitMQ-logo.svg)\n\n## \n\n### ,\n\n* \n\n:,,, ,,,,.\n\n* \n\n:,,,,,\n\n50ms,150ms,100ms,,,,.\n\n### \n\n11,,,.\n\n:\n\n,(^ ^)\n.\n\n\n:,,,\n\n:,, \n,,().\n\n### \n\n \n:,\n:\n\n1. (^^)\n2. ()\n\n3. ,,,,.\n4. .\n\n## SpringBoot RabbitMq\n\n`pom.xml`\n\n```xml\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-amqp</artifactId>\n        </dependency>\n```\n\n`application.yml`\n\n```yaml\nspring:\n  rabbitmq:\n    host: youhostname\n    port: 5672\n    username: test\n    password: dev.5566\n    virtual-host: /\n    publisher-returns: true\n    template:\n      mandatory: true\n```\n\n`topic` `config`\n\n```java\n@Configuration\npublic class RabbitConfig {\n    //\n    @Bean\n    public Queue queue1() {\n        return new Queue(\"hello.queue1\", true); // true\n    }\n\n    @Bean\n    public Queue queue2() {\n        return new Queue(\"hello.queue2\", true);\n    }\n\n    //\n    @Bean\n    TopicExchange topicExchange() {\n        return new TopicExchange(\"topicExchange\");\n    }\n\n    //\n    @Bean\n    public Binding binding1() {\n        return BindingBuilder.bind(queue1()).to(topicExchange()).with(\"key.1\");\n    }\n\n    @Bean\n    public Binding binding2() {\n        return BindingBuilder.bind(queue2()).to(topicExchange()).with(\"key.#\");\n    }\n}\n\n```\n\nmessage\n\n```java\n@Component\npublic class Sender implements ConfirmCallback, ReturnCallback {\n\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @PostConstruct\n    public void init() {\n        rabbitTemplate.setConfirmCallback(this);\n        rabbitTemplate.setReturnCallback(this);\n    }\n\n    @Override\n    public void confirm(CorrelationData correlationData, boolean b, String s) {\n        if (b) {\n            System.out.println(\":\" + correlationData);\n        } else {\n            System.out.println(\":\" + s);\n        }\n    }\n\n    @Override\n    public void returnedMessage(Message message, int i, String s, String s1, String s2) {\n\n    }\n\n    public void send(String msg){\n\n        CorrelationData correlationId = new CorrelationData(UUID.randomUUID().toString());\n\n        System.out.println(\" : \" + msg.toLowerCase());\n        String response = rabbitTemplate.convertSendAndReceive(\"topicExchange\", \"key.1\", msg, correlationId).toString();\n        System.out.println(\" : \" + msg.toLowerCase());\n        System.out.println(\" : \" + response + \" \");\n    }\n}\n\n```\n\n\n\n```java\n@Component\npublic class Receiver {\n\n    @RabbitListener(queues = \"hello.queue1\")\n    public String processMessage1(String msg) {\n        System.out.println(Thread.currentThread().getName() + \" hello.queue1\" + msg);\n        return msg.toUpperCase();\n    }\n\n}\n\n```\n\ncontroller\n\n```java\n@RestController\npublic class RabbitMqController {\n\n    @Autowired\n    private Sender sender;\n\n    @RequestMapping(value = \"/rabbit\", method = RequestMethod.GET)\n    public void rabbit() {\n        sender.send(\"ss\");\n    }\n\n}\n\n```\n\n## \n\n```\n : ss\nSimpleAsyncTaskExecutor-1 hello.queue1ss\n : ss\n : SS \n```","slug":"doc-dev/basics/rabiit","published":1,"updated":"2021-03-09T14:24:39.751Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0da001ismjrbhee8ki2","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> AMQPAdvanced Message Queuing Protocol AMQP/ RabbitMQAMQPErlangPythonRuby.NETJavaJMSCPHPActionScriptXMPPSTOMPAJAX RabbitMQRabbitMQ</p>\n<p><img src=\"http://www.rabbitmq.com/img/RabbitMQ-logo.svg\" alt=\"rabbitmq\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\",\"></a>,</h3><ul>\n<li></li>\n</ul>\n<p>:,,, ,,,,.</p>\n<ul>\n<li></li>\n</ul>\n<p>:,,,,,</p>\n<p>50ms,150ms,100ms,,,,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>11,,,.</p>\n<p>:</p>\n<p>,(^ ^)<br>.<br></p>\n<p>:,,,</p>\n<p>:,,<br>,,().</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br>:,<br>:</p>\n<ol>\n<li><p>(^^)</p>\n</li>\n<li><p>()</p>\n</li>\n<li><p>,,,,.</p>\n</li>\n<li><p>.</p>\n</li>\n</ol>\n<h2 id=\"SpringBoot-RabbitMq\"><a href=\"#SpringBoot-RabbitMq\" class=\"headerlink\" title=\"SpringBoot RabbitMq\"></a>SpringBoot RabbitMq</h2><p><code>pom.xml</code></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>application.yml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">rabbitmq:</span></span><br><span class=\"line\">    <span class=\"attr\">host:</span> <span class=\"string\">youhostname</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">5672</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">test</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">dev.5566</span></span><br><span class=\"line\">    <span class=\"attr\">virtual-host:</span> <span class=\"string\">/</span></span><br><span class=\"line\">    <span class=\"attr\">publisher-returns:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">template:</span></span><br><span class=\"line\">      <span class=\"attr\">mandatory:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<p><code>topic</code> <code>config</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RabbitConfig</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Queue <span class=\"title\">queue1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Queue(<span class=\"string\">&quot;hello.queue1&quot;</span>, <span class=\"keyword\">true</span>); <span class=\"comment\">// true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Queue <span class=\"title\">queue2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Queue(<span class=\"string\">&quot;hello.queue2&quot;</span>, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\">TopicExchange <span class=\"title\">topicExchange</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> TopicExchange(<span class=\"string\">&quot;topicExchange&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Binding <span class=\"title\">binding1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> BindingBuilder.bind(queue1()).to(topicExchange()).with(<span class=\"string\">&quot;key.1&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Binding <span class=\"title\">binding2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> BindingBuilder.bind(queue2()).to(topicExchange()).with(<span class=\"string\">&quot;key.#&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>message</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Sender</span> <span class=\"keyword\">implements</span> <span class=\"title\">ConfirmCallback</span>, <span class=\"title\">ReturnCallback</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RabbitTemplate rabbitTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@PostConstruct</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        rabbitTemplate.setConfirmCallback(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">        rabbitTemplate.setReturnCallback(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">confirm</span><span class=\"params\">(CorrelationData correlationData, <span class=\"keyword\">boolean</span> b, String s)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (b) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;:&quot;</span> + correlationData);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;:&quot;</span> + s);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">returnedMessage</span><span class=\"params\">(Message message, <span class=\"keyword\">int</span> i, String s, String s1, String s2)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">send</span><span class=\"params\">(String msg)</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        CorrelationData correlationId = <span class=\"keyword\">new</span> CorrelationData(UUID.randomUUID().toString());</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; : &quot;</span> + msg.toLowerCase());</span><br><span class=\"line\">        String response = rabbitTemplate.convertSendAndReceive(<span class=\"string\">&quot;topicExchange&quot;</span>, <span class=\"string\">&quot;key.1&quot;</span>, msg, correlationId).toString();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; : &quot;</span> + msg.toLowerCase());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; : &quot;</span> + response + <span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Receiver</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RabbitListener(queues = &quot;hello.queue1&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">processMessage1</span><span class=\"params\">(String msg)</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot; hello.queue1&quot;</span> + msg);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> msg.toUpperCase();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>controller</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RabbitMqController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Sender sender;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(value = &quot;/rabbit&quot;, method = RequestMethod.GET)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rabbit</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        sender.send(<span class=\"string\">&quot;ss&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> : ss</span><br><span class=\"line\">SimpleAsyncTaskExecutor-1 hello.queue1ss</span><br><span class=\"line\"> : ss</span><br><span class=\"line\"> : SS </span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p> AMQPAdvanced Message Queuing Protocol AMQP/ RabbitMQAMQPErlangPythonRuby.NETJavaJMSCPHPActionScriptXMPPSTOMPAJAX RabbitMQRabbitMQ</p>\n<p><img src=\"http://www.rabbitmq.com/img/RabbitMQ-logo.svg\" alt=\"rabbitmq\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><h3 id=\"-\"><a href=\"#-\" class=\"headerlink\" title=\",\"></a>,</h3><ul>\n<li></li>\n</ul>\n<p>:,,, ,,,,.</p>\n<ul>\n<li></li>\n</ul>\n<p>:,,,,,</p>\n<p>50ms,150ms,100ms,,,,.</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p>11,,,.</p>\n<p>:</p>\n<p>,(^ ^)<br>.<br></p>\n<p>:,,,</p>\n<p>:,,<br>,,().</p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><p><br>:,<br>:</p>\n<ol>\n<li><p>(^^)</p>\n</li>\n<li><p>()</p>\n</li>\n<li><p>,,,,.</p>\n</li>\n<li><p>.</p>\n</li>\n</ol>\n<h2 id=\"SpringBoot-RabbitMq\"><a href=\"#SpringBoot-RabbitMq\" class=\"headerlink\" title=\"SpringBoot RabbitMq\"></a>SpringBoot RabbitMq</h2><p><code>pom.xml</code></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>application.yml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">rabbitmq:</span></span><br><span class=\"line\">    <span class=\"attr\">host:</span> <span class=\"string\">youhostname</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">5672</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">test</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">dev.5566</span></span><br><span class=\"line\">    <span class=\"attr\">virtual-host:</span> <span class=\"string\">/</span></span><br><span class=\"line\">    <span class=\"attr\">publisher-returns:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">template:</span></span><br><span class=\"line\">      <span class=\"attr\">mandatory:</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n<p><code>topic</code> <code>config</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RabbitConfig</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Queue <span class=\"title\">queue1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Queue(<span class=\"string\">&quot;hello.queue1&quot;</span>, <span class=\"keyword\">true</span>); <span class=\"comment\">// true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Queue <span class=\"title\">queue2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> Queue(<span class=\"string\">&quot;hello.queue2&quot;</span>, <span class=\"keyword\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\">TopicExchange <span class=\"title\">topicExchange</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> TopicExchange(<span class=\"string\">&quot;topicExchange&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Binding <span class=\"title\">binding1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> BindingBuilder.bind(queue1()).to(topicExchange()).with(<span class=\"string\">&quot;key.1&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Binding <span class=\"title\">binding2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> BindingBuilder.bind(queue2()).to(topicExchange()).with(<span class=\"string\">&quot;key.#&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>message</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Sender</span> <span class=\"keyword\">implements</span> <span class=\"title\">ConfirmCallback</span>, <span class=\"title\">ReturnCallback</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RabbitTemplate rabbitTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@PostConstruct</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">init</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        rabbitTemplate.setConfirmCallback(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">        rabbitTemplate.setReturnCallback(<span class=\"keyword\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">confirm</span><span class=\"params\">(CorrelationData correlationData, <span class=\"keyword\">boolean</span> b, String s)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (b) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;:&quot;</span> + correlationData);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;:&quot;</span> + s);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">returnedMessage</span><span class=\"params\">(Message message, <span class=\"keyword\">int</span> i, String s, String s1, String s2)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">send</span><span class=\"params\">(String msg)</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        CorrelationData correlationId = <span class=\"keyword\">new</span> CorrelationData(UUID.randomUUID().toString());</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; : &quot;</span> + msg.toLowerCase());</span><br><span class=\"line\">        String response = rabbitTemplate.convertSendAndReceive(<span class=\"string\">&quot;topicExchange&quot;</span>, <span class=\"string\">&quot;key.1&quot;</span>, msg, correlationId).toString();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; : &quot;</span> + msg.toLowerCase());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; : &quot;</span> + response + <span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Receiver</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RabbitListener(queues = &quot;hello.queue1&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> String <span class=\"title\">processMessage1</span><span class=\"params\">(String msg)</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot; hello.queue1&quot;</span> + msg);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> msg.toUpperCase();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>controller</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">RabbitMqController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Sender sender;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(value = &quot;/rabbit&quot;, method = RequestMethod.GET)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">rabbit</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        sender.send(<span class=\"string\">&quot;ss&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> : ss</span><br><span class=\"line\">SimpleAsyncTaskExecutor-1 hello.queue1ss</span><br><span class=\"line\"> : ss</span><br><span class=\"line\"> : SS </span><br></pre></td></tr></table></figure>"},{"title":"Redis","date":"2018-02-25T16:00:00.000Z","_content":"\n## \n\nRedis BSDkey-value\n\nRedis  key - value \n\n* Redis\n* Rediskey-valuelistsetzsethash\n* Redismaster-slave\n\n![redis](https://upload.wikimedia.org/wikipedia/en/thumb/6/6b/Redis_Logo.svg/1200px-Redis_Logo.svg.png)\n\n## Redis \n\n*   Redis110000/s,81000/s \n*   Redis Strings, Lists, Hashes, Sets  Ordered Sets \n*   RedisMULTIEXEC\n*   Redis publish/subscribe, , key \n\n## Redis\n\n`SpringBoot` redis\n\nredis starter pom.xml\n\n```xml\n        <dependency>\n            <groupId>cn.com.siss</groupId>\n            <artifactId>spring-boot-starter-redis</artifactId>\n            <version>${starters.version}</version>\n        </dependency>\n```\n\n`application.yml`\n\nredis\n\n```yaml\nspring:\n  profiles:\n    include:\n      - redis\napp:\n  redis:\n    host: redis-dev-3 # redis ip\n    password: redis.123 # redis \n```\n\n\n\n\n```yaml\napp:\n  redis:\n    password: redis.123\n    nodes: redis-dev-1:26379,redis-dev-2:26379,redis-dev-3:26379\nspring:\n  profiles:\n    include:\n      - redis-sentry\n\n```\n\nstring `@Autowired` redisTemplate.\nRedisTemplateUtil.set(redisTemplate, \"p\", \"{\\\"a\\\": \\\"b\\\"}\", 3600L);\n`key` `value` `expireTime`\n\n```java\n@RestController\npublic class HelloWorld {\n\n    @Autowired\n    private RedisTemplate redisTemplate;\n\n    @RequestMapping(value = \"/set/redis\", method = RequestMethod.GET)\n    public Boolean setRedis(){\n        System.out.println(\"controller set method\");\n        boolean a = RedisTemplateUtil.set(redisTemplate, \"p\", \"{\\\"a\\\": \\\"b\\\"}\", 3600L);\n        return a;\n    }\n}\n\n```\n\n redis16 jedis\n\n```java\n        JedisConnectionFactory jedisConnectionFactory = (JedisConnectionFactory) redisTemplate.getConnectionFactory();\n        jedisConnectionFactory.setDatabase(2);\n```\n\nhash\n\n```java\n    @Test\n    public void checkoutSetHmKey() {\n        HashOperations<String, Object, Object> hash = redisTemplate.opsForHash();\n        Map<String, String> map = new HashMap<>();\n        map.put(\"a\", \"b\");\n        hash.putAll(\"124242114234214123412\", map);\n        RedisTemplateUtil.hmSet(redisTemplate, \"s\", \"a\", \"b\");\n    }\n```\n\n### Redis\n\nredis\n\n```java\n@SpringBootApplication\n@EnableCaching\npublic class SpringBootStarterRedisApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(SpringBootStarterRedisApplication.class, args);\n    }\n\n}\n```\n\n```\ncacheNames = \"product\" //\n\nkey = \"\"  key = \"#sellerid\"() //rediskey\n\ncondition = \"#sellerid.length > 10\" //truefalse\n\nunless = \"#result.getCode() != 0\" //false\n```\n\n\n\n\n```java\n@Cacheable(value=\"user\", key=\"'users_'+#id\")\npublic User redis(Long id){\n    User user = new User();\n    user.setUsername(\"hlhdidi\");\n    user.setPassword(\"123\");\n    user.setUid(1);\n    user.setId(1L);\n    System.out.println(\"log4j2?\");\n    return user;\n}\n```\n\n@CacheEvict   \n\nallEntries = false  product\n\nallEntries = true  key\n\n```java\n@CacheEvict(value=\"thisredis\", key=\"'users_'+#id\",condition=\"#id!=1\")\npublic void delUser(Integer id) {\n    // user\n    System.out.println(\"user\");\n}\n```\n\n@CachePut\n\n@Cacheable@Cacheable\n\n@CacheConfig\n\n@CacheConfig: cacheNames @CacheablecacheNames@CacheablecacheNames\n","source":"_posts/doc-dev/basics/redis.md","raw":"---\ntitle: Redis\ndate: 2018-02-26\n\n---\n\n## \n\nRedis BSDkey-value\n\nRedis  key - value \n\n* Redis\n* Rediskey-valuelistsetzsethash\n* Redismaster-slave\n\n![redis](https://upload.wikimedia.org/wikipedia/en/thumb/6/6b/Redis_Logo.svg/1200px-Redis_Logo.svg.png)\n\n## Redis \n\n*   Redis110000/s,81000/s \n*   Redis Strings, Lists, Hashes, Sets  Ordered Sets \n*   RedisMULTIEXEC\n*   Redis publish/subscribe, , key \n\n## Redis\n\n`SpringBoot` redis\n\nredis starter pom.xml\n\n```xml\n        <dependency>\n            <groupId>cn.com.siss</groupId>\n            <artifactId>spring-boot-starter-redis</artifactId>\n            <version>${starters.version}</version>\n        </dependency>\n```\n\n`application.yml`\n\nredis\n\n```yaml\nspring:\n  profiles:\n    include:\n      - redis\napp:\n  redis:\n    host: redis-dev-3 # redis ip\n    password: redis.123 # redis \n```\n\n\n\n\n```yaml\napp:\n  redis:\n    password: redis.123\n    nodes: redis-dev-1:26379,redis-dev-2:26379,redis-dev-3:26379\nspring:\n  profiles:\n    include:\n      - redis-sentry\n\n```\n\nstring `@Autowired` redisTemplate.\nRedisTemplateUtil.set(redisTemplate, \"p\", \"{\\\"a\\\": \\\"b\\\"}\", 3600L);\n`key` `value` `expireTime`\n\n```java\n@RestController\npublic class HelloWorld {\n\n    @Autowired\n    private RedisTemplate redisTemplate;\n\n    @RequestMapping(value = \"/set/redis\", method = RequestMethod.GET)\n    public Boolean setRedis(){\n        System.out.println(\"controller set method\");\n        boolean a = RedisTemplateUtil.set(redisTemplate, \"p\", \"{\\\"a\\\": \\\"b\\\"}\", 3600L);\n        return a;\n    }\n}\n\n```\n\n redis16 jedis\n\n```java\n        JedisConnectionFactory jedisConnectionFactory = (JedisConnectionFactory) redisTemplate.getConnectionFactory();\n        jedisConnectionFactory.setDatabase(2);\n```\n\nhash\n\n```java\n    @Test\n    public void checkoutSetHmKey() {\n        HashOperations<String, Object, Object> hash = redisTemplate.opsForHash();\n        Map<String, String> map = new HashMap<>();\n        map.put(\"a\", \"b\");\n        hash.putAll(\"124242114234214123412\", map);\n        RedisTemplateUtil.hmSet(redisTemplate, \"s\", \"a\", \"b\");\n    }\n```\n\n### Redis\n\nredis\n\n```java\n@SpringBootApplication\n@EnableCaching\npublic class SpringBootStarterRedisApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(SpringBootStarterRedisApplication.class, args);\n    }\n\n}\n```\n\n```\ncacheNames = \"product\" //\n\nkey = \"\"  key = \"#sellerid\"() //rediskey\n\ncondition = \"#sellerid.length > 10\" //truefalse\n\nunless = \"#result.getCode() != 0\" //false\n```\n\n\n\n\n```java\n@Cacheable(value=\"user\", key=\"'users_'+#id\")\npublic User redis(Long id){\n    User user = new User();\n    user.setUsername(\"hlhdidi\");\n    user.setPassword(\"123\");\n    user.setUid(1);\n    user.setId(1L);\n    System.out.println(\"log4j2?\");\n    return user;\n}\n```\n\n@CacheEvict   \n\nallEntries = false  product\n\nallEntries = true  key\n\n```java\n@CacheEvict(value=\"thisredis\", key=\"'users_'+#id\",condition=\"#id!=1\")\npublic void delUser(Integer id) {\n    // user\n    System.out.println(\"user\");\n}\n```\n\n@CachePut\n\n@Cacheable@Cacheable\n\n@CacheConfig\n\n@CacheConfig: cacheNames @CacheablecacheNames@CacheablecacheNames\n","slug":"doc-dev/basics/redis","published":1,"updated":"2021-03-09T14:24:44.266Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0db001ksmjr59zie2y1","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Redis BSDkey-value</p>\n<p>Redis  key - value </p>\n<ul>\n<li>Redis</li>\n<li>Rediskey-valuelistsetzsethash</li>\n<li>Redismaster-slave</li>\n</ul>\n<p><img src=\"https://upload.wikimedia.org/wikipedia/en/thumb/6/6b/Redis_Logo.svg/1200px-Redis_Logo.svg.png\" alt=\"redis\"></p>\n<h2 id=\"Redis-\"><a href=\"#Redis-\" class=\"headerlink\" title=\"Redis \"></a>Redis </h2><ul>\n<li>  Redis110000/s,81000/s </li>\n<li>  Redis Strings, Lists, Hashes, Sets  Ordered Sets </li>\n<li>  RedisMULTIEXEC</li>\n<li>  Redis publish/subscribe, , key </li>\n</ul>\n<h2 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h2><p><code>SpringBoot</code> redis</p>\n<p>redis starter pom.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-redis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;starters.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>application.yml</code></p>\n<p>redis</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">    <span class=\"attr\">include:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">redis</span></span><br><span class=\"line\"><span class=\"attr\">app:</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">    <span class=\"attr\">host:</span> <span class=\"string\">redis-dev-3</span> <span class=\"comment\"># redis ip</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">redis.123</span> <span class=\"comment\"># redis </span></span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">app:</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">redis.123</span></span><br><span class=\"line\">    <span class=\"attr\">nodes:</span> <span class=\"string\">redis-dev-1:26379,redis-dev-2:26379,redis-dev-3:26379</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">    <span class=\"attr\">include:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">redis-sentry</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>string <code>@Autowired</code> redisTemplate.<br>RedisTemplateUtil.set(redisTemplate, p, {&quot;a&quot;: &quot;b&quot;}, 3600L);<br><code>key</code> <code>value</code> <code>expireTime</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloWorld</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(value = &quot;/set/redis&quot;, method = RequestMethod.GET)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">setRedis</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;controller set method&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">boolean</span> a = RedisTemplateUtil.set(redisTemplate, <span class=\"string\">&quot;p&quot;</span>, <span class=\"string\">&quot;&#123;\\&quot;a\\&quot;: \\&quot;b\\&quot;&#125;&quot;</span>, <span class=\"number\">3600L</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> redis16 jedis</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JedisConnectionFactory jedisConnectionFactory = (JedisConnectionFactory) redisTemplate.getConnectionFactory();</span><br><span class=\"line\">jedisConnectionFactory.setDatabase(<span class=\"number\">2</span>);</span><br></pre></td></tr></table></figure>\n\n<p>hash</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">checkoutSetHmKey</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    HashOperations&lt;String, Object, Object&gt; hash = redisTemplate.opsForHash();</span><br><span class=\"line\">    Map&lt;String, String&gt; map = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">    map.put(<span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">    hash.putAll(<span class=\"string\">&quot;124242114234214123412&quot;</span>, map);</span><br><span class=\"line\">    RedisTemplateUtil.hmSet(redisTemplate, <span class=\"string\">&quot;s&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h3><p>redis</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@EnableCaching</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringBootStarterRedisApplication</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        SpringApplication.run(SpringBootStarterRedisApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cacheNames &#x3D; &quot;product&quot; &#x2F;&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">key &#x3D; &quot;&quot;  key &#x3D; &quot;#sellerid&quot;() &#x2F;&#x2F;rediskey</span><br><span class=\"line\"></span><br><span class=\"line\">condition &#x3D; &quot;#sellerid.length &gt; 10&quot; &#x2F;&#x2F;truefalse</span><br><span class=\"line\"></span><br><span class=\"line\">unless &#x3D; &quot;#result.getCode() !&#x3D; 0&quot; &#x2F;&#x2F;false</span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Cacheable(value=&quot;user&quot;, key=&quot;&#x27;users_&#x27;+#id&quot;)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">redis</span><span class=\"params\">(Long id)</span></span>&#123;</span><br><span class=\"line\">    User user = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">    user.setUsername(<span class=\"string\">&quot;hlhdidi&quot;</span>);</span><br><span class=\"line\">    user.setPassword(<span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\">    user.setUid(<span class=\"number\">1</span>);</span><br><span class=\"line\">    user.setId(<span class=\"number\">1L</span>);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;log4j2?&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>@CacheEvict   </p>\n<p>allEntries = false  product</p>\n<p>allEntries = true  key</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@CacheEvict(value=&quot;thisredis&quot;, key=&quot;&#x27;users_&#x27;+#id&quot;,condition=&quot;#id!=1&quot;)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">delUser</span><span class=\"params\">(Integer id)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// user</span></span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;user&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>@CachePut</p>\n<p>@Cacheable@Cacheable</p>\n<p>@CacheConfig</p>\n<p>@CacheConfig: cacheNames @CacheablecacheNames@CacheablecacheNames</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Redis BSDkey-value</p>\n<p>Redis  key - value </p>\n<ul>\n<li>Redis</li>\n<li>Rediskey-valuelistsetzsethash</li>\n<li>Redismaster-slave</li>\n</ul>\n<p><img src=\"https://upload.wikimedia.org/wikipedia/en/thumb/6/6b/Redis_Logo.svg/1200px-Redis_Logo.svg.png\" alt=\"redis\"></p>\n<h2 id=\"Redis-\"><a href=\"#Redis-\" class=\"headerlink\" title=\"Redis \"></a>Redis </h2><ul>\n<li>  Redis110000/s,81000/s </li>\n<li>  Redis Strings, Lists, Hashes, Sets  Ordered Sets </li>\n<li>  RedisMULTIEXEC</li>\n<li>  Redis publish/subscribe, , key </li>\n</ul>\n<h2 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h2><p><code>SpringBoot</code> redis</p>\n<p>redis starter pom.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-redis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;starters.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><code>application.yml</code></p>\n<p>redis</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">    <span class=\"attr\">include:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">redis</span></span><br><span class=\"line\"><span class=\"attr\">app:</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">    <span class=\"attr\">host:</span> <span class=\"string\">redis-dev-3</span> <span class=\"comment\"># redis ip</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">redis.123</span> <span class=\"comment\"># redis </span></span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">app:</span></span><br><span class=\"line\">  <span class=\"attr\">redis:</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">redis.123</span></span><br><span class=\"line\">    <span class=\"attr\">nodes:</span> <span class=\"string\">redis-dev-1:26379,redis-dev-2:26379,redis-dev-3:26379</span></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">    <span class=\"attr\">include:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">redis-sentry</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>string <code>@Autowired</code> redisTemplate.<br>RedisTemplateUtil.set(redisTemplate, p, {&quot;a&quot;: &quot;b&quot;}, 3600L);<br><code>key</code> <code>value</code> <code>expireTime</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloWorld</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(value = &quot;/set/redis&quot;, method = RequestMethod.GET)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Boolean <span class=\"title\">setRedis</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;controller set method&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">boolean</span> a = RedisTemplateUtil.set(redisTemplate, <span class=\"string\">&quot;p&quot;</span>, <span class=\"string\">&quot;&#123;\\&quot;a\\&quot;: \\&quot;b\\&quot;&#125;&quot;</span>, <span class=\"number\">3600L</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> redis16 jedis</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JedisConnectionFactory jedisConnectionFactory = (JedisConnectionFactory) redisTemplate.getConnectionFactory();</span><br><span class=\"line\">jedisConnectionFactory.setDatabase(<span class=\"number\">2</span>);</span><br></pre></td></tr></table></figure>\n\n<p>hash</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">checkoutSetHmKey</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    HashOperations&lt;String, Object, Object&gt; hash = redisTemplate.opsForHash();</span><br><span class=\"line\">    Map&lt;String, String&gt; map = <span class=\"keyword\">new</span> HashMap&lt;&gt;();</span><br><span class=\"line\">    map.put(<span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">    hash.putAll(<span class=\"string\">&quot;124242114234214123412&quot;</span>, map);</span><br><span class=\"line\">    RedisTemplateUtil.hmSet(redisTemplate, <span class=\"string\">&quot;s&quot;</span>, <span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Redis\"><a href=\"#Redis\" class=\"headerlink\" title=\"Redis\"></a>Redis</h3><p>redis</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@EnableCaching</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringBootStarterRedisApplication</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        SpringApplication.run(SpringBootStarterRedisApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cacheNames &#x3D; &quot;product&quot; &#x2F;&#x2F;</span><br><span class=\"line\"></span><br><span class=\"line\">key &#x3D; &quot;&quot;  key &#x3D; &quot;#sellerid&quot;() &#x2F;&#x2F;rediskey</span><br><span class=\"line\"></span><br><span class=\"line\">condition &#x3D; &quot;#sellerid.length &gt; 10&quot; &#x2F;&#x2F;truefalse</span><br><span class=\"line\"></span><br><span class=\"line\">unless &#x3D; &quot;#result.getCode() !&#x3D; 0&quot; &#x2F;&#x2F;false</span><br></pre></td></tr></table></figure>\n\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Cacheable(value=&quot;user&quot;, key=&quot;&#x27;users_&#x27;+#id&quot;)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> User <span class=\"title\">redis</span><span class=\"params\">(Long id)</span></span>&#123;</span><br><span class=\"line\">    User user = <span class=\"keyword\">new</span> User();</span><br><span class=\"line\">    user.setUsername(<span class=\"string\">&quot;hlhdidi&quot;</span>);</span><br><span class=\"line\">    user.setPassword(<span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\">    user.setUid(<span class=\"number\">1</span>);</span><br><span class=\"line\">    user.setId(<span class=\"number\">1L</span>);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;log4j2?&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> user;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>@CacheEvict   </p>\n<p>allEntries = false  product</p>\n<p>allEntries = true  key</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@CacheEvict(value=&quot;thisredis&quot;, key=&quot;&#x27;users_&#x27;+#id&quot;,condition=&quot;#id!=1&quot;)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">delUser</span><span class=\"params\">(Integer id)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// user</span></span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;user&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>@CachePut</p>\n<p>@Cacheable@Cacheable</p>\n<p>@CacheConfig</p>\n<p>@CacheConfig: cacheNames @CacheablecacheNames@CacheablecacheNames</p>\n"},{"title":"Sharding-JDBC ","date":"2018-03-11T16:00:00.000Z","_content":"\n## \n\n![](https://avatars2.githubusercontent.com/u/38046546?s=200&v=4)\n\nSharding-JDBCddframedd-rdbSharding-JDBCdubboxelastic-jobddframe3\nSharding-JDBCJDBCJDBC\nSharding-JDBCjavajarproxyDBA\n\n\n\njavaORMJPA, Hibernate, Mybatis, Spring JDBC TemplateJDBC\nDBCP, C3P0, BoneCP, Druid\n\nJDBCMySQLOracleSQLServer\nbetweenin\n\nSQLlimitorBinding Table\nQPSJDBC99.8%QPS94%\n\n## Sharding-JDBCSpringBoot\n\n\n\n1\"ds0..1.torder0..1.torder{0..1}\"\"expressionexpression->{ expression }\"\n\n${begin..end}beginend\n\n${[unit1, unit2, unit_x]}\n\n2orderTableRuleConfig.setActualDataNodes(\"ds0..1.torder0..1.torder{0..1}\");\n\nds0ds1,t_order0t_order1\n\nds0.t_order0, ds0.t_order1, ds1.t_order0, ds1.t_order1\n\n3orderTableRuleConfig.setTableShardingStrategyConfig(new InlineShardingStrategyConfiguration(\"order_id\", \"t_order${order_id % 2}\"));\n\nt_orderorder_id2\n\norder_id=55%2=1t_order1\n\norder_id=6, 6%2=0, t_order0\n\n4\"\"\n\nDataRespository(sharding-sphere-example)","source":"_posts/doc-dev/basics/sharding-jdbc.md","raw":"---\ntitle: Sharding-JDBC \ndate: 2018-03-12\n\n---\n\n## \n\n![](https://avatars2.githubusercontent.com/u/38046546?s=200&v=4)\n\nSharding-JDBCddframedd-rdbSharding-JDBCdubboxelastic-jobddframe3\nSharding-JDBCJDBCJDBC\nSharding-JDBCjavajarproxyDBA\n\n\n\njavaORMJPA, Hibernate, Mybatis, Spring JDBC TemplateJDBC\nDBCP, C3P0, BoneCP, Druid\n\nJDBCMySQLOracleSQLServer\nbetweenin\n\nSQLlimitorBinding Table\nQPSJDBC99.8%QPS94%\n\n## Sharding-JDBCSpringBoot\n\n\n\n1\"ds0..1.torder0..1.torder{0..1}\"\"expressionexpression->{ expression }\"\n\n${begin..end}beginend\n\n${[unit1, unit2, unit_x]}\n\n2orderTableRuleConfig.setActualDataNodes(\"ds0..1.torder0..1.torder{0..1}\");\n\nds0ds1,t_order0t_order1\n\nds0.t_order0, ds0.t_order1, ds1.t_order0, ds1.t_order1\n\n3orderTableRuleConfig.setTableShardingStrategyConfig(new InlineShardingStrategyConfiguration(\"order_id\", \"t_order${order_id % 2}\"));\n\nt_orderorder_id2\n\norder_id=55%2=1t_order1\n\norder_id=6, 6%2=0, t_order0\n\n4\"\"\n\nDataRespository(sharding-sphere-example)","slug":"doc-dev/basics/sharding-jdbc","published":1,"updated":"2021-03-09T14:25:27.994Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0dc001msmjrezff0v9b","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><img src=\"https://avatars2.githubusercontent.com/u/38046546?s=200&v=4\"></p>\n<p>Sharding-JDBCddframedd-rdbSharding-JDBCdubboxelastic-jobddframe3<br>Sharding-JDBCJDBCJDBC<br>Sharding-JDBCjavajarproxyDBA</p>\n<p></p>\n<p>javaORMJPA, Hibernate, Mybatis, Spring JDBC TemplateJDBC<br>DBCP, C3P0, BoneCP, Druid</p>\n<p>JDBCMySQLOracleSQLServer<br>betweenin</p>\n<p>SQLlimitorBinding Table<br>QPSJDBC99.8%QPS94%</p>\n<h2 id=\"Sharding-JDBCSpringBoot\"><a href=\"#Sharding-JDBCSpringBoot\" class=\"headerlink\" title=\"Sharding-JDBCSpringBoot\"></a>Sharding-JDBCSpringBoot</h2><p></p>\n<p>1ds0..1.torder0..1.torder{0..1}expressionexpression-&gt;{ expression }</p>\n<p>${begin..end}beginend</p>\n<p>${[unit1, unit2, unit_x]}</p>\n<p>2orderTableRuleConfig.setActualDataNodes(ds0..1.torder0..1.torder{0..1});</p>\n<p>ds0ds1,t_order0t_order1</p>\n<p>ds0.t_order0, ds0.t_order1, ds1.t_order0, ds1.t_order1</p>\n<p>3orderTableRuleConfig.setTableShardingStrategyConfig(new InlineShardingStrategyConfiguration(order_id, t_order${order_id % 2}));</p>\n<p>t_orderorder_id2</p>\n<p>order_id=55%2=1t_order1</p>\n<p>order_id=6, 6%2=0, t_order0</p>\n<p>4</p>\n<p>DataRespository(sharding-sphere-example)</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><img src=\"https://avatars2.githubusercontent.com/u/38046546?s=200&v=4\"></p>\n<p>Sharding-JDBCddframedd-rdbSharding-JDBCdubboxelastic-jobddframe3<br>Sharding-JDBCJDBCJDBC<br>Sharding-JDBCjavajarproxyDBA</p>\n<p></p>\n<p>javaORMJPA, Hibernate, Mybatis, Spring JDBC TemplateJDBC<br>DBCP, C3P0, BoneCP, Druid</p>\n<p>JDBCMySQLOracleSQLServer<br>betweenin</p>\n<p>SQLlimitorBinding Table<br>QPSJDBC99.8%QPS94%</p>\n<h2 id=\"Sharding-JDBCSpringBoot\"><a href=\"#Sharding-JDBCSpringBoot\" class=\"headerlink\" title=\"Sharding-JDBCSpringBoot\"></a>Sharding-JDBCSpringBoot</h2><p></p>\n<p>1ds0..1.torder0..1.torder{0..1}expressionexpression-&gt;{ expression }</p>\n<p>${begin..end}beginend</p>\n<p>${[unit1, unit2, unit_x]}</p>\n<p>2orderTableRuleConfig.setActualDataNodes(ds0..1.torder0..1.torder{0..1});</p>\n<p>ds0ds1,t_order0t_order1</p>\n<p>ds0.t_order0, ds0.t_order1, ds1.t_order0, ds1.t_order1</p>\n<p>3orderTableRuleConfig.setTableShardingStrategyConfig(new InlineShardingStrategyConfiguration(order_id, t_order${order_id % 2}));</p>\n<p>t_orderorder_id2</p>\n<p>order_id=55%2=1t_order1</p>\n<p>order_id=6, 6%2=0, t_order0</p>\n<p>4</p>\n<p>DataRespository(sharding-sphere-example)</p>\n"},{"title":"SpringBoot ","date":"2018-03-11T16:00:00.000Z","_content":"\n\n\n\n\nSpringSpring Boot\n\n @Transactional \n\n```java\n    @Transactional\n    public void addMoney() throws Exception {\n        //\n        accountMapper.addMoney();\n        //\n        throw new RuntimeException(\"..\");\n    }\n```\n\n\n\n```java\npackage com.hehe.mapper;\n\n@Mapper\npublic interface AccountMapper {\n\n    @Select(\"select * from account where account_id=1\")\n    Account getAccount();\n\n    @Update(\"update account set balance = balance+100 where account_id=1\")\n    void addMoney();\n}\n```\n\n","source":"_posts/doc-dev/basics/transactional.md","raw":"---\ntitle: SpringBoot \ndate: 2018-03-12\n\n---\n\n\n\n\n\nSpringSpring Boot\n\n @Transactional \n\n```java\n    @Transactional\n    public void addMoney() throws Exception {\n        //\n        accountMapper.addMoney();\n        //\n        throw new RuntimeException(\"..\");\n    }\n```\n\n\n\n```java\npackage com.hehe.mapper;\n\n@Mapper\npublic interface AccountMapper {\n\n    @Select(\"select * from account where account_id=1\")\n    Account getAccount();\n\n    @Update(\"update account set balance = balance+100 where account_id=1\")\n    void addMoney();\n}\n```\n\n","slug":"doc-dev/basics/transactional","published":1,"updated":"2021-03-09T14:25:28.759Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0dc001osmjr9t92asds","content":"<p></p>\n<p></p>\n<p>SpringSpring Boot</p>\n<p> @Transactional </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Transactional</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addMoney</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    accountMapper.addMoney();</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(<span class=\"string\">&quot;..&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hehe.mapper;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Mapper</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">AccountMapper</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Select(&quot;select * from account where account_id=1&quot;)</span></span><br><span class=\"line\">    <span class=\"function\">Account <span class=\"title\">getAccount</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Update(&quot;update account set balance = balance+100 where account_id=1&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">addMoney</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<p></p>\n<p></p>\n<p>SpringSpring Boot</p>\n<p> @Transactional </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Transactional</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">addMoney</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    accountMapper.addMoney();</span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(<span class=\"string\">&quot;..&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hehe.mapper;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Mapper</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">AccountMapper</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Select(&quot;select * from account where account_id=1&quot;)</span></span><br><span class=\"line\">    <span class=\"function\">Account <span class=\"title\">getAccount</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Update(&quot;update account set balance = balance+100 where account_id=1&quot;)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">addMoney</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n"},{"title":" ","date":"2018-03-11T16:00:00.000Z","_content":"\n## Hibernate Validator \n\n*   Hibernate Validator    ,\n\n* Hibernate Validator  Bean Validation  . Hibernate Validator  JSR 303  constraint  constraint\nBean Validation  JavaBean API Java Annotations XML Bean Validation \n\n## Hibernate Validator \n\n1. \n2. \n3. \n\n## spring boot hibernate\n\napi   \n\njar\n\n```xml\n        <dependency>\n            <groupId>cn.com.siss</groupId>\n            <artifactId>spring-boot-starter-validate</artifactId>\n        </dependency>\n```\n\n  ValidationUtils.validate(itemInfo);\n\n```java\n\n@RestController\npublic class DemoController {\n\n    @RequestMapping(value = \"demo\", method = RequestMethod.GET)\n    public void demo(@RequestBody ItemInfo itemInfo) throws DataException {\n        ValidationUtils.validate(itemInfo);\n    }\n\n}\n\n```\n\n\n\n||||Hibernate|\n|:---:|:---:|:---:|:---:|:---:|\n|@AssertFalse|Boolean, boolean|  false||\n|@AssertTrue|Boolean, boolean|  true||\n|@DecimalMax|BigDecimal  BigInteger  String  byte  short  int  long HV  Number|. BigDecimal.||\n|@DecimalMin|BigDecimal  BigInteger  String  byte  short  int  long HV  Number|. BigDecimal.||\n|@Digitsinteger =fraction =|BigDecimal  BigInteger  String  byte  short  int  long HV  Number|  integer   fraction \t|(precision)(scale).|\n|@Future|java.util.Date  java.util.Calendar; HV  Joda Time  /APIReadablePartial     ReadableInstant|.||\n|@Max|BigDecimal  BigInteger  byte  short  int  long HV:(  String String  Number|.|check.|\n|@Min|BigDecimal  BigInteger  byte  short  int  long HV:(  String String  Number|.|check.|\n|@NotNull|| |null.|\n|@Null||||\n|@Past|java.util.Date  java.util.Calendar; HV  Joda Time  /APIReadablePartial     ReadableInstant|.||\n|@Pattern(regex=, flag=)|String|matchregex.||\n|@Size(min=, max=)|min max|.||\n|@Valid||, , ,map,.||","source":"_posts/doc-dev/basics/validate.md","raw":"---\ntitle:  \ndate: 2018-03-12\n\n---\n\n## Hibernate Validator \n\n*   Hibernate Validator    ,\n\n* Hibernate Validator  Bean Validation  . Hibernate Validator  JSR 303  constraint  constraint\nBean Validation  JavaBean API Java Annotations XML Bean Validation \n\n## Hibernate Validator \n\n1. \n2. \n3. \n\n## spring boot hibernate\n\napi   \n\njar\n\n```xml\n        <dependency>\n            <groupId>cn.com.siss</groupId>\n            <artifactId>spring-boot-starter-validate</artifactId>\n        </dependency>\n```\n\n  ValidationUtils.validate(itemInfo);\n\n```java\n\n@RestController\npublic class DemoController {\n\n    @RequestMapping(value = \"demo\", method = RequestMethod.GET)\n    public void demo(@RequestBody ItemInfo itemInfo) throws DataException {\n        ValidationUtils.validate(itemInfo);\n    }\n\n}\n\n```\n\n\n\n||||Hibernate|\n|:---:|:---:|:---:|:---:|:---:|\n|@AssertFalse|Boolean, boolean|  false||\n|@AssertTrue|Boolean, boolean|  true||\n|@DecimalMax|BigDecimal  BigInteger  String  byte  short  int  long HV  Number|. BigDecimal.||\n|@DecimalMin|BigDecimal  BigInteger  String  byte  short  int  long HV  Number|. BigDecimal.||\n|@Digitsinteger =fraction =|BigDecimal  BigInteger  String  byte  short  int  long HV  Number|  integer   fraction \t|(precision)(scale).|\n|@Future|java.util.Date  java.util.Calendar; HV  Joda Time  /APIReadablePartial     ReadableInstant|.||\n|@Max|BigDecimal  BigInteger  byte  short  int  long HV:(  String String  Number|.|check.|\n|@Min|BigDecimal  BigInteger  byte  short  int  long HV:(  String String  Number|.|check.|\n|@NotNull|| |null.|\n|@Null||||\n|@Past|java.util.Date  java.util.Calendar; HV  Joda Time  /APIReadablePartial     ReadableInstant|.||\n|@Pattern(regex=, flag=)|String|matchregex.||\n|@Size(min=, max=)|min max|.||\n|@Valid||, , ,map,.||","slug":"doc-dev/basics/validate","published":1,"updated":"2021-03-09T14:25:12.163Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0dd001qsmjr8rehemo0","content":"<h2 id=\"Hibernate-Validator-\"><a href=\"#Hibernate-Validator-\" class=\"headerlink\" title=\"Hibernate Validator \"></a>Hibernate Validator </h2><ul>\n<li><p>  Hibernate Validator    ,</p>\n</li>\n<li><p>Hibernate Validator  Bean Validation  . Hibernate Validator  JSR 303  constraint  constraint<br>Bean Validation  JavaBean API Java Annotations XML Bean Validation </p>\n</li>\n</ul>\n<h2 id=\"Hibernate-Validator-\"><a href=\"#Hibernate-Validator-\" class=\"headerlink\" title=\"Hibernate Validator \"></a>Hibernate Validator </h2><ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<h2 id=\"spring-boot-hibernate\"><a href=\"#spring-boot-hibernate\" class=\"headerlink\" title=\"spring boot hibernate\"></a>spring boot hibernate</h2><p>api   </p>\n<p>jar</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-validate<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>  ValidationUtils.validate(itemInfo);</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DemoController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(value = &quot;demo&quot;, method = RequestMethod.GET)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">demo</span><span class=\"params\">(<span class=\"meta\">@RequestBody</span> ItemInfo itemInfo)</span> <span class=\"keyword\">throws</span> DataException </span>&#123;</span><br><span class=\"line\">        ValidationUtils.validate(itemInfo);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p>||||Hibernate|<br>|::|::|::|::|::|<br>|@AssertFalse|Boolean, boolean|  false||<br>|@AssertTrue|Boolean, boolean|  true||<br>|@DecimalMax|BigDecimal  BigInteger  String  byte  short  int  long HV  Number|. BigDecimal.||<br>|@DecimalMin|BigDecimal  BigInteger  String  byte  short  int  long HV  Number|. BigDecimal.||<br>|@Digitsinteger =fraction =|BigDecimal  BigInteger  String  byte  short  int  long HV  Number|  integer   fraction     |(precision)(scale).|<br>|@Future|java.util.Date  java.util.Calendar; HV  Joda Time  /APIReadablePartial     ReadableInstant|.||<br>|@Max|BigDecimal  BigInteger  byte  short  int  long HV:(  String String  Number|.|check.|<br>|@Min|BigDecimal  BigInteger  byte  short  int  long HV:(  String String  Number|.|check.|<br>|@NotNull|| |null.|<br>|@Null||||<br>|@Past|java.util.Date  java.util.Calendar; HV  Joda Time  /APIReadablePartial     ReadableInstant|.||<br>|@Pattern(regex=, flag=)|String|matchregex.||<br>|@Size(min=, max=)|min max|.||<br>|@Valid||, , ,map,.||</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Hibernate-Validator-\"><a href=\"#Hibernate-Validator-\" class=\"headerlink\" title=\"Hibernate Validator \"></a>Hibernate Validator </h2><ul>\n<li><p>  Hibernate Validator    ,</p>\n</li>\n<li><p>Hibernate Validator  Bean Validation  . Hibernate Validator  JSR 303  constraint  constraint<br>Bean Validation  JavaBean API Java Annotations XML Bean Validation </p>\n</li>\n</ul>\n<h2 id=\"Hibernate-Validator-\"><a href=\"#Hibernate-Validator-\" class=\"headerlink\" title=\"Hibernate Validator \"></a>Hibernate Validator </h2><ol>\n<li></li>\n<li></li>\n<li></li>\n</ol>\n<h2 id=\"spring-boot-hibernate\"><a href=\"#spring-boot-hibernate\" class=\"headerlink\" title=\"spring boot hibernate\"></a>spring boot hibernate</h2><p>api   </p>\n<p>jar</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-validate<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>  ValidationUtils.validate(itemInfo);</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DemoController</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(value = &quot;demo&quot;, method = RequestMethod.GET)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">demo</span><span class=\"params\">(<span class=\"meta\">@RequestBody</span> ItemInfo itemInfo)</span> <span class=\"keyword\">throws</span> DataException </span>&#123;</span><br><span class=\"line\">        ValidationUtils.validate(itemInfo);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p>||||Hibernate|<br>|::|::|::|::|::|<br>|@AssertFalse|Boolean, boolean|  false||<br>|@AssertTrue|Boolean, boolean|  true||<br>|@DecimalMax|BigDecimal  BigInteger  String  byte  short  int  long HV  Number|. BigDecimal.||<br>|@DecimalMin|BigDecimal  BigInteger  String  byte  short  int  long HV  Number|. BigDecimal.||<br>|@Digitsinteger =fraction =|BigDecimal  BigInteger  String  byte  short  int  long HV  Number|  integer   fraction     |(precision)(scale).|<br>|@Future|java.util.Date  java.util.Calendar; HV  Joda Time  /APIReadablePartial     ReadableInstant|.||<br>|@Max|BigDecimal  BigInteger  byte  short  int  long HV:(  String String  Number|.|check.|<br>|@Min|BigDecimal  BigInteger  byte  short  int  long HV:(  String String  Number|.|check.|<br>|@NotNull|| |null.|<br>|@Null||||<br>|@Past|java.util.Date  java.util.Calendar; HV  Joda Time  /APIReadablePartial     ReadableInstant|.||<br>|@Pattern(regex=, flag=)|String|matchregex.||<br>|@Size(min=, max=)|min max|.||<br>|@Valid||, , ,map,.||</p>\n"},{"title":"Mybatis-Plus ","date":"2018-02-22T16:00:00.000Z","_content":"\n## \n\nMybatis-PlusMP Mybatis  Mybatis mybatis-plusmybatis-pluscrudxmlJPA\n\n## Mybatis-Plus\n\nSpringBoot Mybatis-Plus\n\nMybatis-Plus\n\n```xml\n        <dependency>\n            <groupId>cn.com.siss</groupId>\n            <artifactId>spring-boot-starter-mybatis-plus</artifactId>\n            <version>${starters.version}</version>\n        </dependency>\n\n<!-- mybatis Mybatis Generator -->\n            <plugin>\n                <groupId>org.mybatis.generator</groupId>\n                <artifactId>mybatis-generator-maven-plugin</artifactId>\n                <version>1.3.5</version>\n                <configuration>\n                    <verbose>true</verbose>\n                    <overwrite>true</overwrite>\n                </configuration>\n            </plugin>\n\n\n        <resources>\n            <resource>\n                <directory>src/main/java</directory>\n                <includes>\n                    <include>**/*.xml</include>\n                </includes>\n            </resource>\n            <!---->\n            <resource>\n                <directory>src/main/resources</directory>\n            </resource>\n        </resources>\n```\n\nentity mapper\n\n```yaml\n\nspring:\n  profiles:\n    include:\n      - mybatisplus-rws\nmybatis:\n  typeAliasesPackage: \"cn.com.siss.web.entity\"\n  #checkConfig-location : false\n  mapper-locations: \"classpath:cn/com/siss/web/mapper/xml/*Mapper.xml\"\n\n```\n\n`@MapperScan(\"cn.com.siss.web.mapper*\")` \n\n```java\n@SpringBootApplication\n@MapperScan(\"cn.com.siss.web.mapper*\")\npublic class DemoWebApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(DemoWebApplication.class, args);\n    }\n\n}\n```\n\nname , username, password\n\n```yaml\napp:\n  datasource:\n    name: demo #\n    read:\n      host: mysql-ro-local #   host  mysql-ro-${spring.active.profile}\n      port: 3306 #   port  3306\n    write:\n      host: mysql-local #   host  mysql-${spring.active.profile}\n      port: 3307 #   port  3306\n    username: root\n    password: gUa7c4GulFZluORvMIEdC5Jm6P7UMs0VfCHErThG2AUz/DOvb/e0dHkcBGmtmzyURYQXTxxQngjR4+ccYc/J1Q==\n    druid:\n      public-key: MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJc1VMKK8to2/8IjwA/7QG8qASZl0PWGnZKgNruPAJxAmQQtEMvsFGu6uD3rTfCbFrD4CtNuNz0B3bX067oQZI0CAwEAAQ==\n```\n\n\n\ndurid.jar [druid.jar](http://central.maven.org/maven2/com/alibaba/druid/1.1.9/druid-1.1.9.jar)\n\n\n```bash\njava -cp  druid-1.1.9.jar com.alibaba.druid.filter.config.ConfigTools yourpassword\n\nprivateKey:MIIBVQIBADANBgkqhkiG9w0BAQEFAASCAT8wggE7AgEAAkEAiVDuSXMyYybL6zxlGvOwAOuxTyWeOKCXWYv5+Kfwz2CE08+UczVi07GmMlUT5Z3RxpEuDKKqVYylAgpC7D8QwQIDAQABAkBRDwxLIYyKCVnxGCra+SVZtchqX1uCNBKEEuRSC9lUoNaAhSzUrS6uX9eqlGYaFB11iRUmO33PFX2tJe4ez3nRAiEA2ittzLPt9kbh8t3ZAysr5KUpG4m7Xclfij+pvMbrJU0CIQChIGg0CD2CUtdSwXMlv34VzVuWdNglNFZdSoWqJSiPRQIgL/hgmiPt7LrFL6uL7eBuNEYEdeOg6QxAD5vT7IgoZ/kCIQCBQ391ptq5z/4A3UOkmADuOsbsaKbzCg7zXxLm0lK8xQIhAL1hb6D4zkzDhMXBuWKXX1sf+yPXr5uqNOk7Qd1DyFzo\npublicKey:MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAIlQ7klzMmMmy+s8ZRrzsADrsU8lnjigl1mL+fin8M9ghNPPlHM1YtOxpjJVE+Wd0caRLgyiqlWMpQIKQuw/EMECAwEAAQ==\npassword:IAsFFJu/MU7b3yXUp+v3AiGzxRxp3C/C6W2CXUPyrfH8V52CloF/JAoV4gNvEWUunQkBFYDX6KwgF+7KYJopjg==\n```\n\n`publicKey``password`application.yml\n\nmapper.java\n\n```java\nimport cn.com.siss.web.entity.TbDemo;\n\npublic interface TbDemoMapper {\n    int insert(TbDemo record);\n\n    int insertSelective(TbDemo record);\n\n    TbDemo get(Integer id);\n}\n```\n\nmapper.xml\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n<mapper namespace=\"cn.com.siss.web.mapper.TbDemoMapper\">\n  <resultMap id=\"BaseResultMap\" type=\"cn.com.siss.web.entity.TbDemo\">\n    <result column=\"id\" jdbcType=\"INTEGER\" property=\"id\" />\n    <result column=\"name\" jdbcType=\"VARCHAR\" property=\"name\" />\n  </resultMap>\n  <insert id=\"insert\" parameterType=\"cn.com.siss.web.entity.TbDemo\">\n    insert into tb_demo (id, name)\n    values (#{id,jdbcType=INTEGER}, #{name,jdbcType=VARCHAR})\n  </insert>\n  <insert id=\"insertSelective\" parameterType=\"cn.com.siss.web.entity.TbDemo\">\n    insert into tb_demo\n    <trim prefix=\"(\" suffix=\")\" suffixOverrides=\",\">\n      <if test=\"id != null\">\n        id,\n      </if>\n      <if test=\"name != null\">\n        name,\n      </if>\n    </trim>\n    <trim prefix=\"values (\" suffix=\")\" suffixOverrides=\",\">\n      <if test=\"id != null\">\n        #{id,jdbcType=INTEGER},\n      </if>\n      <if test=\"name != null\">\n        #{name,jdbcType=VARCHAR},\n      </if>\n    </trim>\n  </insert>\n\n  <select id=\"get\" parameterType=\"integer\" resultType=\"cn.com.siss.web.entity.TbDemo\">\n    select * from tb_demo where id = #{id}\n  </select>\n</mapper>\n```\n\n\n\n```java\n    @Autowired\n    private TbDemoMapper tbDemoMapper;\n\n    @Test\n    public void get() {\n        TbDemo tbDemo = tbDemoMapper.get(1);\n        System.out.println(tbDemo.getName());\n    }\n\n    @Test\n    public void insert() {\n        TbDemo tbDemo = new TbDemo();\n        tbDemo.setId(1);\n        tbDemo.setName(\"aa\");\n        tbDemoMapper.insert(tbDemo);\n    }\n```","source":"_posts/doc-dev/basics/mybatis-plus.md","raw":"---\ntitle: Mybatis-Plus \ndate: 2018-02-23\n\n---\n\n## \n\nMybatis-PlusMP Mybatis  Mybatis mybatis-plusmybatis-pluscrudxmlJPA\n\n## Mybatis-Plus\n\nSpringBoot Mybatis-Plus\n\nMybatis-Plus\n\n```xml\n        <dependency>\n            <groupId>cn.com.siss</groupId>\n            <artifactId>spring-boot-starter-mybatis-plus</artifactId>\n            <version>${starters.version}</version>\n        </dependency>\n\n<!-- mybatis Mybatis Generator -->\n            <plugin>\n                <groupId>org.mybatis.generator</groupId>\n                <artifactId>mybatis-generator-maven-plugin</artifactId>\n                <version>1.3.5</version>\n                <configuration>\n                    <verbose>true</verbose>\n                    <overwrite>true</overwrite>\n                </configuration>\n            </plugin>\n\n\n        <resources>\n            <resource>\n                <directory>src/main/java</directory>\n                <includes>\n                    <include>**/*.xml</include>\n                </includes>\n            </resource>\n            <!---->\n            <resource>\n                <directory>src/main/resources</directory>\n            </resource>\n        </resources>\n```\n\nentity mapper\n\n```yaml\n\nspring:\n  profiles:\n    include:\n      - mybatisplus-rws\nmybatis:\n  typeAliasesPackage: \"cn.com.siss.web.entity\"\n  #checkConfig-location : false\n  mapper-locations: \"classpath:cn/com/siss/web/mapper/xml/*Mapper.xml\"\n\n```\n\n`@MapperScan(\"cn.com.siss.web.mapper*\")` \n\n```java\n@SpringBootApplication\n@MapperScan(\"cn.com.siss.web.mapper*\")\npublic class DemoWebApplication {\n\n    public static void main(String[] args) {\n        SpringApplication.run(DemoWebApplication.class, args);\n    }\n\n}\n```\n\nname , username, password\n\n```yaml\napp:\n  datasource:\n    name: demo #\n    read:\n      host: mysql-ro-local #   host  mysql-ro-${spring.active.profile}\n      port: 3306 #   port  3306\n    write:\n      host: mysql-local #   host  mysql-${spring.active.profile}\n      port: 3307 #   port  3306\n    username: root\n    password: gUa7c4GulFZluORvMIEdC5Jm6P7UMs0VfCHErThG2AUz/DOvb/e0dHkcBGmtmzyURYQXTxxQngjR4+ccYc/J1Q==\n    druid:\n      public-key: MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJc1VMKK8to2/8IjwA/7QG8qASZl0PWGnZKgNruPAJxAmQQtEMvsFGu6uD3rTfCbFrD4CtNuNz0B3bX067oQZI0CAwEAAQ==\n```\n\n\n\ndurid.jar [druid.jar](http://central.maven.org/maven2/com/alibaba/druid/1.1.9/druid-1.1.9.jar)\n\n\n```bash\njava -cp  druid-1.1.9.jar com.alibaba.druid.filter.config.ConfigTools yourpassword\n\nprivateKey:MIIBVQIBADANBgkqhkiG9w0BAQEFAASCAT8wggE7AgEAAkEAiVDuSXMyYybL6zxlGvOwAOuxTyWeOKCXWYv5+Kfwz2CE08+UczVi07GmMlUT5Z3RxpEuDKKqVYylAgpC7D8QwQIDAQABAkBRDwxLIYyKCVnxGCra+SVZtchqX1uCNBKEEuRSC9lUoNaAhSzUrS6uX9eqlGYaFB11iRUmO33PFX2tJe4ez3nRAiEA2ittzLPt9kbh8t3ZAysr5KUpG4m7Xclfij+pvMbrJU0CIQChIGg0CD2CUtdSwXMlv34VzVuWdNglNFZdSoWqJSiPRQIgL/hgmiPt7LrFL6uL7eBuNEYEdeOg6QxAD5vT7IgoZ/kCIQCBQ391ptq5z/4A3UOkmADuOsbsaKbzCg7zXxLm0lK8xQIhAL1hb6D4zkzDhMXBuWKXX1sf+yPXr5uqNOk7Qd1DyFzo\npublicKey:MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAIlQ7klzMmMmy+s8ZRrzsADrsU8lnjigl1mL+fin8M9ghNPPlHM1YtOxpjJVE+Wd0caRLgyiqlWMpQIKQuw/EMECAwEAAQ==\npassword:IAsFFJu/MU7b3yXUp+v3AiGzxRxp3C/C6W2CXUPyrfH8V52CloF/JAoV4gNvEWUunQkBFYDX6KwgF+7KYJopjg==\n```\n\n`publicKey``password`application.yml\n\nmapper.java\n\n```java\nimport cn.com.siss.web.entity.TbDemo;\n\npublic interface TbDemoMapper {\n    int insert(TbDemo record);\n\n    int insertSelective(TbDemo record);\n\n    TbDemo get(Integer id);\n}\n```\n\nmapper.xml\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\">\n<mapper namespace=\"cn.com.siss.web.mapper.TbDemoMapper\">\n  <resultMap id=\"BaseResultMap\" type=\"cn.com.siss.web.entity.TbDemo\">\n    <result column=\"id\" jdbcType=\"INTEGER\" property=\"id\" />\n    <result column=\"name\" jdbcType=\"VARCHAR\" property=\"name\" />\n  </resultMap>\n  <insert id=\"insert\" parameterType=\"cn.com.siss.web.entity.TbDemo\">\n    insert into tb_demo (id, name)\n    values (#{id,jdbcType=INTEGER}, #{name,jdbcType=VARCHAR})\n  </insert>\n  <insert id=\"insertSelective\" parameterType=\"cn.com.siss.web.entity.TbDemo\">\n    insert into tb_demo\n    <trim prefix=\"(\" suffix=\")\" suffixOverrides=\",\">\n      <if test=\"id != null\">\n        id,\n      </if>\n      <if test=\"name != null\">\n        name,\n      </if>\n    </trim>\n    <trim prefix=\"values (\" suffix=\")\" suffixOverrides=\",\">\n      <if test=\"id != null\">\n        #{id,jdbcType=INTEGER},\n      </if>\n      <if test=\"name != null\">\n        #{name,jdbcType=VARCHAR},\n      </if>\n    </trim>\n  </insert>\n\n  <select id=\"get\" parameterType=\"integer\" resultType=\"cn.com.siss.web.entity.TbDemo\">\n    select * from tb_demo where id = #{id}\n  </select>\n</mapper>\n```\n\n\n\n```java\n    @Autowired\n    private TbDemoMapper tbDemoMapper;\n\n    @Test\n    public void get() {\n        TbDemo tbDemo = tbDemoMapper.get(1);\n        System.out.println(tbDemo.getName());\n    }\n\n    @Test\n    public void insert() {\n        TbDemo tbDemo = new TbDemo();\n        tbDemo.setId(1);\n        tbDemo.setName(\"aa\");\n        tbDemoMapper.insert(tbDemo);\n    }\n```","slug":"doc-dev/basics/mybatis-plus","published":1,"updated":"2021-03-09T14:25:27.421Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0de001ssmjrd44a940v","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Mybatis-PlusMP Mybatis  Mybatis mybatis-plusmybatis-pluscrudxmlJPA</p>\n<h2 id=\"Mybatis-Plus\"><a href=\"#Mybatis-Plus\" class=\"headerlink\" title=\"Mybatis-Plus\"></a>Mybatis-Plus</h2><p>SpringBoot Mybatis-Plus</p>\n<p>Mybatis-Plus</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-mybatis-plus<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;starters.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- mybatis Mybatis Generator --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis.generator<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">verbose</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">verbose</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">overwrite</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">overwrite</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">directory</span>&gt;</span>src/main/java<span class=\"tag\">&lt;/<span class=\"name\">directory</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>**/*.xml<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">directory</span>&gt;</span>src/main/resources<span class=\"tag\">&lt;/<span class=\"name\">directory</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>entity mapper</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">    <span class=\"attr\">include:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">mybatisplus-rws</span></span><br><span class=\"line\"><span class=\"attr\">mybatis:</span></span><br><span class=\"line\">  <span class=\"attr\">typeAliasesPackage:</span> <span class=\"string\">&quot;cn.com.siss.web.entity&quot;</span></span><br><span class=\"line\">  <span class=\"comment\">#checkConfig-location : false</span></span><br><span class=\"line\">  <span class=\"attr\">mapper-locations:</span> <span class=\"string\">&quot;classpath:cn/com/siss/web/mapper/xml/*Mapper.xml&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>@MapperScan(&quot;cn.com.siss.web.mapper*&quot;)</code> </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@MapperScan(&quot;cn.com.siss.web.mapper*&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DemoWebApplication</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        SpringApplication.run(DemoWebApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>name , username, password</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">app:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">demo</span> <span class=\"comment\">#</span></span><br><span class=\"line\">    <span class=\"attr\">read:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"string\">mysql-ro-local</span> <span class=\"comment\">#   host  mysql-ro-$&#123;spring.active.profile&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">3306</span> <span class=\"comment\">#   port  3306</span></span><br><span class=\"line\">    <span class=\"attr\">write:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"string\">mysql-local</span> <span class=\"comment\">#   host  mysql-$&#123;spring.active.profile&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">3307</span> <span class=\"comment\">#   port  3306</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">gUa7c4GulFZluORvMIEdC5Jm6P7UMs0VfCHErThG2AUz/DOvb/e0dHkcBGmtmzyURYQXTxxQngjR4+ccYc/J1Q==</span></span><br><span class=\"line\">    <span class=\"attr\">druid:</span></span><br><span class=\"line\">      <span class=\"attr\">public-key:</span> <span class=\"string\">MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJc1VMKK8to2/8IjwA/7QG8qASZl0PWGnZKgNruPAJxAmQQtEMvsFGu6uD3rTfCbFrD4CtNuNz0B3bX067oQZI0CAwEAAQ==</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p>durid.jar <a class=\"link\" href=\"http://central.maven.org/maven2/com/alibaba/druid/1.1.9/druid-1.1.9.jar\">druid.jar<i class=\"fas fa-external-link-alt\"></i></a><br></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -cp  druid-1.1.9.jar com.alibaba.druid.filter.config.ConfigTools yourpassword</span><br><span class=\"line\"></span><br><span class=\"line\">privateKey:MIIBVQIBADANBgkqhkiG9w0BAQEFAASCAT8wggE7AgEAAkEAiVDuSXMyYybL6zxlGvOwAOuxTyWeOKCXWYv5+Kfwz2CE08+UczVi07GmMlUT5Z3RxpEuDKKqVYylAgpC7D8QwQIDAQABAkBRDwxLIYyKCVnxGCra+SVZtchqX1uCNBKEEuRSC9lUoNaAhSzUrS6uX9eqlGYaFB11iRUmO33PFX2tJe4ez3nRAiEA2ittzLPt9kbh8t3ZAysr5KUpG4m7Xclfij+pvMbrJU0CIQChIGg0CD2CUtdSwXMlv34VzVuWdNglNFZdSoWqJSiPRQIgL/hgmiPt7LrFL6uL7eBuNEYEdeOg6QxAD5vT7IgoZ/kCIQCBQ391ptq5z/4A3UOkmADuOsbsaKbzCg7zXxLm0lK8xQIhAL1hb6D4zkzDhMXBuWKXX1sf+yPXr5uqNOk7Qd1DyFzo</span><br><span class=\"line\">publicKey:MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAIlQ7klzMmMmy+s8ZRrzsADrsU8lnjigl1mL+fin8M9ghNPPlHM1YtOxpjJVE+Wd0caRLgyiqlWMpQIKQuw/EMECAwEAAQ==</span><br><span class=\"line\">password:IAsFFJu/MU7b3yXUp+v3AiGzxRxp3C/C6W2CXUPyrfH8V52CloF/JAoV4gNvEWUunQkBFYDX6KwgF+7KYJopjg==</span><br></pre></td></tr></table></figure>\n\n<p><code>publicKey</code><code>password</code>application.yml</p>\n<p>mapper.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> cn.com.siss.web.entity.TbDemo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">TbDemoMapper</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">insert</span><span class=\"params\">(TbDemo record)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">insertSelective</span><span class=\"params\">(TbDemo record)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">TbDemo <span class=\"title\">get</span><span class=\"params\">(Integer id)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>mapper.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">mapper</span> <span class=\"meta-keyword\">PUBLIC</span> <span class=\"meta-string\">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class=\"meta-string\">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">&quot;cn.com.siss.web.mapper.TbDemoMapper&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">resultMap</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;BaseResultMap&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;cn.com.siss.web.entity.TbDemo&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;id&quot;</span> <span class=\"attr\">jdbcType</span>=<span class=\"string\">&quot;INTEGER&quot;</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;id&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">jdbcType</span>=<span class=\"string\">&quot;VARCHAR&quot;</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;name&quot;</span> /&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">resultMap</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;insert&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;cn.com.siss.web.entity.TbDemo&quot;</span>&gt;</span></span><br><span class=\"line\">    insert into tb_demo (id, name)</span><br><span class=\"line\">    values (#&#123;id,jdbcType=INTEGER&#125;, #&#123;name,jdbcType=VARCHAR&#125;)</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;insertSelective&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;cn.com.siss.web.entity.TbDemo&quot;</span>&gt;</span></span><br><span class=\"line\">    insert into tb_demo</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">trim</span> <span class=\"attr\">prefix</span>=<span class=\"string\">&quot;(&quot;</span> <span class=\"attr\">suffix</span>=<span class=\"string\">&quot;)&quot;</span> <span class=\"attr\">suffixOverrides</span>=<span class=\"string\">&quot;,&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;id != null&quot;</span>&gt;</span></span><br><span class=\"line\">        id,</span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;name != null&quot;</span>&gt;</span></span><br><span class=\"line\">        name,</span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">trim</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">trim</span> <span class=\"attr\">prefix</span>=<span class=\"string\">&quot;values (&quot;</span> <span class=\"attr\">suffix</span>=<span class=\"string\">&quot;)&quot;</span> <span class=\"attr\">suffixOverrides</span>=<span class=\"string\">&quot;,&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;id != null&quot;</span>&gt;</span></span><br><span class=\"line\">        #&#123;id,jdbcType=INTEGER&#125;,</span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;name != null&quot;</span>&gt;</span></span><br><span class=\"line\">        #&#123;name,jdbcType=VARCHAR&#125;,</span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">trim</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;get&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;integer&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;cn.com.siss.web.entity.TbDemo&quot;</span>&gt;</span></span><br><span class=\"line\">    select * from tb_demo where id = #&#123;id&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> TbDemoMapper tbDemoMapper;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">get</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    TbDemo tbDemo = tbDemoMapper.get(<span class=\"number\">1</span>);</span><br><span class=\"line\">    System.out.println(tbDemo.getName());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    TbDemo tbDemo = <span class=\"keyword\">new</span> TbDemo();</span><br><span class=\"line\">    tbDemo.setId(<span class=\"number\">1</span>);</span><br><span class=\"line\">    tbDemo.setName(<span class=\"string\">&quot;aa&quot;</span>);</span><br><span class=\"line\">    tbDemoMapper.insert(tbDemo);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Mybatis-PlusMP Mybatis  Mybatis mybatis-plusmybatis-pluscrudxmlJPA</p>\n<h2 id=\"Mybatis-Plus\"><a href=\"#Mybatis-Plus\" class=\"headerlink\" title=\"Mybatis-Plus\"></a>Mybatis-Plus</h2><p>SpringBoot Mybatis-Plus</p>\n<p>Mybatis-Plus</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>cn.com.siss<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-mybatis-plus<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;starters.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- mybatis Mybatis Generator --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.mybatis.generator<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.3.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">verbose</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">verbose</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">overwrite</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">overwrite</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">resources</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">directory</span>&gt;</span>src/main/java<span class=\"tag\">&lt;/<span class=\"name\">directory</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">include</span>&gt;</span>**/*.xml<span class=\"tag\">&lt;/<span class=\"name\">include</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">includes</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!----&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">directory</span>&gt;</span>src/main/resources<span class=\"tag\">&lt;/<span class=\"name\">directory</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">resource</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>entity mapper</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">spring:</span></span><br><span class=\"line\">  <span class=\"attr\">profiles:</span></span><br><span class=\"line\">    <span class=\"attr\">include:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">mybatisplus-rws</span></span><br><span class=\"line\"><span class=\"attr\">mybatis:</span></span><br><span class=\"line\">  <span class=\"attr\">typeAliasesPackage:</span> <span class=\"string\">&quot;cn.com.siss.web.entity&quot;</span></span><br><span class=\"line\">  <span class=\"comment\">#checkConfig-location : false</span></span><br><span class=\"line\">  <span class=\"attr\">mapper-locations:</span> <span class=\"string\">&quot;classpath:cn/com/siss/web/mapper/xml/*Mapper.xml&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><code>@MapperScan(&quot;cn.com.siss.web.mapper*&quot;)</code> </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@MapperScan(&quot;cn.com.siss.web.mapper*&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DemoWebApplication</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        SpringApplication.run(DemoWebApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>name , username, password</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">app:</span></span><br><span class=\"line\">  <span class=\"attr\">datasource:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">demo</span> <span class=\"comment\">#</span></span><br><span class=\"line\">    <span class=\"attr\">read:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"string\">mysql-ro-local</span> <span class=\"comment\">#   host  mysql-ro-$&#123;spring.active.profile&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">3306</span> <span class=\"comment\">#   port  3306</span></span><br><span class=\"line\">    <span class=\"attr\">write:</span></span><br><span class=\"line\">      <span class=\"attr\">host:</span> <span class=\"string\">mysql-local</span> <span class=\"comment\">#   host  mysql-$&#123;spring.active.profile&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">3307</span> <span class=\"comment\">#   port  3306</span></span><br><span class=\"line\">    <span class=\"attr\">username:</span> <span class=\"string\">root</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">gUa7c4GulFZluORvMIEdC5Jm6P7UMs0VfCHErThG2AUz/DOvb/e0dHkcBGmtmzyURYQXTxxQngjR4+ccYc/J1Q==</span></span><br><span class=\"line\">    <span class=\"attr\">druid:</span></span><br><span class=\"line\">      <span class=\"attr\">public-key:</span> <span class=\"string\">MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAJc1VMKK8to2/8IjwA/7QG8qASZl0PWGnZKgNruPAJxAmQQtEMvsFGu6uD3rTfCbFrD4CtNuNz0B3bX067oQZI0CAwEAAQ==</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p>durid.jar <a class=\"link\" href=\"http://central.maven.org/maven2/com/alibaba/druid/1.1.9/druid-1.1.9.jar\">druid.jar<i class=\"fas fa-external-link-alt\"></i></a><br></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -cp  druid-1.1.9.jar com.alibaba.druid.filter.config.ConfigTools yourpassword</span><br><span class=\"line\"></span><br><span class=\"line\">privateKey:MIIBVQIBADANBgkqhkiG9w0BAQEFAASCAT8wggE7AgEAAkEAiVDuSXMyYybL6zxlGvOwAOuxTyWeOKCXWYv5+Kfwz2CE08+UczVi07GmMlUT5Z3RxpEuDKKqVYylAgpC7D8QwQIDAQABAkBRDwxLIYyKCVnxGCra+SVZtchqX1uCNBKEEuRSC9lUoNaAhSzUrS6uX9eqlGYaFB11iRUmO33PFX2tJe4ez3nRAiEA2ittzLPt9kbh8t3ZAysr5KUpG4m7Xclfij+pvMbrJU0CIQChIGg0CD2CUtdSwXMlv34VzVuWdNglNFZdSoWqJSiPRQIgL/hgmiPt7LrFL6uL7eBuNEYEdeOg6QxAD5vT7IgoZ/kCIQCBQ391ptq5z/4A3UOkmADuOsbsaKbzCg7zXxLm0lK8xQIhAL1hb6D4zkzDhMXBuWKXX1sf+yPXr5uqNOk7Qd1DyFzo</span><br><span class=\"line\">publicKey:MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAIlQ7klzMmMmy+s8ZRrzsADrsU8lnjigl1mL+fin8M9ghNPPlHM1YtOxpjJVE+Wd0caRLgyiqlWMpQIKQuw/EMECAwEAAQ==</span><br><span class=\"line\">password:IAsFFJu/MU7b3yXUp+v3AiGzxRxp3C/C6W2CXUPyrfH8V52CloF/JAoV4gNvEWUunQkBFYDX6KwgF+7KYJopjg==</span><br></pre></td></tr></table></figure>\n\n<p><code>publicKey</code><code>password</code>application.yml</p>\n<p>mapper.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> cn.com.siss.web.entity.TbDemo;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">TbDemoMapper</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">insert</span><span class=\"params\">(TbDemo record)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">insertSelective</span><span class=\"params\">(TbDemo record)</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\">TbDemo <span class=\"title\">get</span><span class=\"params\">(Integer id)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>mapper.xml</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE <span class=\"meta-keyword\">mapper</span> <span class=\"meta-keyword\">PUBLIC</span> <span class=\"meta-string\">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class=\"meta-string\">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">mapper</span> <span class=\"attr\">namespace</span>=<span class=\"string\">&quot;cn.com.siss.web.mapper.TbDemoMapper&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">resultMap</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;BaseResultMap&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;cn.com.siss.web.entity.TbDemo&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;id&quot;</span> <span class=\"attr\">jdbcType</span>=<span class=\"string\">&quot;INTEGER&quot;</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;id&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">result</span> <span class=\"attr\">column</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">jdbcType</span>=<span class=\"string\">&quot;VARCHAR&quot;</span> <span class=\"attr\">property</span>=<span class=\"string\">&quot;name&quot;</span> /&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">resultMap</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;insert&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;cn.com.siss.web.entity.TbDemo&quot;</span>&gt;</span></span><br><span class=\"line\">    insert into tb_demo (id, name)</span><br><span class=\"line\">    values (#&#123;id,jdbcType=INTEGER&#125;, #&#123;name,jdbcType=VARCHAR&#125;)</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">insert</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;insertSelective&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;cn.com.siss.web.entity.TbDemo&quot;</span>&gt;</span></span><br><span class=\"line\">    insert into tb_demo</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">trim</span> <span class=\"attr\">prefix</span>=<span class=\"string\">&quot;(&quot;</span> <span class=\"attr\">suffix</span>=<span class=\"string\">&quot;)&quot;</span> <span class=\"attr\">suffixOverrides</span>=<span class=\"string\">&quot;,&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;id != null&quot;</span>&gt;</span></span><br><span class=\"line\">        id,</span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;name != null&quot;</span>&gt;</span></span><br><span class=\"line\">        name,</span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">trim</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">trim</span> <span class=\"attr\">prefix</span>=<span class=\"string\">&quot;values (&quot;</span> <span class=\"attr\">suffix</span>=<span class=\"string\">&quot;)&quot;</span> <span class=\"attr\">suffixOverrides</span>=<span class=\"string\">&quot;,&quot;</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;id != null&quot;</span>&gt;</span></span><br><span class=\"line\">        #&#123;id,jdbcType=INTEGER&#125;,</span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">if</span> <span class=\"attr\">test</span>=<span class=\"string\">&quot;name != null&quot;</span>&gt;</span></span><br><span class=\"line\">        #&#123;name,jdbcType=VARCHAR&#125;,</span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">if</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">trim</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">insert</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">select</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;get&quot;</span> <span class=\"attr\">parameterType</span>=<span class=\"string\">&quot;integer&quot;</span> <span class=\"attr\">resultType</span>=<span class=\"string\">&quot;cn.com.siss.web.entity.TbDemo&quot;</span>&gt;</span></span><br><span class=\"line\">    select * from tb_demo where id = #&#123;id&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">select</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> TbDemoMapper tbDemoMapper;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">get</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    TbDemo tbDemo = tbDemoMapper.get(<span class=\"number\">1</span>);</span><br><span class=\"line\">    System.out.println(tbDemo.getName());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">insert</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    TbDemo tbDemo = <span class=\"keyword\">new</span> TbDemo();</span><br><span class=\"line\">    tbDemo.setId(<span class=\"number\">1</span>);</span><br><span class=\"line\">    tbDemo.setName(<span class=\"string\">&quot;aa&quot;</span>);</span><br><span class=\"line\">    tbDemoMapper.insert(tbDemo);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"SpringBootSwagger2","date":"2019-03-11T16:00:00.000Z","_content":"\n## \n\nApi\n\n1. \n2. \n3. postman\n4. \n5. SwaggerSwagger\n\n## \n\n`pom.xml`\n\n```xml\n<dependency>\n\t<groupId>io.springfox</groupId>\n\t<artifactId>springfox-swagger2</artifactId>\n\t<version>2.6.1</version>\n</dependency>\n\n\n<dependency>\n\t<groupId>io.springfox</groupId>\n\t<artifactId>springfox-swagger-ui</artifactId>\n\t<version>2.6.1</version>\n</dependency>\n```\n\nswagger \n\n```java\n@SpringBootApplication\n@EnableSwagger2\npublic class SpringbootSwagger2Application {\n\npublic static void main(String[] args) {\n\tSpringApplication.run(SpringbootSwagger2Application.class, args);\n}\n}\n```\n\n### demo\n\n```java\n@RestController\n@Api(\"Hello-world api\")\npublic class HelloWorld {\n\n    @Autowired\n    private HelloRpcService helloRpcService;\n\n    @Autowired\n    private RedisTemplate redisTemplate;\n\n    @Autowired\n    private KafkaTemplate kafkaTemplate;\n\n    @ApiOperation(\"rpc\")\n    @ApiImplicitParams({\n            @ApiImplicitParam(paramType=\"header\",name=\"username\",dataType=\"String\",required=true,value=\"\",defaultValue=\"xxxx\"),\n            @ApiImplicitParam(paramType=\"query\",name=\"password\",dataType=\"String\",required=true,value=\"\",defaultValue=\"xxxxxxxxxxxx\")\n    })\n    @ApiResponses({\n            @ApiResponse(code=400,message=\"\"),\n            @ApiResponse(code=404,message=\"\"),\n            @ApiResponse(code=500,message=\"\")\n    })\n    @RequestMapping(value = \"/qq\", method = RequestMethod.POST)\n    public Object get(@RequestBody User user){\n        System.out.println(\"controller get method\");\n        Hello b = helloRpcService.get(\"qq\");\n        return b;\n    }\n}\n```\n\n\n\n![world](img/world.jpg)\n\n![hello](img/hello.jpg)\n\n### Swagger\n\nswagger\n\n@ApiController\n@ApiOperation\n@ApiParam\n@ApiModel\n@ApiProperty\n@ApiResponseHTTP1\n@ApiResponsesHTTP\n@ApiIgnoreAPI\n@ApiError \n@ApiImplicitParam\n@ApiImplicitParams","source":"_posts/doc-dev/standard/Swagger2.md","raw":"---\ntitle: SpringBootSwagger2\ndate: 2019-03-12\n\n---\n\n## \n\nApi\n\n1. \n2. \n3. postman\n4. \n5. SwaggerSwagger\n\n## \n\n`pom.xml`\n\n```xml\n<dependency>\n\t<groupId>io.springfox</groupId>\n\t<artifactId>springfox-swagger2</artifactId>\n\t<version>2.6.1</version>\n</dependency>\n\n\n<dependency>\n\t<groupId>io.springfox</groupId>\n\t<artifactId>springfox-swagger-ui</artifactId>\n\t<version>2.6.1</version>\n</dependency>\n```\n\nswagger \n\n```java\n@SpringBootApplication\n@EnableSwagger2\npublic class SpringbootSwagger2Application {\n\npublic static void main(String[] args) {\n\tSpringApplication.run(SpringbootSwagger2Application.class, args);\n}\n}\n```\n\n### demo\n\n```java\n@RestController\n@Api(\"Hello-world api\")\npublic class HelloWorld {\n\n    @Autowired\n    private HelloRpcService helloRpcService;\n\n    @Autowired\n    private RedisTemplate redisTemplate;\n\n    @Autowired\n    private KafkaTemplate kafkaTemplate;\n\n    @ApiOperation(\"rpc\")\n    @ApiImplicitParams({\n            @ApiImplicitParam(paramType=\"header\",name=\"username\",dataType=\"String\",required=true,value=\"\",defaultValue=\"xxxx\"),\n            @ApiImplicitParam(paramType=\"query\",name=\"password\",dataType=\"String\",required=true,value=\"\",defaultValue=\"xxxxxxxxxxxx\")\n    })\n    @ApiResponses({\n            @ApiResponse(code=400,message=\"\"),\n            @ApiResponse(code=404,message=\"\"),\n            @ApiResponse(code=500,message=\"\")\n    })\n    @RequestMapping(value = \"/qq\", method = RequestMethod.POST)\n    public Object get(@RequestBody User user){\n        System.out.println(\"controller get method\");\n        Hello b = helloRpcService.get(\"qq\");\n        return b;\n    }\n}\n```\n\n\n\n![world](img/world.jpg)\n\n![hello](img/hello.jpg)\n\n### Swagger\n\nswagger\n\n@ApiController\n@ApiOperation\n@ApiParam\n@ApiModel\n@ApiProperty\n@ApiResponseHTTP1\n@ApiResponsesHTTP\n@ApiIgnoreAPI\n@ApiError \n@ApiImplicitParam\n@ApiImplicitParams","slug":"doc-dev/standard/Swagger2","published":1,"updated":"2021-03-09T14:26:29.388Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0de001usmjr5vp5af1r","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Api</p>\n<ol>\n<li></li>\n<li></li>\n<li>postman</li>\n<li></li>\n<li>SwaggerSwagger</li>\n</ol>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>pom.xml</code></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.springfox<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>springfox-swagger2<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.6.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.springfox<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>springfox-swagger-ui<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.6.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>swagger </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@EnableSwagger2</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringbootSwagger2Application</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">\tSpringApplication.run(SpringbootSwagger2Application.class, args);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"demo\"><a href=\"#demo\" class=\"headerlink\" title=\"demo\"></a>demo</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@Api(&quot;Hello-world api&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloWorld</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> HelloRpcService helloRpcService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> KafkaTemplate kafkaTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ApiOperation(&quot;rpc&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@ApiImplicitParams(&#123;</span></span><br><span class=\"line\"><span class=\"meta\">            @ApiImplicitParam(paramType=&quot;header&quot;,name=&quot;username&quot;,dataType=&quot;String&quot;,required=true,value=&quot;&quot;,defaultValue=&quot;xxxx&quot;),</span></span><br><span class=\"line\"><span class=\"meta\">            @ApiImplicitParam(paramType=&quot;query&quot;,name=&quot;password&quot;,dataType=&quot;String&quot;,required=true,value=&quot;&quot;,defaultValue=&quot;xxxxxxxxxxxx&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">    &#125;)</span></span><br><span class=\"line\">    <span class=\"meta\">@ApiResponses(&#123;</span></span><br><span class=\"line\"><span class=\"meta\">            @ApiResponse(code=400,message=&quot;&quot;),</span></span><br><span class=\"line\"><span class=\"meta\">            @ApiResponse(code=404,message=&quot;&quot;),</span></span><br><span class=\"line\"><span class=\"meta\">            @ApiResponse(code=500,message=&quot;&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">    &#125;)</span></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(value = &quot;/qq&quot;, method = RequestMethod.POST)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">get</span><span class=\"params\">(<span class=\"meta\">@RequestBody</span> User user)</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;controller get method&quot;</span>);</span><br><span class=\"line\">        Hello b = helloRpcService.get(<span class=\"string\">&quot;qq&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/2019/03/12/doc-dev/standard/Swagger2/world.jpg\" alt=\"world\"></p>\n<p><img src=\"/2019/03/12/doc-dev/standard/Swagger2/hello.jpg\" alt=\"hello\"></p>\n<h3 id=\"Swagger\"><a href=\"#Swagger\" class=\"headerlink\" title=\"Swagger\"></a>Swagger</h3><p>swagger</p>\n<p>@ApiController<br>@ApiOperation<br>@ApiParam<br>@ApiModel<br>@ApiProperty<br>@ApiResponseHTTP1<br>@ApiResponsesHTTP<br>@ApiIgnoreAPI<br>@ApiError <br>@ApiImplicitParam<br>@ApiImplicitParams</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>Api</p>\n<ol>\n<li></li>\n<li></li>\n<li>postman</li>\n<li></li>\n<li>SwaggerSwagger</li>\n</ol>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>pom.xml</code></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.springfox<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>springfox-swagger2<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.6.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.springfox<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>springfox-swagger-ui<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.6.1<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>swagger </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@EnableSwagger2</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SpringbootSwagger2Application</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">\tSpringApplication.run(SpringbootSwagger2Application.class, args);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"demo\"><a href=\"#demo\" class=\"headerlink\" title=\"demo\"></a>demo</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"meta\">@Api(&quot;Hello-world api&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">HelloWorld</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> HelloRpcService helloRpcService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> KafkaTemplate kafkaTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@ApiOperation(&quot;rpc&quot;)</span></span><br><span class=\"line\">    <span class=\"meta\">@ApiImplicitParams(&#123;</span></span><br><span class=\"line\"><span class=\"meta\">            @ApiImplicitParam(paramType=&quot;header&quot;,name=&quot;username&quot;,dataType=&quot;String&quot;,required=true,value=&quot;&quot;,defaultValue=&quot;xxxx&quot;),</span></span><br><span class=\"line\"><span class=\"meta\">            @ApiImplicitParam(paramType=&quot;query&quot;,name=&quot;password&quot;,dataType=&quot;String&quot;,required=true,value=&quot;&quot;,defaultValue=&quot;xxxxxxxxxxxx&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">    &#125;)</span></span><br><span class=\"line\">    <span class=\"meta\">@ApiResponses(&#123;</span></span><br><span class=\"line\"><span class=\"meta\">            @ApiResponse(code=400,message=&quot;&quot;),</span></span><br><span class=\"line\"><span class=\"meta\">            @ApiResponse(code=404,message=&quot;&quot;),</span></span><br><span class=\"line\"><span class=\"meta\">            @ApiResponse(code=500,message=&quot;&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">    &#125;)</span></span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(value = &quot;/qq&quot;, method = RequestMethod.POST)</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">get</span><span class=\"params\">(<span class=\"meta\">@RequestBody</span> User user)</span></span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;controller get method&quot;</span>);</span><br><span class=\"line\">        Hello b = helloRpcService.get(<span class=\"string\">&quot;qq&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> b;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><img src=\"/2019/03/12/doc-dev/standard/Swagger2/world.jpg\" alt=\"world\"></p>\n<p><img src=\"/2019/03/12/doc-dev/standard/Swagger2/hello.jpg\" alt=\"hello\"></p>\n<h3 id=\"Swagger\"><a href=\"#Swagger\" class=\"headerlink\" title=\"Swagger\"></a>Swagger</h3><p>swagger</p>\n<p>@ApiController<br>@ApiOperation<br>@ApiParam<br>@ApiModel<br>@ApiProperty<br>@ApiResponseHTTP1<br>@ApiResponsesHTTP<br>@ApiIgnoreAPI<br>@ApiError <br>@ApiImplicitParam<br>@ApiImplicitParams</p>\n"},{"title":"","date":"2019-03-11T16:00:00.000Z","_content":"\n## DNS\n\n```bash\necho  \"nameserver 172.18.171.113\" > /etc/resolv.conf\necho  \"nameserver 172.18.171.109\" >> /etc/resolv.conf\n# DNSDNS\n```\n\n## \n\n```bash\nvim /etc/sysctl.d/110-siss.conf\n\n# IPv4\nnet.ipv4.ip_forward = 1\n\n# TCPTIME-WAIT sockets\nnet.ipv4.tcp_tw_recycle = 1\n\n# TCP\nnet.ipv4.tcp_tw_reuse = 1\n\n# TCP\nnet.ipv4.tcp_timestamps = 1\n\n# SYNcookieSYN\nnet.ipv4.tcp_syncookies = 1\n\n# \nnet.ipv4.ip_local_port_range = 1024 65000\n\n# \nnet.core.somaxconn = 16384\n\n# \nsysctl -p /etc/sysct.d/110-siss.conf\n```\n\n## LVM\n\n```bash\n# \nfdisk -l\n\n#/dev/xvdc,PV/VG/LV\npvcreate /dev/xvdc  && vgcreate data /dev/xvdc\nlvcreate -n data -l 100%VG data && mkfs.xfs /dev/data/data\n\nmkidr /data\necho \"/dev/data/data  /data  xfs  defaults 1 1\" >> /etc/fstab\nmount -a\n```\n\n## \n\n```bash\n  curl https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo > docker-ce.repo\n  rpm -ivh https://mirrors.aliyun.com/zabbix/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm\n  yum install docker-ce vmstatus  zabbix-agent  -y\n```\n\n## Docker\n\n```bash\nvim /etc/docker/daemon.json\n{\n  \"log-driver\": \"json-file\",\n  \"log-opt\": {\n    \"max-file\": \"10\",\n    \"max-size\": \"10M\"\n  },\n  \"data-root\": \"/data/docker\"\n}\n```\n\n## \n\n```bash\nvim /etc/security/limits.conf\n* soft nofile 65536\n* hard nofile 65536\n* soft nproc  65536\n* soft nproc  65536\n```\n\n## \n\n- `journald`\n\n```bash\nvim /etc/systemd/journald.conf\nSystemMaxUse=50M\nRuntimeMaxUse=50M\nSystemMaxFiles=10\nRuntimeMaxFiles=10\n```\n\n- `rsyslog`(`graylog2`)\n\n```bash\nvim /etc/rsyslog.conf\n# graylog.siss.ioGrayLog\n*.*    @graylog.siss.io:514;RSYSLOG_SyslogProtocol23Format\nsystemctl restart rsyslog\n```\n\n## Ansible\n\n## \n\n[centos7_init.sh](./pkg/centos7_init.sh)","source":"_posts/doc-dev/ops/standard.md","raw":"---\ntitle: \ndate: 2019-03-12\n\n---\n\n## DNS\n\n```bash\necho  \"nameserver 172.18.171.113\" > /etc/resolv.conf\necho  \"nameserver 172.18.171.109\" >> /etc/resolv.conf\n# DNSDNS\n```\n\n## \n\n```bash\nvim /etc/sysctl.d/110-siss.conf\n\n# IPv4\nnet.ipv4.ip_forward = 1\n\n# TCPTIME-WAIT sockets\nnet.ipv4.tcp_tw_recycle = 1\n\n# TCP\nnet.ipv4.tcp_tw_reuse = 1\n\n# TCP\nnet.ipv4.tcp_timestamps = 1\n\n# SYNcookieSYN\nnet.ipv4.tcp_syncookies = 1\n\n# \nnet.ipv4.ip_local_port_range = 1024 65000\n\n# \nnet.core.somaxconn = 16384\n\n# \nsysctl -p /etc/sysct.d/110-siss.conf\n```\n\n## LVM\n\n```bash\n# \nfdisk -l\n\n#/dev/xvdc,PV/VG/LV\npvcreate /dev/xvdc  && vgcreate data /dev/xvdc\nlvcreate -n data -l 100%VG data && mkfs.xfs /dev/data/data\n\nmkidr /data\necho \"/dev/data/data  /data  xfs  defaults 1 1\" >> /etc/fstab\nmount -a\n```\n\n## \n\n```bash\n  curl https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo > docker-ce.repo\n  rpm -ivh https://mirrors.aliyun.com/zabbix/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm\n  yum install docker-ce vmstatus  zabbix-agent  -y\n```\n\n## Docker\n\n```bash\nvim /etc/docker/daemon.json\n{\n  \"log-driver\": \"json-file\",\n  \"log-opt\": {\n    \"max-file\": \"10\",\n    \"max-size\": \"10M\"\n  },\n  \"data-root\": \"/data/docker\"\n}\n```\n\n## \n\n```bash\nvim /etc/security/limits.conf\n* soft nofile 65536\n* hard nofile 65536\n* soft nproc  65536\n* soft nproc  65536\n```\n\n## \n\n- `journald`\n\n```bash\nvim /etc/systemd/journald.conf\nSystemMaxUse=50M\nRuntimeMaxUse=50M\nSystemMaxFiles=10\nRuntimeMaxFiles=10\n```\n\n- `rsyslog`(`graylog2`)\n\n```bash\nvim /etc/rsyslog.conf\n# graylog.siss.ioGrayLog\n*.*    @graylog.siss.io:514;RSYSLOG_SyslogProtocol23Format\nsystemctl restart rsyslog\n```\n\n## Ansible\n\n## \n\n[centos7_init.sh](./pkg/centos7_init.sh)","slug":"doc-dev/ops/standard","published":1,"updated":"2021-03-09T14:26:12.864Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0dh001xsmjrcpwe0k4g","content":"<h2 id=\"DNS\"><a href=\"#DNS\" class=\"headerlink\" title=\"DNS\"></a>DNS</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span>  <span class=\"string\">&quot;nameserver 172.18.171.113&quot;</span> &gt; /etc/resolv.conf</span><br><span class=\"line\"><span class=\"built_in\">echo</span>  <span class=\"string\">&quot;nameserver 172.18.171.109&quot;</span> &gt;&gt; /etc/resolv.conf</span><br><span class=\"line\"><span class=\"comment\"># DNSDNS</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/sysctl.d/110-siss.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># IPv4</span></span><br><span class=\"line\">net.ipv4.ip_forward = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># TCPTIME-WAIT sockets</span></span><br><span class=\"line\">net.ipv4.tcp_tw_recycle = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># TCP</span></span><br><span class=\"line\">net.ipv4.tcp_tw_reuse = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># TCP</span></span><br><span class=\"line\">net.ipv4.tcp_timestamps = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SYNcookieSYN</span></span><br><span class=\"line\">net.ipv4.tcp_syncookies = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">net.ipv4.ip_local_port_range = 1024 65000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">net.core.somaxconn = 16384</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sysctl -p /etc/sysct.d/110-siss.conf</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"LVM\"><a href=\"#LVM\" class=\"headerlink\" title=\"LVM\"></a>LVM</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">fdisk -l</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#/dev/xvdc,PV/VG/LV</span></span><br><span class=\"line\">pvcreate /dev/xvdc  &amp;&amp; vgcreate data /dev/xvdc</span><br><span class=\"line\">lvcreate -n data -l 100%VG data &amp;&amp; mkfs.xfs /dev/data/data</span><br><span class=\"line\"></span><br><span class=\"line\">mkidr /data</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;/dev/data/data  /data  xfs  defaults 1 1&quot;</span> &gt;&gt; /etc/fstab</span><br><span class=\"line\">mount -a</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo &gt; docker-ce.repo</span><br><span class=\"line\">rpm -ivh https://mirrors.aliyun.com/zabbix/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm</span><br><span class=\"line\">yum install docker-ce vmstatus  zabbix-agent  -y</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Docker\"><a href=\"#Docker\" class=\"headerlink\" title=\"Docker\"></a>Docker</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/docker/daemon.json</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;log-driver&quot;</span>: <span class=\"string\">&quot;json-file&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;log-opt&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;max-file&quot;</span>: <span class=\"string\">&quot;10&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;max-size&quot;</span>: <span class=\"string\">&quot;10M&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;data-root&quot;</span>: <span class=\"string\">&quot;/data/docker&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/security/limits.conf</span><br><span class=\"line\">* soft nofile 65536</span><br><span class=\"line\">* hard nofile 65536</span><br><span class=\"line\">* soft nproc  65536</span><br><span class=\"line\">* soft nproc  65536</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><code>journald</code></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/systemd/journald.conf</span><br><span class=\"line\">SystemMaxUse=50M</span><br><span class=\"line\">RuntimeMaxUse=50M</span><br><span class=\"line\">SystemMaxFiles=10</span><br><span class=\"line\">RuntimeMaxFiles=10</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>rsyslog</code>(<code>graylog2</code>)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/rsyslog.conf</span><br><span class=\"line\"><span class=\"comment\"># graylog.siss.ioGrayLog</span></span><br><span class=\"line\">*.*    @graylog.siss.io:514;RSYSLOG_SyslogProtocol23Format</span><br><span class=\"line\">systemctl restart rsyslog</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Ansible\"><a href=\"#Ansible\" class=\"headerlink\" title=\"Ansible\"></a>Ansible</h2><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"./pkg/centos7_init.sh\">centos7_init.sh</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"DNS\"><a href=\"#DNS\" class=\"headerlink\" title=\"DNS\"></a>DNS</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span>  <span class=\"string\">&quot;nameserver 172.18.171.113&quot;</span> &gt; /etc/resolv.conf</span><br><span class=\"line\"><span class=\"built_in\">echo</span>  <span class=\"string\">&quot;nameserver 172.18.171.109&quot;</span> &gt;&gt; /etc/resolv.conf</span><br><span class=\"line\"><span class=\"comment\"># DNSDNS</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/sysctl.d/110-siss.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># IPv4</span></span><br><span class=\"line\">net.ipv4.ip_forward = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># TCPTIME-WAIT sockets</span></span><br><span class=\"line\">net.ipv4.tcp_tw_recycle = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># TCP</span></span><br><span class=\"line\">net.ipv4.tcp_tw_reuse = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># TCP</span></span><br><span class=\"line\">net.ipv4.tcp_timestamps = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># SYNcookieSYN</span></span><br><span class=\"line\">net.ipv4.tcp_syncookies = 1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">net.ipv4.ip_local_port_range = 1024 65000</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">net.core.somaxconn = 16384</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sysctl -p /etc/sysct.d/110-siss.conf</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"LVM\"><a href=\"#LVM\" class=\"headerlink\" title=\"LVM\"></a>LVM</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">fdisk -l</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#/dev/xvdc,PV/VG/LV</span></span><br><span class=\"line\">pvcreate /dev/xvdc  &amp;&amp; vgcreate data /dev/xvdc</span><br><span class=\"line\">lvcreate -n data -l 100%VG data &amp;&amp; mkfs.xfs /dev/data/data</span><br><span class=\"line\"></span><br><span class=\"line\">mkidr /data</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&quot;/dev/data/data  /data  xfs  defaults 1 1&quot;</span> &gt;&gt; /etc/fstab</span><br><span class=\"line\">mount -a</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo &gt; docker-ce.repo</span><br><span class=\"line\">rpm -ivh https://mirrors.aliyun.com/zabbix/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm</span><br><span class=\"line\">yum install docker-ce vmstatus  zabbix-agent  -y</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Docker\"><a href=\"#Docker\" class=\"headerlink\" title=\"Docker\"></a>Docker</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/docker/daemon.json</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">&quot;log-driver&quot;</span>: <span class=\"string\">&quot;json-file&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;log-opt&quot;</span>: &#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;max-file&quot;</span>: <span class=\"string\">&quot;10&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;max-size&quot;</span>: <span class=\"string\">&quot;10M&quot;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"string\">&quot;data-root&quot;</span>: <span class=\"string\">&quot;/data/docker&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/security/limits.conf</span><br><span class=\"line\">* soft nofile 65536</span><br><span class=\"line\">* hard nofile 65536</span><br><span class=\"line\">* soft nproc  65536</span><br><span class=\"line\">* soft nproc  65536</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ul>\n<li><code>journald</code></li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/systemd/journald.conf</span><br><span class=\"line\">SystemMaxUse=50M</span><br><span class=\"line\">RuntimeMaxUse=50M</span><br><span class=\"line\">SystemMaxFiles=10</span><br><span class=\"line\">RuntimeMaxFiles=10</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><code>rsyslog</code>(<code>graylog2</code>)</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/rsyslog.conf</span><br><span class=\"line\"><span class=\"comment\"># graylog.siss.ioGrayLog</span></span><br><span class=\"line\">*.*    @graylog.siss.io:514;RSYSLOG_SyslogProtocol23Format</span><br><span class=\"line\">systemctl restart rsyslog</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Ansible\"><a href=\"#Ansible\" class=\"headerlink\" title=\"Ansible\"></a>Ansible</h2><h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><a href=\"./pkg/centos7_init.sh\">centos7_init.sh</a></p>\n"},{"title":"DNS","date":"2019-03-11T16:00:00.000Z","_content":"\n## Windows\n\n---->--->\n\n![](img/network.jpg)\n\n\n![](img/proper.jpg)\n\nInternet4---\n![ipv4](img/ipv4.jpg)\n\nDNS128.0.100.170\n![dns](img/dns.jpg)\n\n,DNS\n![](img/adv.jpg)\n\nDNS\n![](img/add.jpg)\n\n## \n\n`ping mysql-dev`,`mysql-dev``mysql-dev.siss.io`IP\n![ping](img/ping.jpg)\n\n:\n[](../serviceinfo/dev.md)\n","source":"_posts/doc-dev/ops/use_dns.md","raw":"---\ntitle: DNS\ndate: 2019-03-12\n\n---\n\n## Windows\n\n---->--->\n\n![](img/network.jpg)\n\n\n![](img/proper.jpg)\n\nInternet4---\n![ipv4](img/ipv4.jpg)\n\nDNS128.0.100.170\n![dns](img/dns.jpg)\n\n,DNS\n![](img/adv.jpg)\n\nDNS\n![](img/add.jpg)\n\n## \n\n`ping mysql-dev`,`mysql-dev``mysql-dev.siss.io`IP\n![ping](img/ping.jpg)\n\n:\n[](../serviceinfo/dev.md)\n","slug":"doc-dev/ops/use_dns","published":1,"updated":"2021-03-09T14:26:16.893Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0dh001zsmjr264dfau8","content":"<h2 id=\"Windows\"><a href=\"#Windows\" class=\"headerlink\" title=\"Windows\"></a>Windows</h2><p>-&gt;&gt;</p>\n<p><img src=\"/2019/03/12/doc-dev/ops/use_dns/network.jpg\" alt=\"\"></p>\n<p><br><img src=\"/2019/03/12/doc-dev/ops/use_dns/proper.jpg\" alt=\"\"></p>\n<p>Internet4<br><img src=\"/2019/03/12/doc-dev/ops/use_dns/ipv4.jpg\" alt=\"ipv4\"></p>\n<p>DNS128.0.100.170<br><img src=\"/2019/03/12/doc-dev/ops/use_dns/dns.jpg\" alt=\"dns\"></p>\n<p>,DNS<br><img src=\"/2019/03/12/doc-dev/ops/use_dns/adv.jpg\" alt=\"\"></p>\n<p>DNS<br><img src=\"/2019/03/12/doc-dev/ops/use_dns/add.jpg\" alt=\"\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>ping mysql-dev</code>,<code>mysql-dev</code><code>mysql-dev.siss.io</code>IP<br><img src=\"/2019/03/12/doc-dev/ops/use_dns/ping.jpg\" alt=\"ping\"></p>\n<p>:<br><a href=\"../serviceinfo/dev.md\"></a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Windows\"><a href=\"#Windows\" class=\"headerlink\" title=\"Windows\"></a>Windows</h2><p>-&gt;&gt;</p>\n<p><img src=\"/2019/03/12/doc-dev/ops/use_dns/network.jpg\" alt=\"\"></p>\n<p><br><img src=\"/2019/03/12/doc-dev/ops/use_dns/proper.jpg\" alt=\"\"></p>\n<p>Internet4<br><img src=\"/2019/03/12/doc-dev/ops/use_dns/ipv4.jpg\" alt=\"ipv4\"></p>\n<p>DNS128.0.100.170<br><img src=\"/2019/03/12/doc-dev/ops/use_dns/dns.jpg\" alt=\"dns\"></p>\n<p>,DNS<br><img src=\"/2019/03/12/doc-dev/ops/use_dns/adv.jpg\" alt=\"\"></p>\n<p>DNS<br><img src=\"/2019/03/12/doc-dev/ops/use_dns/add.jpg\" alt=\"\"></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p><code>ping mysql-dev</code>,<code>mysql-dev</code><code>mysql-dev.siss.io</code>IP<br><img src=\"/2019/03/12/doc-dev/ops/use_dns/ping.jpg\" alt=\"ping\"></p>\n<p>:<br><a href=\"../serviceinfo/dev.md\"></a></p>\n"},{"title":"K8S","date":"2019-03-11T16:00:00.000Z","_content":"\n## DNS\n\n```bash\ncd /etc/sysconfig/network-scripts\n# siss.aliyun,DNSDNS\necho -e  \"DOMAIN=siss.aliyun\\nDNS1=172.18.171.109\\nDNS2=172.18.171.113\" >> ifcfg-eth0\n# \nsystemctl restart network\n```\n\n## Zabbix Agent\n\n```bash\nrpm -ivh https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm\nyum install zabbix-agent -y\n```\n\n### \n\n```bash\n# \nsed -i 's/LogFileSize=0/LogFileSize=1/g' /etc/zabbix/zabbix_agentd.conf\n# 127.0.0.1\nsed -i 's/127.0.0.1/zabbix.siss.aliyun/g' /etc/zabbix/zabbix_agentd.conf\n# Hostname\nsed -i \"s/Hostname=Zabbix server/Hostname=$(hostname)/g\" /etc/zabbix/zabbix_agentd.conf\n# HostMeta\nsed -i 's/# HostMetadata=/HostMetadata=linux/g' /etc/zabbix/zabbix_agentd.conf\n# \nsystemctl restart zabbix-agent&&systemctl enable zabbix-agent\n```\n\n## \n\nrsyslog\n\n```bash\n# vim /etc/rsyslog.conf\n...\n# \n*.*    @graylog.siss.aliyun:514;RSYSLOG_SyslogProtocol23Format\n\n# \nsystemctl restart rsyslog\n```","source":"_posts/doc-dev/ops/k8s-node.md","raw":"---\ntitle: K8S\ndate: 2019-03-12\n\n---\n\n## DNS\n\n```bash\ncd /etc/sysconfig/network-scripts\n# siss.aliyun,DNSDNS\necho -e  \"DOMAIN=siss.aliyun\\nDNS1=172.18.171.109\\nDNS2=172.18.171.113\" >> ifcfg-eth0\n# \nsystemctl restart network\n```\n\n## Zabbix Agent\n\n```bash\nrpm -ivh https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm\nyum install zabbix-agent -y\n```\n\n### \n\n```bash\n# \nsed -i 's/LogFileSize=0/LogFileSize=1/g' /etc/zabbix/zabbix_agentd.conf\n# 127.0.0.1\nsed -i 's/127.0.0.1/zabbix.siss.aliyun/g' /etc/zabbix/zabbix_agentd.conf\n# Hostname\nsed -i \"s/Hostname=Zabbix server/Hostname=$(hostname)/g\" /etc/zabbix/zabbix_agentd.conf\n# HostMeta\nsed -i 's/# HostMetadata=/HostMetadata=linux/g' /etc/zabbix/zabbix_agentd.conf\n# \nsystemctl restart zabbix-agent&&systemctl enable zabbix-agent\n```\n\n## \n\nrsyslog\n\n```bash\n# vim /etc/rsyslog.conf\n...\n# \n*.*    @graylog.siss.aliyun:514;RSYSLOG_SyslogProtocol23Format\n\n# \nsystemctl restart rsyslog\n```","slug":"doc-dev/ops/k8s-node","published":1,"updated":"2021-03-09T14:26:08.687Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0dj0021smjr5f9m5u3m","content":"<h2 id=\"DNS\"><a href=\"#DNS\" class=\"headerlink\" title=\"DNS\"></a>DNS</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /etc/sysconfig/network-scripts</span><br><span class=\"line\"><span class=\"comment\"># siss.aliyun,DNSDNS</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e  <span class=\"string\">&quot;DOMAIN=siss.aliyun\\nDNS1=172.18.171.109\\nDNS2=172.18.171.113&quot;</span> &gt;&gt; ifcfg-eth0</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">systemctl restart network</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Zabbix-Agent\"><a href=\"#Zabbix-Agent\" class=\"headerlink\" title=\"Zabbix Agent\"></a>Zabbix Agent</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -ivh https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm</span><br><span class=\"line\">yum install zabbix-agent -y</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/LogFileSize=0/LogFileSize=1/g&#x27;</span> /etc/zabbix/zabbix_agentd.conf</span><br><span class=\"line\"><span class=\"comment\"># 127.0.0.1</span></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/127.0.0.1/zabbix.siss.aliyun/g&#x27;</span> /etc/zabbix/zabbix_agentd.conf</span><br><span class=\"line\"><span class=\"comment\"># Hostname</span></span><br><span class=\"line\">sed -i <span class=\"string\">&quot;s/Hostname=Zabbix server/Hostname=<span class=\"subst\">$(hostname)</span>/g&quot;</span> /etc/zabbix/zabbix_agentd.conf</span><br><span class=\"line\"><span class=\"comment\"># HostMeta</span></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/# HostMetadata=/HostMetadata=linux/g&#x27;</span> /etc/zabbix/zabbix_agentd.conf</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">systemctl restart zabbix-agent&amp;&amp;systemctl <span class=\"built_in\">enable</span> zabbix-agent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>rsyslog</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vim /etc/rsyslog.conf</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">*.*    @graylog.siss.aliyun:514;RSYSLOG_SyslogProtocol23Format</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">systemctl restart rsyslog</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"DNS\"><a href=\"#DNS\" class=\"headerlink\" title=\"DNS\"></a>DNS</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /etc/sysconfig/network-scripts</span><br><span class=\"line\"><span class=\"comment\"># siss.aliyun,DNSDNS</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> -e  <span class=\"string\">&quot;DOMAIN=siss.aliyun\\nDNS1=172.18.171.109\\nDNS2=172.18.171.113&quot;</span> &gt;&gt; ifcfg-eth0</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">systemctl restart network</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Zabbix-Agent\"><a href=\"#Zabbix-Agent\" class=\"headerlink\" title=\"Zabbix Agent\"></a>Zabbix Agent</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rpm -ivh https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm</span><br><span class=\"line\">yum install zabbix-agent -y</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/LogFileSize=0/LogFileSize=1/g&#x27;</span> /etc/zabbix/zabbix_agentd.conf</span><br><span class=\"line\"><span class=\"comment\"># 127.0.0.1</span></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/127.0.0.1/zabbix.siss.aliyun/g&#x27;</span> /etc/zabbix/zabbix_agentd.conf</span><br><span class=\"line\"><span class=\"comment\"># Hostname</span></span><br><span class=\"line\">sed -i <span class=\"string\">&quot;s/Hostname=Zabbix server/Hostname=<span class=\"subst\">$(hostname)</span>/g&quot;</span> /etc/zabbix/zabbix_agentd.conf</span><br><span class=\"line\"><span class=\"comment\"># HostMeta</span></span><br><span class=\"line\">sed -i <span class=\"string\">&#x27;s/# HostMetadata=/HostMetadata=linux/g&#x27;</span> /etc/zabbix/zabbix_agentd.conf</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">systemctl restart zabbix-agent&amp;&amp;systemctl <span class=\"built_in\">enable</span> zabbix-agent</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>rsyslog</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># vim /etc/rsyslog.conf</span></span><br><span class=\"line\">...</span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">*.*    @graylog.siss.aliyun:514;RSYSLOG_SyslogProtocol23Format</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">systemctl restart rsyslog</span><br></pre></td></tr></table></figure>"},{"title":"YUM","date":"2019-03-11T16:00:00.000Z","_content":"\nLinux`yum`CentOS\n\n## \n\n```bash\n# yum-utils\nyum install yum-utils createrepo  nginx -y\n\n# YUM\nmkdir -p /data/yumdata\n```\n\n\n\n[syncRepo.sh](./pkg/syncRepo.sh)\n\n```bash\nyum repolist\n```\n\n![yum repolist](img/yumlist.png)\n\n```bash\n# yumyum\ncd /data/yumdata\nchmod +x syncRepo.sh\nsh syncRepos.h\n\n# NGINX,YUMHTTP\nvi /etc/nginx/nginx.conf\n...\nlocation / {\n    autoindex on;\n    root /data/yumdata/;\n}\n\n# NGINX\nsystemctl enable nginx && systemctl start nginx\n\n# yu\nvim /etc/crontab\n2 3 * * * root /data/yumdata/syncRepo.sh\n```\n\n## \n\n1. repo\n\n    ```bash\n    cd /etc/yum.repos.d && mkdir backup\n    mv *.repo backup\n    ```\n\n2. /etc/yum.repos.d/YUM\n\n   ```bash\n   vim /etc/yum.repos.d/local.repo\n\n   [centos-base]\n   name=CentOS-Base\n   baseurl=http://128.0.100.170/base/\n   enable=1\n   gpgcheck=0\n\n   [centos-update]\n   name=CentOS-Update\n   baseurl=http://128.0.100.170/updates/\n   enable=1\n   gpgcheck=0\n\n   [centos-extrals]\n   name=CentOS-Extrals\n   baseurl=http://128.0.100.170/extras/\n   enable=1\n   gpgcheck=0\n\n   [centos-epel]\n   name=CentOS-EPEL\n   baseurl=http://128.0.100.170/epel/\n   enable=1\n   gpgcheck=0\n\n   [docker-ce]\n   name=Docker-CE\n   baseurl=http://128.0.100.170/docker-ce/\n   enable=1\n   gpgcheck=0\n   ```","source":"_posts/doc-dev/ops/yum.md","raw":"---\ntitle: YUM\ndate: 2019-03-12\n\n---\n\nLinux`yum`CentOS\n\n## \n\n```bash\n# yum-utils\nyum install yum-utils createrepo  nginx -y\n\n# YUM\nmkdir -p /data/yumdata\n```\n\n\n\n[syncRepo.sh](./pkg/syncRepo.sh)\n\n```bash\nyum repolist\n```\n\n![yum repolist](img/yumlist.png)\n\n```bash\n# yumyum\ncd /data/yumdata\nchmod +x syncRepo.sh\nsh syncRepos.h\n\n# NGINX,YUMHTTP\nvi /etc/nginx/nginx.conf\n...\nlocation / {\n    autoindex on;\n    root /data/yumdata/;\n}\n\n# NGINX\nsystemctl enable nginx && systemctl start nginx\n\n# yu\nvim /etc/crontab\n2 3 * * * root /data/yumdata/syncRepo.sh\n```\n\n## \n\n1. repo\n\n    ```bash\n    cd /etc/yum.repos.d && mkdir backup\n    mv *.repo backup\n    ```\n\n2. /etc/yum.repos.d/YUM\n\n   ```bash\n   vim /etc/yum.repos.d/local.repo\n\n   [centos-base]\n   name=CentOS-Base\n   baseurl=http://128.0.100.170/base/\n   enable=1\n   gpgcheck=0\n\n   [centos-update]\n   name=CentOS-Update\n   baseurl=http://128.0.100.170/updates/\n   enable=1\n   gpgcheck=0\n\n   [centos-extrals]\n   name=CentOS-Extrals\n   baseurl=http://128.0.100.170/extras/\n   enable=1\n   gpgcheck=0\n\n   [centos-epel]\n   name=CentOS-EPEL\n   baseurl=http://128.0.100.170/epel/\n   enable=1\n   gpgcheck=0\n\n   [docker-ce]\n   name=Docker-CE\n   baseurl=http://128.0.100.170/docker-ce/\n   enable=1\n   gpgcheck=0\n   ```","slug":"doc-dev/ops/yum","published":1,"updated":"2021-03-09T14:26:22.554Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0do002csmjrg0fb3bje","content":"<p>Linux<code>yum</code>CentOS</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># yum-utils</span></span><br><span class=\"line\">yum install yum-utils createrepo  nginx -y</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># YUM</span></span><br><span class=\"line\">mkdir -p /data/yumdata</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><a href=\"./pkg/syncRepo.sh\">syncRepo.sh</a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum repolist</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2019/03/12/doc-dev/ops/yum/yumlist.png\" alt=\"yum repolist\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># yumyum</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /data/yumdata</span><br><span class=\"line\">chmod +x syncRepo.sh</span><br><span class=\"line\">sh syncRepos.h</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># NGINX,YUMHTTP</span></span><br><span class=\"line\">vi /etc/nginx/nginx.conf</span><br><span class=\"line\">...</span><br><span class=\"line\">location / &#123;</span><br><span class=\"line\">    autoindex on;</span><br><span class=\"line\">    root /data/yumdata/;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># NGINX</span></span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> nginx &amp;&amp; systemctl start nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># yu</span></span><br><span class=\"line\">vim /etc/crontab</span><br><span class=\"line\">2 3 * * * root /data/yumdata/syncRepo.sh</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ol>\n<li><p>repo</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /etc/yum.repos.d &amp;&amp; mkdir backup</span><br><span class=\"line\">mv *.repo backup</span><br></pre></td></tr></table></figure></li>\n<li><p>/etc/yum.repos.d/YUM</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/yum.repos.d/local.repo</span><br><span class=\"line\"></span><br><span class=\"line\">[centos-base]</span><br><span class=\"line\">name=CentOS-Base</span><br><span class=\"line\">baseurl=http://128.0.100.170/base/</span><br><span class=\"line\"><span class=\"built_in\">enable</span>=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\"></span><br><span class=\"line\">[centos-update]</span><br><span class=\"line\">name=CentOS-Update</span><br><span class=\"line\">baseurl=http://128.0.100.170/updates/</span><br><span class=\"line\"><span class=\"built_in\">enable</span>=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\"></span><br><span class=\"line\">[centos-extrals]</span><br><span class=\"line\">name=CentOS-Extrals</span><br><span class=\"line\">baseurl=http://128.0.100.170/extras/</span><br><span class=\"line\"><span class=\"built_in\">enable</span>=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\"></span><br><span class=\"line\">[centos-epel]</span><br><span class=\"line\">name=CentOS-EPEL</span><br><span class=\"line\">baseurl=http://128.0.100.170/epel/</span><br><span class=\"line\"><span class=\"built_in\">enable</span>=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\"></span><br><span class=\"line\">[docker-ce]</span><br><span class=\"line\">name=Docker-CE</span><br><span class=\"line\">baseurl=http://128.0.100.170/docker-ce/</span><br><span class=\"line\"><span class=\"built_in\">enable</span>=1</span><br><span class=\"line\">gpgcheck=0</span><br></pre></td></tr></table></figure></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<p>Linux<code>yum</code>CentOS</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># yum-utils</span></span><br><span class=\"line\">yum install yum-utils createrepo  nginx -y</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># YUM</span></span><br><span class=\"line\">mkdir -p /data/yumdata</span><br></pre></td></tr></table></figure>\n\n<p></p>\n<p><a href=\"./pkg/syncRepo.sh\">syncRepo.sh</a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum repolist</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"/2019/03/12/doc-dev/ops/yum/yumlist.png\" alt=\"yum repolist\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># yumyum</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /data/yumdata</span><br><span class=\"line\">chmod +x syncRepo.sh</span><br><span class=\"line\">sh syncRepos.h</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># NGINX,YUMHTTP</span></span><br><span class=\"line\">vi /etc/nginx/nginx.conf</span><br><span class=\"line\">...</span><br><span class=\"line\">location / &#123;</span><br><span class=\"line\">    autoindex on;</span><br><span class=\"line\">    root /data/yumdata/;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># NGINX</span></span><br><span class=\"line\">systemctl <span class=\"built_in\">enable</span> nginx &amp;&amp; systemctl start nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># yu</span></span><br><span class=\"line\">vim /etc/crontab</span><br><span class=\"line\">2 3 * * * root /data/yumdata/syncRepo.sh</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><ol>\n<li><p>repo</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /etc/yum.repos.d &amp;&amp; mkdir backup</span><br><span class=\"line\">mv *.repo backup</span><br></pre></td></tr></table></figure></li>\n<li><p>/etc/yum.repos.d/YUM</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/yum.repos.d/local.repo</span><br><span class=\"line\"></span><br><span class=\"line\">[centos-base]</span><br><span class=\"line\">name=CentOS-Base</span><br><span class=\"line\">baseurl=http://128.0.100.170/base/</span><br><span class=\"line\"><span class=\"built_in\">enable</span>=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\"></span><br><span class=\"line\">[centos-update]</span><br><span class=\"line\">name=CentOS-Update</span><br><span class=\"line\">baseurl=http://128.0.100.170/updates/</span><br><span class=\"line\"><span class=\"built_in\">enable</span>=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\"></span><br><span class=\"line\">[centos-extrals]</span><br><span class=\"line\">name=CentOS-Extrals</span><br><span class=\"line\">baseurl=http://128.0.100.170/extras/</span><br><span class=\"line\"><span class=\"built_in\">enable</span>=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\"></span><br><span class=\"line\">[centos-epel]</span><br><span class=\"line\">name=CentOS-EPEL</span><br><span class=\"line\">baseurl=http://128.0.100.170/epel/</span><br><span class=\"line\"><span class=\"built_in\">enable</span>=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\"></span><br><span class=\"line\">[docker-ce]</span><br><span class=\"line\">name=Docker-CE</span><br><span class=\"line\">baseurl=http://128.0.100.170/docker-ce/</span><br><span class=\"line\"><span class=\"built_in\">enable</span>=1</span><br><span class=\"line\">gpgcheck=0</span><br></pre></td></tr></table></figure></li>\n</ol>\n"},{"title":"istio1.9iptables","date":"2021-07-19T15:23:13.000Z","_content":"\n## istio1.9iptables\n\nk8s1.9.4  istio \n\n istio1.9.4 istioiptables\n\nistio, istiosystem\n\nistio dep :\n\n```bash\n$ cat /usr/local/bin/istio-start.sh\n\n#!/bin/bash\n#\n# Copyright Istio Authors. All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#    http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n#\n################################################################################\n#\n# Script to configure and start the Istio sidecar.\n\nset -e\n\n# Match pilot/docker/Dockerfile.proxyv2\n# istio \nexport ISTIO_META_ISTIO_VERSION=\"1.9.0\"\n\nset -a\n# Load optional config variables\n# \nISTIO_SIDECAR_CONFIG=${ISTIO_SIDECAR_CONFIG:-/var/lib/istio/envoy/sidecar.env}\nif [[ -r ${ISTIO_SIDECAR_CONFIG} ]]; then\n  # shellcheck disable=SC1090\n  . \"$ISTIO_SIDECAR_CONFIG\"\nfi\n\n# Load config variables ISTIO_SYSTEM_NAMESPACE, CONTROL_PLANE_AUTH_POLICY\nISTIO_CLUSTER_CONFIG=${ISTIO_CLUSTER_CONFIG:-/var/lib/istio/envoy/cluster.env}\nif [[ -r ${ISTIO_CLUSTER_CONFIG} ]]; then\n  # shellcheck disable=SC1090\n  . \"$ISTIO_CLUSTER_CONFIG\"\nfi\nset +a\n\n# Set defaults\nISTIO_BIN_BASE=${ISTIO_BIN_BASE:-/usr/local/bin}\nISTIO_LOG_DIR=${ISTIO_LOG_DIR:-/var/log/istio}\nNS=${ISTIO_NAMESPACE:-default}\nSVC=${ISTIO_SERVICE:-rawvm}\nISTIO_SYSTEM_NAMESPACE=${ISTIO_SYSTEM_NAMESPACE:-istio-system}\n\n# The default matches the default istio.yaml - use sidecar.env to override this if you\n# enable auth. This requires node-agent to be running.\n# istiod \nISTIO_PILOT_PORT=${ISTIO_PILOT_PORT:-15012}\n\n# If set, override the default\nCONTROL_PLANE_AUTH_POLICY=${ISTIO_CP_AUTH:-\"MUTUAL_TLS\"}\n\nif [ -z \"${ISTIO_SVC_IP:-}\" ]; then\n  ISTIO_SVC_IP=$(hostname --all-ip-addresses | cut -d ' ' -f 1)\nfi\n\nif [ -z \"${POD_NAME:-}\" ]; then\n  POD_NAME=$(hostname -s)\nfi\n\n# Init option will only initialize iptables. set ISTIO_CUSTOM_IP_TABLES to true if you would like to ignore this step\n# iptables envoy\nif [ \"${ISTIO_CUSTOM_IP_TABLES}\" != \"true\" ] ; then\n  #  \n    if [[ ${1-} == \"init\" || ${1-} == \"-p\" ]] ; then\n      # clean the previous Istio iptables chains. This part is different from the init image mode,\n      # where the init container runs in a fresh environment and there cannot be previous Istio chains\n      \n      \n      # istioiptables\n      \"${ISTIO_BIN_BASE}/pilot-agent\" istio-clean-iptables\n\n      # Update iptables, based on current config. This is for backward compatibility with the init image mode.\n      # The sidecar image can replace the k8s init image, to avoid downloading 2 different images.\n      \n      # iptables\n      \n      \"${ISTIO_BIN_BASE}/pilot-agent\" istio-iptables \"${@}\"\n      exit 0\n    fi\n    # \n    if [[ ${1-} != \"run\" ]] ; then\n      # clean the previous Istio iptables chains. This part is different from the init image mode,\n      # where the init container runs in a fresh environment and there cannot be previous Istio chains\n      \"${ISTIO_BIN_BASE}/pilot-agent\" istio-clean-iptables\n\n      # Update iptables, based on config file\n      \"${ISTIO_BIN_BASE}/pilot-agent\" istio-iptables\n    fi\nfi\n\nEXEC_USER=${EXEC_USER:-istio-proxy}\nif [ \"${ISTIO_INBOUND_INTERCEPTION_MODE}\" = \"TPROXY\" ] ; then\n  # In order to allow redirect inbound traffic using TPROXY, run envoy with the CAP_NET_ADMIN capability.\n  # This allows configuring listeners with the \"transparent\" socket option set to true.\n  EXEC_USER=root\nfi\n\nif [ -z \"${PILOT_ADDRESS:-}\" ]; then\n  PILOT_ADDRESS=istiod.${ISTIO_SYSTEM_NAMESPACE}.svc:${ISTIO_PILOT_PORT}\nfi\n\nCA_ADDR=${CA_ADDR:-${PILOT_ADDRESS}}\nPROV_CERT=${PROV_CERT-/etc/certs}\nOUTPUT_CERTS=${OUTPUT_CERTS-/etc/certs}\n\nexport PROV_CERT\nexport OUTPUT_CERTS\nexport CA_ADDR\n\n# If predefined ISTIO_AGENT_FLAGS is null, make it an empty string.\nISTIO_AGENT_FLAGS=${ISTIO_AGENT_FLAGS:-}\n# Split ISTIO_AGENT_FLAGS by spaces.\nIFS=' ' read -r -a ISTIO_AGENT_FLAGS_ARRAY <<< \"$ISTIO_AGENT_FLAGS\"\n\nexport PROXY_CONFIG=${PROXY_CONFIG:-\"\nserviceCluster: $SVC\ncontrolPlaneAuthPolicy: ${CONTROL_PLANE_AUTH_POLICY}\ndiscoveryAddress: ${PILOT_ADDRESS}\n\"}\n\nif [ ${EXEC_USER} == \"${USER:-}\" ] ; then\n  # if started as istio-proxy (or current user), do a normal start, without\n  # redirecting stderr.\n  INSTANCE_IP=${ISTIO_SVC_IP} POD_NAME=${POD_NAME} POD_NAMESPACE=${NS} \"${ISTIO_BIN_BASE}/pilot-agent\" proxy \"${ISTIO_AGENT_FLAGS_ARRAY[@]}\"\nelse\n\n# Will run: ${ISTIO_BIN_BASE}/envoy -c $ENVOY_CFG --restart-epoch 0 --drain-time-s 2 --parent-shutdown-time-s 3 --service-cluster $SVC --service-node 'sidecar~${ISTIO_SVC_IP}~${POD_NAME}.${NS}.svc.cluster.local~${NS}.svc.cluster.local' $ISTIO_DEBUG >${ISTIO_LOG_DIR}/istio.log\" istio-proxy\nexec su -s /bin/bash -c \"INSTANCE_IP=${ISTIO_SVC_IP} POD_NAME=${POD_NAME} POD_NAMESPACE=${NS} exec ${ISTIO_BIN_BASE}/pilot-agent proxy ${ISTIO_AGENT_FLAGS_ARRAY[*]} 2> ${ISTIO_LOG_DIR}/istio.err.log > ${ISTIO_LOG_DIR}/istio.log\" ${EXEC_USER}\nfi\n```\n\n### \n\n```bash\n# INSTANCE_IP ip\n# ip\n#  pilot-agent proxy \n$ su -s /bin/bash -c INSTANCE_IP=10.10.13.113 POD_NAME=localhost POD_NAMESPACE=vm exec /usr/local/bin/pilot-agent proxy  2> /var/log/istio/istio.err.log > /var/log/istio/istio.log istio-proxy\n```\n\npilot-agent proxy \n\nistio/pilot/cmd/pilot-agent/main.go\n\n```bash\n\n\t\t\tagent := envoy.NewAgent(envoyProxy, drainDuration)\n\n\t\t\t// Watcher is also kicking envoy start.\n\t\t\twatcher := envoy.NewWatcher(agent.Restart)\n\t\t\tgo watcher.Run(ctx)\n\n\t\t\t// On SIGINT or SIGTERM, cancel the context, triggering a graceful shutdown\n\t\t\tgo cmd.WaitSignalFunc(cancel)\n            # , agent  envoy \n\t\t\treturn agent.Run(ctx)\n\t\t\t\n\t\t# \n\t\t\n\t\t\n\t\t\nfunc (a *agent) Run(ctx context.Context) error {\n\tlog.Info(\"Starting proxy agent\")\n\tfor {\n\t\tselect {\n\t\tcase status := <-a.statusCh:\n\t\t\ta.mutex.Lock()\n\t\t\tif status.err != nil {\n\t\t\t\tif status.err.Error() == errOutOfMemory {\n\t\t\t\t\tlog.Warnf(\"Envoy may have been out of memory killed. Check memory usage and limits.\")\n\t\t\t\t}\n\t\t\t\tlog.Errorf(\"Epoch %d exited with error: %v\", status.epoch, status.err)\n\t\t\t} else {\n\t\t\t\tlog.Infof(\"Epoch %d exited normally\", status.epoch)\n\t\t\t}\n\n\t\t\tdelete(a.activeEpochs, status.epoch)\n\n\t\t\tactive := len(a.activeEpochs)\n\t\t\ta.mutex.Unlock()\n\n\t\t\tif active == 0 {\n\t\t\t\tlog.Infof(\"No more active epochs, terminating\")\n\t\t\t\treturn nil\n\t\t\t}\n\n\t\t\tlog.Infof(\"%d active epochs running\", active)\n\n\t\tcase <-ctx.Done():\n\t\t# terminate\n\t\t\ta.terminate()\n\t\t\tlog.Info(\"Agent has successfully terminated\")\n\t\t\treturn nil\n\t\t}\n\t}\n}\n\t\n\t\n\t\n\t# enovyAPI envoy \nfunc doEnvoyPost(path, contentType, body string, adminPort uint32) (*bytes.Buffer, error) {\n\trequestURL := fmt.Sprintf(\"http://127.0.0.1:%d/%s\", adminPort, path)\n\tbuffer, err := doHTTPPost(requestURL, contentType, body)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn buffer, nil\n}\n\n```\n\n\n ### istio\n\n```bash\n\n-- Logs begin at  2021-07-19 08:59:42 UTC, end at  2021-07-19 16:01:01 UTC. --\n7 19 09:03:35 localhost.localdomain systemd[1]: Started istio-sidecar: The Istio sidecar.\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -D PREROUTING -p tcp -j ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -D PREROUTING -p tcp -j ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -D OUTPUT -p tcp -j ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -F ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -X ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -F ISTIO_DIVERT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -X ISTIO_DIVERT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -F ISTIO_TPROXY\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -X ISTIO_TPROXY\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -D PREROUTING -p tcp -j ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -D PREROUTING -p tcp -j ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -D OUTPUT -p tcp -j ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -F ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -X ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -F ISTIO_DIVERT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -X ISTIO_DIVERT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -F ISTIO_TPROXY\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -X ISTIO_TPROXY\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables-save\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *mangle\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :FORWARD ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Completed on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *nat\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Completed on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables-save\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Generated by ip6tables-save v1.4.21 on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *mangle\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :FORWARD ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Completed on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Generated by ip6tables-save v1.4.21 on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *nat\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Completed on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Environment:\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ------------\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ENVOY_PORT=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_CAPTURE_PORT=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_INTERCEPTION_MODE=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_TPROXY_MARK=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_TPROXY_ROUTE_TABLE=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_PORTS=8080\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_OUTBOUND_PORTS=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_LOCAL_EXCLUDE_PORTS=15090,15021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_SERVICE_CIDR=*\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_SERVICE_EXCLUDE_CIDR=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Variables:\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ----------\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_PORT=15001\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_INBOUND_CAPTURE_PORT=15006\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_TUNNEL_PORT=15008\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_UID=997\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_GID=997\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_INTERCEPTION_MODE=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_TPROXY_MARK=1337\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_TPROXY_ROUTE_TABLE=133\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_PORTS_INCLUDE=8080\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_PORTS_EXCLUDE=15090,15021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_IP_RANGES_INCLUDE=*\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_IP_RANGES_EXCLUDE=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_PORTS_INCLUDE=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_PORTS_EXCLUDE=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: KUBEVIRT_INTERFACES=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ENABLE_INBOUND_IPV6=false\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: DNS_SERVERS=[10.10.10.6],[]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Writing following contents to rules file:  /tmp/iptables-rules-1626685415906987113.txt145448538\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: * nat\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp --dport 15008 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_REDIRECT -p tcp -j REDIRECT --to-ports 15001\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_IN_REDIRECT -p tcp -j REDIRECT --to-ports 15006\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A PREROUTING -p tcp -j ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp --dport 8080 -j ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p tcp -j ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -s 127.0.0.6/32 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo ! -d 127.0.0.1/32 -p tcp ! --dport 53 -m owner --uid-owner 997 -j ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp ! --dport 53 -m owner ! --uid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --uid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo ! -d 127.0.0.1/32 -m owner --gid-owner 997 -j ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp ! --dport 53 -m owner ! --gid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --gid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -p tcp --dport 53 -d 10.10.10.6/32 -j REDIRECT --to-ports 15053\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -d 127.0.0.1/32 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -j ISTIO_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp --dport 53 -m owner --uid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp --dport 53 -m owner --gid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp --dport 53 -d 10.10.10.6/32 -j REDIRECT --to-port 15053\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables-restore --noflush /tmp/iptables-rules-1626685415906987113.txt145448538\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Writing following contents to rules file:  /tmp/ip6tables-rules-1626685415940193066.txt564611057\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables-restore --noflush /tmp/ip6tables-rules-1626685415940193066.txt564611057\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables-save\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *mangle\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :FORWARD ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Completed on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *nat\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_INBOUND - [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_IN_REDIRECT - [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_OUTPUT - [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_REDIRECT - [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A PREROUTING -p tcp -j ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p tcp -j ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp -m udp --dport 53 -m owner --uid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp -m udp --dport 53 -m owner --gid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -d 10.10.10.6/32 -p udp -m udp --dport 53 -j REDIRECT --to-ports 15053\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp -m tcp --dport 15008 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp -m tcp --dport 8080 -j ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_IN_REDIRECT -p tcp -j REDIRECT --to-ports 15006\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -s 127.0.0.6/32 -o lo -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT ! -d 127.0.0.1/32 -o lo -p tcp -m tcp ! --dport 53 -m owner --uid-owner 997 -j ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp -m tcp ! --dport 53 -m owner ! --uid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --uid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT ! -d 127.0.0.1/32 -o lo -m owner --gid-owner 997 -j ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp -m tcp ! --dport 53 -m owner ! --gid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --gid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -d 10.10.10.6/32 -p tcp -m tcp --dport 53 -j REDIRECT --to-ports 15053\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -d 127.0.0.1/32 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -j ISTIO_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_REDIRECT -p tcp -j REDIRECT --to-ports 15001\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Completed on Mon Jul 19 17:03:35 2021\n```","source":"_posts/istio/istio-iptables.md","raw":"---\ntitle: istio1.9iptables\ndate: 2021-07-19 23:23:13\ntags:\n- kubernetes\n- istio\n---\n\n## istio1.9iptables\n\nk8s1.9.4  istio \n\n istio1.9.4 istioiptables\n\nistio, istiosystem\n\nistio dep :\n\n```bash\n$ cat /usr/local/bin/istio-start.sh\n\n#!/bin/bash\n#\n# Copyright Istio Authors. All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#    http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n#\n################################################################################\n#\n# Script to configure and start the Istio sidecar.\n\nset -e\n\n# Match pilot/docker/Dockerfile.proxyv2\n# istio \nexport ISTIO_META_ISTIO_VERSION=\"1.9.0\"\n\nset -a\n# Load optional config variables\n# \nISTIO_SIDECAR_CONFIG=${ISTIO_SIDECAR_CONFIG:-/var/lib/istio/envoy/sidecar.env}\nif [[ -r ${ISTIO_SIDECAR_CONFIG} ]]; then\n  # shellcheck disable=SC1090\n  . \"$ISTIO_SIDECAR_CONFIG\"\nfi\n\n# Load config variables ISTIO_SYSTEM_NAMESPACE, CONTROL_PLANE_AUTH_POLICY\nISTIO_CLUSTER_CONFIG=${ISTIO_CLUSTER_CONFIG:-/var/lib/istio/envoy/cluster.env}\nif [[ -r ${ISTIO_CLUSTER_CONFIG} ]]; then\n  # shellcheck disable=SC1090\n  . \"$ISTIO_CLUSTER_CONFIG\"\nfi\nset +a\n\n# Set defaults\nISTIO_BIN_BASE=${ISTIO_BIN_BASE:-/usr/local/bin}\nISTIO_LOG_DIR=${ISTIO_LOG_DIR:-/var/log/istio}\nNS=${ISTIO_NAMESPACE:-default}\nSVC=${ISTIO_SERVICE:-rawvm}\nISTIO_SYSTEM_NAMESPACE=${ISTIO_SYSTEM_NAMESPACE:-istio-system}\n\n# The default matches the default istio.yaml - use sidecar.env to override this if you\n# enable auth. This requires node-agent to be running.\n# istiod \nISTIO_PILOT_PORT=${ISTIO_PILOT_PORT:-15012}\n\n# If set, override the default\nCONTROL_PLANE_AUTH_POLICY=${ISTIO_CP_AUTH:-\"MUTUAL_TLS\"}\n\nif [ -z \"${ISTIO_SVC_IP:-}\" ]; then\n  ISTIO_SVC_IP=$(hostname --all-ip-addresses | cut -d ' ' -f 1)\nfi\n\nif [ -z \"${POD_NAME:-}\" ]; then\n  POD_NAME=$(hostname -s)\nfi\n\n# Init option will only initialize iptables. set ISTIO_CUSTOM_IP_TABLES to true if you would like to ignore this step\n# iptables envoy\nif [ \"${ISTIO_CUSTOM_IP_TABLES}\" != \"true\" ] ; then\n  #  \n    if [[ ${1-} == \"init\" || ${1-} == \"-p\" ]] ; then\n      # clean the previous Istio iptables chains. This part is different from the init image mode,\n      # where the init container runs in a fresh environment and there cannot be previous Istio chains\n      \n      \n      # istioiptables\n      \"${ISTIO_BIN_BASE}/pilot-agent\" istio-clean-iptables\n\n      # Update iptables, based on current config. This is for backward compatibility with the init image mode.\n      # The sidecar image can replace the k8s init image, to avoid downloading 2 different images.\n      \n      # iptables\n      \n      \"${ISTIO_BIN_BASE}/pilot-agent\" istio-iptables \"${@}\"\n      exit 0\n    fi\n    # \n    if [[ ${1-} != \"run\" ]] ; then\n      # clean the previous Istio iptables chains. This part is different from the init image mode,\n      # where the init container runs in a fresh environment and there cannot be previous Istio chains\n      \"${ISTIO_BIN_BASE}/pilot-agent\" istio-clean-iptables\n\n      # Update iptables, based on config file\n      \"${ISTIO_BIN_BASE}/pilot-agent\" istio-iptables\n    fi\nfi\n\nEXEC_USER=${EXEC_USER:-istio-proxy}\nif [ \"${ISTIO_INBOUND_INTERCEPTION_MODE}\" = \"TPROXY\" ] ; then\n  # In order to allow redirect inbound traffic using TPROXY, run envoy with the CAP_NET_ADMIN capability.\n  # This allows configuring listeners with the \"transparent\" socket option set to true.\n  EXEC_USER=root\nfi\n\nif [ -z \"${PILOT_ADDRESS:-}\" ]; then\n  PILOT_ADDRESS=istiod.${ISTIO_SYSTEM_NAMESPACE}.svc:${ISTIO_PILOT_PORT}\nfi\n\nCA_ADDR=${CA_ADDR:-${PILOT_ADDRESS}}\nPROV_CERT=${PROV_CERT-/etc/certs}\nOUTPUT_CERTS=${OUTPUT_CERTS-/etc/certs}\n\nexport PROV_CERT\nexport OUTPUT_CERTS\nexport CA_ADDR\n\n# If predefined ISTIO_AGENT_FLAGS is null, make it an empty string.\nISTIO_AGENT_FLAGS=${ISTIO_AGENT_FLAGS:-}\n# Split ISTIO_AGENT_FLAGS by spaces.\nIFS=' ' read -r -a ISTIO_AGENT_FLAGS_ARRAY <<< \"$ISTIO_AGENT_FLAGS\"\n\nexport PROXY_CONFIG=${PROXY_CONFIG:-\"\nserviceCluster: $SVC\ncontrolPlaneAuthPolicy: ${CONTROL_PLANE_AUTH_POLICY}\ndiscoveryAddress: ${PILOT_ADDRESS}\n\"}\n\nif [ ${EXEC_USER} == \"${USER:-}\" ] ; then\n  # if started as istio-proxy (or current user), do a normal start, without\n  # redirecting stderr.\n  INSTANCE_IP=${ISTIO_SVC_IP} POD_NAME=${POD_NAME} POD_NAMESPACE=${NS} \"${ISTIO_BIN_BASE}/pilot-agent\" proxy \"${ISTIO_AGENT_FLAGS_ARRAY[@]}\"\nelse\n\n# Will run: ${ISTIO_BIN_BASE}/envoy -c $ENVOY_CFG --restart-epoch 0 --drain-time-s 2 --parent-shutdown-time-s 3 --service-cluster $SVC --service-node 'sidecar~${ISTIO_SVC_IP}~${POD_NAME}.${NS}.svc.cluster.local~${NS}.svc.cluster.local' $ISTIO_DEBUG >${ISTIO_LOG_DIR}/istio.log\" istio-proxy\nexec su -s /bin/bash -c \"INSTANCE_IP=${ISTIO_SVC_IP} POD_NAME=${POD_NAME} POD_NAMESPACE=${NS} exec ${ISTIO_BIN_BASE}/pilot-agent proxy ${ISTIO_AGENT_FLAGS_ARRAY[*]} 2> ${ISTIO_LOG_DIR}/istio.err.log > ${ISTIO_LOG_DIR}/istio.log\" ${EXEC_USER}\nfi\n```\n\n### \n\n```bash\n# INSTANCE_IP ip\n# ip\n#  pilot-agent proxy \n$ su -s /bin/bash -c INSTANCE_IP=10.10.13.113 POD_NAME=localhost POD_NAMESPACE=vm exec /usr/local/bin/pilot-agent proxy  2> /var/log/istio/istio.err.log > /var/log/istio/istio.log istio-proxy\n```\n\npilot-agent proxy \n\nistio/pilot/cmd/pilot-agent/main.go\n\n```bash\n\n\t\t\tagent := envoy.NewAgent(envoyProxy, drainDuration)\n\n\t\t\t// Watcher is also kicking envoy start.\n\t\t\twatcher := envoy.NewWatcher(agent.Restart)\n\t\t\tgo watcher.Run(ctx)\n\n\t\t\t// On SIGINT or SIGTERM, cancel the context, triggering a graceful shutdown\n\t\t\tgo cmd.WaitSignalFunc(cancel)\n            # , agent  envoy \n\t\t\treturn agent.Run(ctx)\n\t\t\t\n\t\t# \n\t\t\n\t\t\n\t\t\nfunc (a *agent) Run(ctx context.Context) error {\n\tlog.Info(\"Starting proxy agent\")\n\tfor {\n\t\tselect {\n\t\tcase status := <-a.statusCh:\n\t\t\ta.mutex.Lock()\n\t\t\tif status.err != nil {\n\t\t\t\tif status.err.Error() == errOutOfMemory {\n\t\t\t\t\tlog.Warnf(\"Envoy may have been out of memory killed. Check memory usage and limits.\")\n\t\t\t\t}\n\t\t\t\tlog.Errorf(\"Epoch %d exited with error: %v\", status.epoch, status.err)\n\t\t\t} else {\n\t\t\t\tlog.Infof(\"Epoch %d exited normally\", status.epoch)\n\t\t\t}\n\n\t\t\tdelete(a.activeEpochs, status.epoch)\n\n\t\t\tactive := len(a.activeEpochs)\n\t\t\ta.mutex.Unlock()\n\n\t\t\tif active == 0 {\n\t\t\t\tlog.Infof(\"No more active epochs, terminating\")\n\t\t\t\treturn nil\n\t\t\t}\n\n\t\t\tlog.Infof(\"%d active epochs running\", active)\n\n\t\tcase <-ctx.Done():\n\t\t# terminate\n\t\t\ta.terminate()\n\t\t\tlog.Info(\"Agent has successfully terminated\")\n\t\t\treturn nil\n\t\t}\n\t}\n}\n\t\n\t\n\t\n\t# enovyAPI envoy \nfunc doEnvoyPost(path, contentType, body string, adminPort uint32) (*bytes.Buffer, error) {\n\trequestURL := fmt.Sprintf(\"http://127.0.0.1:%d/%s\", adminPort, path)\n\tbuffer, err := doHTTPPost(requestURL, contentType, body)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn buffer, nil\n}\n\n```\n\n\n ### istio\n\n```bash\n\n-- Logs begin at  2021-07-19 08:59:42 UTC, end at  2021-07-19 16:01:01 UTC. --\n7 19 09:03:35 localhost.localdomain systemd[1]: Started istio-sidecar: The Istio sidecar.\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -D PREROUTING -p tcp -j ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -D PREROUTING -p tcp -j ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -D OUTPUT -p tcp -j ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -F ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -X ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -F ISTIO_DIVERT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -X ISTIO_DIVERT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -F ISTIO_TPROXY\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -X ISTIO_TPROXY\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -D PREROUTING -p tcp -j ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -D PREROUTING -p tcp -j ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -D OUTPUT -p tcp -j ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -F ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -X ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -F ISTIO_DIVERT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -X ISTIO_DIVERT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -F ISTIO_TPROXY\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -X ISTIO_TPROXY\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables-save\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *mangle\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :FORWARD ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Completed on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *nat\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Completed on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables-save\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Generated by ip6tables-save v1.4.21 on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *mangle\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :FORWARD ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Completed on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Generated by ip6tables-save v1.4.21 on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *nat\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Completed on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Environment:\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ------------\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ENVOY_PORT=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_CAPTURE_PORT=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_INTERCEPTION_MODE=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_TPROXY_MARK=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_TPROXY_ROUTE_TABLE=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_PORTS=8080\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_OUTBOUND_PORTS=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_LOCAL_EXCLUDE_PORTS=15090,15021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_SERVICE_CIDR=*\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_SERVICE_EXCLUDE_CIDR=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Variables:\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ----------\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_PORT=15001\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_INBOUND_CAPTURE_PORT=15006\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_TUNNEL_PORT=15008\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_UID=997\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_GID=997\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_INTERCEPTION_MODE=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_TPROXY_MARK=1337\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_TPROXY_ROUTE_TABLE=133\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_PORTS_INCLUDE=8080\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_PORTS_EXCLUDE=15090,15021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_IP_RANGES_INCLUDE=*\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_IP_RANGES_EXCLUDE=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_PORTS_INCLUDE=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_PORTS_EXCLUDE=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: KUBEVIRT_INTERFACES=\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ENABLE_INBOUND_IPV6=false\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: DNS_SERVERS=[10.10.10.6],[]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Writing following contents to rules file:  /tmp/iptables-rules-1626685415906987113.txt145448538\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: * nat\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp --dport 15008 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_REDIRECT -p tcp -j REDIRECT --to-ports 15001\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_IN_REDIRECT -p tcp -j REDIRECT --to-ports 15006\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A PREROUTING -p tcp -j ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp --dport 8080 -j ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p tcp -j ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -s 127.0.0.6/32 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo ! -d 127.0.0.1/32 -p tcp ! --dport 53 -m owner --uid-owner 997 -j ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp ! --dport 53 -m owner ! --uid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --uid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo ! -d 127.0.0.1/32 -m owner --gid-owner 997 -j ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp ! --dport 53 -m owner ! --gid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --gid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -p tcp --dport 53 -d 10.10.10.6/32 -j REDIRECT --to-ports 15053\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -d 127.0.0.1/32 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -j ISTIO_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp --dport 53 -m owner --uid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp --dport 53 -m owner --gid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp --dport 53 -d 10.10.10.6/32 -j REDIRECT --to-port 15053\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables-restore --noflush /tmp/iptables-rules-1626685415906987113.txt145448538\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Writing following contents to rules file:  /tmp/ip6tables-rules-1626685415940193066.txt564611057\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables-restore --noflush /tmp/ip6tables-rules-1626685415940193066.txt564611057\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables-save\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *mangle\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :FORWARD ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Completed on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *nat\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_INBOUND - [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_IN_REDIRECT - [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_OUTPUT - [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_REDIRECT - [0:0]\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A PREROUTING -p tcp -j ISTIO_INBOUND\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p tcp -j ISTIO_OUTPUT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp -m udp --dport 53 -m owner --uid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp -m udp --dport 53 -m owner --gid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -d 10.10.10.6/32 -p udp -m udp --dport 53 -j REDIRECT --to-ports 15053\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp -m tcp --dport 15008 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp -m tcp --dport 8080 -j ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_IN_REDIRECT -p tcp -j REDIRECT --to-ports 15006\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -s 127.0.0.6/32 -o lo -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT ! -d 127.0.0.1/32 -o lo -p tcp -m tcp ! --dport 53 -m owner --uid-owner 997 -j ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp -m tcp ! --dport 53 -m owner ! --uid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --uid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT ! -d 127.0.0.1/32 -o lo -m owner --gid-owner 997 -j ISTIO_IN_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp -m tcp ! --dport 53 -m owner ! --gid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --gid-owner 997 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -d 10.10.10.6/32 -p tcp -m tcp --dport 53 -j REDIRECT --to-ports 15053\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -d 127.0.0.1/32 -j RETURN\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -j ISTIO_REDIRECT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_REDIRECT -p tcp -j REDIRECT --to-ports 15001\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT\n7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: # Completed on Mon Jul 19 17:03:35 2021\n```","slug":"istio/istio-iptables","published":1,"updated":"2021-08-24T16:25:21.604Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0do002dsmjre5x6g2dc","content":"<h2 id=\"istio1-9iptables\"><a href=\"#istio1-9iptables\" class=\"headerlink\" title=\"istio1.9iptables\"></a>istio1.9iptables</h2><p>k8s1.9.4  istio </p>\n<p> istio1.9.4 istioiptables</p>\n<p>istio, istiosystem<br><br>istio dep :</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat /usr/<span class=\"built_in\">local</span>/bin/istio-start.sh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Copyright Istio Authors. All Rights Reserved.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class=\"line\"><span class=\"comment\"># you may not use this file except in compliance with the License.</span></span><br><span class=\"line\"><span class=\"comment\"># You may obtain a copy of the License at</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class=\"line\"><span class=\"comment\"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class=\"line\"><span class=\"comment\"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class=\"line\"><span class=\"comment\"># See the License for the specific language governing permissions and</span></span><br><span class=\"line\"><span class=\"comment\"># limitations under the License.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">################################################################################</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Script to configure and start the Istio sidecar.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set</span> -e</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Match pilot/docker/Dockerfile.proxyv2</span></span><br><span class=\"line\"><span class=\"comment\"># istio </span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ISTIO_META_ISTIO_VERSION=<span class=\"string\">&quot;1.9.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set</span> -a</span><br><span class=\"line\"><span class=\"comment\"># Load optional config variables</span></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">ISTIO_SIDECAR_CONFIG=<span class=\"variable\">$&#123;ISTIO_SIDECAR_CONFIG:-/var/lib/istio/envoy/sidecar.env&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ -r <span class=\"variable\">$&#123;ISTIO_SIDECAR_CONFIG&#125;</span> ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"comment\"># shellcheck disable=SC1090</span></span><br><span class=\"line\">  . <span class=\"string\">&quot;<span class=\"variable\">$ISTIO_SIDECAR_CONFIG</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Load config variables ISTIO_SYSTEM_NAMESPACE, CONTROL_PLANE_AUTH_POLICY</span></span><br><span class=\"line\">ISTIO_CLUSTER_CONFIG=<span class=\"variable\">$&#123;ISTIO_CLUSTER_CONFIG:-/var/lib/istio/envoy/cluster.env&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ -r <span class=\"variable\">$&#123;ISTIO_CLUSTER_CONFIG&#125;</span> ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"comment\"># shellcheck disable=SC1090</span></span><br><span class=\"line\">  . <span class=\"string\">&quot;<span class=\"variable\">$ISTIO_CLUSTER_CONFIG</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> +a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Set defaults</span></span><br><span class=\"line\">ISTIO_BIN_BASE=<span class=\"variable\">$&#123;ISTIO_BIN_BASE:-/usr/local/bin&#125;</span></span><br><span class=\"line\">ISTIO_LOG_DIR=<span class=\"variable\">$&#123;ISTIO_LOG_DIR:-/var/log/istio&#125;</span></span><br><span class=\"line\">NS=<span class=\"variable\">$&#123;ISTIO_NAMESPACE:-default&#125;</span></span><br><span class=\"line\">SVC=<span class=\"variable\">$&#123;ISTIO_SERVICE:-rawvm&#125;</span></span><br><span class=\"line\">ISTIO_SYSTEM_NAMESPACE=<span class=\"variable\">$&#123;ISTIO_SYSTEM_NAMESPACE:-istio-system&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The default matches the default istio.yaml - use sidecar.env to override this if you</span></span><br><span class=\"line\"><span class=\"comment\"># enable auth. This requires node-agent to be running.</span></span><br><span class=\"line\"><span class=\"comment\"># istiod </span></span><br><span class=\"line\">ISTIO_PILOT_PORT=<span class=\"variable\">$&#123;ISTIO_PILOT_PORT:-15012&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># If set, override the default</span></span><br><span class=\"line\">CONTROL_PLANE_AUTH_POLICY=<span class=\"variable\">$&#123;ISTIO_CP_AUTH:-&quot;MUTUAL_TLS&quot;&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_SVC_IP:-&#125;</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  ISTIO_SVC_IP=$(hostname --all-ip-addresses | cut -d <span class=\"string\">&#x27; &#x27;</span> -f 1)</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$&#123;POD_NAME:-&#125;</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  POD_NAME=$(hostname -s)</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Init option will only initialize iptables. set ISTIO_CUSTOM_IP_TABLES to true if you would like to ignore this step</span></span><br><span class=\"line\"><span class=\"comment\"># iptables envoy</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_CUSTOM_IP_TABLES&#125;</span>&quot;</span> != <span class=\"string\">&quot;true&quot;</span> ] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"comment\">#  </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"variable\">$&#123;1-&#125;</span> == <span class=\"string\">&quot;init&quot;</span> || <span class=\"variable\">$&#123;1-&#125;</span> == <span class=\"string\">&quot;-p&quot;</span> ]] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"comment\"># clean the previous Istio iptables chains. This part is different from the init image mode,</span></span><br><span class=\"line\">      <span class=\"comment\"># where the init container runs in a fresh environment and there cannot be previous Istio chains</span></span><br><span class=\"line\">      </span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\"># istioiptables</span></span><br><span class=\"line\">      <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_BIN_BASE&#125;</span>/pilot-agent&quot;</span> istio-clean-iptables</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\"># Update iptables, based on current config. This is for backward compatibility with the init image mode.</span></span><br><span class=\"line\">      <span class=\"comment\"># The sidecar image can replace the k8s init image, to avoid downloading 2 different images.</span></span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\"># iptables</span></span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_BIN_BASE&#125;</span>/pilot-agent&quot;</span> istio-iptables <span class=\"string\">&quot;<span class=\"variable\">$&#123;@&#125;</span>&quot;</span></span><br><span class=\"line\">      <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"variable\">$&#123;1-&#125;</span> != <span class=\"string\">&quot;run&quot;</span> ]] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"comment\"># clean the previous Istio iptables chains. This part is different from the init image mode,</span></span><br><span class=\"line\">      <span class=\"comment\"># where the init container runs in a fresh environment and there cannot be previous Istio chains</span></span><br><span class=\"line\">      <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_BIN_BASE&#125;</span>/pilot-agent&quot;</span> istio-clean-iptables</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\"># Update iptables, based on config file</span></span><br><span class=\"line\">      <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_BIN_BASE&#125;</span>/pilot-agent&quot;</span> istio-iptables</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">EXEC_USER=<span class=\"variable\">$&#123;EXEC_USER:-istio-proxy&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_INBOUND_INTERCEPTION_MODE&#125;</span>&quot;</span> = <span class=\"string\">&quot;TPROXY&quot;</span> ] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"comment\"># In order to allow redirect inbound traffic using TPROXY, run envoy with the CAP_NET_ADMIN capability.</span></span><br><span class=\"line\">  <span class=\"comment\"># This allows configuring listeners with the &quot;transparent&quot; socket option set to true.</span></span><br><span class=\"line\">  EXEC_USER=root</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$&#123;PILOT_ADDRESS:-&#125;</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  PILOT_ADDRESS=istiod.<span class=\"variable\">$&#123;ISTIO_SYSTEM_NAMESPACE&#125;</span>.svc:<span class=\"variable\">$&#123;ISTIO_PILOT_PORT&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">CA_ADDR=<span class=\"variable\">$&#123;CA_ADDR:-<span class=\"variable\">$&#123;PILOT_ADDRESS&#125;</span>&#125;</span></span><br><span class=\"line\">PROV_CERT=<span class=\"variable\">$&#123;PROV_CERT-/etc/certs&#125;</span></span><br><span class=\"line\">OUTPUT_CERTS=<span class=\"variable\">$&#123;OUTPUT_CERTS-/etc/certs&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">export</span> PROV_CERT</span><br><span class=\"line\"><span class=\"built_in\">export</span> OUTPUT_CERTS</span><br><span class=\"line\"><span class=\"built_in\">export</span> CA_ADDR</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># If predefined ISTIO_AGENT_FLAGS is null, make it an empty string.</span></span><br><span class=\"line\">ISTIO_AGENT_FLAGS=<span class=\"variable\">$&#123;ISTIO_AGENT_FLAGS:-&#125;</span></span><br><span class=\"line\"><span class=\"comment\"># Split ISTIO_AGENT_FLAGS by spaces.</span></span><br><span class=\"line\">IFS=<span class=\"string\">&#x27; &#x27;</span> <span class=\"built_in\">read</span> -r -a ISTIO_AGENT_FLAGS_ARRAY &lt;&lt;&lt; <span class=\"string\">&quot;<span class=\"variable\">$ISTIO_AGENT_FLAGS</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">export</span> PROXY_CONFIG=<span class=\"variable\">$&#123;PROXY_CONFIG:-&quot;</span></span><br><span class=\"line\"><span class=\"variable\">serviceCluster: $SVC</span></span><br><span class=\"line\"><span class=\"variable\">controlPlaneAuthPolicy: <span class=\"variable\">$&#123;CONTROL_PLANE_AUTH_POLICY&#125;</span></span></span><br><span class=\"line\"><span class=\"variable\">discoveryAddress: <span class=\"variable\">$&#123;PILOT_ADDRESS&#125;</span></span></span><br><span class=\"line\"><span class=\"variable\">&quot;&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$&#123;EXEC_USER&#125;</span> == <span class=\"string\">&quot;<span class=\"variable\">$&#123;USER:-&#125;</span>&quot;</span> ] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"comment\"># if started as istio-proxy (or current user), do a normal start, without</span></span><br><span class=\"line\">  <span class=\"comment\"># redirecting stderr.</span></span><br><span class=\"line\">  INSTANCE_IP=<span class=\"variable\">$&#123;ISTIO_SVC_IP&#125;</span> POD_NAME=<span class=\"variable\">$&#123;POD_NAME&#125;</span> POD_NAMESPACE=<span class=\"variable\">$&#123;NS&#125;</span> <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_BIN_BASE&#125;</span>/pilot-agent&quot;</span> proxy <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_AGENT_FLAGS_ARRAY[@]&#125;</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Will run: $&#123;ISTIO_BIN_BASE&#125;/envoy -c $ENVOY_CFG --restart-epoch 0 --drain-time-s 2 --parent-shutdown-time-s 3 --service-cluster $SVC --service-node &#x27;sidecar~$&#123;ISTIO_SVC_IP&#125;~$&#123;POD_NAME&#125;.$&#123;NS&#125;.svc.cluster.local~$&#123;NS&#125;.svc.cluster.local&#x27; $ISTIO_DEBUG &gt;$&#123;ISTIO_LOG_DIR&#125;/istio.log&quot; istio-proxy</span></span><br><span class=\"line\"><span class=\"built_in\">exec</span> su -s /bin/bash -c <span class=\"string\">&quot;INSTANCE_IP=<span class=\"variable\">$&#123;ISTIO_SVC_IP&#125;</span> POD_NAME=<span class=\"variable\">$&#123;POD_NAME&#125;</span> POD_NAMESPACE=<span class=\"variable\">$&#123;NS&#125;</span> exec <span class=\"variable\">$&#123;ISTIO_BIN_BASE&#125;</span>/pilot-agent proxy <span class=\"variable\">$&#123;ISTIO_AGENT_FLAGS_ARRAY[*]&#125;</span> 2&gt; <span class=\"variable\">$&#123;ISTIO_LOG_DIR&#125;</span>/istio.err.log &gt; <span class=\"variable\">$&#123;ISTIO_LOG_DIR&#125;</span>/istio.log&quot;</span> <span class=\"variable\">$&#123;EXEC_USER&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># INSTANCE_IP ip</span></span><br><span class=\"line\"><span class=\"comment\"># ip</span></span><br><span class=\"line\"><span class=\"comment\">#  pilot-agent proxy </span></span><br><span class=\"line\">$ su -s /bin/bash -c INSTANCE_IP=10.10.13.113 POD_NAME=localhost POD_NAMESPACE=vm <span class=\"built_in\">exec</span> /usr/<span class=\"built_in\">local</span>/bin/pilot-agent proxy  2&gt; /var/<span class=\"built_in\">log</span>/istio/istio.err.log &gt; /var/<span class=\"built_in\">log</span>/istio/istio.log istio-proxy</span><br></pre></td></tr></table></figure>\n\n<p>pilot-agent proxy </p>\n<p>istio/pilot/cmd/pilot-agent/main.go</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">\t\t\tagent := envoy.NewAgent(envoyProxy, drainDuration)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t// Watcher is also kicking envoy start.</span><br><span class=\"line\">\t\t\twatcher := envoy.NewWatcher(agent.Restart)</span><br><span class=\"line\">\t\t\tgo watcher.Run(ctx)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t// On SIGINT or SIGTERM, cancel the context, triggering a graceful shutdown</span><br><span class=\"line\">\t\t\tgo cmd.WaitSignalFunc(cancel)</span><br><span class=\"line\">            <span class=\"comment\"># , agent  envoy </span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">return</span> agent.Run(ctx)</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\"># </span></span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">func (a *agent) Run(ctx context.Context) error &#123;</span><br><span class=\"line\">\tlog.Info(<span class=\"string\">&quot;Starting proxy agent&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\tselect &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> status := &lt;-a.statusCh:</span><br><span class=\"line\">\t\t\ta.mutex.Lock()</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> status.err != nil &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> status.err.Error() == errOutOfMemory &#123;</span><br><span class=\"line\">\t\t\t\t\tlog.Warnf(<span class=\"string\">&quot;Envoy may have been out of memory killed. Check memory usage and limits.&quot;</span>)</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tlog.Errorf(<span class=\"string\">&quot;Epoch %d exited with error: %v&quot;</span>, status.epoch, status.err)</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\tlog.Infof(<span class=\"string\">&quot;Epoch %d exited normally&quot;</span>, status.epoch)</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tdelete(a.activeEpochs, status.epoch)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tactive := len(a.activeEpochs)</span><br><span class=\"line\">\t\t\ta.mutex.Unlock()</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> active == 0 &#123;</span><br><span class=\"line\">\t\t\t\tlog.Infof(<span class=\"string\">&quot;No more active epochs, terminating&quot;</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">return</span> nil</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tlog.Infof(<span class=\"string\">&quot;%d active epochs running&quot;</span>, active)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> &lt;-ctx.Done():</span><br><span class=\"line\">\t\t<span class=\"comment\"># terminate</span></span><br><span class=\"line\">\t\t\ta.terminate()</span><br><span class=\"line\">\t\t\tlog.Info(<span class=\"string\">&quot;Agent has successfully terminated&quot;</span>)</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">return</span> nil</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\"># enovyAPI envoy </span></span><br><span class=\"line\">func doEnvoyPost(path, contentType, body string, adminPort uint32) (*bytes.Buffer, error) &#123;</span><br><span class=\"line\">\trequestURL := fmt.Sprintf(<span class=\"string\">&quot;http://127.0.0.1:%d/%s&quot;</span>, adminPort, path)</span><br><span class=\"line\">\tbuffer, err := doHTTPPost(requestURL, contentType, body)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != nil &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">return</span> nil, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">return</span> buffer, nil</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"istio\"><a href=\"#istio\" class=\"headerlink\" title=\"istio\"></a>istio</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">-- Logs begin at  2021-07-19 08:59:42 UTC, end at  2021-07-19 16:01:01 UTC. --</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain systemd[1]: Started istio-sidecar: The Istio sidecar.</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -D PREROUTING -p tcp -j ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -D PREROUTING -p tcp -j ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -D OUTPUT -p tcp -j ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -F ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -X ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -F ISTIO_DIVERT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -X ISTIO_DIVERT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -F ISTIO_TPROXY</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -X ISTIO_TPROXY</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -D PREROUTING -p tcp -j ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -D PREROUTING -p tcp -j ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -D OUTPUT -p tcp -j ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -F ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -X ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -F ISTIO_DIVERT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -X ISTIO_DIVERT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -F ISTIO_TPROXY</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -X ISTIO_TPROXY</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables-save</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *mangle</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :FORWARD ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Completed on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *nat</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Completed on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables-save</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Generated by ip6tables-save v1.4.21 on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *mangle</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :FORWARD ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Completed on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Generated by ip6tables-save v1.4.21 on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *nat</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Completed on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Environment:</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ------------</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ENVOY_PORT=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_CAPTURE_PORT=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_INTERCEPTION_MODE=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_TPROXY_MARK=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_TPROXY_ROUTE_TABLE=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_PORTS=8080</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_OUTBOUND_PORTS=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_LOCAL_EXCLUDE_PORTS=15090,15021</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_SERVICE_CIDR=*</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_SERVICE_EXCLUDE_CIDR=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Variables:</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ----------</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_PORT=15001</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_INBOUND_CAPTURE_PORT=15006</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_TUNNEL_PORT=15008</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_UID=997</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_GID=997</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_INTERCEPTION_MODE=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_TPROXY_MARK=1337</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_TPROXY_ROUTE_TABLE=133</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_PORTS_INCLUDE=8080</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_PORTS_EXCLUDE=15090,15021</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_IP_RANGES_INCLUDE=*</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_IP_RANGES_EXCLUDE=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_PORTS_INCLUDE=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_PORTS_EXCLUDE=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: KUBEVIRT_INTERFACES=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ENABLE_INBOUND_IPV6=<span class=\"literal\">false</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: DNS_SERVERS=[10.10.10.6],[]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Writing following contents to rules file:  /tmp/iptables-rules-1626685415906987113.txt145448538</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: * nat</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp --dport 15008 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_REDIRECT -p tcp -j REDIRECT --to-ports 15001</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_IN_REDIRECT -p tcp -j REDIRECT --to-ports 15006</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A PREROUTING -p tcp -j ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp --dport 8080 -j ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p tcp -j ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -s 127.0.0.6/32 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo ! -d 127.0.0.1/32 -p tcp ! --dport 53 -m owner --uid-owner 997 -j ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp ! --dport 53 -m owner ! --uid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --uid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo ! -d 127.0.0.1/32 -m owner --gid-owner 997 -j ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp ! --dport 53 -m owner ! --gid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --gid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -p tcp --dport 53 -d 10.10.10.6/32 -j REDIRECT --to-ports 15053</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -d 127.0.0.1/32 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -j ISTIO_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp --dport 53 -m owner --uid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp --dport 53 -m owner --gid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp --dport 53 -d 10.10.10.6/32 -j REDIRECT --to-port 15053</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables-restore --noflush /tmp/iptables-rules-1626685415906987113.txt145448538</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Writing following contents to rules file:  /tmp/ip6tables-rules-1626685415940193066.txt564611057</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables-restore --noflush /tmp/ip6tables-rules-1626685415940193066.txt564611057</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables-save</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *mangle</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :FORWARD ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Completed on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *nat</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_INBOUND - [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_IN_REDIRECT - [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_OUTPUT - [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_REDIRECT - [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A PREROUTING -p tcp -j ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p tcp -j ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp -m udp --dport 53 -m owner --uid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp -m udp --dport 53 -m owner --gid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -d 10.10.10.6/32 -p udp -m udp --dport 53 -j REDIRECT --to-ports 15053</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp -m tcp --dport 15008 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp -m tcp --dport 8080 -j ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_IN_REDIRECT -p tcp -j REDIRECT --to-ports 15006</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -s 127.0.0.6/32 -o lo -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT ! -d 127.0.0.1/32 -o lo -p tcp -m tcp ! --dport 53 -m owner --uid-owner 997 -j ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp -m tcp ! --dport 53 -m owner ! --uid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --uid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT ! -d 127.0.0.1/32 -o lo -m owner --gid-owner 997 -j ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp -m tcp ! --dport 53 -m owner ! --gid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --gid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -d 10.10.10.6/32 -p tcp -m tcp --dport 53 -j REDIRECT --to-ports 15053</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -d 127.0.0.1/32 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -j ISTIO_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_REDIRECT -p tcp -j REDIRECT --to-ports 15001</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Completed on Mon Jul 19 17:03:35 2021</span></span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"istio1-9iptables\"><a href=\"#istio1-9iptables\" class=\"headerlink\" title=\"istio1.9iptables\"></a>istio1.9iptables</h2><p>k8s1.9.4  istio </p>\n<p> istio1.9.4 istioiptables</p>\n<p>istio, istiosystem<br><br>istio dep :</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ cat /usr/<span class=\"built_in\">local</span>/bin/istio-start.sh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Copyright Istio Authors. All Rights Reserved.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class=\"line\"><span class=\"comment\"># you may not use this file except in compliance with the License.</span></span><br><span class=\"line\"><span class=\"comment\"># You may obtain a copy of the License at</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">#    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Unless required by applicable law or agreed to in writing, software</span></span><br><span class=\"line\"><span class=\"comment\"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class=\"line\"><span class=\"comment\"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class=\"line\"><span class=\"comment\"># See the License for the specific language governing permissions and</span></span><br><span class=\"line\"><span class=\"comment\"># limitations under the License.</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\">################################################################################</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Script to configure and start the Istio sidecar.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set</span> -e</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Match pilot/docker/Dockerfile.proxyv2</span></span><br><span class=\"line\"><span class=\"comment\"># istio </span></span><br><span class=\"line\"><span class=\"built_in\">export</span> ISTIO_META_ISTIO_VERSION=<span class=\"string\">&quot;1.9.0&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">set</span> -a</span><br><span class=\"line\"><span class=\"comment\"># Load optional config variables</span></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\">ISTIO_SIDECAR_CONFIG=<span class=\"variable\">$&#123;ISTIO_SIDECAR_CONFIG:-/var/lib/istio/envoy/sidecar.env&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ -r <span class=\"variable\">$&#123;ISTIO_SIDECAR_CONFIG&#125;</span> ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"comment\"># shellcheck disable=SC1090</span></span><br><span class=\"line\">  . <span class=\"string\">&quot;<span class=\"variable\">$ISTIO_SIDECAR_CONFIG</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Load config variables ISTIO_SYSTEM_NAMESPACE, CONTROL_PLANE_AUTH_POLICY</span></span><br><span class=\"line\">ISTIO_CLUSTER_CONFIG=<span class=\"variable\">$&#123;ISTIO_CLUSTER_CONFIG:-/var/lib/istio/envoy/cluster.env&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [[ -r <span class=\"variable\">$&#123;ISTIO_CLUSTER_CONFIG&#125;</span> ]]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"comment\"># shellcheck disable=SC1090</span></span><br><span class=\"line\">  . <span class=\"string\">&quot;<span class=\"variable\">$ISTIO_CLUSTER_CONFIG</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"built_in\">set</span> +a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Set defaults</span></span><br><span class=\"line\">ISTIO_BIN_BASE=<span class=\"variable\">$&#123;ISTIO_BIN_BASE:-/usr/local/bin&#125;</span></span><br><span class=\"line\">ISTIO_LOG_DIR=<span class=\"variable\">$&#123;ISTIO_LOG_DIR:-/var/log/istio&#125;</span></span><br><span class=\"line\">NS=<span class=\"variable\">$&#123;ISTIO_NAMESPACE:-default&#125;</span></span><br><span class=\"line\">SVC=<span class=\"variable\">$&#123;ISTIO_SERVICE:-rawvm&#125;</span></span><br><span class=\"line\">ISTIO_SYSTEM_NAMESPACE=<span class=\"variable\">$&#123;ISTIO_SYSTEM_NAMESPACE:-istio-system&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The default matches the default istio.yaml - use sidecar.env to override this if you</span></span><br><span class=\"line\"><span class=\"comment\"># enable auth. This requires node-agent to be running.</span></span><br><span class=\"line\"><span class=\"comment\"># istiod </span></span><br><span class=\"line\">ISTIO_PILOT_PORT=<span class=\"variable\">$&#123;ISTIO_PILOT_PORT:-15012&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># If set, override the default</span></span><br><span class=\"line\">CONTROL_PLANE_AUTH_POLICY=<span class=\"variable\">$&#123;ISTIO_CP_AUTH:-&quot;MUTUAL_TLS&quot;&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_SVC_IP:-&#125;</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  ISTIO_SVC_IP=$(hostname --all-ip-addresses | cut -d <span class=\"string\">&#x27; &#x27;</span> -f 1)</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$&#123;POD_NAME:-&#125;</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  POD_NAME=$(hostname -s)</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Init option will only initialize iptables. set ISTIO_CUSTOM_IP_TABLES to true if you would like to ignore this step</span></span><br><span class=\"line\"><span class=\"comment\"># iptables envoy</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_CUSTOM_IP_TABLES&#125;</span>&quot;</span> != <span class=\"string\">&quot;true&quot;</span> ] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"comment\">#  </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"variable\">$&#123;1-&#125;</span> == <span class=\"string\">&quot;init&quot;</span> || <span class=\"variable\">$&#123;1-&#125;</span> == <span class=\"string\">&quot;-p&quot;</span> ]] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"comment\"># clean the previous Istio iptables chains. This part is different from the init image mode,</span></span><br><span class=\"line\">      <span class=\"comment\"># where the init container runs in a fresh environment and there cannot be previous Istio chains</span></span><br><span class=\"line\">      </span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\"># istioiptables</span></span><br><span class=\"line\">      <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_BIN_BASE&#125;</span>/pilot-agent&quot;</span> istio-clean-iptables</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\"># Update iptables, based on current config. This is for backward compatibility with the init image mode.</span></span><br><span class=\"line\">      <span class=\"comment\"># The sidecar image can replace the k8s init image, to avoid downloading 2 different images.</span></span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\"># iptables</span></span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_BIN_BASE&#125;</span>/pilot-agent&quot;</span> istio-iptables <span class=\"string\">&quot;<span class=\"variable\">$&#123;@&#125;</span>&quot;</span></span><br><span class=\"line\">      <span class=\"built_in\">exit</span> 0</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\">    <span class=\"comment\"># </span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> [[ <span class=\"variable\">$&#123;1-&#125;</span> != <span class=\"string\">&quot;run&quot;</span> ]] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">      <span class=\"comment\"># clean the previous Istio iptables chains. This part is different from the init image mode,</span></span><br><span class=\"line\">      <span class=\"comment\"># where the init container runs in a fresh environment and there cannot be previous Istio chains</span></span><br><span class=\"line\">      <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_BIN_BASE&#125;</span>/pilot-agent&quot;</span> istio-clean-iptables</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\"># Update iptables, based on config file</span></span><br><span class=\"line\">      <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_BIN_BASE&#125;</span>/pilot-agent&quot;</span> istio-iptables</span><br><span class=\"line\">    <span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">EXEC_USER=<span class=\"variable\">$&#123;EXEC_USER:-istio-proxy&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_INBOUND_INTERCEPTION_MODE&#125;</span>&quot;</span> = <span class=\"string\">&quot;TPROXY&quot;</span> ] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"comment\"># In order to allow redirect inbound traffic using TPROXY, run envoy with the CAP_NET_ADMIN capability.</span></span><br><span class=\"line\">  <span class=\"comment\"># This allows configuring listeners with the &quot;transparent&quot; socket option set to true.</span></span><br><span class=\"line\">  EXEC_USER=root</span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -z <span class=\"string\">&quot;<span class=\"variable\">$&#123;PILOT_ADDRESS:-&#125;</span>&quot;</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">  PILOT_ADDRESS=istiod.<span class=\"variable\">$&#123;ISTIO_SYSTEM_NAMESPACE&#125;</span>.svc:<span class=\"variable\">$&#123;ISTIO_PILOT_PORT&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"></span><br><span class=\"line\">CA_ADDR=<span class=\"variable\">$&#123;CA_ADDR:-<span class=\"variable\">$&#123;PILOT_ADDRESS&#125;</span>&#125;</span></span><br><span class=\"line\">PROV_CERT=<span class=\"variable\">$&#123;PROV_CERT-/etc/certs&#125;</span></span><br><span class=\"line\">OUTPUT_CERTS=<span class=\"variable\">$&#123;OUTPUT_CERTS-/etc/certs&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">export</span> PROV_CERT</span><br><span class=\"line\"><span class=\"built_in\">export</span> OUTPUT_CERTS</span><br><span class=\"line\"><span class=\"built_in\">export</span> CA_ADDR</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># If predefined ISTIO_AGENT_FLAGS is null, make it an empty string.</span></span><br><span class=\"line\">ISTIO_AGENT_FLAGS=<span class=\"variable\">$&#123;ISTIO_AGENT_FLAGS:-&#125;</span></span><br><span class=\"line\"><span class=\"comment\"># Split ISTIO_AGENT_FLAGS by spaces.</span></span><br><span class=\"line\">IFS=<span class=\"string\">&#x27; &#x27;</span> <span class=\"built_in\">read</span> -r -a ISTIO_AGENT_FLAGS_ARRAY &lt;&lt;&lt; <span class=\"string\">&quot;<span class=\"variable\">$ISTIO_AGENT_FLAGS</span>&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">export</span> PROXY_CONFIG=<span class=\"variable\">$&#123;PROXY_CONFIG:-&quot;</span></span><br><span class=\"line\"><span class=\"variable\">serviceCluster: $SVC</span></span><br><span class=\"line\"><span class=\"variable\">controlPlaneAuthPolicy: <span class=\"variable\">$&#123;CONTROL_PLANE_AUTH_POLICY&#125;</span></span></span><br><span class=\"line\"><span class=\"variable\">discoveryAddress: <span class=\"variable\">$&#123;PILOT_ADDRESS&#125;</span></span></span><br><span class=\"line\"><span class=\"variable\">&quot;&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$&#123;EXEC_USER&#125;</span> == <span class=\"string\">&quot;<span class=\"variable\">$&#123;USER:-&#125;</span>&quot;</span> ] ; <span class=\"keyword\">then</span></span><br><span class=\"line\">  <span class=\"comment\"># if started as istio-proxy (or current user), do a normal start, without</span></span><br><span class=\"line\">  <span class=\"comment\"># redirecting stderr.</span></span><br><span class=\"line\">  INSTANCE_IP=<span class=\"variable\">$&#123;ISTIO_SVC_IP&#125;</span> POD_NAME=<span class=\"variable\">$&#123;POD_NAME&#125;</span> POD_NAMESPACE=<span class=\"variable\">$&#123;NS&#125;</span> <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_BIN_BASE&#125;</span>/pilot-agent&quot;</span> proxy <span class=\"string\">&quot;<span class=\"variable\">$&#123;ISTIO_AGENT_FLAGS_ARRAY[@]&#125;</span>&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Will run: $&#123;ISTIO_BIN_BASE&#125;/envoy -c $ENVOY_CFG --restart-epoch 0 --drain-time-s 2 --parent-shutdown-time-s 3 --service-cluster $SVC --service-node &#x27;sidecar~$&#123;ISTIO_SVC_IP&#125;~$&#123;POD_NAME&#125;.$&#123;NS&#125;.svc.cluster.local~$&#123;NS&#125;.svc.cluster.local&#x27; $ISTIO_DEBUG &gt;$&#123;ISTIO_LOG_DIR&#125;/istio.log&quot; istio-proxy</span></span><br><span class=\"line\"><span class=\"built_in\">exec</span> su -s /bin/bash -c <span class=\"string\">&quot;INSTANCE_IP=<span class=\"variable\">$&#123;ISTIO_SVC_IP&#125;</span> POD_NAME=<span class=\"variable\">$&#123;POD_NAME&#125;</span> POD_NAMESPACE=<span class=\"variable\">$&#123;NS&#125;</span> exec <span class=\"variable\">$&#123;ISTIO_BIN_BASE&#125;</span>/pilot-agent proxy <span class=\"variable\">$&#123;ISTIO_AGENT_FLAGS_ARRAY[*]&#125;</span> 2&gt; <span class=\"variable\">$&#123;ISTIO_LOG_DIR&#125;</span>/istio.err.log &gt; <span class=\"variable\">$&#123;ISTIO_LOG_DIR&#125;</span>/istio.log&quot;</span> <span class=\"variable\">$&#123;EXEC_USER&#125;</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># INSTANCE_IP ip</span></span><br><span class=\"line\"><span class=\"comment\"># ip</span></span><br><span class=\"line\"><span class=\"comment\">#  pilot-agent proxy </span></span><br><span class=\"line\">$ su -s /bin/bash -c INSTANCE_IP=10.10.13.113 POD_NAME=localhost POD_NAMESPACE=vm <span class=\"built_in\">exec</span> /usr/<span class=\"built_in\">local</span>/bin/pilot-agent proxy  2&gt; /var/<span class=\"built_in\">log</span>/istio/istio.err.log &gt; /var/<span class=\"built_in\">log</span>/istio/istio.log istio-proxy</span><br></pre></td></tr></table></figure>\n\n<p>pilot-agent proxy </p>\n<p>istio/pilot/cmd/pilot-agent/main.go</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">\t\t\tagent := envoy.NewAgent(envoyProxy, drainDuration)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t// Watcher is also kicking envoy start.</span><br><span class=\"line\">\t\t\twatcher := envoy.NewWatcher(agent.Restart)</span><br><span class=\"line\">\t\t\tgo watcher.Run(ctx)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t// On SIGINT or SIGTERM, cancel the context, triggering a graceful shutdown</span><br><span class=\"line\">\t\t\tgo cmd.WaitSignalFunc(cancel)</span><br><span class=\"line\">            <span class=\"comment\"># , agent  envoy </span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">return</span> agent.Run(ctx)</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t<span class=\"comment\"># </span></span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">func (a *agent) Run(ctx context.Context) error &#123;</span><br><span class=\"line\">\tlog.Info(<span class=\"string\">&quot;Starting proxy agent&quot;</span>)</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> &#123;</span><br><span class=\"line\">\t\tselect &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> status := &lt;-a.statusCh:</span><br><span class=\"line\">\t\t\ta.mutex.Lock()</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> status.err != nil &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> status.err.Error() == errOutOfMemory &#123;</span><br><span class=\"line\">\t\t\t\t\tlog.Warnf(<span class=\"string\">&quot;Envoy may have been out of memory killed. Check memory usage and limits.&quot;</span>)</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tlog.Errorf(<span class=\"string\">&quot;Epoch %d exited with error: %v&quot;</span>, status.epoch, status.err)</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\tlog.Infof(<span class=\"string\">&quot;Epoch %d exited normally&quot;</span>, status.epoch)</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tdelete(a.activeEpochs, status.epoch)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tactive := len(a.activeEpochs)</span><br><span class=\"line\">\t\t\ta.mutex.Unlock()</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> active == 0 &#123;</span><br><span class=\"line\">\t\t\t\tlog.Infof(<span class=\"string\">&quot;No more active epochs, terminating&quot;</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">return</span> nil</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tlog.Infof(<span class=\"string\">&quot;%d active epochs running&quot;</span>, active)</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> &lt;-ctx.Done():</span><br><span class=\"line\">\t\t<span class=\"comment\"># terminate</span></span><br><span class=\"line\">\t\t\ta.terminate()</span><br><span class=\"line\">\t\t\tlog.Info(<span class=\"string\">&quot;Agent has successfully terminated&quot;</span>)</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">return</span> nil</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\"># enovyAPI envoy </span></span><br><span class=\"line\">func doEnvoyPost(path, contentType, body string, adminPort uint32) (*bytes.Buffer, error) &#123;</span><br><span class=\"line\">\trequestURL := fmt.Sprintf(<span class=\"string\">&quot;http://127.0.0.1:%d/%s&quot;</span>, adminPort, path)</span><br><span class=\"line\">\tbuffer, err := doHTTPPost(requestURL, contentType, body)</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> err != nil &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">return</span> nil, err</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">return</span> buffer, nil</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"istio\"><a href=\"#istio\" class=\"headerlink\" title=\"istio\"></a>istio</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">-- Logs begin at  2021-07-19 08:59:42 UTC, end at  2021-07-19 16:01:01 UTC. --</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain systemd[1]: Started istio-sidecar: The Istio sidecar.</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -D PREROUTING -p tcp -j ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -D PREROUTING -p tcp -j ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -D OUTPUT -p tcp -j ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -F ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -X ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -F ISTIO_DIVERT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -X ISTIO_DIVERT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -F ISTIO_TPROXY</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t mangle -X ISTIO_TPROXY</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -F ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables -t nat -X ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -D PREROUTING -p tcp -j ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -D PREROUTING -p tcp -j ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -D OUTPUT -p tcp -j ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -F ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -X ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -F ISTIO_DIVERT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -X ISTIO_DIVERT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -F ISTIO_TPROXY</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t mangle -X ISTIO_TPROXY</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -F ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables -t nat -X ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables-save</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *mangle</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :FORWARD ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Completed on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *nat</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Completed on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables-save</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Generated by ip6tables-save v1.4.21 on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *mangle</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :FORWARD ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Completed on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Generated by ip6tables-save v1.4.21 on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *nat</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Completed on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Environment:</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ------------</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ENVOY_PORT=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_CAPTURE_PORT=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_INTERCEPTION_MODE=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_TPROXY_MARK=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_TPROXY_ROUTE_TABLE=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_INBOUND_PORTS=8080</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_OUTBOUND_PORTS=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_LOCAL_EXCLUDE_PORTS=15090,15021</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_SERVICE_CIDR=*</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ISTIO_SERVICE_EXCLUDE_CIDR=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Variables:</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ----------</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_PORT=15001</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_INBOUND_CAPTURE_PORT=15006</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_TUNNEL_PORT=15008</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_UID=997</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: PROXY_GID=997</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_INTERCEPTION_MODE=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_TPROXY_MARK=1337</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_TPROXY_ROUTE_TABLE=133</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_PORTS_INCLUDE=8080</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: INBOUND_PORTS_EXCLUDE=15090,15021</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_IP_RANGES_INCLUDE=*</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_IP_RANGES_EXCLUDE=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_PORTS_INCLUDE=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: OUTBOUND_PORTS_EXCLUDE=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: KUBEVIRT_INTERFACES=</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ENABLE_INBOUND_IPV6=<span class=\"literal\">false</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: DNS_SERVERS=[10.10.10.6],[]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Writing following contents to rules file:  /tmp/iptables-rules-1626685415906987113.txt145448538</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: * nat</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -N ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp --dport 15008 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_REDIRECT -p tcp -j REDIRECT --to-ports 15001</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_IN_REDIRECT -p tcp -j REDIRECT --to-ports 15006</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A PREROUTING -p tcp -j ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp --dport 8080 -j ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p tcp -j ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -s 127.0.0.6/32 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo ! -d 127.0.0.1/32 -p tcp ! --dport 53 -m owner --uid-owner 997 -j ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp ! --dport 53 -m owner ! --uid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --uid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo ! -d 127.0.0.1/32 -m owner --gid-owner 997 -j ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp ! --dport 53 -m owner ! --gid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --gid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -p tcp --dport 53 -d 10.10.10.6/32 -j REDIRECT --to-ports 15053</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -d 127.0.0.1/32 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -j ISTIO_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp --dport 53 -m owner --uid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp --dport 53 -m owner --gid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp --dport 53 -d 10.10.10.6/32 -j REDIRECT --to-port 15053</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables-restore --noflush /tmp/iptables-rules-1626685415906987113.txt145448538</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: Writing following contents to rules file:  /tmp/ip6tables-rules-1626685415940193066.txt564611057</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: ip6tables-restore --noflush /tmp/ip6tables-rules-1626685415940193066.txt564611057</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: iptables-save</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *mangle</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :FORWARD ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Completed on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Generated by iptables-save v1.4.21 on Mon Jul 19 17:03:35 2021</span></span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: *nat</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :PREROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :INPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :OUTPUT ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :POSTROUTING ACCEPT [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_INBOUND - [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_IN_REDIRECT - [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_OUTPUT - [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: :ISTIO_REDIRECT - [0:0]</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A PREROUTING -p tcp -j ISTIO_INBOUND</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p tcp -j ISTIO_OUTPUT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp -m udp --dport 53 -m owner --uid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -p udp -m udp --dport 53 -m owner --gid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A OUTPUT -d 10.10.10.6/32 -p udp -m udp --dport 53 -j REDIRECT --to-ports 15053</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp -m tcp --dport 15008 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_INBOUND -p tcp -m tcp --dport 8080 -j ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_IN_REDIRECT -p tcp -j REDIRECT --to-ports 15006</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -s 127.0.0.6/32 -o lo -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT ! -d 127.0.0.1/32 -o lo -p tcp -m tcp ! --dport 53 -m owner --uid-owner 997 -j ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp -m tcp ! --dport 53 -m owner ! --uid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --uid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT ! -d 127.0.0.1/32 -o lo -m owner --gid-owner 997 -j ISTIO_IN_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -o lo -p tcp -m tcp ! --dport 53 -m owner ! --gid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -m owner --gid-owner 997 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -d 10.10.10.6/32 -p tcp -m tcp --dport 53 -j REDIRECT --to-ports 15053</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -d 127.0.0.1/32 -j RETURN</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_OUTPUT -j ISTIO_REDIRECT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: -A ISTIO_REDIRECT -p tcp -j REDIRECT --to-ports 15001</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: COMMIT</span><br><span class=\"line\">7 19 09:03:35 localhost.localdomain istio-start.sh[6717]: <span class=\"comment\"># Completed on Mon Jul 19 17:03:35 2021</span></span><br></pre></td></tr></table></figure>"},{"title":"istiotcp()","date":"2021-08-23T16:00:00.000Z","_content":"\n## \n\n, mysql, redis, k8s1.11 istio 1.4,\nistiok8s  istio1.6 \n\n## mysql\n\n, mysqlclient server \n\nmysql-client ----> mysql-server\n\n```bash\n$ kubectl apply -f - <<EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  generation: 2\n  labels:\n    app: mysql-server\n  name: mysql-server\n  namespace: demo1\nspec:\n  progressDeadlineSeconds: 600\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      app: mysql-server\n  strategy:\n    rollingUpdate:\n      maxSurge: 25%\n      maxUnavailable: 25%\n    type: RollingUpdate\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: mysql-server\n    spec:\n      containers:\n        - env:\n            - name: MYSQL_ROOT_PASSWORD\n              value: password\n          image: mysql\n          imagePullPolicy: Always\n          name: mysql\n          ports:\n            - containerPort: 3306\n              protocol: TCP\n          resources: {}\n          terminationMessagePath: /dev/termination-log\n          terminationMessagePolicy: File\n      dnsPolicy: ClusterFirst\n      restartPolicy: Always\n      schedulerName: default-scheduler\n      securityContext: {}\n      terminationGracePeriodSeconds: 30\n---\n\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: mysql-server\n  name: mysql-server\n  namespace: demo1\nspec:\n  clusterIP: 10.68.228.107\n  externalTrafficPolicy: Cluster\n  ports:\n    - name: 3306-3306\n      nodePort: 32011\n      port: 3306\n      protocol: TCP\n      targetPort: 3306\n  selector:\n    app: mysql-server\n  sessionAffinity: None\n  type: NodePort\nEOF  \n\n$ kubectl apply -f - <<EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  generation: 2\n  labels:\n    app: mysql-client\n  name: mysql-client\n  namespace: demo1\nspec:\n  progressDeadlineSeconds: 600\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      app: mysql-client\n  strategy:\n    rollingUpdate:\n      maxSurge: 25%\n      maxUnavailable: 25%\n    type: RollingUpdate\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: mysql-client\n    spec:\n      containers:\n        - image: clarechu/mysql-client:v1\n          imagePullPolicy: Always\n          name: mysql\n          resources: {}\n          terminationMessagePath: /dev/termination-log\n          terminationMessagePolicy: File\n      dnsPolicy: ClusterFirst\n      restartPolicy: Always\n      schedulerName: default-scheduler\n      securityContext: {}\n      terminationGracePeriodSeconds: 30\nEOF\n\n```\n\npodsidecar\n\n```bash\n\n$ kubectl get po\n \nNAME                            READY   STATUS    RESTARTS   AGE\nmysql-client-b7db8cc46-99cx5    2/2     Running   0          81s\nmysql-server-6c845f449b-525q6   2/2     Running   0          81s\n```\n\nsidecar  clientserver mysql, mysql-server  nsmysql-server\n\n```bash\n\n$ kubectl exec -it mysql-client-b7db8cc46-99cx5 telnet mysql-server 3306\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.\nDefaulted container \"mysql\" out of: mysql, istio-proxy, istio-init (init)\nConnected to mysql-server\nJ\n8.0.26\t*F?eZTM\\~h#DD#2)caching_sha2_password\n```\n\nmysql-client pod listener(), 3306 `mysql-server.demo1.svc.cluster.local`, cluster\n\n```bash\n  ~ istioctl  pc listener mysql-client-b7db8cc46-99cx5 --port 3306\nADDRESS       PORT MATCH DESTINATION\n10.68.228.107 3306 ALL   Cluster: outbound|3306||mysql-server.demo1.svc.cluster.local\n\n```\n\n , 3306cluster `outbound|3306||mysql-server.demo1.svc.cluster.local`\n\n```json\n\n                    {\n                        \"name\": \"envoy.filters.network.tcp_proxy\",\n                        \"typedConfig\": {\n                            \"@type\": \"type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy\",\n                            \"statPrefix\": \"outbound|3306||mysql-server.demo1.svc.cluster.local\",\n                            \"cluster\": \"outbound|3306||mysql-server.demo1.svc.cluster.local\",\n                            \"accessLog\": [\n                                {\n                                    \"name\": \"envoy.access_loggers.file\",\n                                    \"typedConfig\": {\n                                        \"@type\": \"type.googleapis.com/envoy.extensions.access_loggers.file.v3.FileAccessLog\",\n                                        \"path\": \"/dev/stdout\",\n                                        \"logFormat\": {\n                                            \"textFormat\": \"[%START_TIME%] \\\"%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\\\" %RESPONSE_CODE% %RESPONSE_FLAGS% %RESPONSE_CODE_DETAILS% %CONNECTION_TERMINATION_DETAILS% \\\"%UPSTREAM_TRANSPORT_FAILURE_REASON%\\\" %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \\\"%REQ(X-FORWARDED-FOR)%\\\" \\\"%REQ(USER-AGENT)%\\\" \\\"%REQ(X-REQUEST-ID)%\\\" \\\"%REQ(:AUTHORITY)%\\\" \\\"%UPSTREAM_HOST%\\\" %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\\n\"\n                                        }\n                                    }\n                                }\n                            ]\n                        }\n                    }\n\n```\n\n\npodcluster\n\n```bash\n$ stioctl pc cluster mysql-client-b7db8cc46-99cx5 --fqdn \"outbound|3306||mysql-server.demo1.svc.cluster.local\" -o json\n[\n    {\n        \"transportSocketMatches\": [\n            {\n                \"name\": \"tlsMode-istio\",\n                \"match\": {\n                    \"tlsMode\": \"istio\"\n                },\n                \"transportSocket\": {\n                    \"name\": \"envoy.transport_sockets.tls\",\n                    \"typedConfig\": {\n                        \"@type\": \"type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.UpstreamTlsContext\",\n                        \"commonTlsContext\": {\n                            \"tlsCertificateSdsSecretConfigs\": [\n                                {\n                                    \"name\": \"default\",\n                                    \"sdsConfig\": {\n                                        \"apiConfigSource\": {\n                                            \"apiType\": \"GRPC\",\n                                            \"transportApiVersion\": \"V3\",\n                                            \"grpcServices\": [\n                                                {\n                                                    \"envoyGrpc\": {\n                                                        \"clusterName\": \"sds-grpc\"\n                                                    }\n                                                }\n                                            ],\n                                            \"setNodeOnFirstMessageOnly\": true\n                                        },\n                                        \"initialFetchTimeout\": \"0s\",\n                                        \"resourceApiVersion\": \"V3\"\n                                    }\n                                }\n                            ],\n                            \"combinedValidationContext\": {\n                                \"defaultValidationContext\": {\n                                    \"matchSubjectAltNames\": [\n                                        {\n                                            \"exact\": \"spiffe://cluster.local/ns/demo1/sa/default\"\n                                        }\n                                    ]\n                                },\n                                \"validationContextSdsSecretConfig\": {\n                                    \"name\": \"ROOTCA\",\n                                    \"sdsConfig\": {\n                                        \"apiConfigSource\": {\n                                            \"apiType\": \"GRPC\",\n                                            \"transportApiVersion\": \"V3\",\n                                            \"grpcServices\": [\n                                                {\n                                                    \"envoyGrpc\": {\n                                                        \"clusterName\": \"sds-grpc\"\n                                                    }\n                                                }\n                                            ],\n                                            \"setNodeOnFirstMessageOnly\": true\n                                        },\n                                        \"initialFetchTimeout\": \"0s\",\n                                        \"resourceApiVersion\": \"V3\"\n                                    }\n                                }\n                            },\n                            \"alpnProtocols\": [\n                                \"istio-peer-exchange\",\n                                \"istio\"\n                            ]\n                        },\n                        \"sni\": \"outbound_.3306_._.mysql-server.demo1.svc.cluster.local\"\n                    }\n                }\n            },\n            {\n                \"name\": \"tlsMode-disabled\",\n                \"match\": {},\n                \"transportSocket\": {\n                    \"name\": \"envoy.transport_sockets.raw_buffer\"\n                }\n            }\n        ],\n        \"name\": \"outbound|3306||mysql-server.demo1.svc.cluster.local\",\n        \"type\": \"EDS\",\n        \"edsClusterConfig\": {\n            \"edsConfig\": {\n                \"ads\": {},\n                \"resourceApiVersion\": \"V3\"\n            },\n            \"serviceName\": \"outbound|3306||mysql-server.demo1.svc.cluster.local\"\n        },\n        \"connectTimeout\": \"10s\",\n        \"circuitBreakers\": {\n            \"thresholds\": [\n                {\n                    \"maxConnections\": 4294967295,\n                    \"maxPendingRequests\": 4294967295,\n                    \"maxRequests\": 4294967295,\n                    \"maxRetries\": 4294967295\n                }\n            ]\n        },\n        \"metadata\": {\n            \"filterMetadata\": {\n                \"istio\": {\n                    \"default_original_port\": 3306,\n                    \"services\": [\n                        {\n                            \"host\": \"mysql-server.demo1.svc.cluster.local\",\n                            \"name\": \"mysql-server\",\n                            \"namespace\": \"demo1\"\n                        }\n                    ]\n                }\n            }\n        },\n        \"filters\": [\n            {\n                \"name\": \"istio.metadata_exchange\",\n                \"typedConfig\": {\n                    \"@type\": \"type.googleapis.com/udpa.type.v1.TypedStruct\",\n                    \"typeUrl\": \"type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange\",\n                    \"value\": {\n                        \"protocol\": \"istio-peer-exchange\"\n                    }\n                }\n            }\n        ]\n    }\n]\n```\n\ncluster\n\nEDSdestination pod, Envoy  `outbound|3306||mysql-server.demo1.svc.cluster.local`\n\nenvoy endpoint `outbound|3306||mysql-server.demo1.svc.cluster.local` ,  mysql-server pod ip\n--> `172.20.0.30` \n\n epsvc `endpoint`\n![img2.png](istio-network/img_2.png)\n\n, sidecark8s svcpod ip\n\n![img1.png](istio-network/img_1.png)\n\n```bash\n  ~  istioctl pc ep mysql-client-b7db8cc46-99cx5 --port 3306\nENDPOINT             STATUS      OUTLIER CHECK     CLUSTER\n172.20.0.30:3306     HEALTHY     OK                outbound|3306||mysql-server.demo1.svc.cluster.local\n\n  ~ k get po -o wide\nNAME                            READY   STATUS    RESTARTS   AGE   IP            NODE           NOMINATED NODE   READINESS GATES\nmysql-client-b7db8cc46-99cx5    2/2     Running   0          33m   172.20.0.31   10.10.13.118   <none>           <none>\nmysql-server-6c845f449b-525q6   2/2     Running   0          33m   172.20.0.30   10.10.13.118   <none>           <none>\n```\n\n## mysql\n\n,mysql pod(mysql-client-b7db8cc46-99cx5)mysql, mysql-server,  listener\n\n```bash\n$ ~ kubectl exec -it mysql-client-b7db8cc46-99cx5 telnet 10.10.13.110 3306\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.\nDefaulted container \"mysql\" out of: mysql, istio-proxy, istio-init (init)\nConnected to 10.10.13.110\nJ\n8.0.26\\r(Juh5kguvqI2\"}!caching_sha2_password\n```\n\nserviceentry, , \n\n```bash\n  ~ kubectl exec -it mysql-client-b7db8cc46-99cx5 telnet 10.10.13.110 3306\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.\nDefaulted container \"mysql\" out of: mysql, istio-proxy, istio-init (init)\nConnected to 10.10.13.110\nConnection closed by foreign host\ncommand terminated with exit code 1\n```\n\nclient listener, `0.0.0.0` , nsse,\n`0.0.0.0`listener\n\n```bash\n  ~ istioctl pc listener mysql-client-b7db8cc46-99cx5 --port 3306\nADDRESS       PORT MATCH DESTINATION\n0.0.0.0       3306 ALL   Cluster: outbound|3306||mysql.demo\n10.68.228.107 3306 ALL   Cluster: outbound|3306||mysql-server.demo1.svc.cluster.local\n```\n\ncluster, `outbound|3306||mysql.demo`, svc, svc\n\n```json\n  ~ istioctl pc listener mysql-client-b7db8cc46-99cx5 --port 3306 -o json\n        \n{\n                        \"name\": \"envoy.filters.network.tcp_proxy\",\n                        \"typedConfig\": {\n                            \"@type\": \"type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy\",\n                            \"statPrefix\": \"outbound|3306||mysql.demo\",\n                            \"cluster\": \"outbound|3306||mysql.demo\",\n                            \"accessLog\": [\n                                {\n                                    \"name\": \"envoy.access_loggers.file\",\n                                    \"typedConfig\": {\n                                        \"@type\": \"type.googleapis.com/envoy.extensions.access_loggers.file.v3.FileAccessLog\",\n                                        \"path\": \"/dev/stdout\",\n                                        \"logFormat\": {\n                                            \"textFormat\": \"[%START_TIME%] \\\"%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\\\" %RESPONSE_CODE% %RESPONSE_FLAGS% %RESPONSE_CODE_DETAILS% %CONNECTION_TERMINATION_DETAILS% \\\"%UPSTREAM_TRANSPORT_FAILURE_REASON%\\\" %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \\\"%REQ(X-FORWARDED-FOR)%\\\" \\\"%REQ(USER-AGENT)%\\\" \\\"%REQ(X-REQUEST-ID)%\\\" \\\"%REQ(:AUTHORITY)%\\\" \\\"%UPSTREAM_HOST%\\\" %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\\n\"\n                                        }\n                                    }\n```\n\nserviceentry namespace \n\n### \n\n1. sidecar crd\n\n\nserviceentry namespace sidecardemo1\nsidecar istio-system\n```yaml\napiVersion: networking.istio.io/v1beta1\nkind: Sidecar\nmetadata:\n  name: default\n  namespace: demo1\nspec:\n  egress:\n  - hosts:\n    - \"./*\"\n    - \"istio-system/*\"\n\n```\n\nsidecar mysql-client podlistener, 0.0.0.0 mysql-client mysql\n\n```yaml\n  ~ istioctl pc  listener mysql-client-b7db8cc46-99cx5 --port 3306\nADDRESS       PORT MATCH DESTINATION\n10.68.228.107 3306 ALL   Cluster: outbound|3306||mysql-server.demo1.svc.cluster.local\n10.68.66.97   3306 ALL   Cluster: outbound|3306||mysql-client.demo1.svc.cluster.local\n\n  ~ kubectl exec -it mysql-client-b7db8cc46-99cx5 telnet 10.10.13.110 3306\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.\nDefaulted container \"mysql\" out of: mysql, istio-proxy, istio-init (init)\nConnected to 10.10.13.110\nJ\nB5>I=6s=E6,&M}Qcaching_sha2_password\n\n!#08S01Got packets out of orderConnection closed by foreign host\ncommand terminated with exit code 1\n```\n\n\n2. \n\nsemysqlport 0.0.0.0 3306 \n\n\n3. dns\n\nistioistio dns,istio1.8.\n\nistioiop\n\n```yaml\n  meshConfig:\n    accessLogFile: /dev/stdout\n    defaultConfig:\n      proxyMetadata:\n        ISTIO_META_DNS_CAPTURE: \"true\"\n```\n\nseaddress  mysql.demo122 hostip\n\n```yaml\n- apiVersion: networking.istio.io/v1beta1\n  kind: ServiceEntry\n  metadata:\n    name: mysql\n    namespace: demo\n  spec:\n    addresses:\n    - 240.0.221.130\n    hosts:\n    - mysql.demo122\n    location: MESH_INTERNAL\n    ports:\n    - name: tcp\n      number: 3306\n      protocol: TCP\n      targetPort: 3306\n    resolution: STATIC\n```\n\nserviceentry mysql-clienthost`240.0.221.130`ip\n\n```bash\n  ~ kubectl exec -it mysql-client-b7db8cc46-99cx5 ping mysql.demo122\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.\nDefaulted container \"mysql\" out of: mysql, istio-proxy, istio-init (init)\nPING mysql.demo122 (240.0.221.130) 56(84) bytes of data.\n```\n\nmysql-client-b7db8cc46-99cx50.0.0.0  `240.0.221.130 3306 ALL   Cluster: outbound|3306||mysql.demo122`mysql0.0.0.0\n\n```yaml\n  ~ istioctl pc  listener mysql-client-b7db8cc46-99cx5 --port 3306\nADDRESS       PORT MATCH DESTINATION\n10.68.228.107 3306 ALL   Cluster: outbound|3306||mysql-server.demo1.svc.cluster.local\n10.68.66.97   3306 ALL   Cluster: outbound|3306||mysql-client.demo1.svc.cluster.local\n240.0.221.130 3306 ALL   Cluster: outbound|3306||mysql.demo122\n```\n\n\n## \n\n, \n\n1. namespace sidecar, envoy, \n2. serivceentry\n","source":"_posts/k8s/istio/istio-network.md","raw":"---\ntitle: istiotcp()\ndate: 2021-08-24\ntags:\n- istio\n- k8s\n---\n\n## \n\n, mysql, redis, k8s1.11 istio 1.4,\nistiok8s  istio1.6 \n\n## mysql\n\n, mysqlclient server \n\nmysql-client ----> mysql-server\n\n```bash\n$ kubectl apply -f - <<EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  generation: 2\n  labels:\n    app: mysql-server\n  name: mysql-server\n  namespace: demo1\nspec:\n  progressDeadlineSeconds: 600\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      app: mysql-server\n  strategy:\n    rollingUpdate:\n      maxSurge: 25%\n      maxUnavailable: 25%\n    type: RollingUpdate\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: mysql-server\n    spec:\n      containers:\n        - env:\n            - name: MYSQL_ROOT_PASSWORD\n              value: password\n          image: mysql\n          imagePullPolicy: Always\n          name: mysql\n          ports:\n            - containerPort: 3306\n              protocol: TCP\n          resources: {}\n          terminationMessagePath: /dev/termination-log\n          terminationMessagePolicy: File\n      dnsPolicy: ClusterFirst\n      restartPolicy: Always\n      schedulerName: default-scheduler\n      securityContext: {}\n      terminationGracePeriodSeconds: 30\n---\n\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: mysql-server\n  name: mysql-server\n  namespace: demo1\nspec:\n  clusterIP: 10.68.228.107\n  externalTrafficPolicy: Cluster\n  ports:\n    - name: 3306-3306\n      nodePort: 32011\n      port: 3306\n      protocol: TCP\n      targetPort: 3306\n  selector:\n    app: mysql-server\n  sessionAffinity: None\n  type: NodePort\nEOF  \n\n$ kubectl apply -f - <<EOF\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  generation: 2\n  labels:\n    app: mysql-client\n  name: mysql-client\n  namespace: demo1\nspec:\n  progressDeadlineSeconds: 600\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      app: mysql-client\n  strategy:\n    rollingUpdate:\n      maxSurge: 25%\n      maxUnavailable: 25%\n    type: RollingUpdate\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: mysql-client\n    spec:\n      containers:\n        - image: clarechu/mysql-client:v1\n          imagePullPolicy: Always\n          name: mysql\n          resources: {}\n          terminationMessagePath: /dev/termination-log\n          terminationMessagePolicy: File\n      dnsPolicy: ClusterFirst\n      restartPolicy: Always\n      schedulerName: default-scheduler\n      securityContext: {}\n      terminationGracePeriodSeconds: 30\nEOF\n\n```\n\npodsidecar\n\n```bash\n\n$ kubectl get po\n \nNAME                            READY   STATUS    RESTARTS   AGE\nmysql-client-b7db8cc46-99cx5    2/2     Running   0          81s\nmysql-server-6c845f449b-525q6   2/2     Running   0          81s\n```\n\nsidecar  clientserver mysql, mysql-server  nsmysql-server\n\n```bash\n\n$ kubectl exec -it mysql-client-b7db8cc46-99cx5 telnet mysql-server 3306\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.\nDefaulted container \"mysql\" out of: mysql, istio-proxy, istio-init (init)\nConnected to mysql-server\nJ\n8.0.26\t*F?eZTM\\~h#DD#2)caching_sha2_password\n```\n\nmysql-client pod listener(), 3306 `mysql-server.demo1.svc.cluster.local`, cluster\n\n```bash\n  ~ istioctl  pc listener mysql-client-b7db8cc46-99cx5 --port 3306\nADDRESS       PORT MATCH DESTINATION\n10.68.228.107 3306 ALL   Cluster: outbound|3306||mysql-server.demo1.svc.cluster.local\n\n```\n\n , 3306cluster `outbound|3306||mysql-server.demo1.svc.cluster.local`\n\n```json\n\n                    {\n                        \"name\": \"envoy.filters.network.tcp_proxy\",\n                        \"typedConfig\": {\n                            \"@type\": \"type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy\",\n                            \"statPrefix\": \"outbound|3306||mysql-server.demo1.svc.cluster.local\",\n                            \"cluster\": \"outbound|3306||mysql-server.demo1.svc.cluster.local\",\n                            \"accessLog\": [\n                                {\n                                    \"name\": \"envoy.access_loggers.file\",\n                                    \"typedConfig\": {\n                                        \"@type\": \"type.googleapis.com/envoy.extensions.access_loggers.file.v3.FileAccessLog\",\n                                        \"path\": \"/dev/stdout\",\n                                        \"logFormat\": {\n                                            \"textFormat\": \"[%START_TIME%] \\\"%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\\\" %RESPONSE_CODE% %RESPONSE_FLAGS% %RESPONSE_CODE_DETAILS% %CONNECTION_TERMINATION_DETAILS% \\\"%UPSTREAM_TRANSPORT_FAILURE_REASON%\\\" %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \\\"%REQ(X-FORWARDED-FOR)%\\\" \\\"%REQ(USER-AGENT)%\\\" \\\"%REQ(X-REQUEST-ID)%\\\" \\\"%REQ(:AUTHORITY)%\\\" \\\"%UPSTREAM_HOST%\\\" %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\\n\"\n                                        }\n                                    }\n                                }\n                            ]\n                        }\n                    }\n\n```\n\n\npodcluster\n\n```bash\n$ stioctl pc cluster mysql-client-b7db8cc46-99cx5 --fqdn \"outbound|3306||mysql-server.demo1.svc.cluster.local\" -o json\n[\n    {\n        \"transportSocketMatches\": [\n            {\n                \"name\": \"tlsMode-istio\",\n                \"match\": {\n                    \"tlsMode\": \"istio\"\n                },\n                \"transportSocket\": {\n                    \"name\": \"envoy.transport_sockets.tls\",\n                    \"typedConfig\": {\n                        \"@type\": \"type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.UpstreamTlsContext\",\n                        \"commonTlsContext\": {\n                            \"tlsCertificateSdsSecretConfigs\": [\n                                {\n                                    \"name\": \"default\",\n                                    \"sdsConfig\": {\n                                        \"apiConfigSource\": {\n                                            \"apiType\": \"GRPC\",\n                                            \"transportApiVersion\": \"V3\",\n                                            \"grpcServices\": [\n                                                {\n                                                    \"envoyGrpc\": {\n                                                        \"clusterName\": \"sds-grpc\"\n                                                    }\n                                                }\n                                            ],\n                                            \"setNodeOnFirstMessageOnly\": true\n                                        },\n                                        \"initialFetchTimeout\": \"0s\",\n                                        \"resourceApiVersion\": \"V3\"\n                                    }\n                                }\n                            ],\n                            \"combinedValidationContext\": {\n                                \"defaultValidationContext\": {\n                                    \"matchSubjectAltNames\": [\n                                        {\n                                            \"exact\": \"spiffe://cluster.local/ns/demo1/sa/default\"\n                                        }\n                                    ]\n                                },\n                                \"validationContextSdsSecretConfig\": {\n                                    \"name\": \"ROOTCA\",\n                                    \"sdsConfig\": {\n                                        \"apiConfigSource\": {\n                                            \"apiType\": \"GRPC\",\n                                            \"transportApiVersion\": \"V3\",\n                                            \"grpcServices\": [\n                                                {\n                                                    \"envoyGrpc\": {\n                                                        \"clusterName\": \"sds-grpc\"\n                                                    }\n                                                }\n                                            ],\n                                            \"setNodeOnFirstMessageOnly\": true\n                                        },\n                                        \"initialFetchTimeout\": \"0s\",\n                                        \"resourceApiVersion\": \"V3\"\n                                    }\n                                }\n                            },\n                            \"alpnProtocols\": [\n                                \"istio-peer-exchange\",\n                                \"istio\"\n                            ]\n                        },\n                        \"sni\": \"outbound_.3306_._.mysql-server.demo1.svc.cluster.local\"\n                    }\n                }\n            },\n            {\n                \"name\": \"tlsMode-disabled\",\n                \"match\": {},\n                \"transportSocket\": {\n                    \"name\": \"envoy.transport_sockets.raw_buffer\"\n                }\n            }\n        ],\n        \"name\": \"outbound|3306||mysql-server.demo1.svc.cluster.local\",\n        \"type\": \"EDS\",\n        \"edsClusterConfig\": {\n            \"edsConfig\": {\n                \"ads\": {},\n                \"resourceApiVersion\": \"V3\"\n            },\n            \"serviceName\": \"outbound|3306||mysql-server.demo1.svc.cluster.local\"\n        },\n        \"connectTimeout\": \"10s\",\n        \"circuitBreakers\": {\n            \"thresholds\": [\n                {\n                    \"maxConnections\": 4294967295,\n                    \"maxPendingRequests\": 4294967295,\n                    \"maxRequests\": 4294967295,\n                    \"maxRetries\": 4294967295\n                }\n            ]\n        },\n        \"metadata\": {\n            \"filterMetadata\": {\n                \"istio\": {\n                    \"default_original_port\": 3306,\n                    \"services\": [\n                        {\n                            \"host\": \"mysql-server.demo1.svc.cluster.local\",\n                            \"name\": \"mysql-server\",\n                            \"namespace\": \"demo1\"\n                        }\n                    ]\n                }\n            }\n        },\n        \"filters\": [\n            {\n                \"name\": \"istio.metadata_exchange\",\n                \"typedConfig\": {\n                    \"@type\": \"type.googleapis.com/udpa.type.v1.TypedStruct\",\n                    \"typeUrl\": \"type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange\",\n                    \"value\": {\n                        \"protocol\": \"istio-peer-exchange\"\n                    }\n                }\n            }\n        ]\n    }\n]\n```\n\ncluster\n\nEDSdestination pod, Envoy  `outbound|3306||mysql-server.demo1.svc.cluster.local`\n\nenvoy endpoint `outbound|3306||mysql-server.demo1.svc.cluster.local` ,  mysql-server pod ip\n--> `172.20.0.30` \n\n epsvc `endpoint`\n![img2.png](istio-network/img_2.png)\n\n, sidecark8s svcpod ip\n\n![img1.png](istio-network/img_1.png)\n\n```bash\n  ~  istioctl pc ep mysql-client-b7db8cc46-99cx5 --port 3306\nENDPOINT             STATUS      OUTLIER CHECK     CLUSTER\n172.20.0.30:3306     HEALTHY     OK                outbound|3306||mysql-server.demo1.svc.cluster.local\n\n  ~ k get po -o wide\nNAME                            READY   STATUS    RESTARTS   AGE   IP            NODE           NOMINATED NODE   READINESS GATES\nmysql-client-b7db8cc46-99cx5    2/2     Running   0          33m   172.20.0.31   10.10.13.118   <none>           <none>\nmysql-server-6c845f449b-525q6   2/2     Running   0          33m   172.20.0.30   10.10.13.118   <none>           <none>\n```\n\n## mysql\n\n,mysql pod(mysql-client-b7db8cc46-99cx5)mysql, mysql-server,  listener\n\n```bash\n$ ~ kubectl exec -it mysql-client-b7db8cc46-99cx5 telnet 10.10.13.110 3306\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.\nDefaulted container \"mysql\" out of: mysql, istio-proxy, istio-init (init)\nConnected to 10.10.13.110\nJ\n8.0.26\\r(Juh5kguvqI2\"}!caching_sha2_password\n```\n\nserviceentry, , \n\n```bash\n  ~ kubectl exec -it mysql-client-b7db8cc46-99cx5 telnet 10.10.13.110 3306\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.\nDefaulted container \"mysql\" out of: mysql, istio-proxy, istio-init (init)\nConnected to 10.10.13.110\nConnection closed by foreign host\ncommand terminated with exit code 1\n```\n\nclient listener, `0.0.0.0` , nsse,\n`0.0.0.0`listener\n\n```bash\n  ~ istioctl pc listener mysql-client-b7db8cc46-99cx5 --port 3306\nADDRESS       PORT MATCH DESTINATION\n0.0.0.0       3306 ALL   Cluster: outbound|3306||mysql.demo\n10.68.228.107 3306 ALL   Cluster: outbound|3306||mysql-server.demo1.svc.cluster.local\n```\n\ncluster, `outbound|3306||mysql.demo`, svc, svc\n\n```json\n  ~ istioctl pc listener mysql-client-b7db8cc46-99cx5 --port 3306 -o json\n        \n{\n                        \"name\": \"envoy.filters.network.tcp_proxy\",\n                        \"typedConfig\": {\n                            \"@type\": \"type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy\",\n                            \"statPrefix\": \"outbound|3306||mysql.demo\",\n                            \"cluster\": \"outbound|3306||mysql.demo\",\n                            \"accessLog\": [\n                                {\n                                    \"name\": \"envoy.access_loggers.file\",\n                                    \"typedConfig\": {\n                                        \"@type\": \"type.googleapis.com/envoy.extensions.access_loggers.file.v3.FileAccessLog\",\n                                        \"path\": \"/dev/stdout\",\n                                        \"logFormat\": {\n                                            \"textFormat\": \"[%START_TIME%] \\\"%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\\\" %RESPONSE_CODE% %RESPONSE_FLAGS% %RESPONSE_CODE_DETAILS% %CONNECTION_TERMINATION_DETAILS% \\\"%UPSTREAM_TRANSPORT_FAILURE_REASON%\\\" %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \\\"%REQ(X-FORWARDED-FOR)%\\\" \\\"%REQ(USER-AGENT)%\\\" \\\"%REQ(X-REQUEST-ID)%\\\" \\\"%REQ(:AUTHORITY)%\\\" \\\"%UPSTREAM_HOST%\\\" %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\\n\"\n                                        }\n                                    }\n```\n\nserviceentry namespace \n\n### \n\n1. sidecar crd\n\n\nserviceentry namespace sidecardemo1\nsidecar istio-system\n```yaml\napiVersion: networking.istio.io/v1beta1\nkind: Sidecar\nmetadata:\n  name: default\n  namespace: demo1\nspec:\n  egress:\n  - hosts:\n    - \"./*\"\n    - \"istio-system/*\"\n\n```\n\nsidecar mysql-client podlistener, 0.0.0.0 mysql-client mysql\n\n```yaml\n  ~ istioctl pc  listener mysql-client-b7db8cc46-99cx5 --port 3306\nADDRESS       PORT MATCH DESTINATION\n10.68.228.107 3306 ALL   Cluster: outbound|3306||mysql-server.demo1.svc.cluster.local\n10.68.66.97   3306 ALL   Cluster: outbound|3306||mysql-client.demo1.svc.cluster.local\n\n  ~ kubectl exec -it mysql-client-b7db8cc46-99cx5 telnet 10.10.13.110 3306\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.\nDefaulted container \"mysql\" out of: mysql, istio-proxy, istio-init (init)\nConnected to 10.10.13.110\nJ\nB5>I=6s=E6,&M}Qcaching_sha2_password\n\n!#08S01Got packets out of orderConnection closed by foreign host\ncommand terminated with exit code 1\n```\n\n\n2. \n\nsemysqlport 0.0.0.0 3306 \n\n\n3. dns\n\nistioistio dns,istio1.8.\n\nistioiop\n\n```yaml\n  meshConfig:\n    accessLogFile: /dev/stdout\n    defaultConfig:\n      proxyMetadata:\n        ISTIO_META_DNS_CAPTURE: \"true\"\n```\n\nseaddress  mysql.demo122 hostip\n\n```yaml\n- apiVersion: networking.istio.io/v1beta1\n  kind: ServiceEntry\n  metadata:\n    name: mysql\n    namespace: demo\n  spec:\n    addresses:\n    - 240.0.221.130\n    hosts:\n    - mysql.demo122\n    location: MESH_INTERNAL\n    ports:\n    - name: tcp\n      number: 3306\n      protocol: TCP\n      targetPort: 3306\n    resolution: STATIC\n```\n\nserviceentry mysql-clienthost`240.0.221.130`ip\n\n```bash\n  ~ kubectl exec -it mysql-client-b7db8cc46-99cx5 ping mysql.demo122\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.\nDefaulted container \"mysql\" out of: mysql, istio-proxy, istio-init (init)\nPING mysql.demo122 (240.0.221.130) 56(84) bytes of data.\n```\n\nmysql-client-b7db8cc46-99cx50.0.0.0  `240.0.221.130 3306 ALL   Cluster: outbound|3306||mysql.demo122`mysql0.0.0.0\n\n```yaml\n  ~ istioctl pc  listener mysql-client-b7db8cc46-99cx5 --port 3306\nADDRESS       PORT MATCH DESTINATION\n10.68.228.107 3306 ALL   Cluster: outbound|3306||mysql-server.demo1.svc.cluster.local\n10.68.66.97   3306 ALL   Cluster: outbound|3306||mysql-client.demo1.svc.cluster.local\n240.0.221.130 3306 ALL   Cluster: outbound|3306||mysql.demo122\n```\n\n\n## \n\n, \n\n1. namespace sidecar, envoy, \n2. serivceentry\n","slug":"k8s/istio/istio-network","published":1,"updated":"2021-09-12T16:10:12.847Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckthfc0dp002esmjr8ujf5j7w","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>, mysql, redis, k8s1.11 istio 1.4,<br>istiok8s  istio1.6 </p>\n<h2 id=\"mysql\"><a href=\"#mysql\" class=\"headerlink\" title=\"mysql\"></a>mysql</h2><p>, mysqlclient server </p>\n<p>mysql-client -&gt; mysql-server</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl apply -f - &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">apiVersion: apps/v1</span></span><br><span class=\"line\"><span class=\"string\">kind: Deployment</span></span><br><span class=\"line\"><span class=\"string\">metadata:</span></span><br><span class=\"line\"><span class=\"string\">  generation: 2</span></span><br><span class=\"line\"><span class=\"string\">  labels:</span></span><br><span class=\"line\"><span class=\"string\">    app: mysql-server</span></span><br><span class=\"line\"><span class=\"string\">  name: mysql-server</span></span><br><span class=\"line\"><span class=\"string\">  namespace: demo1</span></span><br><span class=\"line\"><span class=\"string\">spec:</span></span><br><span class=\"line\"><span class=\"string\">  progressDeadlineSeconds: 600</span></span><br><span class=\"line\"><span class=\"string\">  replicas: 1</span></span><br><span class=\"line\"><span class=\"string\">  revisionHistoryLimit: 10</span></span><br><span class=\"line\"><span class=\"string\">  selector:</span></span><br><span class=\"line\"><span class=\"string\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"string\">      app: mysql-server</span></span><br><span class=\"line\"><span class=\"string\">  strategy:</span></span><br><span class=\"line\"><span class=\"string\">    rollingUpdate:</span></span><br><span class=\"line\"><span class=\"string\">      maxSurge: 25%</span></span><br><span class=\"line\"><span class=\"string\">      maxUnavailable: 25%</span></span><br><span class=\"line\"><span class=\"string\">    type: RollingUpdate</span></span><br><span class=\"line\"><span class=\"string\">  template:</span></span><br><span class=\"line\"><span class=\"string\">    metadata:</span></span><br><span class=\"line\"><span class=\"string\">      creationTimestamp: null</span></span><br><span class=\"line\"><span class=\"string\">      labels:</span></span><br><span class=\"line\"><span class=\"string\">        app: mysql-server</span></span><br><span class=\"line\"><span class=\"string\">    spec:</span></span><br><span class=\"line\"><span class=\"string\">      containers:</span></span><br><span class=\"line\"><span class=\"string\">        - env:</span></span><br><span class=\"line\"><span class=\"string\">            - name: MYSQL_ROOT_PASSWORD</span></span><br><span class=\"line\"><span class=\"string\">              value: password</span></span><br><span class=\"line\"><span class=\"string\">          image: mysql</span></span><br><span class=\"line\"><span class=\"string\">          imagePullPolicy: Always</span></span><br><span class=\"line\"><span class=\"string\">          name: mysql</span></span><br><span class=\"line\"><span class=\"string\">          ports:</span></span><br><span class=\"line\"><span class=\"string\">            - containerPort: 3306</span></span><br><span class=\"line\"><span class=\"string\">              protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">          resources: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">          terminationMessagePath: /dev/termination-log</span></span><br><span class=\"line\"><span class=\"string\">          terminationMessagePolicy: File</span></span><br><span class=\"line\"><span class=\"string\">      dnsPolicy: ClusterFirst</span></span><br><span class=\"line\"><span class=\"string\">      restartPolicy: Always</span></span><br><span class=\"line\"><span class=\"string\">      schedulerName: default-scheduler</span></span><br><span class=\"line\"><span class=\"string\">      securityContext: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">      terminationGracePeriodSeconds: 30</span></span><br><span class=\"line\"><span class=\"string\">---</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">apiVersion: v1</span></span><br><span class=\"line\"><span class=\"string\">kind: Service</span></span><br><span class=\"line\"><span class=\"string\">metadata:</span></span><br><span class=\"line\"><span class=\"string\">  labels:</span></span><br><span class=\"line\"><span class=\"string\">    app: mysql-server</span></span><br><span class=\"line\"><span class=\"string\">  name: mysql-server</span></span><br><span class=\"line\"><span class=\"string\">  namespace: demo1</span></span><br><span class=\"line\"><span class=\"string\">spec:</span></span><br><span class=\"line\"><span class=\"string\">  clusterIP: 10.68.228.107</span></span><br><span class=\"line\"><span class=\"string\">  externalTrafficPolicy: Cluster</span></span><br><span class=\"line\"><span class=\"string\">  ports:</span></span><br><span class=\"line\"><span class=\"string\">    - name: 3306-3306</span></span><br><span class=\"line\"><span class=\"string\">      nodePort: 32011</span></span><br><span class=\"line\"><span class=\"string\">      port: 3306</span></span><br><span class=\"line\"><span class=\"string\">      protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">      targetPort: 3306</span></span><br><span class=\"line\"><span class=\"string\">  selector:</span></span><br><span class=\"line\"><span class=\"string\">    app: mysql-server</span></span><br><span class=\"line\"><span class=\"string\">  sessionAffinity: None</span></span><br><span class=\"line\"><span class=\"string\">  type: NodePort</span></span><br><span class=\"line\"><span class=\"string\">EOF</span>  </span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl apply -f - &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">apiVersion: apps/v1</span></span><br><span class=\"line\"><span class=\"string\">kind: Deployment</span></span><br><span class=\"line\"><span class=\"string\">metadata:</span></span><br><span class=\"line\"><span class=\"string\">  generation: 2</span></span><br><span class=\"line\"><span class=\"string\">  labels:</span></span><br><span class=\"line\"><span class=\"string\">    app: mysql-client</span></span><br><span class=\"line\"><span class=\"string\">  name: mysql-client</span></span><br><span class=\"line\"><span class=\"string\">  namespace: demo1</span></span><br><span class=\"line\"><span class=\"string\">spec:</span></span><br><span class=\"line\"><span class=\"string\">  progressDeadlineSeconds: 600</span></span><br><span class=\"line\"><span class=\"string\">  replicas: 1</span></span><br><span class=\"line\"><span class=\"string\">  revisionHistoryLimit: 10</span></span><br><span class=\"line\"><span class=\"string\">  selector:</span></span><br><span class=\"line\"><span class=\"string\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"string\">      app: mysql-client</span></span><br><span class=\"line\"><span class=\"string\">  strategy:</span></span><br><span class=\"line\"><span class=\"string\">    rollingUpdate:</span></span><br><span class=\"line\"><span class=\"string\">      maxSurge: 25%</span></span><br><span class=\"line\"><span class=\"string\">      maxUnavailable: 25%</span></span><br><span class=\"line\"><span class=\"string\">    type: RollingUpdate</span></span><br><span class=\"line\"><span class=\"string\">  template:</span></span><br><span class=\"line\"><span class=\"string\">    metadata:</span></span><br><span class=\"line\"><span class=\"string\">      creationTimestamp: null</span></span><br><span class=\"line\"><span class=\"string\">      labels:</span></span><br><span class=\"line\"><span class=\"string\">        app: mysql-client</span></span><br><span class=\"line\"><span class=\"string\">    spec:</span></span><br><span class=\"line\"><span class=\"string\">      containers:</span></span><br><span class=\"line\"><span class=\"string\">        - image: clarechu/mysql-client:v1</span></span><br><span class=\"line\"><span class=\"string\">          imagePullPolicy: Always</span></span><br><span class=\"line\"><span class=\"string\">          name: mysql</span></span><br><span class=\"line\"><span class=\"string\">          resources: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">          terminationMessagePath: /dev/termination-log</span></span><br><span class=\"line\"><span class=\"string\">          terminationMessagePolicy: File</span></span><br><span class=\"line\"><span class=\"string\">      dnsPolicy: ClusterFirst</span></span><br><span class=\"line\"><span class=\"string\">      restartPolicy: Always</span></span><br><span class=\"line\"><span class=\"string\">      schedulerName: default-scheduler</span></span><br><span class=\"line\"><span class=\"string\">      securityContext: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">      terminationGracePeriodSeconds: 30</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>podsidecar</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ kubectl get po</span><br><span class=\"line\"> </span><br><span class=\"line\">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">mysql-client-b7db8cc46-99cx5    2/2     Running   0          81s</span><br><span class=\"line\">mysql-server-6c845f449b-525q6   2/2     Running   0          81s</span><br></pre></td></tr></table></figure>\n\n<p>sidecar  clientserver mysql, mysql-server  nsmysql-server</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ kubectl <span class=\"built_in\">exec</span> -it mysql-client-b7db8cc46-99cx5 telnet mysql-server 3306</span><br><span class=\"line\">kubectl <span class=\"built_in\">exec</span> [POD] [COMMAND] is DEPRECATED and will be removed <span class=\"keyword\">in</span> a future version. Use kubectl <span class=\"built_in\">exec</span> [POD] -- [COMMAND] instead.</span><br><span class=\"line\">Defaulted container <span class=\"string\">&quot;mysql&quot;</span> out of: mysql, istio-proxy, istio-init (init)</span><br><span class=\"line\">Connected to mysql-server</span><br><span class=\"line\">J</span><br><span class=\"line\">8.0.26\t*F?eZTM\\~h<span class=\"comment\">#DD#2)caching_sha2_password</span></span><br></pre></td></tr></table></figure>\n\n<p>mysql-client pod listener(), 3306 <code>mysql-server.demo1.svc.cluster.local</code>, cluster</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ~ istioctl  pc listener mysql-client-b7db8cc46-99cx5 --port 3306</span><br><span class=\"line\">ADDRESS       PORT MATCH DESTINATION</span><br><span class=\"line\">10.68.228.107 3306 ALL   Cluster: outbound|3306||mysql-server.demo1.svc.cluster.local</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> , 3306cluster <code>outbound|3306||mysql-server.demo1.svc.cluster.local</code></p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;envoy.filters.network.tcp_proxy&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">&quot;typedConfig&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">&quot;@type&quot;</span>: <span class=\"string\">&quot;type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;statPrefix&quot;</span>: <span class=\"string\">&quot;outbound|3306||mysql-server.demo1.svc.cluster.local&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;cluster&quot;</span>: <span class=\"string\">&quot;outbound|3306||mysql-server.demo1.svc.cluster.local&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;accessLog&quot;</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;envoy.access_loggers.file&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;typedConfig&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">&quot;@type&quot;</span>: <span class=\"string\">&quot;type.googleapis.com/envoy.extensions.access_loggers.file.v3.FileAccessLog&quot;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/dev/stdout&quot;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">&quot;logFormat&quot;</span>: &#123;</span><br><span class=\"line\">                        <span class=\"attr\">&quot;textFormat&quot;</span>: <span class=\"string\">&quot;[%START_TIME%] \\&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% %RESPONSE_CODE_DETAILS% %CONNECTION_TERMINATION_DETAILS% \\&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \\&quot;%REQ(X-FORWARDED-FOR)%\\&quot; \\&quot;%REQ(USER-AGENT)%\\&quot; \\&quot;%REQ(X-REQUEST-ID)%\\&quot; \\&quot;%REQ(:AUTHORITY)%\\&quot; \\&quot;%UPSTREAM_HOST%\\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\\n&quot;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p>podcluster</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ stioctl pc cluster mysql-client-b7db8cc46-99cx5 --fqdn <span class=\"string\">&quot;outbound|3306||mysql-server.demo1.svc.cluster.local&quot;</span> -o json</span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;transportSocketMatches&quot;</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;tlsMode-istio&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;match&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;tlsMode&quot;</span>: <span class=\"string\">&quot;istio&quot;</span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;transportSocket&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;envoy.transport_sockets.tls&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;typedConfig&quot;</span>: &#123;</span><br><span class=\"line\">                        <span class=\"string\">&quot;@type&quot;</span>: <span class=\"string\">&quot;type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.UpstreamTlsContext&quot;</span>,</span><br><span class=\"line\">                        <span class=\"string\">&quot;commonTlsContext&quot;</span>: &#123;</span><br><span class=\"line\">                            <span class=\"string\">&quot;tlsCertificateSdsSecretConfigs&quot;</span>: [</span><br><span class=\"line\">                                &#123;</span><br><span class=\"line\">                                    <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;default&quot;</span>,</span><br><span class=\"line\">                                    <span class=\"string\">&quot;sdsConfig&quot;</span>: &#123;</span><br><span class=\"line\">                                        <span class=\"string\">&quot;apiConfigSource&quot;</span>: &#123;</span><br><span class=\"line\">                                            <span class=\"string\">&quot;apiType&quot;</span>: <span class=\"string\">&quot;GRPC&quot;</span>,</span><br><span class=\"line\">                                            <span class=\"string\">&quot;transportApiVersion&quot;</span>: <span class=\"string\">&quot;V3&quot;</span>,</span><br><span class=\"line\">                                            <span class=\"string\">&quot;grpcServices&quot;</span>: [</span><br><span class=\"line\">                                                &#123;</span><br><span class=\"line\">                                                    <span class=\"string\">&quot;envoyGrpc&quot;</span>: &#123;</span><br><span class=\"line\">                                                        <span class=\"string\">&quot;clusterName&quot;</span>: <span class=\"string\">&quot;sds-grpc&quot;</span></span><br><span class=\"line\">                                                    &#125;</span><br><span class=\"line\">                                                &#125;</span><br><span class=\"line\">                                            ],</span><br><span class=\"line\">                                            <span class=\"string\">&quot;setNodeOnFirstMessageOnly&quot;</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">                                        &#125;,</span><br><span class=\"line\">                                        <span class=\"string\">&quot;initialFetchTimeout&quot;</span>: <span class=\"string\">&quot;0s&quot;</span>,</span><br><span class=\"line\">                                        <span class=\"string\">&quot;resourceApiVersion&quot;</span>: <span class=\"string\">&quot;V3&quot;</span></span><br><span class=\"line\">                                    &#125;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            ],</span><br><span class=\"line\">                            <span class=\"string\">&quot;combinedValidationContext&quot;</span>: &#123;</span><br><span class=\"line\">                                <span class=\"string\">&quot;defaultValidationContext&quot;</span>: &#123;</span><br><span class=\"line\">                                    <span class=\"string\">&quot;matchSubjectAltNames&quot;</span>: [</span><br><span class=\"line\">                                        &#123;</span><br><span class=\"line\">                                            <span class=\"string\">&quot;exact&quot;</span>: <span class=\"string\">&quot;spiffe://cluster.local/ns/demo1/sa/default&quot;</span></span><br><span class=\"line\">                                        &#125;</span><br><span class=\"line\">                                    ]</span><br><span class=\"line\">                                &#125;,</span><br><span class=\"line\">                                <span class=\"string\">&quot;validationContextSdsSecretConfig&quot;</span>: &#123;</span><br><span class=\"line\">                                    <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;ROOTCA&quot;</span>,</span><br><span class=\"line\">                                    <span class=\"string\">&quot;sdsConfig&quot;</span>: &#123;</span><br><span class=\"line\">                                        <span class=\"string\">&quot;apiConfigSource&quot;</span>: &#123;</span><br><span class=\"line\">                                            <span class=\"string\">&quot;apiType&quot;</span>: <span class=\"string\">&quot;GRPC&quot;</span>,</span><br><span class=\"line\">                                            <span class=\"string\">&quot;transportApiVersion&quot;</span>: <span class=\"string\">&quot;V3&quot;</span>,</span><br><span class=\"line\">                                            <span class=\"string\">&quot;grpcServices&quot;</span>: [</span><br><span class=\"line\">                                                &#123;</span><br><span class=\"line\">                                                    <span class=\"string\">&quot;envoyGrpc&quot;</span>: &#123;</span><br><span class=\"line\">                                                        <span class=\"string\">&quot;clusterName&quot;</span>: <span class=\"string\">&quot;sds-grpc&quot;</span></span><br><span class=\"line\">                                                    &#125;</span><br><span class=\"line\">                                                &#125;</span><br><span class=\"line\">                                            ],</span><br><span class=\"line\">                                            <span class=\"string\">&quot;setNodeOnFirstMessageOnly&quot;</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">                                        &#125;,</span><br><span class=\"line\">                                        <span class=\"string\">&quot;initialFetchTimeout&quot;</span>: <span class=\"string\">&quot;0s&quot;</span>,</span><br><span class=\"line\">                                        <span class=\"string\">&quot;resourceApiVersion&quot;</span>: <span class=\"string\">&quot;V3&quot;</span></span><br><span class=\"line\">                                    &#125;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;,</span><br><span class=\"line\">                            <span class=\"string\">&quot;alpnProtocols&quot;</span>: [</span><br><span class=\"line\">                                <span class=\"string\">&quot;istio-peer-exchange&quot;</span>,</span><br><span class=\"line\">                                <span class=\"string\">&quot;istio&quot;</span></span><br><span class=\"line\">                            ]</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        <span class=\"string\">&quot;sni&quot;</span>: <span class=\"string\">&quot;outbound_.3306_._.mysql-server.demo1.svc.cluster.local&quot;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;tlsMode-disabled&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;match&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;transportSocket&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;envoy.transport_sockets.raw_buffer&quot;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;outbound|3306||mysql-server.demo1.svc.cluster.local&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;EDS&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;edsClusterConfig&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;edsConfig&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;ads&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;resourceApiVersion&quot;</span>: <span class=\"string\">&quot;V3&quot;</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"string\">&quot;serviceName&quot;</span>: <span class=\"string\">&quot;outbound|3306||mysql-server.demo1.svc.cluster.local&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;connectTimeout&quot;</span>: <span class=\"string\">&quot;10s&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;circuitBreakers&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;thresholds&quot;</span>: [</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;maxConnections&quot;</span>: 4294967295,</span><br><span class=\"line\">                    <span class=\"string\">&quot;maxPendingRequests&quot;</span>: 4294967295,</span><br><span class=\"line\">                    <span class=\"string\">&quot;maxRequests&quot;</span>: 4294967295,</span><br><span class=\"line\">                    <span class=\"string\">&quot;maxRetries&quot;</span>: 4294967295</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;metadata&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;filterMetadata&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;istio&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;default_original_port&quot;</span>: 3306,</span><br><span class=\"line\">                    <span class=\"string\">&quot;services&quot;</span>: [</span><br><span class=\"line\">                        &#123;</span><br><span class=\"line\">                            <span class=\"string\">&quot;host&quot;</span>: <span class=\"string\">&quot;mysql-server.demo1.svc.cluster.local&quot;</span>,</span><br><span class=\"line\">                            <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;mysql-server&quot;</span>,</span><br><span class=\"line\">                            <span class=\"string\">&quot;namespace&quot;</span>: <span class=\"string\">&quot;demo1&quot;</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    ]</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;filters&quot;</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;istio.metadata_exchange&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;typedConfig&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;@type&quot;</span>: <span class=\"string\">&quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;typeUrl&quot;</span>: <span class=\"string\">&quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;value&quot;</span>: &#123;</span><br><span class=\"line\">                        <span class=\"string\">&quot;protocol&quot;</span>: <span class=\"string\">&quot;istio-peer-exchange&quot;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>cluster</p>\n<p>EDSdestination pod, Envoy  <code>outbound|3306||mysql-server.demo1.svc.cluster.local</code></p>\n<p>envoy endpoint <code>outbound|3306||mysql-server.demo1.svc.cluster.local</code> ,  mysql-server pod ip<br>&gt; <code>172.20.0.30</code> </p>\n<p> epsvc <code>endpoint</code><br><img src=\"/2021/08/24/k8s/istio/istio-network/img_2.png\" alt=\"img2.png\"></p>\n<p>, sidecark8s svcpod ip</p>\n<p><img src=\"/2021/08/24/k8s/istio/istio-network/img_1.png\" alt=\"img1.png\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ~  istioctl pc ep mysql-client-b7db8cc46-99cx5 --port 3306</span><br><span class=\"line\">ENDPOINT             STATUS      OUTLIER CHECK     CLUSTER</span><br><span class=\"line\">172.20.0.30:3306     HEALTHY     OK                outbound|3306||mysql-server.demo1.svc.cluster.local</span><br><span class=\"line\"></span><br><span class=\"line\">  ~ k get po -o wide</span><br><span class=\"line\">NAME                            READY   STATUS    RESTARTS   AGE   IP            NODE           NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">mysql-client-b7db8cc46-99cx5    2/2     Running   0          33m   172.20.0.31   10.10.13.118   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">mysql-server-6c845f449b-525q6   2/2     Running   0          33m   172.20.0.30   10.10.13.118   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"mysql\"><a href=\"#mysql\" class=\"headerlink\" title=\"mysql\"></a>mysql</h2><p>,mysql pod(mysql-client-b7db8cc46-99cx5)mysql, mysql-server,  listener</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ~ kubectl <span class=\"built_in\">exec</span> -it mysql-client-b7db8cc46-99cx5 telnet 10.10.13.110 3306</span><br><span class=\"line\">kubectl <span class=\"built_in\">exec</span> [POD] [COMMAND] is DEPRECATED and will be removed <span class=\"keyword\">in</span> a future version. Use kubectl <span class=\"built_in\">exec</span> [POD] -- [COMMAND] instead.</span><br><span class=\"line\">Defaulted container <span class=\"string\">&quot;mysql&quot;</span> out of: mysql, istio-proxy, istio-init (init)</span><br><span class=\"line\">Connected to 10.10.13.110</span><br><span class=\"line\">J</span><br><span class=\"line\">8.0.26\\r(Juh5kguvqI2<span class=\"string\">&quot;&#125;!caching_sha2_password</span></span><br></pre></td></tr></table></figure>\n\n<p>serviceentry, , </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ~ kubectl <span class=\"built_in\">exec</span> -it mysql-client-b7db8cc46-99cx5 telnet 10.10.13.110 3306</span><br><span class=\"line\">kubectl <span class=\"built_in\">exec</span> [POD] [COMMAND] is DEPRECATED and will be removed <span class=\"keyword\">in</span> a future version. Use kubectl <span class=\"built_in\">exec</span> [POD] -- [COMMAND] instead.</span><br><span class=\"line\">Defaulted container <span class=\"string\">&quot;mysql&quot;</span> out of: mysql, istio-proxy, istio-init (init)</span><br><span class=\"line\">Connected to 10.10.13.110</span><br><span class=\"line\">Connection closed by foreign host</span><br><span class=\"line\"><span class=\"built_in\">command</span> terminated with <span class=\"built_in\">exit</span> code 1</span><br></pre></td></tr></table></figure>\n\n<p>client listener, <code>0.0.0.0</code> , nsse,<br><code>0.0.0.0</code>listener</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ~ istioctl pc listener mysql-client-b7db8cc46-99cx5 --port 3306</span><br><span class=\"line\">ADDRESS       PORT MATCH DESTINATION</span><br><span class=\"line\">0.0.0.0       3306 ALL   Cluster: outbound|3306||mysql.demo</span><br><span class=\"line\">10.68.228.107 3306 ALL   Cluster: outbound|3306||mysql-server.demo1.svc.cluster.local</span><br></pre></td></tr></table></figure>\n\n<p>cluster, <code>outbound|3306||mysql.demo</code>, svc, svc</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ~ istioctl pc listener mysql-client-b7db8cc46-99cx5 --port 3306 -o json</span><br><span class=\"line\">        </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">                        <span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;envoy.filters.network.tcp_proxy&quot;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">&quot;typedConfig&quot;</span>: &#123;</span><br><span class=\"line\">                            <span class=\"attr\">&quot;@type&quot;</span>: <span class=\"string\">&quot;type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy&quot;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">&quot;statPrefix&quot;</span>: <span class=\"string\">&quot;outbound|3306||mysql.demo&quot;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">&quot;cluster&quot;</span>: <span class=\"string\">&quot;outbound|3306||mysql.demo&quot;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">&quot;accessLog&quot;</span>: [</span><br><span class=\"line\">                                &#123;</span><br><span class=\"line\">                                    <span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;envoy.access_loggers.file&quot;</span>,</span><br><span class=\"line\">                                    <span class=\"attr\">&quot;typedConfig&quot;</span>: &#123;</span><br><span class=\"line\">                                        <span class=\"attr\">&quot;@type&quot;</span>: <span class=\"string\">&quot;type.googleapis.com/envoy.extensions.access_loggers.file.v3.FileAccessLog&quot;</span>,</span><br><span class=\"line\">                                        <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/dev/stdout&quot;</span>,</span><br><span class=\"line\">                                        <span class=\"attr\">&quot;logFormat&quot;</span>: &#123;</span><br><span class=\"line\">                                            <span class=\"attr\">&quot;textFormat&quot;</span>: <span class=\"string\">&quot;[%START_TIME%] \\&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% %RESPONSE_CODE_DETAILS% %CONNECTION_TERMINATION_DETAILS% \\&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \\&quot;%REQ(X-FORWARDED-FOR)%\\&quot; \\&quot;%REQ(USER-AGENT)%\\&quot; \\&quot;%REQ(X-REQUEST-ID)%\\&quot; \\&quot;%REQ(:AUTHORITY)%\\&quot; \\&quot;%UPSTREAM_HOST%\\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\\n&quot;</span></span><br><span class=\"line\">                                        &#125;</span><br><span class=\"line\">                                    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>serviceentry namespace </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>sidecar crd</li>\n</ol>\n<p>serviceentry namespace sidecardemo1<br>sidecar istio-system</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.istio.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Sidecar</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">default</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">demo1</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">egress:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">hosts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">&quot;./*&quot;</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">&quot;istio-system/*&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>sidecar mysql-client podlistener, 0.0.0.0 mysql-client mysql</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\"></span>  <span class=\"string\">~</span> <span class=\"string\">istioctl</span> <span class=\"string\">pc</span>  <span class=\"string\">listener</span> <span class=\"string\">mysql-client-b7db8cc46-99cx5</span> <span class=\"string\">--port</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"string\">ADDRESS</span>       <span class=\"string\">PORT</span> <span class=\"string\">MATCH</span> <span class=\"string\">DESTINATION</span></span><br><span class=\"line\"><span class=\"attr\">10.68.228.107 3306 ALL   Cluster:</span> <span class=\"string\">outbound|3306||mysql-server.demo1.svc.cluster.local</span></span><br><span class=\"line\"><span class=\"attr\">10.68.66.97   3306 ALL   Cluster:</span> <span class=\"string\">outbound|3306||mysql-client.demo1.svc.cluster.local</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\"></span>  <span class=\"string\">~</span> <span class=\"string\">kubectl</span> <span class=\"string\">exec</span> <span class=\"string\">-it</span> <span class=\"string\">mysql-client-b7db8cc46-99cx5</span> <span class=\"string\">telnet</span> <span class=\"number\">10.10</span><span class=\"number\">.13</span><span class=\"number\">.110</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">exec</span> [<span class=\"string\">POD</span>] [<span class=\"string\">COMMAND</span>] <span class=\"string\">is</span> <span class=\"string\">DEPRECATED</span> <span class=\"string\">and</span> <span class=\"string\">will</span> <span class=\"string\">be</span> <span class=\"string\">removed</span> <span class=\"string\">in</span> <span class=\"string\">a</span> <span class=\"string\">future</span> <span class=\"string\">version.</span> <span class=\"string\">Use</span> <span class=\"string\">kubectl</span> <span class=\"string\">exec</span> [<span class=\"string\">POD</span>] <span class=\"string\">--</span> [<span class=\"string\">COMMAND</span>] <span class=\"string\">instead.</span></span><br><span class=\"line\"><span class=\"string\">Defaulted</span> <span class=\"string\">container</span> <span class=\"string\">&quot;mysql&quot;</span> <span class=\"attr\">out of:</span> <span class=\"string\">mysql,</span> <span class=\"string\">istio-proxy,</span> <span class=\"string\">istio-init</span> <span class=\"string\">(init)</span></span><br><span class=\"line\"><span class=\"string\">Connected</span> <span class=\"string\">to</span> <span class=\"number\">10.10</span><span class=\"number\">.13</span><span class=\"number\">.110</span></span><br><span class=\"line\"><span class=\"string\">J</span></span><br><span class=\"line\"><span class=\"string\">B5&gt;I=6s=E6,&amp;M&#125;Qcaching_sha2_password</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">!#08S01Got</span> <span class=\"string\">packets</span> <span class=\"string\">out</span> <span class=\"string\">of</span> <span class=\"string\">orderConnection</span> <span class=\"string\">closed</span> <span class=\"string\">by</span> <span class=\"string\">foreign</span> <span class=\"string\">host</span></span><br><span class=\"line\"><span class=\"string\">command</span> <span class=\"string\">terminated</span> <span class=\"string\">with</span> <span class=\"string\">exit</span> <span class=\"string\">code</span> <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>semysqlport 0.0.0.0 3306 </p>\n<ol start=\"3\">\n<li>dns</li>\n</ol>\n<p>istioistio dns,istio1.8.</p>\n<p>istioiop</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">meshConfig:</span></span><br><span class=\"line\">  <span class=\"attr\">accessLogFile:</span> <span class=\"string\">/dev/stdout</span></span><br><span class=\"line\">  <span class=\"attr\">defaultConfig:</span></span><br><span class=\"line\">    <span class=\"attr\">proxyMetadata:</span></span><br><span class=\"line\">      <span class=\"attr\">ISTIO_META_DNS_CAPTURE:</span> <span class=\"string\">&quot;true&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>seaddress  mysql.demo122 hostip</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.istio.io/v1beta1</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ServiceEntry</span></span><br><span class=\"line\">  <span class=\"attr\">metadata:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">mysql</span></span><br><span class=\"line\">    <span class=\"attr\">namespace:</span> <span class=\"string\">demo</span></span><br><span class=\"line\">  <span class=\"attr\">spec:</span></span><br><span class=\"line\">    <span class=\"attr\">addresses:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"number\">240.0</span><span class=\"number\">.221</span><span class=\"number\">.130</span></span><br><span class=\"line\">    <span class=\"attr\">hosts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">mysql.demo122</span></span><br><span class=\"line\">    <span class=\"attr\">location:</span> <span class=\"string\">MESH_INTERNAL</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">tcp</span></span><br><span class=\"line\">      <span class=\"attr\">number:</span> <span class=\"number\">3306</span></span><br><span class=\"line\">      <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">      <span class=\"attr\">targetPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\">    <span class=\"attr\">resolution:</span> <span class=\"string\">STATIC</span></span><br></pre></td></tr></table></figure>\n\n<p>serviceentry mysql-clienthost<code>240.0.221.130</code>ip</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ~ kubectl <span class=\"built_in\">exec</span> -it mysql-client-b7db8cc46-99cx5 ping mysql.demo122</span><br><span class=\"line\">kubectl <span class=\"built_in\">exec</span> [POD] [COMMAND] is DEPRECATED and will be removed <span class=\"keyword\">in</span> a future version. Use kubectl <span class=\"built_in\">exec</span> [POD] -- [COMMAND] instead.</span><br><span class=\"line\">Defaulted container <span class=\"string\">&quot;mysql&quot;</span> out of: mysql, istio-proxy, istio-init (init)</span><br><span class=\"line\">PING mysql.demo122 (240.0.221.130) 56(84) bytes of data.</span><br></pre></td></tr></table></figure>\n\n<p>mysql-client-b7db8cc46-99cx50.0.0.0  <code>240.0.221.130 3306 ALL   Cluster: outbound|3306||mysql.demo122</code>mysql0.0.0.0</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\"></span>  <span class=\"string\">~</span> <span class=\"string\">istioctl</span> <span class=\"string\">pc</span>  <span class=\"string\">listener</span> <span class=\"string\">mysql-client-b7db8cc46-99cx5</span> <span class=\"string\">--port</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"string\">ADDRESS</span>       <span class=\"string\">PORT</span> <span class=\"string\">MATCH</span> <span class=\"string\">DESTINATION</span></span><br><span class=\"line\"><span class=\"attr\">10.68.228.107 3306 ALL   Cluster:</span> <span class=\"string\">outbound|3306||mysql-server.demo1.svc.cluster.local</span></span><br><span class=\"line\"><span class=\"attr\">10.68.66.97   3306 ALL   Cluster:</span> <span class=\"string\">outbound|3306||mysql-client.demo1.svc.cluster.local</span></span><br><span class=\"line\"><span class=\"attr\">240.0.221.130 3306 ALL   Cluster:</span> <span class=\"string\">outbound|3306||mysql.demo122</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>, </p>\n<ol>\n<li>namespace sidecar, envoy, </li>\n<li>serivceentry</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>, mysql, redis, k8s1.11 istio 1.4,<br>istiok8s  istio1.6 </p>\n<h2 id=\"mysql\"><a href=\"#mysql\" class=\"headerlink\" title=\"mysql\"></a>mysql</h2><p>, mysqlclient server </p>\n<p>mysql-client -&gt; mysql-server</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ kubectl apply -f - &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">apiVersion: apps/v1</span></span><br><span class=\"line\"><span class=\"string\">kind: Deployment</span></span><br><span class=\"line\"><span class=\"string\">metadata:</span></span><br><span class=\"line\"><span class=\"string\">  generation: 2</span></span><br><span class=\"line\"><span class=\"string\">  labels:</span></span><br><span class=\"line\"><span class=\"string\">    app: mysql-server</span></span><br><span class=\"line\"><span class=\"string\">  name: mysql-server</span></span><br><span class=\"line\"><span class=\"string\">  namespace: demo1</span></span><br><span class=\"line\"><span class=\"string\">spec:</span></span><br><span class=\"line\"><span class=\"string\">  progressDeadlineSeconds: 600</span></span><br><span class=\"line\"><span class=\"string\">  replicas: 1</span></span><br><span class=\"line\"><span class=\"string\">  revisionHistoryLimit: 10</span></span><br><span class=\"line\"><span class=\"string\">  selector:</span></span><br><span class=\"line\"><span class=\"string\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"string\">      app: mysql-server</span></span><br><span class=\"line\"><span class=\"string\">  strategy:</span></span><br><span class=\"line\"><span class=\"string\">    rollingUpdate:</span></span><br><span class=\"line\"><span class=\"string\">      maxSurge: 25%</span></span><br><span class=\"line\"><span class=\"string\">      maxUnavailable: 25%</span></span><br><span class=\"line\"><span class=\"string\">    type: RollingUpdate</span></span><br><span class=\"line\"><span class=\"string\">  template:</span></span><br><span class=\"line\"><span class=\"string\">    metadata:</span></span><br><span class=\"line\"><span class=\"string\">      creationTimestamp: null</span></span><br><span class=\"line\"><span class=\"string\">      labels:</span></span><br><span class=\"line\"><span class=\"string\">        app: mysql-server</span></span><br><span class=\"line\"><span class=\"string\">    spec:</span></span><br><span class=\"line\"><span class=\"string\">      containers:</span></span><br><span class=\"line\"><span class=\"string\">        - env:</span></span><br><span class=\"line\"><span class=\"string\">            - name: MYSQL_ROOT_PASSWORD</span></span><br><span class=\"line\"><span class=\"string\">              value: password</span></span><br><span class=\"line\"><span class=\"string\">          image: mysql</span></span><br><span class=\"line\"><span class=\"string\">          imagePullPolicy: Always</span></span><br><span class=\"line\"><span class=\"string\">          name: mysql</span></span><br><span class=\"line\"><span class=\"string\">          ports:</span></span><br><span class=\"line\"><span class=\"string\">            - containerPort: 3306</span></span><br><span class=\"line\"><span class=\"string\">              protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">          resources: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">          terminationMessagePath: /dev/termination-log</span></span><br><span class=\"line\"><span class=\"string\">          terminationMessagePolicy: File</span></span><br><span class=\"line\"><span class=\"string\">      dnsPolicy: ClusterFirst</span></span><br><span class=\"line\"><span class=\"string\">      restartPolicy: Always</span></span><br><span class=\"line\"><span class=\"string\">      schedulerName: default-scheduler</span></span><br><span class=\"line\"><span class=\"string\">      securityContext: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">      terminationGracePeriodSeconds: 30</span></span><br><span class=\"line\"><span class=\"string\">---</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">apiVersion: v1</span></span><br><span class=\"line\"><span class=\"string\">kind: Service</span></span><br><span class=\"line\"><span class=\"string\">metadata:</span></span><br><span class=\"line\"><span class=\"string\">  labels:</span></span><br><span class=\"line\"><span class=\"string\">    app: mysql-server</span></span><br><span class=\"line\"><span class=\"string\">  name: mysql-server</span></span><br><span class=\"line\"><span class=\"string\">  namespace: demo1</span></span><br><span class=\"line\"><span class=\"string\">spec:</span></span><br><span class=\"line\"><span class=\"string\">  clusterIP: 10.68.228.107</span></span><br><span class=\"line\"><span class=\"string\">  externalTrafficPolicy: Cluster</span></span><br><span class=\"line\"><span class=\"string\">  ports:</span></span><br><span class=\"line\"><span class=\"string\">    - name: 3306-3306</span></span><br><span class=\"line\"><span class=\"string\">      nodePort: 32011</span></span><br><span class=\"line\"><span class=\"string\">      port: 3306</span></span><br><span class=\"line\"><span class=\"string\">      protocol: TCP</span></span><br><span class=\"line\"><span class=\"string\">      targetPort: 3306</span></span><br><span class=\"line\"><span class=\"string\">  selector:</span></span><br><span class=\"line\"><span class=\"string\">    app: mysql-server</span></span><br><span class=\"line\"><span class=\"string\">  sessionAffinity: None</span></span><br><span class=\"line\"><span class=\"string\">  type: NodePort</span></span><br><span class=\"line\"><span class=\"string\">EOF</span>  </span><br><span class=\"line\"></span><br><span class=\"line\">$ kubectl apply -f - &lt;&lt;<span class=\"string\">EOF</span></span><br><span class=\"line\"><span class=\"string\">apiVersion: apps/v1</span></span><br><span class=\"line\"><span class=\"string\">kind: Deployment</span></span><br><span class=\"line\"><span class=\"string\">metadata:</span></span><br><span class=\"line\"><span class=\"string\">  generation: 2</span></span><br><span class=\"line\"><span class=\"string\">  labels:</span></span><br><span class=\"line\"><span class=\"string\">    app: mysql-client</span></span><br><span class=\"line\"><span class=\"string\">  name: mysql-client</span></span><br><span class=\"line\"><span class=\"string\">  namespace: demo1</span></span><br><span class=\"line\"><span class=\"string\">spec:</span></span><br><span class=\"line\"><span class=\"string\">  progressDeadlineSeconds: 600</span></span><br><span class=\"line\"><span class=\"string\">  replicas: 1</span></span><br><span class=\"line\"><span class=\"string\">  revisionHistoryLimit: 10</span></span><br><span class=\"line\"><span class=\"string\">  selector:</span></span><br><span class=\"line\"><span class=\"string\">    matchLabels:</span></span><br><span class=\"line\"><span class=\"string\">      app: mysql-client</span></span><br><span class=\"line\"><span class=\"string\">  strategy:</span></span><br><span class=\"line\"><span class=\"string\">    rollingUpdate:</span></span><br><span class=\"line\"><span class=\"string\">      maxSurge: 25%</span></span><br><span class=\"line\"><span class=\"string\">      maxUnavailable: 25%</span></span><br><span class=\"line\"><span class=\"string\">    type: RollingUpdate</span></span><br><span class=\"line\"><span class=\"string\">  template:</span></span><br><span class=\"line\"><span class=\"string\">    metadata:</span></span><br><span class=\"line\"><span class=\"string\">      creationTimestamp: null</span></span><br><span class=\"line\"><span class=\"string\">      labels:</span></span><br><span class=\"line\"><span class=\"string\">        app: mysql-client</span></span><br><span class=\"line\"><span class=\"string\">    spec:</span></span><br><span class=\"line\"><span class=\"string\">      containers:</span></span><br><span class=\"line\"><span class=\"string\">        - image: clarechu/mysql-client:v1</span></span><br><span class=\"line\"><span class=\"string\">          imagePullPolicy: Always</span></span><br><span class=\"line\"><span class=\"string\">          name: mysql</span></span><br><span class=\"line\"><span class=\"string\">          resources: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">          terminationMessagePath: /dev/termination-log</span></span><br><span class=\"line\"><span class=\"string\">          terminationMessagePolicy: File</span></span><br><span class=\"line\"><span class=\"string\">      dnsPolicy: ClusterFirst</span></span><br><span class=\"line\"><span class=\"string\">      restartPolicy: Always</span></span><br><span class=\"line\"><span class=\"string\">      schedulerName: default-scheduler</span></span><br><span class=\"line\"><span class=\"string\">      securityContext: &#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">      terminationGracePeriodSeconds: 30</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>podsidecar</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ kubectl get po</span><br><span class=\"line\"> </span><br><span class=\"line\">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class=\"line\">mysql-client-b7db8cc46-99cx5    2/2     Running   0          81s</span><br><span class=\"line\">mysql-server-6c845f449b-525q6   2/2     Running   0          81s</span><br></pre></td></tr></table></figure>\n\n<p>sidecar  clientserver mysql, mysql-server  nsmysql-server</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ kubectl <span class=\"built_in\">exec</span> -it mysql-client-b7db8cc46-99cx5 telnet mysql-server 3306</span><br><span class=\"line\">kubectl <span class=\"built_in\">exec</span> [POD] [COMMAND] is DEPRECATED and will be removed <span class=\"keyword\">in</span> a future version. Use kubectl <span class=\"built_in\">exec</span> [POD] -- [COMMAND] instead.</span><br><span class=\"line\">Defaulted container <span class=\"string\">&quot;mysql&quot;</span> out of: mysql, istio-proxy, istio-init (init)</span><br><span class=\"line\">Connected to mysql-server</span><br><span class=\"line\">J</span><br><span class=\"line\">8.0.26\t*F?eZTM\\~h<span class=\"comment\">#DD#2)caching_sha2_password</span></span><br></pre></td></tr></table></figure>\n\n<p>mysql-client pod listener(), 3306 <code>mysql-server.demo1.svc.cluster.local</code>, cluster</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ~ istioctl  pc listener mysql-client-b7db8cc46-99cx5 --port 3306</span><br><span class=\"line\">ADDRESS       PORT MATCH DESTINATION</span><br><span class=\"line\">10.68.228.107 3306 ALL   Cluster: outbound|3306||mysql-server.demo1.svc.cluster.local</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p> , 3306cluster <code>outbound|3306||mysql-server.demo1.svc.cluster.local</code></p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;envoy.filters.network.tcp_proxy&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">&quot;typedConfig&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">&quot;@type&quot;</span>: <span class=\"string\">&quot;type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;statPrefix&quot;</span>: <span class=\"string\">&quot;outbound|3306||mysql-server.demo1.svc.cluster.local&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;cluster&quot;</span>: <span class=\"string\">&quot;outbound|3306||mysql-server.demo1.svc.cluster.local&quot;</span>,</span><br><span class=\"line\">        <span class=\"attr\">&quot;accessLog&quot;</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;envoy.access_loggers.file&quot;</span>,</span><br><span class=\"line\">                <span class=\"attr\">&quot;typedConfig&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">&quot;@type&quot;</span>: <span class=\"string\">&quot;type.googleapis.com/envoy.extensions.access_loggers.file.v3.FileAccessLog&quot;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/dev/stdout&quot;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">&quot;logFormat&quot;</span>: &#123;</span><br><span class=\"line\">                        <span class=\"attr\">&quot;textFormat&quot;</span>: <span class=\"string\">&quot;[%START_TIME%] \\&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% %RESPONSE_CODE_DETAILS% %CONNECTION_TERMINATION_DETAILS% \\&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \\&quot;%REQ(X-FORWARDED-FOR)%\\&quot; \\&quot;%REQ(USER-AGENT)%\\&quot; \\&quot;%REQ(X-REQUEST-ID)%\\&quot; \\&quot;%REQ(:AUTHORITY)%\\&quot; \\&quot;%UPSTREAM_HOST%\\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\\n&quot;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n<p>podcluster</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ stioctl pc cluster mysql-client-b7db8cc46-99cx5 --fqdn <span class=\"string\">&quot;outbound|3306||mysql-server.demo1.svc.cluster.local&quot;</span> -o json</span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;transportSocketMatches&quot;</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;tlsMode-istio&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;match&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;tlsMode&quot;</span>: <span class=\"string\">&quot;istio&quot;</span></span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;transportSocket&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;envoy.transport_sockets.tls&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;typedConfig&quot;</span>: &#123;</span><br><span class=\"line\">                        <span class=\"string\">&quot;@type&quot;</span>: <span class=\"string\">&quot;type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.UpstreamTlsContext&quot;</span>,</span><br><span class=\"line\">                        <span class=\"string\">&quot;commonTlsContext&quot;</span>: &#123;</span><br><span class=\"line\">                            <span class=\"string\">&quot;tlsCertificateSdsSecretConfigs&quot;</span>: [</span><br><span class=\"line\">                                &#123;</span><br><span class=\"line\">                                    <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;default&quot;</span>,</span><br><span class=\"line\">                                    <span class=\"string\">&quot;sdsConfig&quot;</span>: &#123;</span><br><span class=\"line\">                                        <span class=\"string\">&quot;apiConfigSource&quot;</span>: &#123;</span><br><span class=\"line\">                                            <span class=\"string\">&quot;apiType&quot;</span>: <span class=\"string\">&quot;GRPC&quot;</span>,</span><br><span class=\"line\">                                            <span class=\"string\">&quot;transportApiVersion&quot;</span>: <span class=\"string\">&quot;V3&quot;</span>,</span><br><span class=\"line\">                                            <span class=\"string\">&quot;grpcServices&quot;</span>: [</span><br><span class=\"line\">                                                &#123;</span><br><span class=\"line\">                                                    <span class=\"string\">&quot;envoyGrpc&quot;</span>: &#123;</span><br><span class=\"line\">                                                        <span class=\"string\">&quot;clusterName&quot;</span>: <span class=\"string\">&quot;sds-grpc&quot;</span></span><br><span class=\"line\">                                                    &#125;</span><br><span class=\"line\">                                                &#125;</span><br><span class=\"line\">                                            ],</span><br><span class=\"line\">                                            <span class=\"string\">&quot;setNodeOnFirstMessageOnly&quot;</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">                                        &#125;,</span><br><span class=\"line\">                                        <span class=\"string\">&quot;initialFetchTimeout&quot;</span>: <span class=\"string\">&quot;0s&quot;</span>,</span><br><span class=\"line\">                                        <span class=\"string\">&quot;resourceApiVersion&quot;</span>: <span class=\"string\">&quot;V3&quot;</span></span><br><span class=\"line\">                                    &#125;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            ],</span><br><span class=\"line\">                            <span class=\"string\">&quot;combinedValidationContext&quot;</span>: &#123;</span><br><span class=\"line\">                                <span class=\"string\">&quot;defaultValidationContext&quot;</span>: &#123;</span><br><span class=\"line\">                                    <span class=\"string\">&quot;matchSubjectAltNames&quot;</span>: [</span><br><span class=\"line\">                                        &#123;</span><br><span class=\"line\">                                            <span class=\"string\">&quot;exact&quot;</span>: <span class=\"string\">&quot;spiffe://cluster.local/ns/demo1/sa/default&quot;</span></span><br><span class=\"line\">                                        &#125;</span><br><span class=\"line\">                                    ]</span><br><span class=\"line\">                                &#125;,</span><br><span class=\"line\">                                <span class=\"string\">&quot;validationContextSdsSecretConfig&quot;</span>: &#123;</span><br><span class=\"line\">                                    <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;ROOTCA&quot;</span>,</span><br><span class=\"line\">                                    <span class=\"string\">&quot;sdsConfig&quot;</span>: &#123;</span><br><span class=\"line\">                                        <span class=\"string\">&quot;apiConfigSource&quot;</span>: &#123;</span><br><span class=\"line\">                                            <span class=\"string\">&quot;apiType&quot;</span>: <span class=\"string\">&quot;GRPC&quot;</span>,</span><br><span class=\"line\">                                            <span class=\"string\">&quot;transportApiVersion&quot;</span>: <span class=\"string\">&quot;V3&quot;</span>,</span><br><span class=\"line\">                                            <span class=\"string\">&quot;grpcServices&quot;</span>: [</span><br><span class=\"line\">                                                &#123;</span><br><span class=\"line\">                                                    <span class=\"string\">&quot;envoyGrpc&quot;</span>: &#123;</span><br><span class=\"line\">                                                        <span class=\"string\">&quot;clusterName&quot;</span>: <span class=\"string\">&quot;sds-grpc&quot;</span></span><br><span class=\"line\">                                                    &#125;</span><br><span class=\"line\">                                                &#125;</span><br><span class=\"line\">                                            ],</span><br><span class=\"line\">                                            <span class=\"string\">&quot;setNodeOnFirstMessageOnly&quot;</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">                                        &#125;,</span><br><span class=\"line\">                                        <span class=\"string\">&quot;initialFetchTimeout&quot;</span>: <span class=\"string\">&quot;0s&quot;</span>,</span><br><span class=\"line\">                                        <span class=\"string\">&quot;resourceApiVersion&quot;</span>: <span class=\"string\">&quot;V3&quot;</span></span><br><span class=\"line\">                                    &#125;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;,</span><br><span class=\"line\">                            <span class=\"string\">&quot;alpnProtocols&quot;</span>: [</span><br><span class=\"line\">                                <span class=\"string\">&quot;istio-peer-exchange&quot;</span>,</span><br><span class=\"line\">                                <span class=\"string\">&quot;istio&quot;</span></span><br><span class=\"line\">                            ]</span><br><span class=\"line\">                        &#125;,</span><br><span class=\"line\">                        <span class=\"string\">&quot;sni&quot;</span>: <span class=\"string\">&quot;outbound_.3306_._.mysql-server.demo1.svc.cluster.local&quot;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;tlsMode-disabled&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;match&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;transportSocket&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;envoy.transport_sockets.raw_buffer&quot;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;outbound|3306||mysql-server.demo1.svc.cluster.local&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;type&quot;</span>: <span class=\"string\">&quot;EDS&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;edsClusterConfig&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;edsConfig&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;ads&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;resourceApiVersion&quot;</span>: <span class=\"string\">&quot;V3&quot;</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"string\">&quot;serviceName&quot;</span>: <span class=\"string\">&quot;outbound|3306||mysql-server.demo1.svc.cluster.local&quot;</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;connectTimeout&quot;</span>: <span class=\"string\">&quot;10s&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;circuitBreakers&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;thresholds&quot;</span>: [</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;maxConnections&quot;</span>: 4294967295,</span><br><span class=\"line\">                    <span class=\"string\">&quot;maxPendingRequests&quot;</span>: 4294967295,</span><br><span class=\"line\">                    <span class=\"string\">&quot;maxRequests&quot;</span>: 4294967295,</span><br><span class=\"line\">                    <span class=\"string\">&quot;maxRetries&quot;</span>: 4294967295</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;metadata&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;filterMetadata&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;istio&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;default_original_port&quot;</span>: 3306,</span><br><span class=\"line\">                    <span class=\"string\">&quot;services&quot;</span>: [</span><br><span class=\"line\">                        &#123;</span><br><span class=\"line\">                            <span class=\"string\">&quot;host&quot;</span>: <span class=\"string\">&quot;mysql-server.demo1.svc.cluster.local&quot;</span>,</span><br><span class=\"line\">                            <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;mysql-server&quot;</span>,</span><br><span class=\"line\">                            <span class=\"string\">&quot;namespace&quot;</span>: <span class=\"string\">&quot;demo1&quot;</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    ]</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;filters&quot;</span>: [</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;istio.metadata_exchange&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;typedConfig&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;@type&quot;</span>: <span class=\"string\">&quot;type.googleapis.com/udpa.type.v1.TypedStruct&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;typeUrl&quot;</span>: <span class=\"string\">&quot;type.googleapis.com/envoy.tcp.metadataexchange.config.MetadataExchange&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;value&quot;</span>: &#123;</span><br><span class=\"line\">                        <span class=\"string\">&quot;protocol&quot;</span>: <span class=\"string\">&quot;istio-peer-exchange&quot;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>cluster</p>\n<p>EDSdestination pod, Envoy  <code>outbound|3306||mysql-server.demo1.svc.cluster.local</code></p>\n<p>envoy endpoint <code>outbound|3306||mysql-server.demo1.svc.cluster.local</code> ,  mysql-server pod ip<br>&gt; <code>172.20.0.30</code> </p>\n<p> epsvc <code>endpoint</code><br><img src=\"/2021/08/24/k8s/istio/istio-network/img_2.png\" alt=\"img2.png\"></p>\n<p>, sidecark8s svcpod ip</p>\n<p><img src=\"/2021/08/24/k8s/istio/istio-network/img_1.png\" alt=\"img1.png\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ~  istioctl pc ep mysql-client-b7db8cc46-99cx5 --port 3306</span><br><span class=\"line\">ENDPOINT             STATUS      OUTLIER CHECK     CLUSTER</span><br><span class=\"line\">172.20.0.30:3306     HEALTHY     OK                outbound|3306||mysql-server.demo1.svc.cluster.local</span><br><span class=\"line\"></span><br><span class=\"line\">  ~ k get po -o wide</span><br><span class=\"line\">NAME                            READY   STATUS    RESTARTS   AGE   IP            NODE           NOMINATED NODE   READINESS GATES</span><br><span class=\"line\">mysql-client-b7db8cc46-99cx5    2/2     Running   0          33m   172.20.0.31   10.10.13.118   &lt;none&gt;           &lt;none&gt;</span><br><span class=\"line\">mysql-server-6c845f449b-525q6   2/2     Running   0          33m   172.20.0.30   10.10.13.118   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"mysql\"><a href=\"#mysql\" class=\"headerlink\" title=\"mysql\"></a>mysql</h2><p>,mysql pod(mysql-client-b7db8cc46-99cx5)mysql, mysql-server,  listener</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ ~ kubectl <span class=\"built_in\">exec</span> -it mysql-client-b7db8cc46-99cx5 telnet 10.10.13.110 3306</span><br><span class=\"line\">kubectl <span class=\"built_in\">exec</span> [POD] [COMMAND] is DEPRECATED and will be removed <span class=\"keyword\">in</span> a future version. Use kubectl <span class=\"built_in\">exec</span> [POD] -- [COMMAND] instead.</span><br><span class=\"line\">Defaulted container <span class=\"string\">&quot;mysql&quot;</span> out of: mysql, istio-proxy, istio-init (init)</span><br><span class=\"line\">Connected to 10.10.13.110</span><br><span class=\"line\">J</span><br><span class=\"line\">8.0.26\\r(Juh5kguvqI2<span class=\"string\">&quot;&#125;!caching_sha2_password</span></span><br></pre></td></tr></table></figure>\n\n<p>serviceentry, , </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ~ kubectl <span class=\"built_in\">exec</span> -it mysql-client-b7db8cc46-99cx5 telnet 10.10.13.110 3306</span><br><span class=\"line\">kubectl <span class=\"built_in\">exec</span> [POD] [COMMAND] is DEPRECATED and will be removed <span class=\"keyword\">in</span> a future version. Use kubectl <span class=\"built_in\">exec</span> [POD] -- [COMMAND] instead.</span><br><span class=\"line\">Defaulted container <span class=\"string\">&quot;mysql&quot;</span> out of: mysql, istio-proxy, istio-init (init)</span><br><span class=\"line\">Connected to 10.10.13.110</span><br><span class=\"line\">Connection closed by foreign host</span><br><span class=\"line\"><span class=\"built_in\">command</span> terminated with <span class=\"built_in\">exit</span> code 1</span><br></pre></td></tr></table></figure>\n\n<p>client listener, <code>0.0.0.0</code> , nsse,<br><code>0.0.0.0</code>listener</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ~ istioctl pc listener mysql-client-b7db8cc46-99cx5 --port 3306</span><br><span class=\"line\">ADDRESS       PORT MATCH DESTINATION</span><br><span class=\"line\">0.0.0.0       3306 ALL   Cluster: outbound|3306||mysql.demo</span><br><span class=\"line\">10.68.228.107 3306 ALL   Cluster: outbound|3306||mysql-server.demo1.svc.cluster.local</span><br></pre></td></tr></table></figure>\n\n<p>cluster, <code>outbound|3306||mysql.demo</code>, svc, svc</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ~ istioctl pc listener mysql-client-b7db8cc46-99cx5 --port 3306 -o json</span><br><span class=\"line\">        </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">                        <span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;envoy.filters.network.tcp_proxy&quot;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">&quot;typedConfig&quot;</span>: &#123;</span><br><span class=\"line\">                            <span class=\"attr\">&quot;@type&quot;</span>: <span class=\"string\">&quot;type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy&quot;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">&quot;statPrefix&quot;</span>: <span class=\"string\">&quot;outbound|3306||mysql.demo&quot;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">&quot;cluster&quot;</span>: <span class=\"string\">&quot;outbound|3306||mysql.demo&quot;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">&quot;accessLog&quot;</span>: [</span><br><span class=\"line\">                                &#123;</span><br><span class=\"line\">                                    <span class=\"attr\">&quot;name&quot;</span>: <span class=\"string\">&quot;envoy.access_loggers.file&quot;</span>,</span><br><span class=\"line\">                                    <span class=\"attr\">&quot;typedConfig&quot;</span>: &#123;</span><br><span class=\"line\">                                        <span class=\"attr\">&quot;@type&quot;</span>: <span class=\"string\">&quot;type.googleapis.com/envoy.extensions.access_loggers.file.v3.FileAccessLog&quot;</span>,</span><br><span class=\"line\">                                        <span class=\"attr\">&quot;path&quot;</span>: <span class=\"string\">&quot;/dev/stdout&quot;</span>,</span><br><span class=\"line\">                                        <span class=\"attr\">&quot;logFormat&quot;</span>: &#123;</span><br><span class=\"line\">                                            <span class=\"attr\">&quot;textFormat&quot;</span>: <span class=\"string\">&quot;[%START_TIME%] \\&quot;%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%\\&quot; %RESPONSE_CODE% %RESPONSE_FLAGS% %RESPONSE_CODE_DETAILS% %CONNECTION_TERMINATION_DETAILS% \\&quot;%UPSTREAM_TRANSPORT_FAILURE_REASON%\\&quot; %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% \\&quot;%REQ(X-FORWARDED-FOR)%\\&quot; \\&quot;%REQ(USER-AGENT)%\\&quot; \\&quot;%REQ(X-REQUEST-ID)%\\&quot; \\&quot;%REQ(:AUTHORITY)%\\&quot; \\&quot;%UPSTREAM_HOST%\\&quot; %UPSTREAM_CLUSTER% %UPSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_LOCAL_ADDRESS% %DOWNSTREAM_REMOTE_ADDRESS% %REQUESTED_SERVER_NAME% %ROUTE_NAME%\\n&quot;</span></span><br><span class=\"line\">                                        &#125;</span><br><span class=\"line\">                                    &#125;</span><br></pre></td></tr></table></figure>\n\n<p>serviceentry namespace </p>\n<h3 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h3><ol>\n<li>sidecar crd</li>\n</ol>\n<p>serviceentry namespace sidecardemo1<br>sidecar istio-system</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.istio.io/v1beta1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Sidecar</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">default</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">demo1</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">egress:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">hosts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">&quot;./*&quot;</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">&quot;istio-system/*&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>sidecar mysql-client podlistener, 0.0.0.0 mysql-client mysql</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\"></span>  <span class=\"string\">~</span> <span class=\"string\">istioctl</span> <span class=\"string\">pc</span>  <span class=\"string\">listener</span> <span class=\"string\">mysql-client-b7db8cc46-99cx5</span> <span class=\"string\">--port</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"string\">ADDRESS</span>       <span class=\"string\">PORT</span> <span class=\"string\">MATCH</span> <span class=\"string\">DESTINATION</span></span><br><span class=\"line\"><span class=\"attr\">10.68.228.107 3306 ALL   Cluster:</span> <span class=\"string\">outbound|3306||mysql-server.demo1.svc.cluster.local</span></span><br><span class=\"line\"><span class=\"attr\">10.68.66.97   3306 ALL   Cluster:</span> <span class=\"string\">outbound|3306||mysql-client.demo1.svc.cluster.local</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\"></span>  <span class=\"string\">~</span> <span class=\"string\">kubectl</span> <span class=\"string\">exec</span> <span class=\"string\">-it</span> <span class=\"string\">mysql-client-b7db8cc46-99cx5</span> <span class=\"string\">telnet</span> <span class=\"number\">10.10</span><span class=\"number\">.13</span><span class=\"number\">.110</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"string\">kubectl</span> <span class=\"string\">exec</span> [<span class=\"string\">POD</span>] [<span class=\"string\">COMMAND</span>] <span class=\"string\">is</span> <span class=\"string\">DEPRECATED</span> <span class=\"string\">and</span> <span class=\"string\">will</span> <span class=\"string\">be</span> <span class=\"string\">removed</span> <span class=\"string\">in</span> <span class=\"string\">a</span> <span class=\"string\">future</span> <span class=\"string\">version.</span> <span class=\"string\">Use</span> <span class=\"string\">kubectl</span> <span class=\"string\">exec</span> [<span class=\"string\">POD</span>] <span class=\"string\">--</span> [<span class=\"string\">COMMAND</span>] <span class=\"string\">instead.</span></span><br><span class=\"line\"><span class=\"string\">Defaulted</span> <span class=\"string\">container</span> <span class=\"string\">&quot;mysql&quot;</span> <span class=\"attr\">out of:</span> <span class=\"string\">mysql,</span> <span class=\"string\">istio-proxy,</span> <span class=\"string\">istio-init</span> <span class=\"string\">(init)</span></span><br><span class=\"line\"><span class=\"string\">Connected</span> <span class=\"string\">to</span> <span class=\"number\">10.10</span><span class=\"number\">.13</span><span class=\"number\">.110</span></span><br><span class=\"line\"><span class=\"string\">J</span></span><br><span class=\"line\"><span class=\"string\">B5&gt;I=6s=E6,&amp;M&#125;Qcaching_sha2_password</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">!#08S01Got</span> <span class=\"string\">packets</span> <span class=\"string\">out</span> <span class=\"string\">of</span> <span class=\"string\">orderConnection</span> <span class=\"string\">closed</span> <span class=\"string\">by</span> <span class=\"string\">foreign</span> <span class=\"string\">host</span></span><br><span class=\"line\"><span class=\"string\">command</span> <span class=\"string\">terminated</span> <span class=\"string\">with</span> <span class=\"string\">exit</span> <span class=\"string\">code</span> <span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n\n\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>semysqlport 0.0.0.0 3306 </p>\n<ol start=\"3\">\n<li>dns</li>\n</ol>\n<p>istioistio dns,istio1.8.</p>\n<p>istioiop</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">meshConfig:</span></span><br><span class=\"line\">  <span class=\"attr\">accessLogFile:</span> <span class=\"string\">/dev/stdout</span></span><br><span class=\"line\">  <span class=\"attr\">defaultConfig:</span></span><br><span class=\"line\">    <span class=\"attr\">proxyMetadata:</span></span><br><span class=\"line\">      <span class=\"attr\">ISTIO_META_DNS_CAPTURE:</span> <span class=\"string\">&quot;true&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>seaddress  mysql.demo122 hostip</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiVersion:</span> <span class=\"string\">networking.istio.io/v1beta1</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ServiceEntry</span></span><br><span class=\"line\">  <span class=\"attr\">metadata:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">mysql</span></span><br><span class=\"line\">    <span class=\"attr\">namespace:</span> <span class=\"string\">demo</span></span><br><span class=\"line\">  <span class=\"attr\">spec:</span></span><br><span class=\"line\">    <span class=\"attr\">addresses:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"number\">240.0</span><span class=\"number\">.221</span><span class=\"number\">.130</span></span><br><span class=\"line\">    <span class=\"attr\">hosts:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">mysql.demo122</span></span><br><span class=\"line\">    <span class=\"attr\">location:</span> <span class=\"string\">MESH_INTERNAL</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">tcp</span></span><br><span class=\"line\">      <span class=\"attr\">number:</span> <span class=\"number\">3306</span></span><br><span class=\"line\">      <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">      <span class=\"attr\">targetPort:</span> <span class=\"number\">3306</span></span><br><span class=\"line\">    <span class=\"attr\">resolution:</span> <span class=\"string\">STATIC</span></span><br></pre></td></tr></table></figure>\n\n<p>serviceentry mysql-clienthost<code>240.0.221.130</code>ip</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  ~ kubectl <span class=\"built_in\">exec</span> -it mysql-client-b7db8cc46-99cx5 ping mysql.demo122</span><br><span class=\"line\">kubectl <span class=\"built_in\">exec</span> [POD] [COMMAND] is DEPRECATED and will be removed <span class=\"keyword\">in</span> a future version. Use kubectl <span class=\"built_in\">exec</span> [POD] -- [COMMAND] instead.</span><br><span class=\"line\">Defaulted container <span class=\"string\">&quot;mysql&quot;</span> out of: mysql, istio-proxy, istio-init (init)</span><br><span class=\"line\">PING mysql.demo122 (240.0.221.130) 56(84) bytes of data.</span><br></pre></td></tr></table></figure>\n\n<p>mysql-client-b7db8cc46-99cx50.0.0.0  <code>240.0.221.130 3306 ALL   Cluster: outbound|3306||mysql.demo122</code>mysql0.0.0.0</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\"></span>  <span class=\"string\">~</span> <span class=\"string\">istioctl</span> <span class=\"string\">pc</span>  <span class=\"string\">listener</span> <span class=\"string\">mysql-client-b7db8cc46-99cx5</span> <span class=\"string\">--port</span> <span class=\"number\">3306</span></span><br><span class=\"line\"><span class=\"string\">ADDRESS</span>       <span class=\"string\">PORT</span> <span class=\"string\">MATCH</span> <span class=\"string\">DESTINATION</span></span><br><span class=\"line\"><span class=\"attr\">10.68.228.107 3306 ALL   Cluster:</span> <span class=\"string\">outbound|3306||mysql-server.demo1.svc.cluster.local</span></span><br><span class=\"line\"><span class=\"attr\">10.68.66.97   3306 ALL   Cluster:</span> <span class=\"string\">outbound|3306||mysql-client.demo1.svc.cluster.local</span></span><br><span class=\"line\"><span class=\"attr\">240.0.221.130 3306 ALL   Cluster:</span> <span class=\"string\">outbound|3306||mysql.demo122</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>, </p>\n<ol>\n<li>namespace sidecar, envoy, </li>\n<li>serivceentry</li>\n</ol>\n"}],"PostAsset":[{"_id":"source/_posts/analysis/bookinfo.png","slug":"bookinfo.png","post":"ckthfc0ct000fsmjrc2lcefkq","modified":0,"renderable":0},{"_id":"source/_posts/analysis/iptables.png","slug":"iptables.png","post":"ckthfc0ct000fsmjrc2lcefkq","modified":0,"renderable":0},{"_id":"source/_posts/go-gc/go-heap/img.png","slug":"go-heap/img.png","post":"ckthfc0co0006smjrgpi378wo","modified":0,"renderable":0},{"_id":"source/_posts/go-gc/go-heap/img1.png","slug":"go-heap/img1.png","post":"ckthfc0co0006smjrgpi378wo","modified":0,"renderable":0},{"_id":"source/_posts/go-gc/go-heap/img2.png","slug":"go-heap/img2.png","post":"ckthfc0co0006smjrgpi378wo","modified":0,"renderable":0},{"_id":"source/_posts/linux/namespace/img.png","slug":"img.png","post":"ckthfc0d2000ysmjrghfj4gar","modified":0,"renderable":0},{"_id":"source/_posts/linux/namespace/img_2.png","slug":"img_2.png","post":"ckthfc0d2000ysmjrghfj4gar","modified":0,"renderable":0},{"_id":"source/_posts/linux/namespace/img_3.png","slug":"img_3.png","post":"ckthfc0d2000ysmjrghfj4gar","modified":0,"renderable":0},{"_id":"source/_posts/k8s/istio/debug-istio/img.png","slug":"img.png","post":"ckthfc0d50015smjr9g9c1buv","modified":0,"renderable":0},{"_id":"source/_posts/k8s/istio/debug-istio/img_1.png","slug":"img_1.png","post":"ckthfc0d50015smjr9g9c1buv","modified":0,"renderable":0},{"_id":"source/_posts/k8s/istio/debug-istio/img_2.png","slug":"img_2.png","post":"ckthfc0d50015smjr9g9c1buv","modified":0,"renderable":0},{"_id":"source/_posts/k8s/istio/istio-network/img_1.png","slug":"img_1.png","post":"ckthfc0dp002esmjr8ujf5j7w","modified":0,"renderable":0},{"_id":"source/_posts/k8s/istio/istio-network/img_2.png","slug":"img_2.png","post":"ckthfc0dp002esmjr8ujf5j7w","modified":0,"renderable":0},{"_id":"source/_posts/go-gc/go-heap.md","post":"ckthfc0co0006smjrgpi378wo","slug":"go-heap.md","modified":1,"renderable":1},{"_id":"source/_posts/go-gc/go-heap2.md","post":"ckthfc0co0006smjrgpi378wo","slug":"go-heap2.md","modified":1,"renderable":1},{"_id":"source/_posts/go-gc/go-heap2/img4.png","slug":"go-heap2/img4.png","post":"ckthfc0co0006smjrgpi378wo","modified":0,"renderable":0},{"_id":"source/_posts/go-gc/go-heap2/img5.png","slug":"go-heap2/img5.png","post":"ckthfc0co0006smjrgpi378wo","modified":0,"renderable":0},{"_id":"source/_posts/go-gc/go-heap2/img6.png","slug":"go-heap2/img6.png","post":"ckthfc0co0006smjrgpi378wo","modified":0,"renderable":0},{"_id":"source/_posts/go-gc/go-heap2/img8.png","slug":"go-heap2/img8.png","post":"ckthfc0co0006smjrgpi378wo","modified":0,"renderable":0}],"PostCategory":[{"post_id":"ckthfc0cz000ssmjr2w6b6hqk","category_id":"ckthfc0d1000wsmjrbhns05j8","_id":"ckthfc0d50016smjre5ludcwn"}],"PostTag":[{"post_id":"ckthfc0cj0002smjr4sgi4er4","tag_id":"ckthfc0cl0004smjrghizht6q","_id":"ckthfc0cp0009smjrax198e94"},{"post_id":"ckthfc0cl0003smjr9y3lauip","tag_id":"ckthfc0cp0008smjr5rep13ca","_id":"ckthfc0cs000esmjr5vocgcyy"},{"post_id":"ckthfc0cs000dsmjr1doy7zqn","tag_id":"ckthfc0cl0004smjrghizht6q","_id":"ckthfc0cu000hsmjr878c6pwg"},{"post_id":"ckthfc0cn0005smjr2ggn2kze","tag_id":"ckthfc0cl0004smjrghizht6q","_id":"ckthfc0cv000jsmjrewhb0z2d"},{"post_id":"ckthfc0co0006smjrgpi378wo","tag_id":"ckthfc0ct000gsmjrg3nz2mdr","_id":"ckthfc0cx000nsmjr6h9cfc8h"},{"post_id":"ckthfc0co0007smjr7u8p8g5j","tag_id":"ckthfc0ct000gsmjrg3nz2mdr","_id":"ckthfc0cz000rsmjr58si1ayp"},{"post_id":"ckthfc0cq000bsmjr9snx7pql","tag_id":"ckthfc0cy000psmjr3wh84ofg","_id":"ckthfc0d1000vsmjrbb5s46ta"},{"post_id":"ckthfc0ct000fsmjrc2lcefkq","tag_id":"ckthfc0d0000tsmjrcqkhf9hk","_id":"ckthfc0d30010smjrdh4bfdmw"},{"post_id":"ckthfc0d30011smjrctf8hhz8","tag_id":"ckthfc0cl0004smjrghizht6q","_id":"ckthfc0d50014smjrg968ezop"},{"post_id":"ckthfc0cu000ismjrfzridd9g","tag_id":"ckthfc0d3000zsmjrf8vkcwvg","_id":"ckthfc0d60017smjr8my6c7ws"},{"post_id":"ckthfc0cv000ksmjrf2te51ms","tag_id":"ckthfc0d3000zsmjrf8vkcwvg","_id":"ckthfc0d7001bsmjr56vcayec"},{"post_id":"ckthfc0cw000msmjra3xc6f09","tag_id":"ckthfc0d60019smjraq9fazoh","_id":"ckthfc0d9001fsmjrhrzdgk7s"},{"post_id":"ckthfc0cx000osmjrhmk17jwm","tag_id":"ckthfc0cy000psmjr3wh84ofg","_id":"ckthfc0db001jsmjr3oxvbybo"},{"post_id":"ckthfc0cy000qsmjr2thjfk4m","tag_id":"ckthfc0d60019smjraq9fazoh","_id":"ckthfc0dc001nsmjr96bm74c2"},{"post_id":"ckthfc0cz000ssmjr2w6b6hqk","tag_id":"ckthfc0cy000psmjr3wh84ofg","_id":"ckthfc0de001rsmjr3lgcadzf"},{"post_id":"ckthfc0cz000ssmjr2w6b6hqk","tag_id":"ckthfc0db001lsmjrhec2aeyg","_id":"ckthfc0de001tsmjrfgglftj2"},{"post_id":"ckthfc0d0000usmjr5in39oyo","tag_id":"ckthfc0cl0004smjrghizht6q","_id":"ckthfc0dh001wsmjr09byatwj"},{"post_id":"ckthfc0d0000usmjr5in39oyo","tag_id":"ckthfc0dd001psmjr7wjo5oc4","_id":"ckthfc0dh001ysmjrgrh15g7b"},{"post_id":"ckthfc0d2000xsmjr23154t3q","tag_id":"ckthfc0cl0004smjrghizht6q","_id":"ckthfc0dj0022smjrd9a43s42"},{"post_id":"ckthfc0d2000xsmjr23154t3q","tag_id":"ckthfc0df001vsmjren7n85j2","_id":"ckthfc0dj0023smjrh5x7ag2q"},{"post_id":"ckthfc0d2000ysmjrghfj4gar","tag_id":"ckthfc0cl0004smjrghizht6q","_id":"ckthfc0dk0025smjrbnuk95qd"},{"post_id":"ckthfc0d2000ysmjrghfj4gar","tag_id":"ckthfc0dd001psmjr7wjo5oc4","_id":"ckthfc0dk0026smjrc3124qg9"},{"post_id":"ckthfc0d40012smjr5qnz7fvq","tag_id":"ckthfc0cl0004smjrghizht6q","_id":"ckthfc0dk0028smjraz109blb"},{"post_id":"ckthfc0d40012smjr5qnz7fvq","tag_id":"ckthfc0dj0024smjrfqzi4if3","_id":"ckthfc0dk0029smjre0hdbkej"},{"post_id":"ckthfc0d50015smjr9g9c1buv","tag_id":"ckthfc0cy000psmjr3wh84ofg","_id":"ckthfc0dk002asmjr6cgjd8oh"},{"post_id":"ckthfc0d50015smjr9g9c1buv","tag_id":"ckthfc0dk0027smjratv35kva","_id":"ckthfc0dk002bsmjr8d0i9mso"},{"post_id":"ckthfc0do002dsmjre5x6g2dc","tag_id":"ckthfc0d60019smjraq9fazoh","_id":"ckthfc0dq002fsmjr9gxo9d2e"},{"post_id":"ckthfc0do002dsmjre5x6g2dc","tag_id":"ckthfc0cy000psmjr3wh84ofg","_id":"ckthfc0dq002gsmjr6ygebt5z"},{"post_id":"ckthfc0dp002esmjr8ujf5j7w","tag_id":"ckthfc0cy000psmjr3wh84ofg","_id":"ckthfc0dq002hsmjrhxzy1pq5"},{"post_id":"ckthfc0dp002esmjr8ujf5j7w","tag_id":"ckthfc0dk0027smjratv35kva","_id":"ckthfc0dq002ismjr3uwn7cc8"}],"Tag":[{"name":"linux","_id":"ckthfc0cl0004smjrghizht6q"},{"name":"docker","_id":"ckthfc0cp0008smjr5rep13ca"},{"name":"golang","_id":"ckthfc0ct000gsmjrg3nz2mdr"},{"name":"istio","_id":"ckthfc0cy000psmjr3wh84ofg"},{"name":"iptables","_id":"ckthfc0d0000tsmjrcqkhf9hk"},{"name":"go","_id":"ckthfc0d3000zsmjrf8vkcwvg"},{"name":"kubernetes","_id":"ckthfc0d60019smjraq9fazoh"},{"name":"kiali","_id":"ckthfc0db001lsmjrhec2aeyg"},{"name":"kernal","_id":"ckthfc0dd001psmjr7wjo5oc4"},{"name":"kernel","_id":"ckthfc0df001vsmjren7n85j2"},{"name":"network","_id":"ckthfc0dj0024smjrfqzi4if3"},{"name":"k8s","_id":"ckthfc0dk0027smjratv35kva"}]}}